---
title: "Przegląd architektury replikacji maszyn wirtualnych VMware do platformy Azure | Dokumentacja firmy Microsoft"
description: "Ten artykuł zawiera omówienie składników i architektury używane podczas replikowania lokalnych maszyn wirtualnych VMware do platformy Azure z usługą Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27.017
ms.author: raynew
ms.openlocfilehash: 4aae04a793bab11562c20ceec0e1ae8f1a035a0f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-vmware-replication-to-azure"></a><span data-ttu-id="e77c6-103">Krok 1: Przejrzyj architekturę replikacji maszyn wirtualnych VMware do platformy Azure</span><span class="sxs-lookup"><span data-stu-id="e77c6-103">Step 1: Review the architecture for VMware replication to Azure</span></span>

<span data-ttu-id="e77c6-104">W tym artykule opisano składniki i procesy użyty podczas replikowania maszyn wirtualnych VMware lokalnego do platformy Azure przy użyciu [usługi Azure Site Recovery](site-recovery-overview.md) usługi.</span><span class="sxs-lookup"><span data-stu-id="e77c6-104">This article describes the components and processes used when replicating on-premises VMware virtual machines to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="e77c6-105">Wszelkie komentarze umieszczaj pod tym artykułem lub zadawaj pytania na [Forum usług Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="e77c6-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="e77c6-106">Składniki architektury</span><span class="sxs-lookup"><span data-stu-id="e77c6-106">Architectural components</span></span>

<span data-ttu-id="e77c6-107">W tabeli przedstawiono składniki, które są potrzebne.</span><span class="sxs-lookup"><span data-stu-id="e77c6-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="e77c6-108">**Składnik**</span><span class="sxs-lookup"><span data-stu-id="e77c6-108">**Component**</span></span> | <span data-ttu-id="e77c6-109">**Wymaganie**</span><span class="sxs-lookup"><span data-stu-id="e77c6-109">**Requirement**</span></span> | <span data-ttu-id="e77c6-110">**Szczegóły**</span><span class="sxs-lookup"><span data-stu-id="e77c6-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="e77c6-111">**Azure**</span><span class="sxs-lookup"><span data-stu-id="e77c6-111">**Azure**</span></span> | <span data-ttu-id="e77c6-112">Potrzebujesz subskrypcji platformy Azure, konto usługi Azure storage i sieć platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-112">You need an Azure subscription, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="e77c6-113">Replikowane dane są przechowywane na koncie magazynu.</span><span class="sxs-lookup"><span data-stu-id="e77c6-113">Replicated data is stored in the storage account.</span></span> <span data-ttu-id="e77c6-114">Maszyny wirtualne platformy Azure są tworzone przy użyciu zreplikowanych danych podczas pracy awaryjnej z lokacji lokalnej.</span><span class="sxs-lookup"><span data-stu-id="e77c6-114">Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="e77c6-115">Maszyny wirtualne platformy Azure nawiązują połączenie z siecią wirtualną platformy Azure, gdy są tworzone.</span><span class="sxs-lookup"><span data-stu-id="e77c6-115">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="e77c6-116">**Serwer konfiguracji**</span><span class="sxs-lookup"><span data-stu-id="e77c6-116">**Configuration server**</span></span> | <span data-ttu-id="e77c6-117">Jeden serwer zarządzania (maszyna wirtualna oprogramowania VMware) uruchamia wszystkie lokalną składnikami usługi Site Recovery dla wdrożenia na lokalny.</span><span class="sxs-lookup"><span data-stu-id="e77c6-117">A single on-premises management server (VMware VM) that runs all the on-premises Site Recovery components for the deployment.</span></span> <span data-ttu-id="e77c6-118">Należą do konfiguracji serwera, serwer przetwarzania, główny serwer docelowy.</span><span class="sxs-lookup"><span data-stu-id="e77c6-118">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="e77c6-119">Składnik serwera konfiguracji służy do koordynowania komunikacji między środowiskiem lokalnym i platformą Azure oraz do zarządzania replikacją danych.</span><span class="sxs-lookup"><span data-stu-id="e77c6-119">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="e77c6-120">**Serwer przetwarzania**:</span><span class="sxs-lookup"><span data-stu-id="e77c6-120">**Process server**:</span></span>  | <span data-ttu-id="e77c6-121">Domyślnie instalowany na serwerze konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-121">Installed by default on the configuration server.</span></span> | <span data-ttu-id="e77c6-122">Działa jako brama replikacji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-122">Acts as a replication gateway.</span></span> <span data-ttu-id="e77c6-123">Odbiera dane replikacji, optymalizuje je przy użyciu pamięci podręcznej, kompresji i szyfrowania, a następnie wysyła je do usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="e77c6-123">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="e77c6-124">Serwer przetwarzania obsługuje także instalację wypychaną usługi Mobility na chronionych maszynach i przeprowadza automatyczne odnajdywanie maszyn wirtualnych programu VMware.</span><span class="sxs-lookup"><span data-stu-id="e77c6-124">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="e77c6-125">Wraz z rozwojem wdrożenia możliwe będzie dodawanie dodatkowych oddzielnych dedykowanych serwerów przetwarzania w celu obsługi coraz większej ilości danych związanych z ruchem replikacji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-125">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="e77c6-126">**Główny serwer docelowy**</span><span class="sxs-lookup"><span data-stu-id="e77c6-126">**Master target server**</span></span> | <span data-ttu-id="e77c6-127">Instalowany domyślnie na lokalnym serwerze konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-127">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="e77c6-128">Służy do obsługi replikacji danych podczas powrotu po awarii z platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-128">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="e77c6-129">W przypadku dużego ruchu powrotu po awarii można wdrożyć oddzielny główny serwer docelowy na potrzeby obsługi powrotu po awarii.</span><span class="sxs-lookup"><span data-stu-id="e77c6-129">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="e77c6-130">**Serwery VMware**</span><span class="sxs-lookup"><span data-stu-id="e77c6-130">**VMware servers**</span></span> | <span data-ttu-id="e77c6-131">Maszyny wirtualne programu VMware są hostowane na serwerach vSphere ESXi. Zalecamy użycie serwera vCenter do zarządzania hostami.</span><span class="sxs-lookup"><span data-stu-id="e77c6-131">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="e77c6-132">Serwery VMware są dodawane do magazynu usługi Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="e77c6-132">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="e77c6-133">**Zreplikowane maszyny**</span><span class="sxs-lookup"><span data-stu-id="e77c6-133">**Replicated machines**</span></span> | <span data-ttu-id="e77c6-134">Będzie można zainstalować usługi mobilności na każdej maszynie Wirtualnej VMware, replikacji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-134">The Mobility service will be installed on each VMware VM you replicate.</span></span> <span data-ttu-id="e77c6-135">Można ją zainstalować ręcznie na poszczególnych maszynach lub za pośrednictwem instalacji wypychanej z serwera przetwarzania.</span><span class="sxs-lookup"><span data-stu-id="e77c6-135">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="e77c6-136">**Rysunek 1: Składniki replikacji z oprogramowania VMware na platformę Azure**</span><span class="sxs-lookup"><span data-stu-id="e77c6-136">**Figure 1: VMware to Azure components**</span></span>

![Składniki](./media/vmware-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="e77c6-138">Proces replikacji</span><span class="sxs-lookup"><span data-stu-id="e77c6-138">Replication process</span></span>

1. <span data-ttu-id="e77c6-139">Konfigurowanie wdrożenia, łącznie z lokalnymi i składniki platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-139">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="e77c6-140">W magazynie usług odzyskiwania Określ replikacji źródłowych i docelowych, skonfiguruj serwer konfiguracji Utwórz zasady replikacji, wdrażanie usługi mobilności, Włącz replikację i testować tryb failover.</span><span class="sxs-lookup"><span data-stu-id="e77c6-140">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2. <span data-ttu-id="e77c6-141">Replikacja maszyny, zgodnie z zasadami replikacji i początkowej kopii danych są replikowane do magazynu Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-141">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
3. <span data-ttu-id="e77c6-142">Po zakończeniu replikacji początkowej, rozpoczyna replikację zmian różnicowych na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-142">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="e77c6-143">Śledzone zmiany dla maszyny są przechowywane w pliku hrl.</span><span class="sxs-lookup"><span data-stu-id="e77c6-143">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="e77c6-144">Na potrzeby zarządzania replikacją replikowane maszyny komunikują się z serwerem konfiguracji na porcie HTTPS 443 dla danych przychodzących.</span><span class="sxs-lookup"><span data-stu-id="e77c6-144">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="e77c6-145">Maszyn replikowanych wysyłanie danych replikacji na serwer przetwarzania na porcie HTTPS 9443 dla ruchu przychodzącego (może być modyfikowany).</span><span class="sxs-lookup"><span data-stu-id="e77c6-145">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="e77c6-146">Serwer konfiguracji synchronizuje replikację z platformą Azure za pośrednictwem portu HTTPS 443 dla danych wychodzących.</span><span class="sxs-lookup"><span data-stu-id="e77c6-146">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="e77c6-147">Serwer przetwarzania odbiera dane z maszyn źródłowych, optymalizuje je i szyfruje, a następnie wysyła do usługi Azure Storage za pośrednictwem portu 443 dla danych wychodzących.</span><span class="sxs-lookup"><span data-stu-id="e77c6-147">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="e77c6-148">Jeśli włączono spójność wielu maszyn wirtualnych, maszyny z grupy replikacji komunikują się między sobą na porcie 20004.</span><span class="sxs-lookup"><span data-stu-id="e77c6-148">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="e77c6-149">Funkcja spójności wielu maszyn wirtualnych jest używana, jeśli wiele maszyn zostanie połączonych w grupę replikacji, która współużytkuje punkty odzyskiwania spójne na poziomie awarii i aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-149">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="e77c6-150">Jest to przydatne, jeśli maszyny obsługują to samo obciążenie i muszą być spójne.</span><span class="sxs-lookup"><span data-stu-id="e77c6-150">This is useful if machines are running the same workload and need to be consistent.</span></span>
4. <span data-ttu-id="e77c6-151">Ruch jest replikowany do publicznych punktów końcowych usługi Azure Storage za pośrednictwem Internetu.</span><span class="sxs-lookup"><span data-stu-id="e77c6-151">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="e77c6-152">Alternatywnie można użyć [publicznej komunikacji równorzędnej](../expressroute/expressroute-circuit-peerings.md#public-peering) usługi Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e77c6-152">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="e77c6-153">Replikowanie ruchu za pośrednictwem sieci VPN typu lokacja-lokacja z lokacji lokalnej platformy Azure nie jest obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="e77c6-153">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>


<span data-ttu-id="e77c6-154">**Rysunek 2: Replikacja z oprogramowania VMware na platformę Azure**</span><span class="sxs-lookup"><span data-stu-id="e77c6-154">**Figure 2: VMware to Azure replication**</span></span>

![Rozszerzone](./media/vmware-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="e77c6-156">Proces pracy w trybie failover i podczas powrotu po awarii</span><span class="sxs-lookup"><span data-stu-id="e77c6-156">Failover and failback process</span></span>

1. <span data-ttu-id="e77c6-157">Po upewnieniu się, że testowe przełączenie w tryb failover działa zgodnie z oczekiwaniami, możesz uruchamiać niezaplanowane przełączenia w tryb failover na platformę Azure zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="e77c6-157">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="e77c6-158">Planowane przejście w tryb failover nie jest obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="e77c6-158">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="e77c6-159">W tryb failover możesz przełączyć pojedynczą maszynę lub możesz utworzyć [plany odzyskiwania](site-recovery-create-recovery-plans.md), aby przełączyć wiele maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="e77c6-159">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="e77c6-160">Po przejściu w tryb failover na platformie Azure zostaną utworzone repliki maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="e77c6-160">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="e77c6-161">Po zatwierdzeniu trybu failover można rozpocząć uzyskiwanie dostępu do obciążenia z poziomu repliki maszyny wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-161">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="e77c6-162">Po ponownym udostępnieniu głównej lokacji lokalnej można do niej powrócić po awarii.</span><span class="sxs-lookup"><span data-stu-id="e77c6-162">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="e77c6-163">Należy skonfigurować infrastrukturę powrotu po awarii, uruchomić replikację maszyny z lokacji dodatkowej do lokacji głównej i uruchomić nieplanowane przejście w tryb failover z lokacji dodatkowej.</span><span class="sxs-lookup"><span data-stu-id="e77c6-163">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="e77c6-164">Po zatwierdzeniu pracy w trybie failover dane będą znowu dostępne lokalnie i konieczne będzie ponowne włączenie replikacji do platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-164">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="e77c6-165">Dowiedz się więcej</span><span class="sxs-lookup"><span data-stu-id="e77c6-165">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="e77c6-166">Istnieje kilka wymagań powrotu po awarii:</span><span class="sxs-lookup"><span data-stu-id="e77c6-166">There are a few failback requirements:</span></span>


- <span data-ttu-id="e77c6-167">**Tymczasowy serwer przetwarzania na platformie Azure**: jeśli chcesz powrócić po awarii z platformy Azure po przejściu w tryb failover, konieczne będzie skonfigurowanie maszyny wirtualnej platformy Azure jako serwera przetwarzania do obsługi replikacji z platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-167">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="e77c6-168">Po zakończeniu powrotu po awarii można usunąć tę maszynę wirtualną.</span><span class="sxs-lookup"><span data-stu-id="e77c6-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="e77c6-169">**Połączenie VPN**: na potrzeby powrotu po awarii będzie potrzebne połączenie VPN (lub usługa Azure ExpressRoute) skonfigurowane z sieci platformy Azure do lokacji lokalnej.</span><span class="sxs-lookup"><span data-stu-id="e77c6-169">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="e77c6-170">**Oddzielny lokalny główny serwer docelowy**: lokalny główny serwer docelowy obsługuje powrót po awarii.</span><span class="sxs-lookup"><span data-stu-id="e77c6-170">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="e77c6-171">Główny serwer docelowy jest instalowany domyślnie na serwerze zarządzania, ale w przypadku powrotu po awarii większych ilości ruchu należy skonfigurować oddzielny lokalny główny serwer docelowy.</span><span class="sxs-lookup"><span data-stu-id="e77c6-171">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="e77c6-172">**Zasady powrotu po awarii**: aby móc przeprowadzić ponowną replikację do lokacji lokalnej, należy utworzyć zasady powrotu po awarii.</span><span class="sxs-lookup"><span data-stu-id="e77c6-172">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="e77c6-173">Są one tworzone automatycznie podczas tworzenia zasad replikacji.</span><span class="sxs-lookup"><span data-stu-id="e77c6-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="e77c6-174">**Infrastruktura VMware**: musisz wykonać powrót po awarii do lokalnej maszyny wirtualnej programu VMware.</span><span class="sxs-lookup"><span data-stu-id="e77c6-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="e77c6-175">Oznacza to, że wymagana jest lokalna infrastruktura VMware, nawet jeśli replikujesz lokalne serwery fizyczne do platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e77c6-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="e77c6-176">**Rysunek 3: Powrót po awarii między oprogramowaniem VMware i serwerem fizycznym**</span><span class="sxs-lookup"><span data-stu-id="e77c6-176">**Figure 3: VMware/physical failback**</span></span>

![Powrót po awarii](./media/vmware-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="e77c6-178">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="e77c6-178">Next steps</span></span>

<span data-ttu-id="e77c6-179">Przejdź do [krok 2: Sprawdź wymagania wstępne i ograniczenia](vmware-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="e77c6-179">Go to [Step 2: Verify prerequisites and limitations](vmware-walkthrough-prerequisites.md)</span></span>
