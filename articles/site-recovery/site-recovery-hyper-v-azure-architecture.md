---
title: "Jak działa replikacja funkcji Hyper-V do platformy Azure w usłudze Site Recovery? | Microsoft Docs"
description: "Ten artykuł zawiera omówienie sposobu działania replikacji funkcji Hyper-V w usłudze Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: 6fa952af93033f82effdef418903fc93d94dd05c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-hyper-v-replication-to-azure-work"></a><span data-ttu-id="fa432-104">Jak działa replikacja funkcji Hyper-V do platformy Azure?</span><span class="sxs-lookup"><span data-stu-id="fa432-104">How does Hyper-V replication to Azure work?</span></span>

<span data-ttu-id="fa432-105">Przeczytaj ten artykuł, aby zapoznać się z architekturą i przepływami pracy replikacji funkcji Hyper-V do platformy Azure przy użyciu usługi [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="fa432-105">Read this article to understand the architecture and workflows for Hyper-V replication to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="fa432-106">Zamieść wszelkie komentarze pod tym artykułem lub na [forum usług Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="fa432-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="fa432-107">Oto co możesz replikować do platformy Azure:</span><span class="sxs-lookup"><span data-stu-id="fa432-107">You can replicate the following to Azure:</span></span>
- <span data-ttu-id="fa432-108">**Funkcja Hyper-V z programem VMM**: Maszyny wirtualne znajdujące się na lokalnych hostach funkcji Hyper-V zarządzanych w chmurach programu System Center Virtual Machine Manager (VMM).</span><span class="sxs-lookup"><span data-stu-id="fa432-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="fa432-109">Na hostach może działać dowolny [obsługiwany system operacyjny](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="fa432-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="fa432-110">Replikować możesz maszyny wirtualne funkcji Hyper-V, na których działa dowolny system operacyjny gościa [obsługiwany przez funkcję Hyper-V i platformę Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="fa432-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="fa432-111">**Funkcja Hyper-V bez programu VMM**: Lokalne maszyny wirtualne znajdujące się na hostach funkcji Hyper-V, które nie są zarządzane w chmurach programu VMM.</span><span class="sxs-lookup"><span data-stu-id="fa432-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="fa432-112">Na hostach może działać dowolny [obsługiwany system operacyjny](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span><span class="sxs-lookup"><span data-stu-id="fa432-112">Hosts can run any of the [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="fa432-113">Replikować możesz maszyny wirtualne funkcji Hyper-V, na których działa dowolny system operacyjny gościa [obsługiwany przez funkcję Hyper-V i platformę Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="fa432-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="fa432-114">Składniki architektury</span><span class="sxs-lookup"><span data-stu-id="fa432-114">Architectural components</span></span>

<span data-ttu-id="fa432-115">**Obszar**</span><span class="sxs-lookup"><span data-stu-id="fa432-115">**Area**</span></span> | <span data-ttu-id="fa432-116">**Składnik**</span><span class="sxs-lookup"><span data-stu-id="fa432-116">**Component**</span></span> | <span data-ttu-id="fa432-117">**Szczegóły**</span><span class="sxs-lookup"><span data-stu-id="fa432-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="fa432-118">**Azure**</span><span class="sxs-lookup"><span data-stu-id="fa432-118">**Azure**</span></span> | <span data-ttu-id="fa432-119">W przypadku platformy Azure konieczne jest posiadanie konta platformy Microsoft Azure, konta usługi Azure Storage i sieci platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="fa432-120">Konta magazynu i sieci mogą być kontami opartymi na usłudze Resource Manager lub kontami klasycznymi.</span><span class="sxs-lookup"><span data-stu-id="fa432-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="fa432-121">Replikowane dane są przechowywane na koncie magazynu. W przypadku wystąpienia w lokacji lokalnej przejścia w tryb failover maszyny wirtualne platformy Azure są tworzone przy użyciu zreplikowanych danych.</span><span class="sxs-lookup"><span data-stu-id="fa432-121">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="fa432-122">Maszyny wirtualne platformy Azure nawiązują połączenie z siecią wirtualną platformy Azure, gdy są tworzone.</span><span class="sxs-lookup"><span data-stu-id="fa432-122">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="fa432-123">**Serwer VMM**</span><span class="sxs-lookup"><span data-stu-id="fa432-123">**VMM server**</span></span> | <span data-ttu-id="fa432-124">Hosty funkcji Hyper-V znajdujące się w chmurach programu VMM</span><span class="sxs-lookup"><span data-stu-id="fa432-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="fa432-125">Jeśli hosty funkcji Hyper-V są zarządzane w chmurach programu VMM, należy zarejestrować serwer VMM w magazynie usługi Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="fa432-125">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="fa432-126">Na serwerze VMM należy zainstalować dostawcę usługi Site Recovery w celu organizowania replikacji z platformą Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-126">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="fa432-127">Aby skonfigurować mapowanie sieci, trzeba dysponować sieciami logicznymi i maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="fa432-127">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="fa432-128">Sieć maszyn wirtualnych powinna być połączona z siecią logiczną skojarzoną z chmurą.</span><span class="sxs-lookup"><span data-stu-id="fa432-128">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="fa432-129">**Host funkcji Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="fa432-129">**Hyper-V host**</span></span> | <span data-ttu-id="fa432-130">Serwery funkcji Hyper-V można wdrożyć z użyciem serwera VMM lub bez niego.</span><span class="sxs-lookup"><span data-stu-id="fa432-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="fa432-131">Jeśli nie ma serwera VMM, dostawca usługi Site Recovery jest instalowany na hoście w celu organizowania replikacji z usługą Site Recovery przez Internet.</span><span class="sxs-lookup"><span data-stu-id="fa432-131">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="fa432-132">W przypadku użycia serwera VMM dostawca jest instalowany na nim, a nie na hoście.</span><span class="sxs-lookup"><span data-stu-id="fa432-132">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="fa432-133">Agent usługi Recovery Services jest instalowany na hoście w celu obsługi replikacji danych.</span><span class="sxs-lookup"><span data-stu-id="fa432-133">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="fa432-134">Komunikacja zarówno ze strony dostawcy, jak i agenta, jest bezpieczna i szyfrowana.</span><span class="sxs-lookup"><span data-stu-id="fa432-134">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="fa432-135">Zreplikowane dane w usłudze Azure Storage również są szyfrowane.</span><span class="sxs-lookup"><span data-stu-id="fa432-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="fa432-136">**Maszyny wirtualne funkcji Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="fa432-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="fa432-137">Wymagana jest co najmniej jedna maszyna wirtualna na serwerze hosta funkcji Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="fa432-137">You need one or more VMs on the Hyper-V host server.</span></span> | <span data-ttu-id="fa432-138">Niczego nie trzeba jawnie instalować na maszynach wirtualnych</span><span class="sxs-lookup"><span data-stu-id="fa432-138">Nothing needs to explicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="fa432-139">Kroki wdrażania</span><span class="sxs-lookup"><span data-stu-id="fa432-139">Deployment steps</span></span>

1. <span data-ttu-id="fa432-140">**Azure**: Skonfiguruj składniki platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-140">**Azure**: You set up the Azure components.</span></span> <span data-ttu-id="fa432-141">Przed rozpoczęciem wdrażania usługi Site Recovery zaleca się skonfigurowanie kont magazynu i sieci.</span><span class="sxs-lookup"><span data-stu-id="fa432-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="fa432-142">**Magazyn**: Utwórz magazyn usługi Recovery Services na potrzeby usługi Site Recovery i skonfiguruj ustawienia magazynu, co obejmuje skonfigurowanie ustawień źródła i celu, skonfigurowanie zasad replikacji i włączenie replikacji.</span><span class="sxs-lookup"><span data-stu-id="fa432-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="fa432-143">**Źródło i cel**:</span><span class="sxs-lookup"><span data-stu-id="fa432-143">**Source and target**:</span></span>
    - <span data-ttu-id="fa432-144">**Hosty funkcji Hyper-V w chmurach programu VMM**: W ramach określania ustawień źródła pobierz i zainstaluj dostawcę usługi Azure Site Recovery na serwerze VMM oraz agenta usługi Azure Site Recovery na każdym hoście funkcji Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="fa432-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install the Azure Site Recovery Provider on the VMM server, and the Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="fa432-145">Źródłem będzie serwer VMM.</span><span class="sxs-lookup"><span data-stu-id="fa432-145">The source will be the VMM server.</span></span> <span data-ttu-id="fa432-146">Celem jest platforma Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-146">The target is Azure.</span></span>
    - <span data-ttu-id="fa432-147">Hosty funkcji Hyper-V bez programu VMM: W ramach określania ustawień źródła pobierz i zainstaluj dostawcę i agenta na każdym hoście funkcji Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="fa432-147">Hyper-V hosts without VMM: When you specify source settings, you download and install the Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="fa432-148">Podczas wdrażania należy zebrać hosty w lokacji funkcji Hyper-V i określić tę lokację jako źródło.</span><span class="sxs-lookup"><span data-stu-id="fa432-148">During deployment you gather the hosts into a Hyper-V site, and specify this site as the source.</span></span> <span data-ttu-id="fa432-149">Celem jest platforma Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-149">The target is Azure.</span></span>

    <span data-ttu-id="fa432-150">![Replikacja VMM/funkcji Hyper-V w systemie Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![replikacji lokacji funkcji Hyper-V do platformy Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="fa432-150">![Hyper-V/VMM replication to Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication to Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="fa432-151">**Zasady replikacji**: Utwórz zasady replikacji dla lokacji funkcji Hyper-V lub chmury programu VMM.</span><span class="sxs-lookup"><span data-stu-id="fa432-151">**Replication policy**: You create a replication policy for the Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="fa432-152">Te zasady są stosowane do wszystkich maszyn wirtualnych znajdujących się na hostach w lokacji lub w chmurze.</span><span class="sxs-lookup"><span data-stu-id="fa432-152">The policy is applied to all VMs located on hosts in the site or cloud.</span></span>
5. <span data-ttu-id="fa432-153">**Włącz replikację**: Włącz replikację maszyn wirtualnych funkcji Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="fa432-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="fa432-154">Początkowa replikacja jest wykonywana zgodnie z ustawieniami zasad replikacji.</span><span class="sxs-lookup"><span data-stu-id="fa432-154">Initial replication occurs in accordance with the replication policy settings.</span></span> <span data-ttu-id="fa432-155">Zmiany danych są śledzone i po zakończeniu początkowej replikacji rozpoczyna się replikowanie zmian różnicowych do platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-155">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="fa432-156">Śledzone zmiany elementu są przechowywane w pliku hrl.</span><span class="sxs-lookup"><span data-stu-id="fa432-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="fa432-157">**Testowe przełączenie w tryb failover**: Wykonaj testowe przełączenie w tryb failover, aby upewnić się, że wszystko działa zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="fa432-157">**Test failover**:  You run a test failover to make sure everything's working as expected.</span></span>

<span data-ttu-id="fa432-158">Dowiedz się więcej o wdrażaniu:</span><span class="sxs-lookup"><span data-stu-id="fa432-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="fa432-159">Wprowadzenie do replikacji maszyn wirtualnych funkcji Hyper-V do platformy Azure — z programem VMM</span><span class="sxs-lookup"><span data-stu-id="fa432-159">Get started with Hyper-V VM replication to Azure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- <span data-ttu-id="fa432-160">[Get started with Hyper-V VM replication to Azure - without VMM](site-recovery-hyper-v-site-to-azure.md) (Wprowadzenie do replikacji maszyn wirtualnych funkcji Hyper-V do platformy Azure — bez programu VMM)</span><span class="sxs-lookup"><span data-stu-id="fa432-160">[Get started with Hyper-V VM replication to Azure - without VMM](site-recovery-hyper-v-site-to-azure.md)</span></span>

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="fa432-161">Przepływ pracy replikacji funkcji Hyper-V</span><span class="sxs-lookup"><span data-stu-id="fa432-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="fa432-162">Włączanie ochrony</span><span class="sxs-lookup"><span data-stu-id="fa432-162">Enable protection</span></span>

1. <span data-ttu-id="fa432-163">Po włączeniu ochrony dla maszyny wirtualnej funkcji Hyper-V, w witrynie Azure Portal lub środowisku lokalnym, zostanie uruchomione zadanie **Włącz ochronę**.</span><span class="sxs-lookup"><span data-stu-id="fa432-163">After you enable protection for a Hyper-V VM, in the Azure portal or on-premises, the **Enable protection** starts.</span></span>
2. <span data-ttu-id="fa432-164">To zadanie sprawdza, czy maszyna spełnia wymagania wstępne, a następnie wywołuje metodę [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), aby skonfigurować replikację za pomocą określonych ustawień.</span><span class="sxs-lookup"><span data-stu-id="fa432-164">The job checks that the machine complies with prerequisites, before invoking the [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), to set up replication with the settings you've configured.</span></span>
3. <span data-ttu-id="fa432-165">Zadanie uruchamia replikację początkową, wywołując metodę [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx), aby zainicjować pełną replikację maszyny wirtualnej i wysłać dyski wirtualne maszyny wirtualnej na platformę Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-165">The job starts initial replication by invoking the [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, to initialize a full VM replication, and send the VM's virtual disks to Azure.</span></span>
4. <span data-ttu-id="fa432-166">To zadanie możesz monitorować na karcie **Zadania**.</span><span class="sxs-lookup"><span data-stu-id="fa432-166">You can monitor the job in the **Jobs** tab.</span></span>
        <span data-ttu-id="fa432-167">![Lista zadań](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Szczegóły zadania Włącz ochronę](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="fa432-167">![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="fa432-168">Replikacja początkowa</span><span class="sxs-lookup"><span data-stu-id="fa432-168">Initial replication</span></span>

1. <span data-ttu-id="fa432-169">Po wyzwoleniu replikacji początkowej tworzona jest [migawka maszyny wirtualnej funkcji Hyper-V](https://technet.microsoft.com/library/dd560637.aspx).</span><span class="sxs-lookup"><span data-stu-id="fa432-169">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="fa432-170">Wirtualne dyski twarde są replikowane pojedynczo, dopóki wszystkie nie zostaną skopiowane na platformę Azure.</span><span class="sxs-lookup"><span data-stu-id="fa432-170">Virtual hard disks are replicated one by one until they're all copied to Azure.</span></span> <span data-ttu-id="fa432-171">Może to trochę potrwać, w zależności od rozmiaru maszyny wirtualnej i przepustowości sieci.</span><span class="sxs-lookup"><span data-stu-id="fa432-171">It could take a while, depending on the VM size, and network bandwidth.</span></span> <span data-ttu-id="fa432-172">Aby zoptymalizować użycie sieci, zobacz [Jak zarządzać użyciem przepustowości sieci przez ochronę za pomocą replikacji zasobów lokalnych do platformy Azure](https://support.microsoft.com/kb/3056159).</span><span class="sxs-lookup"><span data-stu-id="fa432-172">To optimize your network usage, see [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="fa432-173">Jeśli podczas replikacji początkowej będzie miała miejsce zmiana dysku, składnik Replica Replication Tracker funkcji Hyper-V będzie śledził te zmiany jako dzienniki replikacji funkcji Hyper-V (hrl).</span><span class="sxs-lookup"><span data-stu-id="fa432-173">If disk changes occur while initial replication is in progress, the Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="fa432-174">Te pliki znajdują się w tym samym folderze co dyski.</span><span class="sxs-lookup"><span data-stu-id="fa432-174">These files are located in the same folder as the disks.</span></span> <span data-ttu-id="fa432-175">Z każdym dyskiem jest skojarzony plik hrl, który zostanie wysłany do magazynu pomocniczego.</span><span class="sxs-lookup"><span data-stu-id="fa432-175">Each disk has an associated .hrl file that will be sent to secondary storage.</span></span>
4. <span data-ttu-id="fa432-176">Pliki migawki i dziennika zużywają zasoby dysku w trakcie replikacji początkowej.</span><span class="sxs-lookup"><span data-stu-id="fa432-176">The snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="fa432-177">Po zakończeniu replikacji początkowej migawka maszyny wirtualnej jest usuwana.</span><span class="sxs-lookup"><span data-stu-id="fa432-177">When the initial replication finishes, the VM snapshot is deleted.</span></span> <span data-ttu-id="fa432-178">Różnicowe zmiany dysku w dzienniku są synchronizowane i scalane z dyskiem nadrzędnym.</span><span class="sxs-lookup"><span data-stu-id="fa432-178">Delta disk changes in the log are synchronized and merged to the parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="fa432-179">Finalizowanie ochrony</span><span class="sxs-lookup"><span data-stu-id="fa432-179">Finalize protection</span></span>

1. <span data-ttu-id="fa432-180">Po zakończeniu replikacji początkowej zadanie **Finalizuj ochronę na maszynie wirtualnej** konfiguruje ustawienia sieciowe i inne ustawienia po replikacji, aby maszyna wirtualna była chroniona.</span><span class="sxs-lookup"><span data-stu-id="fa432-180">After the initial replication finishes, the **Finalize protection on the virtual machine** job configures network and other post-replication settings, so that the virtual machine is protected.</span></span>
    <span data-ttu-id="fa432-181">![Zadanie Finalizuj ochronę](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="fa432-181">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="fa432-182">W przypadku przeprowadzania replikacji na platformę Azure może być konieczne dostosowanie ustawień maszyny wirtualnej w taki sposób, aby była gotowa do przejścia w tryb failover.</span><span class="sxs-lookup"><span data-stu-id="fa432-182">If you're replicating to Azure, you might need to tweak the settings for the virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="fa432-183">W tym momencie możesz uruchomić testowe przejście w tryb failover w celu sprawdzenia, czy wszystko działa zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="fa432-183">At this point you can run a test failover to check everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="fa432-184">Replikacja różnicowa</span><span class="sxs-lookup"><span data-stu-id="fa432-184">Delta replication</span></span>

1. <span data-ttu-id="fa432-185">Po przeprowadzeniu replikacji początkowej rozpoczynana jest synchronizacja przyrostowa zgodnie z ustawieniami replikacji.</span><span class="sxs-lookup"><span data-stu-id="fa432-185">After the initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="fa432-186">Składnik Replica Replication Tracker funkcji Hyper-V śledzi zmiany na wirtualnym dysku twardym w plikach hrl.</span><span class="sxs-lookup"><span data-stu-id="fa432-186">The Hyper-V Replica Replication Tracker tracks the changes to a virtual hard disk as .hrl files.</span></span> <span data-ttu-id="fa432-187">Z każdym dyskiem skonfigurowanym pod kątem replikacji jest skojarzony plik hrl.</span><span class="sxs-lookup"><span data-stu-id="fa432-187">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="fa432-188">Ten dziennik jest wysyłany do konta magazynu klienta po zakończeniu replikacji początkowej.</span><span class="sxs-lookup"><span data-stu-id="fa432-188">This log is sent to the customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="fa432-189">Gdy plik dziennika jest przesyłany do platformy Azure, zmiany na dysku podstawowym są śledzone w innym pliku dziennika, w tym samym katalogu.</span><span class="sxs-lookup"><span data-stu-id="fa432-189">When a log is in transit to Azure, the changes in the primary disk are tracked in another log file, in the same directory.</span></span>
3. <span data-ttu-id="fa432-190">Podczas replikacji początkowej i różnicowej możesz monitorować maszynę wirtualną w widoku maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="fa432-190">During initial and delta replication, you can monitor the VM in the VM view.</span></span> <span data-ttu-id="fa432-191">[Dowiedz się więcej](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="fa432-191">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="fa432-192">Synchronizacja replikacji</span><span class="sxs-lookup"><span data-stu-id="fa432-192">Replication synchronization</span></span>

1. <span data-ttu-id="fa432-193">Jeśli replikacja różnicowa nie powiedzie się, a pełna replikacja byłaby kosztowna pod względem przepustowości lub czasu, maszyna wirtualna jest oznaczana do ponownej synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="fa432-193">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="fa432-194">Jeśli na przykład pliki hrl będą zajmować 50% rozmiaru dysku, to maszyna wirtualna zostanie oznaczona do ponownej synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="fa432-194">For example, if the .hrl files reach 50% of the disk size, then the VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="fa432-195">Ponowna synchronizacja minimalizuje ilość wysyłanych danych dzięki obliczaniu sum kontrolnych źródłowych i docelowych maszyn wirtualnych oraz wysyłaniu tylko danych różnicowych.</span><span class="sxs-lookup"><span data-stu-id="fa432-195">Resynchronization minimizes the amount of data sent by computing checksums of the source and target virtual machines, and sending only the delta data.</span></span> <span data-ttu-id="fa432-196">Ponowna synchronizacja używa algorytmu dzielenia na fragmenty o stałym bloku. Za jego pomocą pliki źródłowe i docelowe są dzielone na stałe fragmenty.</span><span class="sxs-lookup"><span data-stu-id="fa432-196">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="fa432-197">Dla każdego fragmentu są generowane sumy kontrolne, które następnie są porównywane w celu określenia, które bloki ze źródła mają zostać zastosowane do celu.</span><span class="sxs-lookup"><span data-stu-id="fa432-197">Checksums for each chunk are generated and then compared to determine which blocks from the source need to be applied to the target.</span></span>
3. <span data-ttu-id="fa432-198">Po ukończeniu ponownej synchronizacji replikacja różnicowa powinna zostać wznowiona.</span><span class="sxs-lookup"><span data-stu-id="fa432-198">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="fa432-199">Domyślnie ponowna synchronizacja jest zaplanowana do automatycznego uruchamiania poza godzinami pracy, ale możliwe jest uruchomienie ponownej synchronizacji maszyny wirtualnej ręcznie.</span><span class="sxs-lookup"><span data-stu-id="fa432-199">By default resynchronization is scheduled to run automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="fa432-200">Na przykład możesz wznowić ponowną synchronizację, jeśli wystąpi awaria sieci lub inna awaria.</span><span class="sxs-lookup"><span data-stu-id="fa432-200">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="fa432-201">W tym celu wybierz maszynę wirtualną w portalu i wybierz pozycję **Synchronizuj ponownie**.</span><span class="sxs-lookup"><span data-stu-id="fa432-201">To do this, select the VM in the portal > **Resynchronize**.</span></span>

    ![Ręczna ponowna synchronizacja](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="fa432-203">Ponowne próby</span><span class="sxs-lookup"><span data-stu-id="fa432-203">Retries</span></span>

<span data-ttu-id="fa432-204">Jeśli wystąpi błąd replikacji, może zostać użyty wbudowany mechanizm ponawiania.</span><span class="sxs-lookup"><span data-stu-id="fa432-204">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="fa432-205">Tę logikę można podzielić na dwie kategorie:</span><span class="sxs-lookup"><span data-stu-id="fa432-205">This logic can be classified into two categories:</span></span>

<span data-ttu-id="fa432-206">**Kategoria**</span><span class="sxs-lookup"><span data-stu-id="fa432-206">**Category**</span></span> | <span data-ttu-id="fa432-207">**Szczegóły**</span><span class="sxs-lookup"><span data-stu-id="fa432-207">**Details**</span></span>
--- | ---
<span data-ttu-id="fa432-208">**Błąd nieodwracalny**</span><span class="sxs-lookup"><span data-stu-id="fa432-208">**Non-recoverable errors**</span></span> | <span data-ttu-id="fa432-209">Nie jest podejmowana próba ponowienia.</span><span class="sxs-lookup"><span data-stu-id="fa432-209">No retry is attempted.</span></span> <span data-ttu-id="fa432-210">Maszyna wirtualna będzie mieć stan **Krytyczny** i będzie wymagana interwencja administratora.</span><span class="sxs-lookup"><span data-stu-id="fa432-210">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="fa432-211">Przykłady błędów tego typu: przerwany łańcuch dysków VHD, nieprawidłowy stan repliki maszyny wirtualnej, błędy uwierzytelniania sieci (błędy autoryzacji), błędy Nie znaleziono maszyny wirtualnej (w przypadku autonomicznych serwerów funkcji Hyper-V)</span><span class="sxs-lookup"><span data-stu-id="fa432-211">Examples of these errors include: broken VHD chain; Invalid state for the replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="fa432-212">**Błędy odwracalne**</span><span class="sxs-lookup"><span data-stu-id="fa432-212">**Recoverable errors**</span></span> | <span data-ttu-id="fa432-213">Ponowne próby są wykonywane co interwał replikacji przy użyciu wycofywania wykładniczego zwiększającego interwał ponawiania prób od początku pierwszej próby o 1, 2, 4, 8 i 10 minut.</span><span class="sxs-lookup"><span data-stu-id="fa432-213">Retries occur every replication interval, using an exponential back-off that increases the retry interval from the start of the first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="fa432-214">Jeśli błąd będzie się powtarzać, ponowne próby będą wykonywane co 30 minut.</span><span class="sxs-lookup"><span data-stu-id="fa432-214">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="fa432-215">Są to na przykład błędy sieci, błędy małej ilości miejsca na dysku i warunki małej ilości pamięci</span><span class="sxs-lookup"><span data-stu-id="fa432-215">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="fa432-216">Cykl życia ochrony i odzyskiwania</span><span class="sxs-lookup"><span data-stu-id="fa432-216">Protection and recovery lifecycle</span></span>

![przepływ pracy](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="fa432-218">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="fa432-218">Next steps</span></span>

- <span data-ttu-id="fa432-219">[Check deployment prerequisites](site-recovery-prereq.md) (Sprawdzanie wymagań wstępnych dotyczących wdrożenia)</span><span class="sxs-lookup"><span data-stu-id="fa432-219">[Check deployment prerequisites](site-recovery-prereq.md)</span></span>
- <span data-ttu-id="fa432-220">Rozwiązywanie problemów:</span><span class="sxs-lookup"><span data-stu-id="fa432-220">Troubleshoot with:</span></span>
    - [<span data-ttu-id="fa432-221">Monitorowanie i rozwiązywanie problemów z ochroną</span><span class="sxs-lookup"><span data-stu-id="fa432-221">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - <span data-ttu-id="fa432-222">[Help from Microsoft support](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support) (Pomoc techniczna od firmy Microsoft)</span><span class="sxs-lookup"><span data-stu-id="fa432-222">[Help from Microsoft support](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)</span></span>
    - <span data-ttu-id="fa432-223">[Common errors and resolutions](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions) (Typowe błędy i rozwiązania)</span><span class="sxs-lookup"><span data-stu-id="fa432-223">[Common errors and resolutions](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)</span></span>
