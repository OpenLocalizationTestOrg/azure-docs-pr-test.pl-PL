---
title: "Rozwiązywanie problemów z grup zabezpieczeń sieci - Portal | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak rozwiązywać problemy z grup zabezpieczeń sieci w modelu wdrażania usługi Azure Resource Manager przy użyciu portalu Azure."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: a54feccf-0123-4e49-a743-eb8d0bdd1ebc
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: f01d3b43a7953697a6b03e176dace33448d95cd9
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-network-security-groups-using-the-azure-portal"></a><span data-ttu-id="2c0b2-103">Rozwiązywanie problemów z grup zabezpieczeń sieci przy użyciu portalu Azure</span><span class="sxs-lookup"><span data-stu-id="2c0b2-103">Troubleshoot Network Security Groups using the Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="2c0b2-104">Azure Portal</span><span class="sxs-lookup"><span data-stu-id="2c0b2-104">Azure Portal</span></span>](virtual-network-nsg-troubleshoot-portal.md)
> * [<span data-ttu-id="2c0b2-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="2c0b2-105">PowerShell</span></span>](virtual-network-nsg-troubleshoot-powershell.md)
> 
> 

<span data-ttu-id="2c0b2-106">Jeśli skonfigurowana grup zabezpieczeń sieci (NSG) na maszynie wirtualnej (VM) i występują problemy z połączeniem maszyny Wirtualnej, ten artykuł zawiera omówienie funkcji diagnostyki dla grup NSG do dalszego rozwiązywania.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-106">If you configured Network Security Groups (NSGs) on your virtual machine (VM) and are experiencing VM connectivity issues, this article provides an overview of diagnostics capabilities for NSGs to help troubleshoot further.</span></span>

<span data-ttu-id="2c0b2-107">Grupy NSG umożliwiają kontrolę typów ruchu przepływające i maszyn wirtualnych (VM).</span><span class="sxs-lookup"><span data-stu-id="2c0b2-107">NSGs enable you to control the types of traffic that flow in and out of your virtual machines (VMs).</span></span> <span data-ttu-id="2c0b2-108">Grupy NSG można zastosować do podsieci w sieci wirtualnej platformy Azure (VNet) i/lub interfejsów sieciowych (NIC).</span><span class="sxs-lookup"><span data-stu-id="2c0b2-108">NSGs can be applied to subnets in an Azure Virtual Network (VNet), network interfaces (NIC), or both.</span></span> <span data-ttu-id="2c0b2-109">Skuteczne zasady stosowane do karty Sieciowej są agregacji reguł, które istnieją w grup NSG stosowana do karty Sieciowej i podsieci, w której jest dołączona do.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-109">The effective rules applied to a NIC are an aggregation of the rules that exist in the NSGs applied to a NIC and the subnet it is connected to.</span></span> <span data-ttu-id="2c0b2-110">Reguły w tych grup NSG można czasami konflikt ze sobą i mieć wpływ na łączność sieciową z maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-110">Rules across these NSGs can sometimes conflict with each other and impact a VM's network connectivity.</span></span>  

<span data-ttu-id="2c0b2-111">Można wyświetlić wszystkie reguły efektywnym elementem systemu zabezpieczeń z grup NSG, jak stosować kart sieciowych maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-111">You can view all the effective security rules from your NSGs, as applied on your VM's NICs.</span></span> <span data-ttu-id="2c0b2-112">W tym artykule pokazano, jak rozwiązywać problemy z połączeniem maszyny Wirtualnej przy użyciu tych reguł w modelu wdrażania usługi Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-112">This article shows how to troubleshoot VM connectivity issues using these rules in the Azure Resource Manager deployment model.</span></span> <span data-ttu-id="2c0b2-113">Jeśli nie znasz z sieci wirtualnej i NSG pojęcia, przeczytaj [sieci wirtualnej](virtual-networks-overview.md) i [sieciowej grupy zabezpieczeń](virtual-networks-nsg.md) omówienie artykułów.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-113">If you're not familiar with VNet and NSG concepts, read the [Virtual network](virtual-networks-overview.md) and [Network security groups](virtual-networks-nsg.md) overview articles.</span></span>

## <a name="using-effective-security-rules-to-troubleshoot-vm-traffic-flow"></a><span data-ttu-id="2c0b2-114">Rozwiązywanie problemów z przepływem ruchu maszyny Wirtualnej za pomocą skuteczne reguły zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="2c0b2-114">Using Effective Security Rules to troubleshoot VM traffic flow</span></span>
<span data-ttu-id="2c0b2-115">Scenariusz, który następuje jest przykładem to powszechny problem połączenia:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-115">The scenario that follows is an example of a common connection problem:</span></span>

<span data-ttu-id="2c0b2-116">Maszyna wirtualna o nazwie *VM1* jest częścią podsieci o nazwie *podsieć1* w ramach sieci wirtualnej o nazwie *WestUS VNet1*.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-116">A VM named *VM1* is part of a subnet named *Subnet1* within a VNet named *WestUS-VNet1*.</span></span> <span data-ttu-id="2c0b2-117">Próba nawiązania połączenia z maszyną wirtualną za pomocą protokołu RDP za pośrednictwem portu 3389 protokołu TCP nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-117">An attempt to connect to the VM using RDP over TCP port 3389 fails.</span></span> <span data-ttu-id="2c0b2-118">Grupy NSG są stosowane w obu karty interfejsu Sieciowego *VM1 NIC1* i podsieć *podsieć1*.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-118">NSGs are applied at both the NIC *VM1-NIC1* and the subnet *Subnet1*.</span></span> <span data-ttu-id="2c0b2-119">Ruch do portu 3389 protokołu TCP jest dozwolona w grupie NSG skojarzone z interfejsem sieciowym *VM1 NIC1*, ale TCP ping VM1 do portu 3389 kończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-119">Traffic to TCP port 3389 is allowed in the NSG associated with the network interface *VM1-NIC1*, however TCP ping to VM1's port 3389 fails.</span></span>

<span data-ttu-id="2c0b2-120">Podczas tego przykładu korzysta z portu 3389 protokołu TCP, następujące czynności może służyć do określenia błędów połączenia przychodzącego i wychodzącego przez dowolnego portu.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-120">While this example uses TCP port 3389, the following steps can be used to determine inbound and outbound connection failures over any port.</span></span>

### <span data-ttu-id="2c0b2-121"><a name="vm"></a>Wyświetl reguły efektywnym elementem systemu zabezpieczeń dla maszyny wirtualnej</span><span class="sxs-lookup"><span data-stu-id="2c0b2-121"><a name="vm"></a>View effective security rules for a virtual machine</span></span>
<span data-ttu-id="2c0b2-122">Wykonaj poniższe kroki, aby rozwiązać grup NSG dla maszyny Wirtualnej:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-122">Complete the following steps to troubleshoot NSGs for a VM:</span></span>

<span data-ttu-id="2c0b2-123">Pełna lista reguł efektywnym elementem systemu zabezpieczeń można wyświetlić karty sieciowej, z samej maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-123">You can view full list of the effective security rules on a NIC, from the VM itself.</span></span> <span data-ttu-id="2c0b2-124">Można także dodawanie, modyfikowanie i usuwanie reguły NSG podsieci i karty w bloku skuteczne reguły, jeśli masz uprawnienia do wykonania tych operacji.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-124">You can also add, modify, and delete both NIC and subnet NSG rules from the effective rules blade, if you have permissions to perform these operations.</span></span>

1. <span data-ttu-id="2c0b2-125">Zaloguj się do portalu Azure pod adresem https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-125">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="2c0b2-126">Kliknij przycisk **więcej usług**, następnie kliknij przycisk **maszyn wirtualnych** na liście.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-126">Click **More services**, then click **Virtual machines** in the list that appears.</span></span>
3. <span data-ttu-id="2c0b2-127">Wybierz maszynę Wirtualną, aby rozwiązać problemy z listy, która pojawia się i zostanie wyświetlony blok maszyny Wirtualnej, z opcjami.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-127">Select a VM to troubleshoot from the list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="2c0b2-128">Kliknij przycisk **Diagnozuj & rozwiązywania problemów** , a następnie wybierz powszechny problem.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-128">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="2c0b2-129">Na przykład **nie mogę połączyć się z maszyną Wirtualną z systemem Windows** jest zaznaczone.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-129">For this example, **I can’t connect to my Windows VM** is selected.</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image1.png)
5. <span data-ttu-id="2c0b2-130">Kroki są wyświetlane w obszarze ten problem, jak pokazano na poniższej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-130">Steps appear under the problem, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image2.png)
   
    <span data-ttu-id="2c0b2-131">Kliknij przycisk *efektywnym elementem systemu zabezpieczeń, zasady grupy* na liście zalecanych kroków.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-131">Click *effective security group rules* in the list of recommended steps.</span></span>
6. <span data-ttu-id="2c0b2-132">**Pobieranie reguł efektywnym elementem systemu zabezpieczeń** zostanie wyświetlony blok, jak pokazano na poniższej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-132">The **Get effective security rules** blade appears, as shown in the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image3.png)
   
    <span data-ttu-id="2c0b2-133">Zwróć uwagę sekcje obrazu:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-133">Notice the following sections of the picture:</span></span>
   
   * <span data-ttu-id="2c0b2-134">**Zakres:** ustawioną *VM1*, maszyny Wirtualnej wybrany w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-134">**Scope:** Set to *VM1*, the VM selected in step 3.</span></span>
   * <span data-ttu-id="2c0b2-135">**Interfejs sieciowy:** *VM1 NIC1* jest zaznaczone.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-135">**Network interface:** *VM1-NIC1* is selected.</span></span> <span data-ttu-id="2c0b2-136">Maszyna wirtualna może mieć wiele interfejsów sieciowych (NIC).</span><span class="sxs-lookup"><span data-stu-id="2c0b2-136">A VM can have multiple network interfaces (NIC).</span></span> <span data-ttu-id="2c0b2-137">Poszczególne karty Sieciowe mogą mieć unikatowe efektywnym elementem systemu zabezpieczeń reguły.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-137">Each NIC can have unique effective security rules.</span></span> <span data-ttu-id="2c0b2-138">Podczas rozwiązywania problemu, należy wyświetlić reguły efektywnym elementem systemu zabezpieczeń dla poszczególnych kart sieciowych.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-138">When troubleshooting, you may need to view the effective security rules for each NIC.</span></span>
   * <span data-ttu-id="2c0b2-139">**Grupy NSG skojarzone:** grupy NSG można zastosować do karty Sieciowej i podsieci, karta sieciowa jest połączona.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-139">**Associated NSGs:** NSGs can be applied to both the NIC and the subnet the NIC is connected to.</span></span> <span data-ttu-id="2c0b2-140">Na ilustracji grupy NSG zostały zastosowane do kartę Sieciową i podsieć, z którą jest połączona.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-140">In the picture, an NSG has been applied to both the NIC and the subnet it's connected to.</span></span> <span data-ttu-id="2c0b2-141">Możesz kliknąć nazwy grupy NSG bezpośrednio zmodyfikować zasady grup NSG.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-141">You can click on the NSG names to directly modify rules in the NSGs.</span></span>
   * <span data-ttu-id="2c0b2-142">**Karta VM1 nsg:** listę reguł w zdjęć jest grupa NSG stosowana do karty sieciowej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-142">**VM1-nsg tab:** The list of rules displayed in the picture is for the NSG applied to the NIC.</span></span> <span data-ttu-id="2c0b2-143">Kilka reguł domyślnych są tworzone przez usługę Azure zawsze, gdy grupa NSG jest tworzona.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-143">Several default rules are created by Azure whenever an NSG is created.</span></span> <span data-ttu-id="2c0b2-144">Nie można usunąć reguły domyślne, ale można je zastąpić przy użyciu reguł o wyższym priorytecie.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-144">You can't remove the default rules, but you can override them with rules of higher priority.</span></span> <span data-ttu-id="2c0b2-145">Aby dowiedzieć się więcej na temat reguł domyślnych, przeczytaj [omówienie NSG](virtual-networks-nsg.md#default-rules) artykułu.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-145">To learn more about default rules, read the [NSG overview](virtual-networks-nsg.md#default-rules) article.</span></span>
   * <span data-ttu-id="2c0b2-146">**Kolumna docelowa:** reguł zawiera tekst w kolumnie, podczas gdy inne muszą prefiksy adresów.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-146">**DESTINATION column:** Some of the rules have text in the column, while others have address prefixes.</span></span> <span data-ttu-id="2c0b2-147">Tekst jest nazwą znaczniki domyślne stosowane do reguły zabezpieczeń podczas jej tworzenia.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-147">The text is the name of default tags applied to the security rule when it was created.</span></span> <span data-ttu-id="2c0b2-148">Tagi są dostarczane przez system identyfikatorów, które reprezentują wiele prefiksów.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-148">The tags are system-provided identifiers that represent multiple prefixes.</span></span> <span data-ttu-id="2c0b2-149">Wybranie reguły za pomocą tagów, takich jak *AllowInternetOutBound*, zawiera listę prefiksów **prefiksy adresów** bloku.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-149">Selecting a rule with a tag, such as *AllowInternetOutBound*, lists the prefixes in the **Address prefixes** blade.</span></span>
   * <span data-ttu-id="2c0b2-150">**Pobieranie:** listę reguł może trwać długo.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-150">**Download:** The list of rules can be long.</span></span> <span data-ttu-id="2c0b2-151">Plik CSV reguł dla analizy offline można pobrać po kliknięciu **Pobierz** i zapisać plik.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-151">You can download a .csv file of the rules for offline analysis by clicking **Download** and saving the file.</span></span>
   * <span data-ttu-id="2c0b2-152">**AllowRDP** reguły dla ruchu przychodzącego: ta zasada umożliwia połączeń protokołu RDP z maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-152">**AllowRDP** Inbound rule: This rule allows RDP connections to the VM.</span></span>
7. <span data-ttu-id="2c0b2-153">Kliknij przycisk **NSG podsieć1** kartę, aby wyświetlić skuteczne reguły z Grupa NSG stosowana do podsieci, jak pokazano na poniższej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-153">Click the **Subnet1-NSG** tab to view the effective rules from the NSG applied to the subnet, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image4.png)
   
    <span data-ttu-id="2c0b2-154">Powiadomienie *denyRDP* **przychodzący** reguły.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-154">Notice the *denyRDP* **Inbound** rule.</span></span> <span data-ttu-id="2c0b2-155">Reguły ruchu przychodzącego w podsieci są obliczane przed zasady stosowane w interfejsie sieciowym.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-155">Inbound rules applied at the subnet are evaluated before rules applied at the network interface.</span></span> <span data-ttu-id="2c0b2-156">Ponieważ w tej podsieci jest stosowana reguła odmowy, żądanie połączenia do 3389 protokołu TCP nie powiedzie się, ponieważ nigdy nie jest obliczane regułą Zezwalaj umieszczoną karty interfejsu Sieciowego.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-156">Since the deny rule is applied at the subnet, the request to connect to TCP 3389 fails, because the allow rule at the NIC is never evaluated.</span></span> 
   
    <span data-ttu-id="2c0b2-157">*DenyRDP* reguły jest powód, dlaczego połączenie RDP kończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-157">The *denyRDP* rule is the reason why the RDP connection is failing.</span></span> <span data-ttu-id="2c0b2-158">Usunięcie go powinno rozwiązać problem.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-158">Removing it should resolve the problem.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="2c0b2-159">Jeśli skojarzona z kartą Sieciową maszyny Wirtualnej nie jest w stanie uruchomionym lub grupy NSG nie zostały zastosowane do karty Sieciowej lub podsieci, są wyświetlane żadne reguły.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-159">If the VM associated with the NIC is not in a running state, or NSGs haven't been applied to the NIC or subnet, no rules are shown.</span></span>
   > 
   > 
8. <span data-ttu-id="2c0b2-160">Aby edytować reguły NSG, kliknij przycisk *NSG podsieć1* w **skojarzonych grup NSG** sekcji.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-160">To edit NSG rules, click *Subnet1-NSG* in the **Associated NSGs** section.</span></span>
   <span data-ttu-id="2c0b2-161">Spowoduje to otwarcie **NSG podsieć1** bloku.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-161">This opens the **Subnet1-NSG** blade.</span></span> <span data-ttu-id="2c0b2-162">Reguły można bezpośrednio edytować, klikając **reguły zabezpieczeń dla ruchu przychodzącego**.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-162">You can directly edit the rules by clicking on **Inbound security rules**.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image7.png)
9. <span data-ttu-id="2c0b2-163">Po usunięciu *denyRDP* reguły dla ruchu przychodzącego w **NSG podsieć1** i dodawanie *allowRDP* reguły obowiązującą reguł listy wygląda jak poniżej:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-163">After removing the *denyRDP* inbound rule in the **Subnet1-NSG** and adding an *allowRDP* rule, the effective rules list looks like the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image8.png)
   
    <span data-ttu-id="2c0b2-164">Upewnij się, że portu 3389 protokołu TCP jest otwarty przez otwarcie połączenia RDP do maszyny Wirtualnej lub przy użyciu narzędzia PsPing narzędzia.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-164">Confirm that TCP port 3389 is open by opening an RDP connection to the VM or using the PsPing tool.</span></span> <span data-ttu-id="2c0b2-165">Użytkownik może dowiedzieć się więcej o narzędzia PsPing odczytując [stronę pobierania narzędzia PsPing](https://technet.microsoft.com/sysinternals/psping.aspx).</span><span class="sxs-lookup"><span data-stu-id="2c0b2-165">You can learn more about PsPing by reading the [PsPing download page](https://technet.microsoft.com/sysinternals/psping.aspx).</span></span>

### <span data-ttu-id="2c0b2-166"><a name="nic"></a>Wyświetl reguły efektywnym elementem systemu zabezpieczeń dla interfejsu sieciowego</span><span class="sxs-lookup"><span data-stu-id="2c0b2-166"><a name="nic"></a>View effective security rules for a network interface</span></span>
<span data-ttu-id="2c0b2-167">Jeśli do ruchu maszyny Wirtualnej jest w pełni funkcjonalne dla określonych kart interfejsu Sieciowego, można wyświetlić pełną listę skuteczne reguły do karty Sieciowej z kontekstu interfejsów sieciowych, wykonując następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-167">If your VM traffic flow is impacted for a specific NIC, you can view a full list of the effective rules for the NIC from the network interfaces context by completing the following steps:</span></span>

1. <span data-ttu-id="2c0b2-168">Zaloguj się do portalu Azure pod adresem https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-168">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="2c0b2-169">Kliknij przycisk **więcej usług**, następnie kliknij przycisk **interfejsy sieciowe** na liście.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-169">Click **More services**, then click **Network interfaces** in the list that appears.</span></span>
3. <span data-ttu-id="2c0b2-170">Wybierz interfejs sieciowy.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-170">Select a network interface.</span></span> <span data-ttu-id="2c0b2-171">Na poniższej ilustracji, karta sieciowa o nazwie *VM1 NIC1* jest zaznaczone.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-171">In the following picture, a NIC named *VM1-NIC1* is selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image5.png)
   
    <span data-ttu-id="2c0b2-172">Zwróć uwagę, że **zakres** ustawiono wybrany interfejs sieciowy.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-172">Notice that the **Scope** is set to the network interface selected.</span></span> <span data-ttu-id="2c0b2-173">Aby dowiedzieć się więcej o dodatkowe informacje wyświetlane, przeczytaj kroku 6 **Rozwiązywanie problemów z grup NSG dla maszyny Wirtualnej** sekcji tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-173">To learn more about the additional information shown, read step 6 of the **Troubleshoot NSGs for a VM** section of this article.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="2c0b2-174">Usunięcie grupy NSG z interfejsem sieciowym podsieci grupa NSG jest nadal skuteczne w danej karty sieciowej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-174">If an NSG is removed from a network interface, the subnet NSG is still effective on the given NIC.</span></span> <span data-ttu-id="2c0b2-175">W takim przypadku dane wyjściowe będą wyświetla tylko reguły NSG podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-175">In this case, the output would only show rules from the subnet NSG.</span></span> <span data-ttu-id="2c0b2-176">Reguły są wyświetlane tylko, jeśli karta sieciowa jest podłączona do maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-176">Rules only appear if the NIC is attached to a VM.</span></span>
   > 
   > 
4. <span data-ttu-id="2c0b2-177">Zasady można edytować bezpośrednio do grupy zabezpieczeń sieci skojarzonych z karty Sieciowej i podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-177">You can directly edit rules for NSGs associated with a NIC and a subnet.</span></span> <span data-ttu-id="2c0b2-178">Aby dowiedzieć się, jak to zrobić, przeczytaj kroku 8 **wyświetlić reguły efektywnym elementem systemu zabezpieczeń dla maszyny wirtualnej** sekcji tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-178">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

## <span data-ttu-id="2c0b2-179"><a name="nsg"></a>Wyświetlanie efektywnym elementem systemu zabezpieczeń reguł sieciowej grupy zabezpieczeń (NSG)</span><span class="sxs-lookup"><span data-stu-id="2c0b2-179"><a name="nsg"></a>View effective security rules for a network security group (NSG)</span></span>
<span data-ttu-id="2c0b2-180">Podczas modyfikowania reguły NSG, można przejrzeć wpływu reguły dodawany na określonej maszynie Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-180">When modifying NSG rules, you may want to review the impact of the rules being added on a particular VM.</span></span> <span data-ttu-id="2c0b2-181">Pełna lista reguł efektywnym elementem systemu zabezpieczeń można wyświetlić wszystkie karty sieciowe obsługujące danego grupa NSG jest stosowana do, bez konieczności przełączania kontekstu w danym bloku NSG.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-181">You can view a full list of the effective security rules for all the NICs that a given NSG is applied to, without having to switch context from the given NSG blade.</span></span> <span data-ttu-id="2c0b2-182">Rozwiązywać skuteczne reguły w obrębie grupy NSG, wykonaj następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-182">To troubleshoot effective rules within an NSG, complete the following steps:</span></span>

1. <span data-ttu-id="2c0b2-183">Zaloguj się do portalu Azure pod adresem https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-183">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="2c0b2-184">Kliknij przycisk **więcej usług**, następnie kliknij przycisk **sieciowej grupy zabezpieczeń** na liście.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-184">Click **More services**, then click **Network security groups** in the list that appears.</span></span>
3. <span data-ttu-id="2c0b2-185">Wybierz grupy NSG.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-185">Select an NSG.</span></span> <span data-ttu-id="2c0b2-186">Na poniższej ilustracji grupy NSG o nazwie grupy nsg VM1 został wybrany.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-186">In the following picture, an NSG named VM1-nsg was selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image6.png)
   
    <span data-ttu-id="2c0b2-187">Zwróć uwagę sekcje poprzedniego obrazu:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-187">Notice the following sections of the previous picture:</span></span>
   
   * <span data-ttu-id="2c0b2-188">**Zakres:** ustawioną NSG wybrane.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-188">**Scope:** Set to the NSG selected.</span></span>
   * <span data-ttu-id="2c0b2-189">**Maszyna wirtualna:** gdy grupa NSG jest stosowana do podsieci, nie jest stosowana dla wszystkich interfejsów sieciowych dołączonych do wszystkich maszyn wirtualnych podłączonych do podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-189">**Virtual machine:** When an NSG is applied to a subnet, it's applied to all network interfaces attached to all VMs connected to the subnet.</span></span> <span data-ttu-id="2c0b2-190">Ta lista zawiera ta grupa NSG jest stosowana do wszystkich maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-190">This list shows all VMs this NSG is applied to.</span></span> <span data-ttu-id="2c0b2-191">Żadnej maszyny Wirtualnej można wybrać z listy.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-191">You can select any VM from the list.</span></span>
     
     > [!NOTE]
     > <span data-ttu-id="2c0b2-192">Jeśli grupa NSG jest stosowana tylko puste podsieci, maszyny wirtualne nie są wyświetlane.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-192">If an NSG is applied to only an empty subnet, VMs will not be listed.</span></span> <span data-ttu-id="2c0b2-193">Jeśli grupa NSG jest stosowana do karty Sieciowej, która nie jest skojarzona z maszyną Wirtualną, te karty sieciowe również nie są wyświetlane.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-193">If an NSG is applied to a NIC which is not associated with a VM, those NICs will also not be listed.</span></span> 
     > 
     > 
   * <span data-ttu-id="2c0b2-194">**Interfejs sieciowy:** maszyny Wirtualnej może mieć wiele interfejsów sieciowych.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-194">**Network Interface:** A VM can have multiple network interfaces.</span></span> <span data-ttu-id="2c0b2-195">Możesz wybrać karty sieciowej podłączony do wybranej maszynie Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-195">You can select a network interface attached to the selected VM.</span></span>
   * <span data-ttu-id="2c0b2-196">**AssociatedNSGs:** w dowolnym momencie, karta sieciowa może mieć maksymalnie dwóch skuteczne grup NSG, jeden stosowany do karty Sieciowej, a drugą do podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-196">**AssociatedNSGs:** At any time, a NIC can have up to two effective NSGs, one applied to the NIC and the other to the subnet.</span></span> <span data-ttu-id="2c0b2-197">Mimo że zakres został wybrany jako grupa nsg VM1, jeśli karta NIC ma podsieć skuteczne NSG, dane wyjściowe zostaną wyświetlone zarówno grupy NSG.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-197">Although the scope is selected as VM1-nsg, if the NIC has an effective subnet NSG, the output will show both NSGs.</span></span>
4. <span data-ttu-id="2c0b2-198">Zasady można edytować bezpośrednio do grupy zabezpieczeń sieci skojarzonych z karty Sieciowej lub podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-198">You can directly edit rules for NSGs associated with a NIC or subnet.</span></span> <span data-ttu-id="2c0b2-199">Aby dowiedzieć się, jak to zrobić, przeczytaj kroku 8 **wyświetlić reguły efektywnym elementem systemu zabezpieczeń dla maszyny wirtualnej** sekcji tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-199">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

<span data-ttu-id="2c0b2-200">Aby dowiedzieć się więcej o dodatkowe informacje wyświetlane, przeczytaj kroku 6 **wyświetlić reguły efektywnym elementem systemu zabezpieczeń dla maszyny wirtualnej** sekcji tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-200">To learn more about the additional information shown, read step 6 of the **View effective security rules for a virtual machine** section of this article.</span></span>

> [!NOTE]
> <span data-ttu-id="2c0b2-201">Chociaż podsieci i karty Sieciowej można każdego mieć tylko jedną grupę NSG zastosowanych do nich, grupy NSG można skojarzyć wielu kart sieciowych i wielu podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-201">Though a subnet and NIC can each have only one NSG applied to them, an NSG can be associated to multiple NICs and multiple subnets.</span></span>
> 
> 

## <a name="considerations"></a><span data-ttu-id="2c0b2-202">Zagadnienia do rozważenia</span><span class="sxs-lookup"><span data-stu-id="2c0b2-202">Considerations</span></span>
<span data-ttu-id="2c0b2-203">Podczas rozwiązywania problemów z łącznością, należy wziąć pod uwagę następujące kwestie:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-203">Consider the following points when troubleshooting connectivity problems:</span></span>

* <span data-ttu-id="2c0b2-204">Reguły NSG domyślne zostanie blokowanie dostępu przychodzące z Internetu i zezwolić tylko sieci wirtualnej ruch przychodzący.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-204">Default NSG rules will block inbound access from the internet and only permit VNet inbound traffic.</span></span> <span data-ttu-id="2c0b2-205">Zasady należy jawnie dodać udostępnianie przychodzące z Internetu, zgodnie z wymaganiami.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-205">Rules should be explicitly added to allow inbound access from Internet, as required.</span></span>
* <span data-ttu-id="2c0b2-206">Jeśli nie żadnych reguł zabezpieczeń grupy NSG powoduje niepowodzenie łączności sieciowej maszyny Wirtualnej, problem może być z powodu:</span><span class="sxs-lookup"><span data-stu-id="2c0b2-206">If there are no NSG security rules causing a VM’s network connectivity to fail, the problem may be due to:</span></span>
  * <span data-ttu-id="2c0b2-207">Oprogramowanie zapory działających w systemie operacyjnym maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="2c0b2-207">Firewall software running within the VM's operating system</span></span>
  * <span data-ttu-id="2c0b2-208">Trasy skonfigurowanych dla urządzenia wirtualnego lub ruch lokalny.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-208">Routes configured for virtual appliances or on-premises traffic.</span></span> <span data-ttu-id="2c0b2-209">Ruch internetowy mogą zostać przekierowane do lokalnego przy użyciu tunelowania wymuszonego.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-209">Internet traffic can be redirected to on-premises via forced-tunneling.</span></span> <span data-ttu-id="2c0b2-210">Połączenia protokołu RDP/SSH z Internetu do maszyny Wirtualnej może nie działać to ustawienie, w zależności od tego, jak sprzęt sieci lokalnej obsługuje ten ruch.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-210">An RDP/SSH connection from the Internet to your VM may not work with this setting, depending on how the on-premises network hardware handles this traffic.</span></span> <span data-ttu-id="2c0b2-211">Odczyt [Rozwiązywanie problemów z tras](virtual-network-routes-troubleshoot-powershell.md) artykuł, aby dowiedzieć się, jak diagnozować problemy trasy, które mogą utrudnić przepływu ruchu i z maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-211">Read the [Troubleshooting Routes](virtual-network-routes-troubleshoot-powershell.md) article to learn how to diagnose route problems that may be impeding the flow of traffic in and out of the VM.</span></span> 
* <span data-ttu-id="2c0b2-212">Domyślnie ma połączyć za pomocą sieci wirtualnych, VIRTUAL_NETWORK tag zostanie automatycznie rozwiń węzeł aby objąć prefiksy połączyć za pomocą sieci wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-212">If you have peered VNets, by default, the VIRTUAL_NETWORK tag will automatically expand to include prefixes for peered VNets.</span></span> <span data-ttu-id="2c0b2-213">Możesz wyświetlić te prefiksy **ExpandedAddressPrefix** listy, aby rozwiązać problemy związane z łącznością komunikacji równorzędnej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-213">You can view these prefixes in the **ExpandedAddressPrefix** list, to troubleshoot any issues related to VNet peering connectivity.</span></span> 
* <span data-ttu-id="2c0b2-214">Reguły efektywnym elementem systemu zabezpieczeń są wyświetlane tylko jeśli jest grupy NSG skojarzonej z maszyny Wirtualnej karty Sieciowej i podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-214">Effective security rules are only shown if there is an NSG associated with the VM’s NIC and or subnet.</span></span> 
* <span data-ttu-id="2c0b2-215">Jeśli nie ma żadnych grup NSG skojarzona z kartą Sieciową lub w podsieci i publicznego adresu IP przypisane do maszyny Wirtualnej, wszystkie porty jest otwarte dla przychodzący i wychodzący dostęp.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-215">If there are no NSGs associated with the NIC or subnet and you have a public IP address assigned to your VM, all ports will be open for inbound and outbound access.</span></span> <span data-ttu-id="2c0b2-216">Jeśli maszyna wirtualna ma publiczny adres IP, zdecydowanie zalecane jest zastosowanie grup NSG do kart Sieciowych lub podsieci.</span><span class="sxs-lookup"><span data-stu-id="2c0b2-216">If the VM has a public IP address, applying NSGs to the NIC or subnet is strongly recommended.</span></span>

