---
title: "trasy zdefiniowane przez aaaUser i przesyłania dalej protokołu IP na platformie Azure | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak trasy zdefiniowane przez użytkownika tooconfigure (przez) i przesyłania dalej protokołu IP tooforward ruchu toonetwork urządzeń wirtualnych na platformie Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="25db8-103">Trasy zdefiniowane przez użytkownika i przekazywanie adresów IP</span><span class="sxs-lookup"><span data-stu-id="25db8-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="25db8-104">Po dodaniu maszynach wirtualnych (VM) tooa sieć wirtualną (VNet) na platformie Azure można zauważyć maszyn wirtualnych hello automatycznie są możliwe toocommunicate ze sobą za pośrednictwem sieci hello.</span><span class="sxs-lookup"><span data-stu-id="25db8-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="25db8-105">Nie trzeba toospecify bramy, nawet jeśli hello maszyn wirtualnych znajdują się w różnych podsieciach.</span><span class="sxs-lookup"><span data-stu-id="25db8-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="25db8-106">Witaj dotyczy to także komunikacji z toohello maszyn wirtualnych hello publicznego Internetu i sieci lokalnej tooyour nawet gdy połączenie hybrydowe z platformy Azure tooyour własnych centrum danych jest obecny.</span><span class="sxs-lookup"><span data-stu-id="25db8-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="25db8-107">Taki przepływ komunikacji jest możliwa, ponieważ Azure korzysta z szeregu toodefine trasy systemu sposób przepływu ruchu w sieci IP.</span><span class="sxs-lookup"><span data-stu-id="25db8-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="25db8-108">Trasy systemowe sterują przepływem hello komunikacji hello następujące scenariusze:</span><span class="sxs-lookup"><span data-stu-id="25db8-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="25db8-109">Z poziomu hello tej samej podsieci.</span><span class="sxs-lookup"><span data-stu-id="25db8-109">From within hello same subnet.</span></span>
* <span data-ttu-id="25db8-110">Z tooanother podsieci w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="25db8-111">Z maszyn wirtualnych toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="25db8-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="25db8-112">Z sieci wirtualnej tooanother sieci wirtualnej za pośrednictwem bramy sieci VPN.</span><span class="sxs-lookup"><span data-stu-id="25db8-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="25db8-113">Z tooanother sieci wirtualnej sieci wirtualnej za pośrednictwem sieci wirtualnej komunikacji równorzędnej (łańcucha usługi).</span><span class="sxs-lookup"><span data-stu-id="25db8-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="25db8-114">Z sieci wirtualnej sieci lokalnej tooyour za pośrednictwem bramy sieci VPN.</span><span class="sxs-lookup"><span data-stu-id="25db8-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="25db8-115">na poniższym rysunku Hello przedstawiono prostą konfigurację obejmującą sieć wirtualną, dwie podsieci i kilka maszyn wirtualnych wraz z hello tras systemowych, umożliwiających tooflow ruchu IP.</span><span class="sxs-lookup"><span data-stu-id="25db8-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Trasy systemowe platformy Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="25db8-117">Chociaż hello korzystanie z tras systemowych umożliwia ruch sieciowy automatycznie w danym wdrożeniu, istnieją przypadki, w których chcesz toocontrol hello routingiem pakietów przez urządzenie wirtualne.</span><span class="sxs-lookup"><span data-stu-id="25db8-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="25db8-118">Można więc tworząc trasy zdefiniowane przez użytkownika, który określisz hello następnego skoku dla pakietów przepływających zamiast tego urządzenia wirtualnego toogo tooyour tooa określonej podsieci i włączenie IP hello przesyłania dalej dla maszyny Wirtualnej uruchomionej jako urządzenie wirtualne hello.</span><span class="sxs-lookup"><span data-stu-id="25db8-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="25db8-119">Hello na poniższej ilustracji przedstawiono przykład tras zdefiniowanych przez użytkownika i przesyłania pakietów tooforce IP wysyłane tooone podsieci z innego toogo przez urządzenie wirtualne w trzeciej podsieci.</span><span class="sxs-lookup"><span data-stu-id="25db8-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Trasy systemowe platformy Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="25db8-121">Trasy zdefiniowane przez użytkownika są stosowane tootraffic wychodzącego z podsieci z wszystkich zasobów (takich jak interfejsów sieciowych dołączonych tooVMs) w podsieci hello.</span><span class="sxs-lookup"><span data-stu-id="25db8-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="25db8-122">Nie można utworzyć trasy toospecify jak ruchu wprowadza podsieci hello Internetu, na przykład.</span><span class="sxs-lookup"><span data-stu-id="25db8-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="25db8-123">urządzenia Hello przesyłasz toocannot ruchu należeć hello tej samej podsieci, w których pochodzą hello ruchu.</span><span class="sxs-lookup"><span data-stu-id="25db8-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="25db8-124">Dla urządzeń zawsze należy utworzyć oddzielne podsieci.</span><span class="sxs-lookup"><span data-stu-id="25db8-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="25db8-125">Zasób trasy</span><span class="sxs-lookup"><span data-stu-id="25db8-125">Route resource</span></span>
<span data-ttu-id="25db8-126">Pakiety są przesyłane za pośrednictwem sieci TCP/IP w oparciu o tabelę tras zdefiniowaną w każdym węźle w sieci fizycznej hello.</span><span class="sxs-lookup"><span data-stu-id="25db8-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="25db8-127">Tabela tras jest kolekcją indywidualnych tras używane toodecide gdzie tooforward pakiety na podstawie hello docelowy adres IP.</span><span class="sxs-lookup"><span data-stu-id="25db8-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="25db8-128">Trasa składa się z następujących hello:</span><span class="sxs-lookup"><span data-stu-id="25db8-128">A route consists of hello following:</span></span>

| <span data-ttu-id="25db8-129">Właściwość</span><span class="sxs-lookup"><span data-stu-id="25db8-129">Property</span></span> | <span data-ttu-id="25db8-130">Opis</span><span class="sxs-lookup"><span data-stu-id="25db8-130">Description</span></span> | <span data-ttu-id="25db8-131">Ograniczenia</span><span class="sxs-lookup"><span data-stu-id="25db8-131">Constraints</span></span> | <span data-ttu-id="25db8-132">Zagadnienia do rozważenia</span><span class="sxs-lookup"><span data-stu-id="25db8-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="25db8-133">Przedrostek adresu</span><span class="sxs-lookup"><span data-stu-id="25db8-133">Address Prefix</span></span> |<span data-ttu-id="25db8-134">dotyczy Hello docelowego CIDR toowhich hello trasa, na przykład 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="25db8-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="25db8-135">Musi być prawidłowy zakres CIDR reprezentujący adresy w hello publicznej sieci Internet, sieci wirtualnej platformy Azure lub lokalnego centrum danych.</span><span class="sxs-lookup"><span data-stu-id="25db8-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="25db8-136">Upewnij się, że hello **prefiks adresu** nie zawiera adresu hello hello **następnego przeskoku**, w przeciwnym razie pakiety wpadną w pętlę, przechodząc od źródła hello toohello następnego przeskoku nigdy nie docierając Lokalizacja docelowa Hello.</span><span class="sxs-lookup"><span data-stu-id="25db8-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="25db8-137">Typ następnego skoku</span><span class="sxs-lookup"><span data-stu-id="25db8-137">Next hop type</span></span> |<span data-ttu-id="25db8-138">Typ Hello pakietów hello Azure przeskoku powinny być przesyłane do.</span><span class="sxs-lookup"><span data-stu-id="25db8-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="25db8-139">Musi mieć jedną z hello następujące wartości:</span><span class="sxs-lookup"><span data-stu-id="25db8-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="25db8-140">**Sieć wirtualna**</span><span class="sxs-lookup"><span data-stu-id="25db8-140">**Virtual Network**.</span></span> <span data-ttu-id="25db8-141">Reprezentuje lokalną sieć wirtualną hello.</span><span class="sxs-lookup"><span data-stu-id="25db8-141">Represents hello local virtual network.</span></span> <span data-ttu-id="25db8-142">Na przykład, jeśli masz dwie podsieci 10.1.0.0/16 i 10.2.0.0/16 w tej samej sieci wirtualnej hello, hello trasa dla każdej podsieci w tabeli tras hello będzie mieć wartość następnego skoku z *sieci wirtualnej*.</span><span class="sxs-lookup"><span data-stu-id="25db8-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="25db8-143">**Brama sieci wirtualnej**</span><span class="sxs-lookup"><span data-stu-id="25db8-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="25db8-144">Reprezentuje usługę Azure S2S VPN Gateway.</span><span class="sxs-lookup"><span data-stu-id="25db8-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="25db8-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="25db8-145">**Internet**.</span></span> <span data-ttu-id="25db8-146">Reprezentuje hello domyślną bramę sieci Internet podał hello infrastruktury platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="25db8-147">**Urządzenie wirtualne**.</span><span class="sxs-lookup"><span data-stu-id="25db8-147">**Virtual Appliance**.</span></span> <span data-ttu-id="25db8-148">Reprezentuje urządzenie wirtualne dodane tooyour sieci wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="25db8-149">**Brak**.</span><span class="sxs-lookup"><span data-stu-id="25db8-149">**None**.</span></span> <span data-ttu-id="25db8-150">Reprezentuje czarną dziurę.</span><span class="sxs-lookup"><span data-stu-id="25db8-150">Represents a black hole.</span></span> <span data-ttu-id="25db8-151">Pakiety przesyłane dalej tooa czarnej dziury nie zostaną w ogóle przekazane.</span><span class="sxs-lookup"><span data-stu-id="25db8-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="25db8-152">Należy rozważyć użycie **urządzenie wirtualne** toodirect ruchu tooa maszyny Wirtualnej lub usługi równoważenia obciążenia Azure wewnętrznego adresu IP.</span><span class="sxs-lookup"><span data-stu-id="25db8-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="25db8-153">Tego typu umożliwia hello Specyfikacja adresu IP, zgodnie z poniższym opisem.</span><span class="sxs-lookup"><span data-stu-id="25db8-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="25db8-154">Należy rozważyć użycie **Brak** wpisz toostop pakiety z przechodzenia tooa danego przeznaczenia.</span><span class="sxs-lookup"><span data-stu-id="25db8-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="25db8-155">Adres następnego skoku</span><span class="sxs-lookup"><span data-stu-id="25db8-155">Next hop address</span></span> |<span data-ttu-id="25db8-156">adres następnego przeskoku Hello zawiera hello adres IP, które powinny zostać przekazane pakiety.</span><span class="sxs-lookup"><span data-stu-id="25db8-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="25db8-157">Wartości następnego skoku są dozwolone tylko w przypadku tras, których typ następnego przeskoku hello jest *urządzenie wirtualne*.</span><span class="sxs-lookup"><span data-stu-id="25db8-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="25db8-158">Musi być adresem IP, który jest dostępny w sieci wirtualnej, w których stosowane hello trasy zdefiniowane przez użytkownika, bez pośrednictwa hello **Brama sieci wirtualnej**.</span><span class="sxs-lookup"><span data-stu-id="25db8-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="25db8-159">adres IP Hello ma toobe hello wirtualne w tej samej sieci, jeśli jest ono stosowane lub peered sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="25db8-160">Jeśli hello adres IP reprezentuje Maszynę wirtualną, upewnij się, możesz włączyć [przesyłanie dalej IP](#IP-forwarding) Azure hello maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="25db8-161">Jeśli hello IP adres reprezentuje hello wewnętrzny adres IP usługi równoważenia obciążenia Azure, upewnij się, że masz dopasowywania reguły dla każdego portu równoważenia obciążenia mają tooload równowagi.</span><span class="sxs-lookup"><span data-stu-id="25db8-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="25db8-162">W programie Azure PowerShell niektóre wartości "Typ następnego przeskoku" hello mają różne nazwy elementu:</span><span class="sxs-lookup"><span data-stu-id="25db8-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="25db8-163">Sieć wirtualna to VnetLocal,</span><span class="sxs-lookup"><span data-stu-id="25db8-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="25db8-164">Brama sieci wirtualnej to VirtualNetworkGateway,</span><span class="sxs-lookup"><span data-stu-id="25db8-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="25db8-165">Urządzenie wirtualne to VirtualAppliance,</span><span class="sxs-lookup"><span data-stu-id="25db8-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="25db8-166">Internet to Internet</span><span class="sxs-lookup"><span data-stu-id="25db8-166">Internet is Internet</span></span>
* <span data-ttu-id="25db8-167">Brak to None.</span><span class="sxs-lookup"><span data-stu-id="25db8-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="25db8-168">Trasy systemowe</span><span class="sxs-lookup"><span data-stu-id="25db8-168">System routes</span></span>
<span data-ttu-id="25db8-169">Każda podsieć utworzona w sieci wirtualnej jest automatycznie kojarzony z tabeli tras, która zawiera następujące reguły dotyczące tras systemowych hello:</span><span class="sxs-lookup"><span data-stu-id="25db8-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="25db8-170">**Reguła lokalnej sieci wirtualnej**: ta reguła jest tworzona automatycznie dla każdej podsieci w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="25db8-171">Określa, że istnieje bezpośrednie połączenie między maszynami wirtualnymi hello w hello sieci wirtualnej i żadnego pośredniego następnego skoku nie istnieje.</span><span class="sxs-lookup"><span data-stu-id="25db8-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="25db8-172">**Reguła lokalna**: Ta reguła stosuje się zakres adresów lokalnych toohello ruch kierowany tooall i używa bramy sieci VPN jako miejsca docelowego hello następnego skoku.</span><span class="sxs-lookup"><span data-stu-id="25db8-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="25db8-173">**Reguła sieci Internet**: Ta reguła obsługuje wszystkie toohello ruch kierowany publicznej sieci Internet (0.0.0.0/0 prefiks adresu) i bramą internetową infrastruktury hello używa jako hello następnego przeskoku dla wszystkich toohello ruch kierowany Internet.</span><span class="sxs-lookup"><span data-stu-id="25db8-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="25db8-174">Trasy definiowane przez użytkownika</span><span class="sxs-lookup"><span data-stu-id="25db8-174">User-defined routes</span></span>
<span data-ttu-id="25db8-175">Dla większości środowisk wystarczy hello trasy systemowe zdefiniowane już przez platformę Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="25db8-176">Można jednak konieczne toocreate tabelę tras i dodać co najmniej jednej trasy w szczególnych przypadkach, takich jak:</span><span class="sxs-lookup"><span data-stu-id="25db8-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="25db8-177">Wymuszanie tunelowania toohello Internet za pośrednictwem sieci lokalnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="25db8-178">Korzystanie z urządzeń lokalnych w środowisku platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="25db8-179">W powyższych scenariuszy hello będzie mieć toocreate tabelę tras i dodać tooit trasy zdefiniowane przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="25db8-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="25db8-180">Może występować wiele tabel tras i hello sama tabela może być skojarzony tooone lub więcej podsieci.</span><span class="sxs-lookup"><span data-stu-id="25db8-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="25db8-181">A każda podsieć może być tylko skojarzona tooa jedną tabelą tras.</span><span class="sxs-lookup"><span data-stu-id="25db8-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="25db8-182">Wszystkie maszyny wirtualne i usługi w chmurze w podsieci użyć hello trasy tabeli skojarzonej toothat podsieci.</span><span class="sxs-lookup"><span data-stu-id="25db8-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="25db8-183">Korzysta ona z tras systemowych do momentu tabelę tras jest toohello skojarzonych podsieci.</span><span class="sxs-lookup"><span data-stu-id="25db8-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="25db8-184">Jeśli skojarzenie istnieje, routing odbywa się w oparciu o najdłuższe dopasowanie prefiksu (Longest Prefix Match, LPM) wybierane spośród tras definiowanych przez użytkownika i tras systemowych.</span><span class="sxs-lookup"><span data-stu-id="25db8-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="25db8-185">Jeśli istnieje więcej niż jedna trasa z hello LPM tego samego odpowiada, a następnie, wybór trasy odbywa się w następującej kolejności hello:</span><span class="sxs-lookup"><span data-stu-id="25db8-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="25db8-186">Trasa zdefiniowana przez użytkownika</span><span class="sxs-lookup"><span data-stu-id="25db8-186">User defined route</span></span>
2. <span data-ttu-id="25db8-187">Trasa protokołu BGP (jeśli używane są połączenia ExpressRoute)</span><span class="sxs-lookup"><span data-stu-id="25db8-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="25db8-188">Trasa systemowa</span><span class="sxs-lookup"><span data-stu-id="25db8-188">System route</span></span>

<span data-ttu-id="25db8-189">toolearn trasy zdefiniowane przez użytkownika toocreate zobacz [jak tooCreate tras i włączanie przesyłania dalej IP na platformie Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="25db8-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="25db8-190">Trasy zdefiniowane przez użytkownika są tylko zastosowane tooAzure maszyn wirtualnych i usług w chmurze.</span><span class="sxs-lookup"><span data-stu-id="25db8-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="25db8-191">Na przykład chcąc tooadd urządzenie wirtualne zapory między siecią lokalną a Azure, trzeba będzie toocreate trasy zdefiniowanej przez użytkownika dla tabel tras platformy przekazujący całego ruchu kierowanego toohello przestrzeni adresów lokalnych toohello wirtualnego urządzenia.</span><span class="sxs-lookup"><span data-stu-id="25db8-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="25db8-192">Można również dodać zdefiniowany przez użytkownika tras (przez) toohello GatewaySubnet tooforward cały ruch z lokalnymi tooAzure za pośrednictwem hello urządzenie wirtualne.</span><span class="sxs-lookup"><span data-stu-id="25db8-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="25db8-193">Ta możliwość została ostatnio dodana.</span><span class="sxs-lookup"><span data-stu-id="25db8-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="25db8-194">Trasy protokołu BGP</span><span class="sxs-lookup"><span data-stu-id="25db8-194">BGP routes</span></span>
<span data-ttu-id="25db8-195">Jeśli masz połączenie ExpressRoute między siecią lokalną a Azure, można włączyć trasy protokołu BGP toopropagate z Twojej tooAzure sieci lokalnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="25db8-196">Te trasy protokołu BGP są używane w hello trasy definiowane przez sam sposób jak tras systemowych i użytkownika w każdej podsieci platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="25db8-197">Więcej informacji można znaleźć w artykule [ExpressRoute — wprowadzenie](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="25db8-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="25db8-198">Istnieje możliwość skonfigurowania tunelowania przez sieć lokalną, tworząc trasy zdefiniowane przez użytkownika dla podsieci 0.0.0.0/0, korzystającą z bramy sieci VPN hello jako hello następnego przeskoku działu toouse środowiska platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="25db8-199">Metoda ta działa jednak tylko w przypadku korzystania z bramy sieci VPN, a nie połączeń ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="25db8-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="25db8-200">W przypadku połączeń ExpressRoute wymuszanie tunelowania jest konfigurowane za pomocą protokołu BGP.</span><span class="sxs-lookup"><span data-stu-id="25db8-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="25db8-201">Przekazywanie IP</span><span class="sxs-lookup"><span data-stu-id="25db8-201">IP forwarding</span></span>
<span data-ttu-id="25db8-202">Jak opisano powyżej, jednym toocreate głównych powodów hello trasy zdefiniowane przez użytkownika jest urządzenie wirtualne tooa tooforward ruchu.</span><span class="sxs-lookup"><span data-stu-id="25db8-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="25db8-203">Urządzenie wirtualne jest tylko maszynę Wirtualną, która uruchamia ruchu sieciowego toohandle aplikacji używane w sposób, takie jak Zapora lub urządzenie NAT.</span><span class="sxs-lookup"><span data-stu-id="25db8-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="25db8-204">Ta maszyna wirtualna musi być możliwe tooreceive ruchu przychodzącego, który jest Nieuwzględnione tooitself.</span><span class="sxs-lookup"><span data-stu-id="25db8-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="25db8-205">tooallow ruch tooreceive maszyn wirtualnych skierowana tooother miejsc docelowych, należy włączyć przesyłania dalej protokołu IP dla hello maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="25db8-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="25db8-206">To ustawienie nie jest to ustawienie w systemie operacyjnym gościa hello Azure.</span><span class="sxs-lookup"><span data-stu-id="25db8-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="25db8-207">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="25db8-207">Next steps</span></span>
* <span data-ttu-id="25db8-208">Dowiedz się, jak za[tworzyć trasy w modelu wdrażania usługi Resource Manager hello](virtual-network-create-udr-arm-template.md) i kojarzyć je toosubnets.</span><span class="sxs-lookup"><span data-stu-id="25db8-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="25db8-209">Dowiedz się, jak za[tworzyć trasy w hello klasycznego modelu wdrażania](virtual-network-create-udr-classic-ps.md) i kojarzyć je toosubnets.</span><span class="sxs-lookup"><span data-stu-id="25db8-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>

