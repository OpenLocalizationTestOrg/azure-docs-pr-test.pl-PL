---
title: "Szczegółowy Pulpit zdalny, rozwiązywanie problemów z platformy Azure | Dokumentacja firmy Microsoft"
description: "Przeglądanie szczegółowe kroki rozwiązywania problemów dla zdalnego pulpitu błędy, których nie do maszyn wirtualnych systemu Windows na platformie Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "Nie można połączyć z pulpitem zdalnym, rozwiązywanie problemów z pulpitu zdalnego, Pulpit zdalny nie może połączyć błędy usług pulpitu zdalnego, rozwiązywania problemów pulpitu zdalnego, problemy z pulpitu zdalnego"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: 22080b9402b13fd8162024db10aef5475880e4a7
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-to-windows-vms-in-azure"></a><span data-ttu-id="7e80c-104">Szczegółowe kroki rozwiązywania problemów dotyczących problemów połączeń usług pulpitu zdalnego do maszyn wirtualnych systemu Windows na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="7e80c-104">Detailed troubleshooting steps for remote desktop connection issues to Windows VMs in Azure</span></span>
<span data-ttu-id="7e80c-105">Ten artykuł zawiera szczegółowe kroki rozwiązywania problemów w celu zdiagnozowania i rozwiązania złożonych błędy pulpitu zdalnego dla komputerów z systemem Windows Azure maszyny wirtualne.</span><span class="sxs-lookup"><span data-stu-id="7e80c-105">This article provides detailed troubleshooting steps to diagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7e80c-106">Aby wyeliminować błędy częściej pulpitu zdalnego, upewnij się, że odczytu [podstawowe artykuł dotyczący rozwiązywania problemów dla pulpitu zdalnego](troubleshoot-rdp-connection.md) przed kontynuowaniem.</span><span class="sxs-lookup"><span data-stu-id="7e80c-106">To eliminate the more common Remote Desktop errors, make sure to read [the basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="7e80c-107">Możesz napotkać komunikat o błędzie, który wygląda inaczej, wszelkie komunikaty o błędach specyficznych objęte pulpitu zdalnego [podstawowy przewodnik rozwiązywania problemów z pulpitu zdalnego](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="7e80c-107">You may encounter a Remote Desktop error message that does not resemble any of the specific error messages covered in [the basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="7e80c-108">Wykonaj następujące kroki, aby określić, dlaczego nie można nawiązać połączenia z usługą RDP na maszynie Wirtualnej platformy Azure jest klienta usług pulpitu zdalnego (RDP).</span><span class="sxs-lookup"><span data-stu-id="7e80c-108">Follow these steps to determine why the Remote Desktop (RDP) client is unable to connect to the RDP service on the Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="7e80c-109">Jeśli potrzebujesz więcej pomocy w dowolnym momencie, w tym artykule, możesz skontaktować się ekspertów platformy Azure na [MSDN Azure i fora przepełnienie stosu](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="7e80c-109">If you need more help at any point in this article, you can contact the Azure experts on [the MSDN Azure and the Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="7e80c-110">Alternatywnie można również pliku zdarzenia pomocy technicznej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="7e80c-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="7e80c-111">Przejdź do [witrynę pomocy technicznej platformy Azure](https://azure.microsoft.com/support/options/) i kliknij przycisk **Get Support**.</span><span class="sxs-lookup"><span data-stu-id="7e80c-111">Go to the [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="7e80c-112">Aby uzyskać informacje o korzystaniu z pomocą techniczną platformy Azure, przeczytaj [często zadawane pytania dotyczące programu Microsoft Azure Obsługa](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="7e80c-112">For information about using Azure Support, read the [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="7e80c-113">Składniki połączenia pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="7e80c-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="7e80c-114">Połączenie RDP obejmuje następujące składniki:</span><span class="sxs-lookup"><span data-stu-id="7e80c-114">The following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="7e80c-115">Przed kontynuowaniem, warto umysłowo Przejrzyj zmiany od momentu ostatniego pomyślnego połączenia pulpitu zdalnego do maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7e80c-115">Before proceeding, it might help to mentally review what has changed since the last successful Remote Desktop connection to the VM.</span></span> <span data-ttu-id="7e80c-116">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="7e80c-116">For example:</span></span>

* <span data-ttu-id="7e80c-117">Publiczny adres IP maszyny Wirtualnej lub usługi w chmurze zawierających maszyny Wirtualnej (nazywane również wirtualnego adresu IP [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) została zmieniona.</span><span class="sxs-lookup"><span data-stu-id="7e80c-117">The public IP address of the VM or the cloud service containing the VM (also called the virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="7e80c-118">Niepowodzenie RDP mogło być, ponieważ pamięć podręczna klienta DNS nadal zawiera *stary adres IP* zarejestrowane nazwy DNS.</span><span class="sxs-lookup"><span data-stu-id="7e80c-118">The RDP failure could be because your DNS client cache still has the *old IP address* registered for the DNS name.</span></span> <span data-ttu-id="7e80c-119">Opróżnienia pamięci podręcznej klienta DNS, a następnie spróbuj ponownie nawiązać połączenie z maszyną Wirtualną.</span><span class="sxs-lookup"><span data-stu-id="7e80c-119">Flush your DNS client cache and try connecting the VM again.</span></span> <span data-ttu-id="7e80c-120">Lub spróbuj połączyć się bezpośrednio przy użyciu nowego adresu VIP.</span><span class="sxs-lookup"><span data-stu-id="7e80c-120">Or try connecting directly with the new VIP.</span></span>
* <span data-ttu-id="7e80c-121">Używasz aplikacji innych firm do zarządzania połączeniami pulpitu zdalnego zamiast przy użyciu połączenia wygenerowane w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="7e80c-121">You are using a third-party application to manage your Remote Desktop connections instead of using the connection generated by the Azure portal.</span></span> <span data-ttu-id="7e80c-122">Upewnij się, że konfiguracja aplikacji zawiera poprawny port TCP dla ruchu pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-122">Verify that the application configuration includes the correct TCP port for the Remote Desktop traffic.</span></span> <span data-ttu-id="7e80c-123">Możesz sprawdzić tego portu klasycznych maszyn wirtualnych w [portalu Azure](https://portal.azure.com), klikając ustawienia maszyny Wirtualnej > punktów końcowych.</span><span class="sxs-lookup"><span data-stu-id="7e80c-123">You can check this port for a classic virtual machine in the [Azure portal](https://portal.azure.com), by clicking the VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="7e80c-124">Czynności wstępne</span><span class="sxs-lookup"><span data-stu-id="7e80c-124">Preliminary steps</span></span>
<span data-ttu-id="7e80c-125">Przed kontynuowaniem szczegółowe Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="7e80c-125">Before proceeding to the detailed troubleshooting,</span></span>

* <span data-ttu-id="7e80c-126">Sprawdź stan maszyny wirtualnej w portalu Azure w poszukiwaniu problemów oczywiste.</span><span class="sxs-lookup"><span data-stu-id="7e80c-126">Check the status of the virtual machine in the Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="7e80c-127">Postępuj zgodnie z [kroków szybkiej poprawki dla typowych błędów protokołu RDP w podręczniku rozwiązywania problemów podstawowe](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="7e80c-127">Follow the [quick fix steps for common RDP errors in the basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="7e80c-128">Spróbuj ponownie połączyć się z maszyną Wirtualną za pośrednictwem pulpitu zdalnego po wykonaniu tych kroków.</span><span class="sxs-lookup"><span data-stu-id="7e80c-128">Try reconnecting to the VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="7e80c-129">Szczegółowe kroki rozwiązywania problemów</span><span class="sxs-lookup"><span data-stu-id="7e80c-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="7e80c-130">Klient usług pulpitu zdalnego nie może być dostęp do usług pulpitu zdalnego na maszynie Wirtualnej Azure z powodu problemów w następujących źródeł:</span><span class="sxs-lookup"><span data-stu-id="7e80c-130">The Remote Desktop client may not be able to reach the Remote Desktop service on the Azure VM due to issues at the following sources:</span></span>

* [<span data-ttu-id="7e80c-131">Komputer klienta usług pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="7e80c-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="7e80c-132">Urządzenie brzegowe intranetowych w organizacji</span><span class="sxs-lookup"><span data-stu-id="7e80c-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="7e80c-133">Punkt końcowy usługi w chmurze i uzyskiwać dostęp do listy kontroli (ACL)</span><span class="sxs-lookup"><span data-stu-id="7e80c-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="7e80c-134">Sieciowe grupy zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="7e80c-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="7e80c-135">Oparte na systemie Windows Azure maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="7e80c-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="7e80c-136">Źródło 1: Komputer klienta usług pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="7e80c-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="7e80c-137">Upewnij się, że komputer może nawiązywać połączenia pulpitu zdalnego do innego lokalnego, komputer z systemem Windows.</span><span class="sxs-lookup"><span data-stu-id="7e80c-137">Verify that your computer can make Remote Desktop connections to another on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="7e80c-138">Jeśli nie, sprawdź następujące ustawienia na komputerze:</span><span class="sxs-lookup"><span data-stu-id="7e80c-138">If you cannot, check for the following settings on your computer:</span></span>

* <span data-ttu-id="7e80c-139">Ustawienia zapory lokalnej, która blokuje ruch pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="7e80c-140">Lokalnie zainstalowane oprogramowanie serwera proxy klienta, który uniemożliwia połączeń pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="7e80c-141">Lokalnie zainstalować oprogramowania, który uniemożliwia połączeń pulpitu zdalnego do monitorowania sieci.</span><span class="sxs-lookup"><span data-stu-id="7e80c-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="7e80c-142">Inne rodzaje oprogramowania zabezpieczającego które monitorowania ruchu lub Zezwalaj/nie zezwalaj na określone typy ruchu, który uniemożliwia połączeń pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="7e80c-143">W takich przypadkach tymczasowo wyłączone i spróbuj połączyć się z komputerem lokalnym za pośrednictwem pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-143">In all these cases, temporarily disable the software and try to connect to an on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="7e80c-144">Jeśli przyczynę rzeczywiste można znaleźć w ten sposób, współpracować z administratorem sieci, aby rozwiązać oprogramowanie ustawienia połączeń usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-144">If you can find out the actual cause this way, work with your network administrator to correct the software settings to allow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="7e80c-145">Źródło 2: Urządzenie brzegowe intranetu organizacji</span><span class="sxs-lookup"><span data-stu-id="7e80c-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="7e80c-146">Upewnij się, że komputer bezpośrednio połączony z Internetem mogą nawiązywać połączenia pulpitu zdalnego do maszyny wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="7e80c-146">Verify that a computer directly connected to the Internet can make Remote Desktop connections to your Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="7e80c-147">Jeśli nie masz komputera, który jest bezpośrednio połączony z Internetem, tworzenie i testowanie z nowej maszyny wirtualnej platformy Azure w usłudze chmury lub grupy zasobów.</span><span class="sxs-lookup"><span data-stu-id="7e80c-147">If you do not have a computer that is directly connected to the Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="7e80c-148">Aby uzyskać więcej informacji, zobacz [Utwórz maszynę wirtualną z systemem Windows na platformie Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="7e80c-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="7e80c-149">Maszyna wirtualna i grupy zasobów lub usługi w chmurze, można usunąć po testu.</span><span class="sxs-lookup"><span data-stu-id="7e80c-149">You can delete the virtual machine and the resource group or the cloud service, after the test.</span></span>

<span data-ttu-id="7e80c-150">Jeśli tworzysz Podłączanie pulpitu zdalnego z komputerem bezpośrednio połączone z Internetem, sprawdź do urządzenia brzegowe intranetu organizacji:</span><span class="sxs-lookup"><span data-stu-id="7e80c-150">If you can create a Remote Desktop connection with a computer directly attached to the Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="7e80c-151">Wewnętrzny Zapora blokuje połączenia HTTPS z Internetem.</span><span class="sxs-lookup"><span data-stu-id="7e80c-151">An internal firewall blocking HTTPS connections to the Internet.</span></span>
* <span data-ttu-id="7e80c-152">Serwer proxy uniemożliwia połączeń pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="7e80c-153">Włamań lub oprogramowanie na urządzeniach w sieci krawędzi, która uniemożliwia połączeń pulpitu zdalnego do monitorowania sieci.</span><span class="sxs-lookup"><span data-stu-id="7e80c-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="7e80c-154">Skontaktować się z administratorem sieci, aby poprawić ustawień urządzenia brzegowe intranet organizacji, aby zezwolić oparty na protokole HTTPS pulpitu zdalnego połączenia z Internetem.</span><span class="sxs-lookup"><span data-stu-id="7e80c-154">Work with your network administrator to correct the settings of your organization intranet edge device to allow HTTPS-based Remote Desktop connections to the Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="7e80c-155">Źródło 3: Punkt końcowy usługi w chmurze i listy ACL</span><span class="sxs-lookup"><span data-stu-id="7e80c-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="7e80c-156">Dla maszyn wirtualnych utworzonych przy użyciu klasycznego modelu wdrożenia Sprawdź, czy innej maszyny Wirtualnej platformy Azure, który znajduje się w tej samej usługi w chmurze lub sieci wirtualnej mogą wysyłać połączeń pulpitu zdalnego do maszyny Wirtualnej Azure.</span><span class="sxs-lookup"><span data-stu-id="7e80c-156">For VMs created using the Classic deployment model, verify that another Azure VM that is in the same cloud service or virtual network can make Remote Desktop connections to your Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="7e80c-157">Dla maszyn wirtualnych utworzonych w Menedżerze zasobów, przejdź do [źródła 4: grup zabezpieczeń sieci](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="7e80c-157">For virtual machines created in Resource Manager, skip to [Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="7e80c-158">Jeśli nie masz innej maszyny wirtualnej w tej samej usługi w chmurze lub sieci wirtualnej, utwórz je.</span><span class="sxs-lookup"><span data-stu-id="7e80c-158">If you do not have another virtual machine in the same cloud service or virtual network, create one.</span></span> <span data-ttu-id="7e80c-159">Postępuj zgodnie z instrukcjami [Utwórz maszynę wirtualną z systemem Windows na platformie Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="7e80c-159">Follow the steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="7e80c-160">Po zakończeniu testu, należy usunąć testowej maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7e80c-160">Delete the test virtual machine after the test is completed.</span></span>

<span data-ttu-id="7e80c-161">Jeśli można połączyć za pośrednictwem pulpitu zdalnego do maszyny wirtualnej w tej samej usługi w chmurze lub sieci wirtualnej, sprawdź następujące ustawienia:</span><span class="sxs-lookup"><span data-stu-id="7e80c-161">If you can connect via Remote Desktop to a virtual machine in the same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="7e80c-162">Konfiguracja punktu końcowego dla ruchu pulpitu zdalnego w systemie docelowym maszyny Wirtualnej: port TCP prywatny punktu końcowego musi być zgodny z portem TCP, na którym nasłuchuje usługa Pulpit zdalny maszyny Wirtualnej (wartość domyślna to 3389).</span><span class="sxs-lookup"><span data-stu-id="7e80c-162">The endpoint configuration for Remote Desktop traffic on the target VM: The private TCP port of the endpoint must match the TCP port on which the VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="7e80c-163">Listy ACL punktu końcowego ruchu pulpitu zdalnego w systemie docelowym maszyny Wirtualnej: listy kontroli dostępu zezwala na określanie dozwolony lub niedozwolony ruch przychodzący z Internetu, na podstawie jego adresu IP źródłowego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-163">The ACL for the Remote Desktop traffic endpoint on the target VM: ACLs allow you to specify allowed or denied incoming traffic from the Internet based on its source IP address.</span></span> <span data-ttu-id="7e80c-164">Nieprawidłowo skonfigurowane listy kontroli dostępu może uniemożliwić ruchu przychodzącego usług pulpitu zdalnego do punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic to the endpoint.</span></span> <span data-ttu-id="7e80c-165">Sprawdź z listy kontroli dostępu, aby upewnić się, że ruch przychodzący z publiczne adresy IP serwera proxy lub inny serwer krawędzi jest dozwolone.</span><span class="sxs-lookup"><span data-stu-id="7e80c-165">Check your ACLs to ensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="7e80c-166">Aby uzyskać więcej informacji, zobacz [co to jest sieć listy kontroli dostępu (ACL)?](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="7e80c-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="7e80c-167">Aby sprawdzić, czy punkt końcowy jest źródłem problemu, Usuń bieżący punkt końcowy i utworzyć nową, wybierając losowego portu z zakresu od 49152 – 65535 numeru portu zewnętrznego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-167">To check if the endpoint is the source of the problem, remove the current endpoint and create a new one, choosing a random port in the range 49152–65535 for the external port number.</span></span> <span data-ttu-id="7e80c-168">Aby uzyskać więcej informacji, zobacz [sposobu konfigurowania punktów końcowych do maszyny wirtualnej](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="7e80c-168">For more information, see [How to set up endpoints to a virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="7e80c-169">Źródła 4: Grupy zabezpieczeń sieci</span><span class="sxs-lookup"><span data-stu-id="7e80c-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="7e80c-170">Grupy zabezpieczeń sieci umożliwiają większą kontrolę nad dozwolonego ruchu przychodzącego i wychodzącego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="7e80c-171">Można utworzyć zasady obejmujące podsieci i usług w sieci wirtualnej platformy Azure w chmurze.</span><span class="sxs-lookup"><span data-stu-id="7e80c-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="7e80c-172">Użyj funkcji [weryfikacji przepływu adresu IP](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) w celu potwierdzenia, że reguła w sieciowej grupie zabezpieczeń blokuje ruch do lub z maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7e80c-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) to confirm if a rule in a Network Security Group is blocking traffic to or from a virtual machine.</span></span> <span data-ttu-id="7e80c-173">Można również przejrzeć efektywnym elementem systemu zabezpieczeń zasady grupy w celu zapewnienia ruchu przychodzącego "Zezwalaj" NSG reguły istnieje i jest priorytety dla portu protokołu RDP (ustawienie domyślne 3389).</span><span class="sxs-lookup"><span data-stu-id="7e80c-173">You can also review effective security group rules to ensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="7e80c-174">Aby uzyskać więcej informacji, zobacz [przepływu ruchu przy użyciu skuteczne reguły zabezpieczeń rozwiązywać problemy z maszyny Wirtualnej](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="7e80c-174">For more information, see [Using Effective Security Rules to troubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="7e80c-175">Źródło 5: Opartych na systemie Windows Azure maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="7e80c-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="7e80c-176">Postępuj zgodnie z instrukcjami [w tym artykule](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="7e80c-176">Follow the instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="7e80c-177">W tym artykule resetuje usługi pulpitu zdalnego na maszynie wirtualnej:</span><span class="sxs-lookup"><span data-stu-id="7e80c-177">This article resets the Remote Desktop service on the virtual machine:</span></span>

* <span data-ttu-id="7e80c-178">Włącz regułę domyślną "Pulpit zdalny" Zapora systemu Windows (port 3389 protokołu TCP).</span><span class="sxs-lookup"><span data-stu-id="7e80c-178">Enable the "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="7e80c-179">Włączenie połączeń pulpitu zdalnego za pomocą ustawienia wartości rejestru HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections na 0.</span><span class="sxs-lookup"><span data-stu-id="7e80c-179">Enable Remote Desktop connections by setting the HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value to 0.</span></span>

<span data-ttu-id="7e80c-180">Ponów próbę połączenia z komputera.</span><span class="sxs-lookup"><span data-stu-id="7e80c-180">Try the connection from your computer again.</span></span> <span data-ttu-id="7e80c-181">Jeśli nadal nie można nawiązać za pośrednictwem pulpitu zdalnego, sprawdź następujące możliwe problemy:</span><span class="sxs-lookup"><span data-stu-id="7e80c-181">If you are still not able to connect via Remote Desktop, check for the following possible problems:</span></span>

* <span data-ttu-id="7e80c-182">Usługi pulpitu zdalnego nie działa w systemie docelowym maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7e80c-182">The Remote Desktop service is not running on the target VM.</span></span>
* <span data-ttu-id="7e80c-183">Usługa Pulpit zdalny nie nasłuchuje portu 3389 protokołu TCP.</span><span class="sxs-lookup"><span data-stu-id="7e80c-183">The Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="7e80c-184">Zapora systemu Windows lub innej zapory lokalnej ma wychodzącą regułę, która uniemożliwia ruchu pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="7e80c-185">Włamań lub monitorowania oprogramowania uruchomionego na maszynie wirtualnej Azure sieci uniemożliwia połączeń pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-185">Intrusion detection or network monitoring software running on the Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="7e80c-186">Dla maszyn wirtualnych utworzonych przy użyciu klasycznego modelu wdrażania można użyć sesję zdalną programu Azure PowerShell do maszyny wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="7e80c-186">For VMs created using the classic deployment model, you can use a remote Azure PowerShell session to the Azure virtual machine.</span></span> <span data-ttu-id="7e80c-187">Najpierw należy zainstalować certyfikat dla maszyny wirtualnej usługi hostingu w chmurze.</span><span class="sxs-lookup"><span data-stu-id="7e80c-187">First, you need to install a certificate for the virtual machine's hosting cloud service.</span></span> <span data-ttu-id="7e80c-188">Przejdź do [skonfigurować bezpiecznego środowiska PowerShell dostępu zdalnego do maszyny wirtualnej platformy Azure](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) i Pobierz **InstallWinRMCertAzureVM.ps1** plik skryptu na komputerze lokalnym.</span><span class="sxs-lookup"><span data-stu-id="7e80c-188">Go to [Configure Secure Remote PowerShell Access to Azure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download the **InstallWinRMCertAzureVM.ps1** script file to your local computer.</span></span>

<span data-ttu-id="7e80c-189">Następnie zainstaluj programu Azure PowerShell, jeśli nie jest jeszcze.</span><span class="sxs-lookup"><span data-stu-id="7e80c-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="7e80c-190">Zobacz artykuł [Instalowanie i konfigurowanie programu Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="7e80c-190">See [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="7e80c-191">Następnie otwórz wiersz polecenia programu PowerShell systemu Azure i zmień bieżący folder na lokalizację **InstallWinRMCertAzureVM.ps1** pliku skryptu.</span><span class="sxs-lookup"><span data-stu-id="7e80c-191">Next, open an Azure PowerShell command prompt and change the current folder to the location of the **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="7e80c-192">Aby uruchomić skrypt programu Azure PowerShell, należy ustawić zasady wykonywania poprawne.</span><span class="sxs-lookup"><span data-stu-id="7e80c-192">To run an Azure PowerShell script, you must set the correct execution policy.</span></span> <span data-ttu-id="7e80c-193">Uruchom **Get-ExecutionPolicy** polecenie, aby określić bieżący poziom zasad.</span><span class="sxs-lookup"><span data-stu-id="7e80c-193">Run the **Get-ExecutionPolicy** command to determine your current policy level.</span></span> <span data-ttu-id="7e80c-194">Informacje o ustawianiu odpowiedni poziom, zobacz [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e80c-194">For information about setting the appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="7e80c-195">Następnie wypełnij nazwę subskrypcji platformy Azure, nazwa usługi w chmurze i nazwę maszyny wirtualnej (usuwanie < i > znaków), a następnie uruchom następujące polecenia.</span><span class="sxs-lookup"><span data-stu-id="7e80c-195">Next, fill in your Azure subscription name, the cloud service name, and your virtual machine name (removing the < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of the cloud service that contains the target virtual machine>"
$vmName="<Name of the target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="7e80c-196">Można uzyskać nazwy poprawną subskrypcję z *Nazwa subskrypcji* właściwości wyświetlania **Get-AzureSubscription** polecenia.</span><span class="sxs-lookup"><span data-stu-id="7e80c-196">You can get the correct subscription name from the *SubscriptionName* property of the display of the **Get-AzureSubscription** command.</span></span> <span data-ttu-id="7e80c-197">Nazwa usługi w chmurze maszyny wirtualnej z uzyskaniem *ServiceName* kolumny na wyświetlaczu **Get-AzureVM** polecenia.</span><span class="sxs-lookup"><span data-stu-id="7e80c-197">You can get the cloud service name for the virtual machine from the *ServiceName* column in the display of the **Get-AzureVM** command.</span></span>

<span data-ttu-id="7e80c-198">Sprawdź, czy istnieje nowy certyfikat.</span><span class="sxs-lookup"><span data-stu-id="7e80c-198">Check if you have the new certificate.</span></span> <span data-ttu-id="7e80c-199">Otwórz przystawkę Certyfikaty dla bieżącego użytkownika i Znajdź **zaufany główny Certification Authorities\Certificates** folderu.</span><span class="sxs-lookup"><span data-stu-id="7e80c-199">Open a Certificates snap-in for the current user and look in the **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="7e80c-200">Powinny pojawić się certyfikatu z nazwą DNS w kolumnie wystawiony dla usługi w chmurze (przykład: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="7e80c-200">You should see a certificate with the DNS name of your cloud service in the Issued To column (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="7e80c-201">Następnie zainicjować sesję zdalną programu Azure PowerShell przy użyciu tych poleceń.</span><span class="sxs-lookup"><span data-stu-id="7e80c-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="7e80c-202">Po wprowadzeniu poświadczeń administratora prawidłowe, powinny zostać wyświetlone informacje podobne do następującego wiersza polecenia programu Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7e80c-202">After entering valid administrator credentials, you should see something similar to the following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="7e80c-203">Pierwsza część ten monit jest nazwę usługi chmury, która zawiera docelową maszynę Wirtualną, która może być inny niż "cloudservice4testing.cloudapp.net".</span><span class="sxs-lookup"><span data-stu-id="7e80c-203">The first part of this prompt is your cloud service name that contains the target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="7e80c-204">Obecnie można przeprowadzić programu Azure PowerShell polecenia dla tej usługi w chmurze do badania problemów wymienionych i popraw konfigurację.</span><span class="sxs-lookup"><span data-stu-id="7e80c-204">You can now issue Azure PowerShell commands for this cloud service to investigate the problems mentioned and correct the configuration.</span></span>

### <a name="to-manually-correct-the-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="7e80c-205">Aby ręcznie rozwiązać nasłuchiwanie na porcie TCP usług pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="7e80c-205">To manually correct the Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="7e80c-206">W wierszu zdalnej sesji programu Azure PowerShell Uruchom to polecenie.</span><span class="sxs-lookup"><span data-stu-id="7e80c-206">At the remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="7e80c-207">Właściwość PortNumber pokazuje bieżący numer portu.</span><span class="sxs-lookup"><span data-stu-id="7e80c-207">The PortNumber property shows the current port number.</span></span> <span data-ttu-id="7e80c-208">W razie potrzeby zmień pulpitu zdalnego portu numer wstecz do wartości domyślnej (3389) za pomocą tego polecenia.</span><span class="sxs-lookup"><span data-stu-id="7e80c-208">If needed, change the Remote Desktop port number back to its default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="7e80c-209">Sprawdź, czy port został zmieniony na 3389 za pomocą tego polecenia.</span><span class="sxs-lookup"><span data-stu-id="7e80c-209">Verify that the port has been changed to 3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="7e80c-210">Zakończenia sesji zdalnej programu Azure PowerShell za pomocą tego polecenia.</span><span class="sxs-lookup"><span data-stu-id="7e80c-210">Exit the remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="7e80c-211">Sprawdź, czy punkt końcowy pulpitu zdalnego dla maszyny Wirtualnej Azure również używa portu TCP 3398 jako wewnętrznego portu.</span><span class="sxs-lookup"><span data-stu-id="7e80c-211">Verify that the Remote Desktop endpoint for the Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="7e80c-212">Ponowne uruchomienie maszyny Wirtualnej Azure, a następnie spróbuj ponownie za pomocą połączenia pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="7e80c-212">Restart the Azure VM and try the Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="7e80c-213">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="7e80c-213">Additional resources</span></span>
[<span data-ttu-id="7e80c-214">Jak można zresetować hasła lub usługi pulpitu zdalnego dla maszyn wirtualnych systemu Windows</span><span class="sxs-lookup"><span data-stu-id="7e80c-214">How to reset a password or the Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="7e80c-215">Instalowanie i konfigurowanie programu Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e80c-215">How to install and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="7e80c-216">Rozwiązywanie problemów z połączeniami Secure Shell (SSH) do maszyny wirtualnej opartych na systemie Linux platformy Azure</span><span class="sxs-lookup"><span data-stu-id="7e80c-216">Troubleshoot Secure Shell (SSH) connections to a Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="7e80c-217">Rozwiązywanie problemów z dostępem do aplikacji działających na maszynie wirtualnej platformy Azure</span><span class="sxs-lookup"><span data-stu-id="7e80c-217">Troubleshoot access to an application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

