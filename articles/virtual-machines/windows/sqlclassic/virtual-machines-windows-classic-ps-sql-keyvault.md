---
title: aaaIntegrate Key Vault z programem SQL Server na maszynach wirtualnych systemu Windows na platformie Azure (klasyczne) | Dokumentacja firmy Microsoft
description: "Dowiedz się, jak tooautomate hello konfiguracji programu SQL Server szyfrowania do użycia z usługą Azure Key Vault. W tym temacie wyjaśniono, jak utworzyć toouse integracji magazynu kluczy Azure z maszyn wirtualnych programu SQL Server w hello klasycznego modelu wdrażania."
services: virtual-machines-windows
documentationcenter: 
author: rothja
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: ab8d41a7-1971-4032-ab71-eb435c455dc1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 02/17/2017
ms.author: jroth
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 54664875b76dac7271d5a9f00b3f41fdc9c08491
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-key-vault-integration-for-sql-server-on-azure-virtual-machines-classic"></a><span data-ttu-id="a356d-104">Konfigurowanie integracji magazynu kluczy Azure dla programu SQL Server na maszynach wirtualnych Azure (klasyczne)</span><span class="sxs-lookup"><span data-stu-id="a356d-104">Configure Azure Key Vault Integration for SQL Server on Azure Virtual Machines (Classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="a356d-105">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="a356d-105">Resource Manager</span></span>](../sql/virtual-machines-windows-ps-sql-keyvault.md)
> * [<span data-ttu-id="a356d-106">Wdrożenie klasyczne</span><span class="sxs-lookup"><span data-stu-id="a356d-106">Classic</span></span>](../classic/ps-sql-keyvault.md)
> 
> 

## <a name="overview"></a><span data-ttu-id="a356d-107">Omówienie</span><span class="sxs-lookup"><span data-stu-id="a356d-107">Overview</span></span>
<span data-ttu-id="a356d-108">Istnieje wiele funkcji szyfrowania programu SQL Server, takich jak [przezroczystego szyfrowania danych (funkcji TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [szyfrowania na poziomie kolumny (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), i [szyfrowania kopii zapasowych](https://msdn.microsoft.com/library/dn449489.aspx).</span><span class="sxs-lookup"><span data-stu-id="a356d-108">There are multiple SQL Server encryption features, such as [transparent data encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [column level encryption (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), and [backup encryption](https://msdn.microsoft.com/library/dn449489.aspx).</span></span> <span data-ttu-id="a356d-109">Te formy szyfrowania wymaga toomanage i przechowywania kluczy kryptograficznych hello używanego do szyfrowania.</span><span class="sxs-lookup"><span data-stu-id="a356d-109">These forms of encryption require you toomanage and store hello cryptographic keys you use for encryption.</span></span> <span data-ttu-id="a356d-110">Witaj usługi Azure Key Vault (AKV) jest zaprojektowana tooimprove hello zabezpieczeń i zarządzanie tych kluczy w lokalizacji bezpieczne i wysokiej dostępności.</span><span class="sxs-lookup"><span data-stu-id="a356d-110">hello Azure Key Vault (AKV) service is designed tooimprove hello security and management of these keys in a secure and highly available location.</span></span> <span data-ttu-id="a356d-111">Witaj [Łącznik usług SQL Server](http://www.microsoft.com/download/details.aspx?id=45344) włącza te klucze z usługi Azure Key Vault toouse programu SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a356d-111">hello [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) enables SQL Server toouse these keys from Azure Key Vault.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="a356d-112">Platforma Azure ma dwa różne modele wdrażania do tworzenia i pracy z zasobami: [Resource Manager i Model Klasyczny](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="a356d-112">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="a356d-113">W tym artykule omówiono przy użyciu klasycznego modelu wdrożenia hello.</span><span class="sxs-lookup"><span data-stu-id="a356d-113">This article covers using hello Classic deployment model.</span></span> <span data-ttu-id="a356d-114">Firma Microsoft zaleca, aby większości nowych wdrożeń korzystać hello modelu Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a356d-114">Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

<span data-ttu-id="a356d-115">Jeśli korzystasz z programu SQL Server z lokalnymi maszynami, istnieją [kroki można wykonać tooaccess usługi Azure Key Vault z komputera lokalnego programu SQL Server](https://msdn.microsoft.com/library/dn198405.aspx).</span><span class="sxs-lookup"><span data-stu-id="a356d-115">If you are running SQL Server with on-premises machines, there are [steps you can follow tooaccess Azure Key Vault from your on-premises SQL Server machine](https://msdn.microsoft.com/library/dn198405.aspx).</span></span> <span data-ttu-id="a356d-116">Jednak dla programu SQL Server na maszynach wirtualnych Azure, można oszczędzić czas za pomocą hello *integracji magazynu kluczy Azure* funkcji.</span><span class="sxs-lookup"><span data-stu-id="a356d-116">But for SQL Server in Azure VMs, you can save time by using hello *Azure Key Vault Integration* feature.</span></span> <span data-ttu-id="a356d-117">Z kilku tooenable poleceń cmdlet programu Azure PowerShell tej funkcji, można zautomatyzować hello konfiguracji niezbędne do tooaccess maszyny Wirtualnej SQL magazynu kluczy.</span><span class="sxs-lookup"><span data-stu-id="a356d-117">With a few Azure PowerShell cmdlets tooenable this feature, you can automate hello configuration necessary for a SQL VM tooaccess your key vault.</span></span>

<span data-ttu-id="a356d-118">Gdy ta funkcja jest włączona, automatycznie jest instalowana hello Łącznik usług SQL Server, konfiguruje tooaccess dostawcy EKM hello Azure Key Vault i tworzy tooallow poświadczeń hello możesz tooaccess Twojego magazynu.</span><span class="sxs-lookup"><span data-stu-id="a356d-118">When this feature is enabled, it automatically installs hello SQL Server Connector, configures hello EKM provider tooaccess Azure Key Vault, and creates hello credential tooallow you tooaccess your vault.</span></span> <span data-ttu-id="a356d-119">Jeśli użytkownik przeglądał hello kroki hello wcześniej wymienionymi lokalnej dokumentacji, zobaczysz, że ta funkcja pozwala zautomatyzować kroki 2 i 3.</span><span class="sxs-lookup"><span data-stu-id="a356d-119">If you looked at hello steps in hello previously mentioned on-premises documentation, you can see that this feature automates steps 2 and 3.</span></span> <span data-ttu-id="a356d-120">jedyną operacją Hello nadal musisz toodo ręcznie jest toocreate hello — magazyn kluczy i kluczy.</span><span class="sxs-lookup"><span data-stu-id="a356d-120">hello only thing you would still need toodo manually is toocreate hello key vault and keys.</span></span> <span data-ttu-id="a356d-121">Dostępne jest zautomatyzowany hello wszystkie ustawienia maszyny wirtualnej SQL.</span><span class="sxs-lookup"><span data-stu-id="a356d-121">From there, hello entire setup of your SQL VM is automated.</span></span> <span data-ttu-id="a356d-122">Po ukończeniu tej konfiguracji tej funkcji można wykonywać toobegin instrukcje T-SQL szyfrowania z bazy danych lub kopii zapasowych w zwykły sposób.</span><span class="sxs-lookup"><span data-stu-id="a356d-122">Once this feature has completed this setup, you can execute T-SQL statements toobegin encrypting your databases or backups as you normally would.</span></span>

[!INCLUDE [AKV Integration Prepare](../../../../includes/virtual-machines-sql-server-akv-prepare.md)]

## <a name="configure-akv-integration"></a><span data-ttu-id="a356d-123">Skonfiguruj Integracja</span><span class="sxs-lookup"><span data-stu-id="a356d-123">Configure AKV Integration</span></span>
<span data-ttu-id="a356d-124">Za pomocą programu PowerShell tooconfigure integracji magazynu kluczy Azure.</span><span class="sxs-lookup"><span data-stu-id="a356d-124">Use PowerShell tooconfigure Azure Key Vault Integration.</span></span> <span data-ttu-id="a356d-125">Witaj następujące sekcje zawierają omówienie hello wymagane parametry, a następnie przykładowy skrypt programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a356d-125">hello following sections provide an overview of hello required parameters and then a sample PowerShell script.</span></span>

### <a name="install-hello-sql-server-iaas-extension"></a><span data-ttu-id="a356d-126">Zainstaluj hello IaaS rozszerzenie dotyczące programu SQL Server</span><span class="sxs-lookup"><span data-stu-id="a356d-126">Install hello SQL Server IaaS Extension</span></span>
<span data-ttu-id="a356d-127">Najpierw [zainstalować hello IaaS rozszerzenie dotyczące programu SQL Server](../classic/sql-server-agent-extension.md).</span><span class="sxs-lookup"><span data-stu-id="a356d-127">First, [install hello SQL Server IaaS Extension](../classic/sql-server-agent-extension.md).</span></span>

### <a name="understand-hello-input-parameters"></a><span data-ttu-id="a356d-128">Zrozumienie hello parametrów wejściowych</span><span class="sxs-lookup"><span data-stu-id="a356d-128">Understand hello input parameters</span></span>
<span data-ttu-id="a356d-129">Witaj następujące tabeli list hello wymagane parametry skryptu PowerShell hello toorun w następnej sekcji hello.</span><span class="sxs-lookup"><span data-stu-id="a356d-129">hello following table lists hello parameters required toorun hello PowerShell script in hello next section.</span></span>

| <span data-ttu-id="a356d-130">Parametr</span><span class="sxs-lookup"><span data-stu-id="a356d-130">Parameter</span></span> | <span data-ttu-id="a356d-131">Opis</span><span class="sxs-lookup"><span data-stu-id="a356d-131">Description</span></span> | <span data-ttu-id="a356d-132">Przykład</span><span class="sxs-lookup"><span data-stu-id="a356d-132">Example</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a356d-133">**$akvURL**</span><span class="sxs-lookup"><span data-stu-id="a356d-133">**$akvURL**</span></span> |<span data-ttu-id="a356d-134">**adres URL magazynu kluczy Hello**</span><span class="sxs-lookup"><span data-stu-id="a356d-134">**hello key vault URL**</span></span> |<span data-ttu-id="a356d-135">"https://contosokeyvault.vault.azure.net/"</span><span class="sxs-lookup"><span data-stu-id="a356d-135">"https://contosokeyvault.vault.azure.net/"</span></span> |
| <span data-ttu-id="a356d-136">**$spName**</span><span class="sxs-lookup"><span data-stu-id="a356d-136">**$spName**</span></span> |<span data-ttu-id="a356d-137">**Główna nazwa usługi**</span><span class="sxs-lookup"><span data-stu-id="a356d-137">**Service Principal name**</span></span> |<span data-ttu-id="a356d-138">"fde2b411 - 33d 5-4e11-af04eb07b669ccf2"</span><span class="sxs-lookup"><span data-stu-id="a356d-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span></span> |
| <span data-ttu-id="a356d-139">**$spSecret**</span><span class="sxs-lookup"><span data-stu-id="a356d-139">**$spSecret**</span></span> |<span data-ttu-id="a356d-140">**Klucz tajny nazwy głównej usługi**</span><span class="sxs-lookup"><span data-stu-id="a356d-140">**Service Principal secret**</span></span> |<span data-ttu-id="a356d-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM ="</span><span class="sxs-lookup"><span data-stu-id="a356d-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span></span> |
| <span data-ttu-id="a356d-142">**$credName**</span><span class="sxs-lookup"><span data-stu-id="a356d-142">**$credName**</span></span> |<span data-ttu-id="a356d-143">**Nazwa poświadczenia**: integracja powoduje utworzenie poświadczenia w programie SQL Server, dzięki czemu hello wirtualna toohave dostępu toohello klucza magazynu.</span><span class="sxs-lookup"><span data-stu-id="a356d-143">**Credential name**: AKV Integration creates a credential within SQL Server, allowing hello VM toohave access toohello key vault.</span></span> <span data-ttu-id="a356d-144">Wybierz nazwę tego poświadczenia.</span><span class="sxs-lookup"><span data-stu-id="a356d-144">Choose a name for this credential.</span></span> |<span data-ttu-id="a356d-145">"mycred1"</span><span class="sxs-lookup"><span data-stu-id="a356d-145">"mycred1"</span></span> |
| <span data-ttu-id="a356d-146">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="a356d-146">**$vmName**</span></span> |<span data-ttu-id="a356d-147">**Nazwa maszyny wirtualnej**: hello nazwę wcześniej utworzonej maszyny Wirtualnej SQL.</span><span class="sxs-lookup"><span data-stu-id="a356d-147">**Virtual machine name**: hello name of a previously created SQL VM.</span></span> |<span data-ttu-id="a356d-148">"myvmname"</span><span class="sxs-lookup"><span data-stu-id="a356d-148">"myvmname"</span></span> |
| <span data-ttu-id="a356d-149">**$serviceName**</span><span class="sxs-lookup"><span data-stu-id="a356d-149">**$serviceName**</span></span> |<span data-ttu-id="a356d-150">**Nazwa usługi**: hello usługi w chmurze nazwę, która jest skojarzona z hello maszyny Wirtualnej SQL.</span><span class="sxs-lookup"><span data-stu-id="a356d-150">**Service name**: hello Cloud Service name that is associated with hello SQL VM.</span></span> |<span data-ttu-id="a356d-151">"mycloudservicename"</span><span class="sxs-lookup"><span data-stu-id="a356d-151">"mycloudservicename"</span></span> |

### <a name="enable-akv-integration-with-powershell"></a><span data-ttu-id="a356d-152">Włącz integracja przy użyciu programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="a356d-152">Enable AKV Integration with PowerShell</span></span>
<span data-ttu-id="a356d-153">Witaj **AzureVMSqlServerKeyVaultCredentialConfig nowy** polecenie cmdlet tworzy obiekt konfiguracji dla funkcji integracji magazynu kluczy Azure hello.</span><span class="sxs-lookup"><span data-stu-id="a356d-153">hello **New-AzureVMSqlServerKeyVaultCredentialConfig** cmdlet creates a configuration object for hello Azure Key Vault Integration feature.</span></span> <span data-ttu-id="a356d-154">Witaj **AzureVMSqlServerExtension zestaw** konfiguruje tej integracji z hello **KeyVaultCredentialSettings** parametru.</span><span class="sxs-lookup"><span data-stu-id="a356d-154">hello **Set-AzureVMSqlServerExtension** configures this integration with hello **KeyVaultCredentialSettings** parameter.</span></span> <span data-ttu-id="a356d-155">Witaj, jak po Pokaż kroki toouse tych poleceń.</span><span class="sxs-lookup"><span data-stu-id="a356d-155">hello following steps show how toouse these commands.</span></span>

1. <span data-ttu-id="a356d-156">W programie Azure PowerShell najpierw skonfigurować parametry wejściowe hello wartościami określonych zgodnie z opisem w poprzednich sekcjach tego tematu, hello.</span><span class="sxs-lookup"><span data-stu-id="a356d-156">In Azure PowerShell, first configure hello input parameters with your specific values as described in hello previous sections of this topic.</span></span> <span data-ttu-id="a356d-157">Przykładem jest Hello następującego skryptu.</span><span class="sxs-lookup"><span data-stu-id="a356d-157">hello following script is an example.</span></span>
   
        $akvURL = "https://contosokeyvault.vault.azure.net/"
        $spName = "fde2b411-33d5-4e11-af04eb07b669ccf2"
        $spSecret = "9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="
        $credName = "mycred1"
        $vmName = "myvmname"
        $serviceName = "mycloudservicename"
2. <span data-ttu-id="a356d-158">Następnie użyj następujących hello skryptu tooconfigure i Włącz integracja.</span><span class="sxs-lookup"><span data-stu-id="a356d-158">Then use hello following script tooconfigure and enable AKV Integration.</span></span>
   
        $secureakv =  $spSecret | ConvertTo-SecureString -AsPlainText -Force
        $akvs = New-AzureVMSqlServerKeyVaultCredentialConfig -Enable -CredentialName $credname -AzureKeyVaultUrl $akvURL -ServicePrincipalName $spName -ServicePrincipalSecret $secureakv
        Get-AzureVM -ServiceName $serviceName -Name $vmName | Set-AzureVMSqlServerExtension -KeyVaultCredentialSettings $akvs | Update-AzureVM

<span data-ttu-id="a356d-159">Witaj rozszerzenia agenta SQL IaaS zaktualizuje hello maszyny Wirtualnej SQL przy użyciu tej nowej konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="a356d-159">hello SQL IaaS Agent Extension will update hello SQL VM with this new configuration.</span></span>

[!INCLUDE [AKV Integration Next Steps](../../../../includes/virtual-machines-sql-server-akv-next-steps.md)]

