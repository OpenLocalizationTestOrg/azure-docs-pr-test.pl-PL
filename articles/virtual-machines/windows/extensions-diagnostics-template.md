---
title: Dodawanie monitorowania i diagnostyki do maszyny wirtualnej platformy Azure | Dokumentacja firmy Microsoft
description: "Szablon usługi Azure resource manager umożliwia utworzenie nowej maszyny wirtualnej systemu Windows z rozszerzeniem diagnostycznych platformy Azure."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6955e3d8c7b032ee898be11e611080905b5069ba
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="c89f5-103">Użyj monitorowania i diagnostyki z szablonów maszyny Wirtualnej systemu Windows i usługi Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="c89f5-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="c89f5-104">Rozszerzenie diagnostyki Azure udostępnia, monitorowania i diagnostyki możliwości w systemie Windows na podstawie maszyny wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="c89f5-104">The Azure Diagnostics Extension provides the monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="c89f5-105">Te możliwości w maszynie wirtualnej można włączyć w tym rozszerzenia jako część szablonu usługi azure resource manager.</span><span class="sxs-lookup"><span data-stu-id="c89f5-105">You can enable these capabilities on the virtual machine by including the extension as part of the azure resource manager template.</span></span> <span data-ttu-id="c89f5-106">Zobacz [tworzenia szablonów usługi Azure Resource Manager z rozszerzeń maszyny Wirtualnej](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) uzyskać więcej informacji o tym wszystkie rozszerzenia w ramach szablonu maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="c89f5-107">W tym artykule opisano, jak dodać rozszerzenie diagnostyki Azure do szablonu maszyny wirtualnej systemu windows.</span><span class="sxs-lookup"><span data-stu-id="c89f5-107">This article describes how you can add the Azure Diagnostics extension to a windows virtual machine template.</span></span>  

## <a name="add-the-azure-diagnostics-extension-to-the-vm-resource-definition"></a><span data-ttu-id="c89f5-108">Dodaj rozszerzenie diagnostyki Azure w definicji zasobu maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="c89f5-108">Add the Azure Diagnostics extension to the VM resource definition</span></span>
<span data-ttu-id="c89f5-109">Aby włączyć rozszerzenie diagnostyki na maszynie wirtualnej systemu Windows należy dodać rozszerzenie jako zasób maszyny Wirtualnej w szablonu usługi Resource manager.</span><span class="sxs-lookup"><span data-stu-id="c89f5-109">To enable the diagnostics extension on a Windows Virtual Machine you need to add the extension as a VM resource in the Resource manager template.</span></span>

<span data-ttu-id="c89f5-110">Dla prostego Menedżera zasobów konfigurację rozszerzenia, aby dodać oparte na maszynie wirtualnej *zasobów* tablicy dla maszyny wirtualnej:</span><span class="sxs-lookup"><span data-stu-id="c89f5-110">For a simple Resource Manager based Virtual Machine add the extension configuration to the *resources* array for the Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="c89f5-111">Inny wspólnej Konwencji jest dodać Konfiguracja rozszerzenia w węźle głównym zasobów szablonu zamiast definiować go w węźle zasobów maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-111">Another common convention is add the extension configuration at the root resources node of the template instead of defining it under the virtual machine's resources node.</span></span> <span data-ttu-id="c89f5-112">Z tej metody należy jawnie określić hierarchiczną relację między rozszerzenia i maszynę wirtualną z *nazwa* i *typu* wartości.</span><span class="sxs-lookup"><span data-stu-id="c89f5-112">With this approach you have to explicitly specify a hierarchical relation between the extension and the virtual machine with the *name* and *type* values.</span></span> <span data-ttu-id="c89f5-113">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="c89f5-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="c89f5-114">Rozszerzenie zawsze jest skojarzony z maszyną wirtualną, możesz bezpośrednio zdefiniować go bezpośrednio w węźle zasobu maszyny wirtualnej lub zdefiniować ją na poziomie podstawowym i umożliwia hierarchiczne konwencji nazewnictwa skojarzyć go z maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-114">The extension is always associated with the virtual machine, you can either directly define it under the virtual machine's resource node directly or define it at the base level and use the hierarchical naming convention to associate it with the virtual machine.</span></span>

<span data-ttu-id="c89f5-115">Zestawy skalowania maszyny wirtualnej konfiguracji rozszerzenia jest przewidziany w *extensionProfile* właściwość *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="c89f5-115">For Virtual Machine Scale Sets the extensions configuration is specified in the *extensionProfile* property of the *VirtualMachineProfile*.</span></span>

<span data-ttu-id="c89f5-116">*Wydawcy* właściwość z wartością **Microsoft.Azure.Diagnostics** i *typu* właściwość z wartością **IaaSDiagnostics** jednoznacznie zidentyfikować rozszerzenia diagnostyki Azure.</span><span class="sxs-lookup"><span data-stu-id="c89f5-116">The *publisher* property with the value of **Microsoft.Azure.Diagnostics** and the *type* property with the value of **IaaSDiagnostics** uniquely identify the Azure Diagnostics extension.</span></span>

<span data-ttu-id="c89f5-117">Wartość *nazwa* właściwości może służyć do odwoływania się do rozszerzenia w grupie zasobów.</span><span class="sxs-lookup"><span data-stu-id="c89f5-117">The value of the *name* property can be used to refer to the extension in the resource group.</span></span> <span data-ttu-id="c89f5-118">Ustawienie jej specjalnie do **Microsoft.Insights.VMDiagnosticsSettings** umożliwi można łatwo zidentyfikować w portalu Azure, zapewniając, że monitorowanie wykresy Pokaż się poprawnie w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="c89f5-118">Setting it specifically to **Microsoft.Insights.VMDiagnosticsSettings** will enable it to be easily identified by the Azure portal ensuring that the monitoring charts show up correctly in the Azure portal.</span></span>

<span data-ttu-id="c89f5-119">*TypeHandlerVersion* Określa wersję rozszerzenia, o których chcesz użyć.</span><span class="sxs-lookup"><span data-stu-id="c89f5-119">The *typeHandlerVersion* specifies the version of the extension you would like to use.</span></span> <span data-ttu-id="c89f5-120">Ustawienie *autoUpgradeMinorVersion* wersja pomocnicza do **true** zapewnia pobierze najnowszą wersję pomocniczą rozszerzenia, które jest dostępne.</span><span class="sxs-lookup"><span data-stu-id="c89f5-120">Setting *autoUpgradeMinorVersion* minor version to **true** ensures that you will get the latest Minor version of the extension that is available.</span></span> <span data-ttu-id="c89f5-121">Zdecydowanie zaleca się, że możesz zawsze ustawić *autoUpgradeMinorVersion* zawsze być **true** tak, aby zawsze uzyskać próbę użycia najnowsze rozszerzenia diagnostyki dostępne nowe funkcje i poprawki błędów.</span><span class="sxs-lookup"><span data-stu-id="c89f5-121">It is highly recommended that you always set *autoUpgradeMinorVersion* to always be **true** so that you always get to use the latest available diagnostics extension with all the new features and bug fixes.</span></span> 

<span data-ttu-id="c89f5-122">*Ustawienia* element zawiera właściwości konfiguracji rozszerzenia, które można ustawić i ponownie odczytywana rozszerzenia (nazywane czasami publicznej konfiguracji).</span><span class="sxs-lookup"><span data-stu-id="c89f5-122">The *settings* element contains configurations properties for the extension that can be set and read back from the extension (sometimes referred to as public configuration).</span></span> <span data-ttu-id="c89f5-123">*Xmlcfg* właściwość zawiera konfigurację xml na podstawie dzienników diagnostycznych liczniki wydajności itp, które zostaną zebrane przez agenta diagnostyki.</span><span class="sxs-lookup"><span data-stu-id="c89f5-123">The *xmlcfg* property contains xml based configuration for the diagnostics logs, performance counters etc that will be collected by the diagnostics agent.</span></span> <span data-ttu-id="c89f5-124">Zobacz [schemat konfiguracji diagnostyki](https://msdn.microsoft.com/library/azure/dn782207.aspx) uzyskać więcej informacji na temat samego schematu xml.</span><span class="sxs-lookup"><span data-stu-id="c89f5-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about the xml schema itself.</span></span> <span data-ttu-id="c89f5-125">Typowym rozwiązaniem jest przechowywanie rzeczywistego pliku xml konfiguracji jako zmienną w szablonie usługi Azure Resource Manager i następnie połącz i base64 kodować je, aby ustawić wartość *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="c89f5-125">A common practice is to store the actual xml configuration as a variable in the Azure Resource Manager template and then concatenate and base64 encode them to set the value for *xmlcfg*.</span></span> <span data-ttu-id="c89f5-126">Zobacz sekcję dotyczącą [zmienne konfiguracji diagnostyki](#diagnostics-configuration-variables) Aby dowiedzieć się więcej o sposobie przechowywania xml w zmiennych.</span><span class="sxs-lookup"><span data-stu-id="c89f5-126">See the section on [diagnostics configuration variables](#diagnostics-configuration-variables) to understand more about how to store the xml in variables.</span></span> <span data-ttu-id="c89f5-127">*StorageAccount* właściwość określa nazwę konta magazynu, do których diagnostyki będą przekazywane dane.</span><span class="sxs-lookup"><span data-stu-id="c89f5-127">The *storageAccount* property specifies the name of the storage account to which diagnostics data will be transferred.</span></span> 

<span data-ttu-id="c89f5-128">Właściwości w *protectedSettings* (Konfiguracja czasami określone jako prywatne) można ustawić, ale nie można odczytać po ustawiany.</span><span class="sxs-lookup"><span data-stu-id="c89f5-128">The properties in *protectedSettings* (sometimes referred to as private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="c89f5-129">Tylko do zapisu rodzaj *protectedSettings* ułatwia przydatne w przypadku przechowywania kluczy tajnych, takie jak klucz konta magazynu której będą zapisywane dane diagnostyczne.</span><span class="sxs-lookup"><span data-stu-id="c89f5-129">The write-only nature of *protectedSettings* makes it useful for storing secrets like the storage account key where the diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="c89f5-130">Określanie konta magazynu diagnostyki jako parametrów</span><span class="sxs-lookup"><span data-stu-id="c89f5-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="c89f5-131">Powyżej fragment json rozszerzenia diagnostyki przyjmuje dwa parametry *existingdiagnosticsStorageAccountName* i *existingdiagnosticsStorageResourceGroup* Aby określić konto magazynu diagnostyki, w którym będą przechowywane dane diagnostyczne.</span><span class="sxs-lookup"><span data-stu-id="c89f5-131">The diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* to specify the diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="c89f5-132">Określenie konta magazynu diagnostyki jako parametr ułatwia łatwo zmienić konto magazynu diagnostyki w różnych środowiskach np. może chcesz użyć innego diagnostycznego konta magazynu do testowania i inną wdrożenia produkcyjnego.</span><span class="sxs-lookup"><span data-stu-id="c89f5-132">Specifying the diagnostics storage account as a parameter makes it easy to change the diagnostics storage account across different environments e.g. you may want to use a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "The name of an existing storage account to which diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "The resource group for the storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="c89f5-133">Jest to najlepsze rozwiązanie, aby określić konto magazynu diagnostyki w innej grupie zasobów niż grupa zasobów dla maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-133">It is best practice to specify a diagnostics storage account in a different resource group than the resource group for the virtual machine.</span></span> <span data-ttu-id="c89f5-134">Grupa zasobów jest uznawana za jednostkę wdrożenia własnej okres istnienia, maszynę wirtualną można wdrożyć i wdrożone nowe aktualizacje konfiguracji zostały wprowadzone go do niego, ale można kontynuować przechowywanie danych diagnostycznych z tego samego konta magazynu przez te wdrożenia maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-134">A resource group can be considered to be a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it to it but you may want to continue storing the diagnostics data in the same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="c89f5-135">Mając konto magazynu w różnych zasobów umożliwia konta magazynu, aby akceptować dane z różnych wdrożenia maszyny wirtualnej, co ułatwia rozwiązywanie problemów w różnych wersjach.</span><span class="sxs-lookup"><span data-stu-id="c89f5-135">Having the storage account in a different resource enables the storage account to accept data from various virtual machine deployments making it easy to troubleshoot issues across the various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="c89f5-136">W przypadku utworzenia szablonu maszyny wirtualnej systemu windows z programu Visual Studio domyślne konto magazynu może być ustawiona do używania tego samego konta magazynu, gdzie jest przekazywany dysk VHD maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-136">If you create a windows virtual machine template from Visual Studio the default storage account might be set to use the same storage account where the virtual machine VHD is uploaded.</span></span> <span data-ttu-id="c89f5-137">To uprościć początkowej konfiguracji maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-137">This is to simplify initial setup of the VM.</span></span> <span data-ttu-id="c89f5-138">Należy ponownie współczynnika szablonu, aby użyć innego konta magazynu, który może być przekazany jako parametr.</span><span class="sxs-lookup"><span data-stu-id="c89f5-138">You should re-factor the template to use a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="c89f5-139">Zmienne konfiguracji diagnostyki</span><span class="sxs-lookup"><span data-stu-id="c89f5-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="c89f5-140">Definiuje powyżej fragment json rozszerzenia diagnostyki *accountid* zmiennej, aby uprościć pobieranie klucz konta magazynu dla magazynu diagnostyki:</span><span class="sxs-lookup"><span data-stu-id="c89f5-140">The diagnostics extension json snippet above defines an *accountid* variable to simplify getting the storage account key for the diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="c89f5-141">*Xmlcfg* właściwości rozszerzenia diagnostyki jest definiowana za pomocą wielu zmiennych, które są połączone ze sobą.</span><span class="sxs-lookup"><span data-stu-id="c89f5-141">The *xmlcfg* property for the diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="c89f5-142">Wartości tych zmiennych są w formacie xml, więc muszą być prawidłowo wpisywany podczas ustawiania zmiennych json.</span><span class="sxs-lookup"><span data-stu-id="c89f5-142">The values of these variables are in xml so they need to be escaped correctly when setting the json variables.</span></span>

<span data-ttu-id="c89f5-143">Poniżej opisano plik xml konfiguracji diagnostyki, który zbiera dane liczników wydajności poziomu standardowych systemowych oraz niektóre dzienniki zdarzeń systemu windows i dzienników infrastruktury Diagnostyka.</span><span class="sxs-lookup"><span data-stu-id="c89f5-143">The following describes the diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="c89f5-144">Ma zostały zmienione znaczenie i prawidłowo sformatowane, dzięki czemu konfiguracji można wkleić bezpośrednio do sekcji zmiennych szablonu.</span><span class="sxs-lookup"><span data-stu-id="c89f5-144">It has been escaped and formatted correctly so that the configuration can directly be pasted into the variables section of your template.</span></span> <span data-ttu-id="c89f5-145">Zobacz [schemat konfiguracji diagnostyki](https://msdn.microsoft.com/library/azure/dn782207.aspx) więcej człowieka przykład do odczytu pliku konfiguracji XML.</span><span class="sxs-lookup"><span data-stu-id="c89f5-145">See the [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of the configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="c89f5-146">Węzeł xml definicji metryk w powyższej konfiguracji jest element konfiguracji ważne, ponieważ definiuje sposób liczników wydajności zdefiniowanych we wcześniejszej części kodu xml w *PerformanceCounter* węzła będą agregowane i przechowywane.</span><span class="sxs-lookup"><span data-stu-id="c89f5-146">The Metrics definition xml node in the above configuration is an important configuration element as it defines how the performance counters defined earlier in the xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="c89f5-147">Te metryki dysku wykresy monitorowania i alertów w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="c89f5-147">These metrics drive the monitoring charts and alerts in the Azure portal.</span></span>  <span data-ttu-id="c89f5-148">**Metryki** węzła o *resourceID* i **MetricAggregation** muszą być zawarte w konfiguracji diagnostyki dla maszyny Wirtualnej, jeśli chcesz wyświetlić dane w portalu Azure monitorowania maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-148">The **Metrics** node with the *resourceID* and **MetricAggregation** must be included in the diagnostics configuration for your VM if you want to see the VM monitoring data in the Azure portal.</span></span> 
> 
> 

<span data-ttu-id="c89f5-149">Poniżej przedstawiono przykładowy kod xml definicji metryk:</span><span class="sxs-lookup"><span data-stu-id="c89f5-149">The following is an example of the xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="c89f5-150">*ResourceID* atrybutu unikatowo identyfikuje maszyny wirtualnej w ramach subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="c89f5-150">The *resourceID* attribute uniquely identifies the virtual machine in your subscription.</span></span> <span data-ttu-id="c89f5-151">Upewnij się, że należy użyć funkcji subscription() i resourceGroup() tak, aby szablon automatycznie aktualizuje te wartości na podstawie subskrypcji i grupy zasobów, które wdrażasz.</span><span class="sxs-lookup"><span data-stu-id="c89f5-151">Make sure to use the subscription() and resourceGroup() functions so that the template automatically updates those values based on the subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="c89f5-152">Jeśli tworzysz wiele maszyn wirtualnych w pętli, musisz wypełnić *resourceID* wartości z funkcji copyIndex() poprawnie rozróżnianie każdego poszczególnych maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="c89f5-152">If you are creating multiple Virtual Machines in a loop then you will have to populate the *resourceID* value with an copyIndex() function to correctly differentiate each individual VM.</span></span> <span data-ttu-id="c89f5-153">*XmlCfg* wartość może zostać zaktualizowane do obsługi to w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="c89f5-153">The *xmlCfg* value can be updated to support this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="c89f5-154">Wartość MetricAggregation *PT1H* i *PT1M* oznaczającego agregacji na minutę i agregacji ponad godzinę.</span><span class="sxs-lookup"><span data-stu-id="c89f5-154">The MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="c89f5-155">Tabele WADMetrics w magazynie</span><span class="sxs-lookup"><span data-stu-id="c89f5-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="c89f5-156">Konfiguracja metryki powyżej wygeneruje tabel na koncie magazynu diagnostyki z następujących konwencji nazewnictwa:</span><span class="sxs-lookup"><span data-stu-id="c89f5-156">The Metrics configuration above will generate tables in your diagnostics storage account with the following naming conventions:</span></span>

* <span data-ttu-id="c89f5-157">**WADMetrics** : standardowego prefiksu dla wszystkich tabel WADMetrics</span><span class="sxs-lookup"><span data-stu-id="c89f5-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="c89f5-158">**PT1H** lub **PT1M** : oznacza, że tabela zawiera agregowanie danych ponad 1 godzina lub 1 minuta</span><span class="sxs-lookup"><span data-stu-id="c89f5-158">**PT1H** or **PT1M** : Signifies that the table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="c89f5-159">**P10D** : oznacza, że tabela będzie zawierać danych dla 10 dni od uruchomienia tabeli na zbieranie danych</span><span class="sxs-lookup"><span data-stu-id="c89f5-159">**P10D** : Signifies the table will contain data for 10 days from when the table started collecting data</span></span>
* <span data-ttu-id="c89f5-160">**V2S** : stała znakowa</span><span class="sxs-lookup"><span data-stu-id="c89f5-160">**V2S** : String constant</span></span>
* <span data-ttu-id="c89f5-161">**RRRRMMDD** : Data, w którym tabeli rozpoczęcia, zbieranie danych</span><span class="sxs-lookup"><span data-stu-id="c89f5-161">**yyyymmdd** : The date at which the table started collecting data</span></span>

<span data-ttu-id="c89f5-162">Przykład: *WADMetricsPT1HP10DV2S20151108* zawierają zagregowane ponad godzinę 10 dni, począwszy od dnia 2015-11-lis dane metryk</span><span class="sxs-lookup"><span data-stu-id="c89f5-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="c89f5-163">Każda tabela WADMetrics będzie zawierać następujące kolumny:</span><span class="sxs-lookup"><span data-stu-id="c89f5-163">Each WADMetrics table will contain the following columns:</span></span>

* <span data-ttu-id="c89f5-164">**PartitionKey**: partitionkey jest tworzony na podstawie *resourceID* wartość do unikatowej identyfikacji zasobu maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="c89f5-164">**PartitionKey**: The partitionkey is constructed based on the *resourceID* value to uniquely identify the VM resource.</span></span> <span data-ttu-id="c89f5-165">na przykład: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="c89f5-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="c89f5-166">**RowKey** : zgodne z formatem <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="c89f5-166">**RowKey** : Follows the format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="c89f5-167">Malejącej obliczanie osi czasu jest Takty maksymalny czas minus godzina rozpoczęcia okresu agregacji.</span><span class="sxs-lookup"><span data-stu-id="c89f5-167">The descending time tick calculation is max time ticks minus the time of the beginning of the aggregation period.</span></span> <span data-ttu-id="c89f5-168">Na przykład</span><span class="sxs-lookup"><span data-stu-id="c89f5-168">E.g.</span></span> <span data-ttu-id="c89f5-169">Jeśli okres próbki uruchomione w dniu 2015-10-lis i będzie 00:00Hrs UTC, a następnie obliczenia: DateTime.MaxValue.Ticks - (DateTime(2015,11,10,0,0,0,DateTimeKind.Utc) nowe. Znaczniki).</span><span class="sxs-lookup"><span data-stu-id="c89f5-169">if the sample period started on 10-Nov-2015 and 00:00Hrs UTC then the calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="c89f5-170">Dla pamięci klucz wiersza danych licznika wydajności liczba dostępnych bajtów będzie wyglądała, takich jak: 2519551871999999999__:005CMemory:005CAvailable:0020 bajtów</span><span class="sxs-lookup"><span data-stu-id="c89f5-170">For the memory available bytes performance counter the row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="c89f5-171">**CounterName** : Nazwa licznika wydajności.</span><span class="sxs-lookup"><span data-stu-id="c89f5-171">**CounterName** : Is the name of the performance counter.</span></span> <span data-ttu-id="c89f5-172">Odpowiada *counterSpecifier* zdefiniowane w pliku konfiguracji xml.</span><span class="sxs-lookup"><span data-stu-id="c89f5-172">This matches the *counterSpecifier* defined in the xml config.</span></span>
* <span data-ttu-id="c89f5-173">**Maksymalna** : maksymalna wartość licznika wydajności w okresie agregacji.</span><span class="sxs-lookup"><span data-stu-id="c89f5-173">**Maximum** : The maximum value of the performance counter over the aggregation period.</span></span>
* <span data-ttu-id="c89f5-174">**Minimalna** : minimalną wartość licznika wydajności w okresie agregacji.</span><span class="sxs-lookup"><span data-stu-id="c89f5-174">**Minimum** : The minimum value of the performance counter over the aggregation period.</span></span>
* <span data-ttu-id="c89f5-175">**Całkowita liczba** : sumę wszystkich wartości licznika wydajności zgłoszonych w okresie agregacji.</span><span class="sxs-lookup"><span data-stu-id="c89f5-175">**Total** : The sum of all values of the performance counter reported over the aggregation period.</span></span>
* <span data-ttu-id="c89f5-176">**Liczba** : zgłosił sumę wartości licznika wydajności.</span><span class="sxs-lookup"><span data-stu-id="c89f5-176">**Count** : The total number of values reported for the performance counter.</span></span>
* <span data-ttu-id="c89f5-177">**Średnia** : wartość średnia (łączna/liczba) licznika wydajności w okresie agregacji.</span><span class="sxs-lookup"><span data-stu-id="c89f5-177">**Average** : The average (total/count) value of the performance counter over the aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c89f5-178">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="c89f5-178">Next Steps</span></span>
* <span data-ttu-id="c89f5-179">Dla kompletnego przykładowego szablonu maszyny wirtualnej systemu Windows z rozszerzeniem diagnostyki [201-rozszerzenia maszyny wirtualnej — monitorowanie diagnostycznych](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="c89f5-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="c89f5-180">Wdrażanie, używając szablonu Menedżera zasobów [programu Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) lub [wiersza polecenia platformy Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="c89f5-180">Deploy the resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="c89f5-181">Dowiedz się więcej o [tworzenia szablonów usługi Azure Resource Manager](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="c89f5-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

