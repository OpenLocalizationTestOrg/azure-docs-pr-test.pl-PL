---
title: aaaAdd monitorowania i diagnostyki tooan maszyny wirtualnej platformy Azure | Dokumentacja firmy Microsoft
description: "Toocreate szablon Menedżera zasobów platformy Azure nowej maszyny wirtualnej systemu Windows za pomocą diagnostyki Azure rozszerzenia."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="311a2-103">Użyj monitorowania i diagnostyki z szablonów maszyny Wirtualnej systemu Windows i usługi Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="311a2-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="311a2-104">Hello rozszerzenia diagnostyki Azure udostępnia hello monitorowania i diagnostyki możliwości systemu Windows na podstawie maszyny wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="311a2-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="311a2-105">Te możliwości w maszynie wirtualnej hello można włączyć w tym rozszerzenia hello jako część hello szablonu usługi azure resource manager.</span><span class="sxs-lookup"><span data-stu-id="311a2-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="311a2-106">Zobacz [tworzenia szablonów usługi Azure Resource Manager z rozszerzeń maszyny Wirtualnej](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) uzyskać więcej informacji o tym wszystkie rozszerzenia w ramach szablonu maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="311a2-107">W tym artykule opisano sposób dodawania szablonu maszyny wirtualnej systemu windows hello Azure Diagnostics rozszerzenia tooa.</span><span class="sxs-lookup"><span data-stu-id="311a2-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="311a2-108">Dodawanie definicji zasobu hello Azure Diagnostics rozszerzenia toohello maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="311a2-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="311a2-109">tooenable hello diagnostyki rozszerzenia na maszynie wirtualnej systemu Windows należy rozszerzenia hello tooadd jako zasób maszyny Wirtualnej w hello szablonu usługi Resource manager.</span><span class="sxs-lookup"><span data-stu-id="311a2-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="311a2-110">Dla prostego Menedżera zasobów opartych na maszynie wirtualnej dodać hello rozszerzenia konfiguracji toohello *zasobów* tablicy dla hello maszyny wirtualnej:</span><span class="sxs-lookup"><span data-stu-id="311a2-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="311a2-111">Innym wspólnej Konwencji jest dodać Konfiguracja rozszerzenia hello na hello zasobów korzenia hello szablonu zamiast definiować go w węźle zasobów hello maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="311a2-112">Z tej metody ma tooexplicitly Określ hierarchicznych relacji między rozszerzenie hello i hello maszyny wirtualnej z hello *nazwa* i *typu* wartości.</span><span class="sxs-lookup"><span data-stu-id="311a2-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="311a2-113">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="311a2-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="311a2-114">rozszerzenia Hello jest zawsze skojarzony z maszyną wirtualną hello, możesz bezpośrednio zdefiniować go bezpośrednio w węźle zasobu maszyny wirtualnej hello lub zdefiniować ją na poziomie podstawowym hello i użyj tooassociate konwencji nazewnictwa hierarchiczna hello go przy użyciu hello wirtualnego maszyny.</span><span class="sxs-lookup"><span data-stu-id="311a2-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="311a2-115">Zestawy skalowania maszyny wirtualnej hello rozszerzeń określana jest konfiguracja w hello *extensionProfile* właściwości hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="311a2-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="311a2-116">Witaj *wydawcy* właściwość z wartością hello **Microsoft.Azure.Diagnostics** i hello *typu* właściwość z wartością hello **IaaSDiagnostics** jednoznacznie zidentyfikować hello Azure Diagnostics rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="311a2-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="311a2-117">Witaj wartość hello *nazwa* właściwości mogą być używane toorefer toohello rozszerzenia w grupie zasobów hello.</span><span class="sxs-lookup"><span data-stu-id="311a2-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="311a2-118">Ustawienie w szczególności za**Microsoft.Insights.VMDiagnosticsSettings** umożliwi toobe można zidentyfikować hello zapewnienie portalu Azure, która hello monitorowania wykresy będą wyświetlane poprawnie w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="311a2-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="311a2-119">Witaj *typeHandlerVersion* Określa wersję hello rozszerzenia hello chcesz toouse.</span><span class="sxs-lookup"><span data-stu-id="311a2-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="311a2-120">Ustawienie *autoUpgradeMinorVersion* podrzędny numer wersji zbyt**true** zapewnia pobierze najnowszą wersję pomocniczą hello hello rozszerzenia, która jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="311a2-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="311a2-121">Zdecydowanie zaleca się, że możesz zawsze ustawić *autoUpgradeMinorVersion* można tooalways **true** tak, aby zawsze uzyskać toouse hello najnowsze diagnostyki dostępne rozszerzenia ze wszystkimi hello nowe funkcje i usterki poprawki.</span><span class="sxs-lookup"><span data-stu-id="311a2-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="311a2-122">Witaj *ustawienia* element zawiera właściwości konfiguracji hello rozszerzenia, które można ustawić i ponownie odczytywana hello rozszerzenia (czasami określonego tooas publicznej konfiguracji).</span><span class="sxs-lookup"><span data-stu-id="311a2-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="311a2-123">Witaj *xmlcfg* właściwość zawiera konfigurację xml na podstawie dzienników diagnostycznych hello, liczniki wydajności itp, które zostaną zebrane przez agenta diagnostyki hello.</span><span class="sxs-lookup"><span data-stu-id="311a2-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="311a2-124">Zobacz [schemat konfiguracji diagnostyki](https://msdn.microsoft.com/library/azure/dn782207.aspx) uzyskać więcej informacji o schematu xml hello samej siebie.</span><span class="sxs-lookup"><span data-stu-id="311a2-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="311a2-125">Popularną praktyką jest toostore hello rzeczywiste xml konfiguracji jako zmienną hello szablonu usługi Azure Resource Manager i następnie ZŁĄCZ.teksty i base64 zakodować je wartość hello tooset *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="311a2-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="311a2-126">Zobacz sekcję hello na [zmienne konfiguracji diagnostyki](#diagnostics-configuration-variables) toounderstand więcej informacji na temat sposobu toostore hello xml w zmiennych.</span><span class="sxs-lookup"><span data-stu-id="311a2-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="311a2-127">Witaj *storageAccount* właściwość określa nazwę hello dane diagnostyczne toowhich konta magazynu hello zostanie przeniesiona.</span><span class="sxs-lookup"><span data-stu-id="311a2-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="311a2-128">Witaj właściwości w *protectedSettings* (czasami określonego tooas konfiguracji prywatnej) można ustawić, ale nie można odczytać po ustawiany.</span><span class="sxs-lookup"><span data-stu-id="311a2-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="311a2-129">Witaj tylko do zapisu rodzaj *protectedSettings* ułatwia przydatne w przypadku przechowywania kluczy tajnych, takie jak klucz konta magazynu hello której będą zapisywane dane diagnostyczne hello.</span><span class="sxs-lookup"><span data-stu-id="311a2-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="311a2-130">Określanie konta magazynu diagnostyki jako parametrów</span><span class="sxs-lookup"><span data-stu-id="311a2-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="311a2-131">powyżej fragment json rozszerzenia diagnostyki Hello przyjmuje dwa parametry *existingdiagnosticsStorageAccountName* i *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostyki Konto magazynu, w którym będą przechowywane dane diagnostyczne.</span><span class="sxs-lookup"><span data-stu-id="311a2-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="311a2-132">Określanie hello diagnostycznego konta magazynu, zgodnie z parametrem umożliwia łatwe toochange hello diagnostycznego konta magazynu różnych środowiskach np. Możesz toouse konto magazynu diagnostyki różnych testowanie i inne hasło dla użytkownika wdrożenia produkcyjnego.</span><span class="sxs-lookup"><span data-stu-id="311a2-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="311a2-133">Jest najlepszym rozwiązaniem toospecify konto magazynu diagnostyki w innej grupie zasobów niż grupa zasobów hello hello maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="311a2-134">Grupa zasobów jest uznawana za toobe jednostki wdrożenia własnej okres istnienia, maszynę wirtualną można wdrożyć i wdrożone nowe aktualizacje konfiguracje są wprowadzane go tooit, ale może być toocontinue przechowywanie danych diagnostycznych hello w hello tego samego konta magazynu przez te wdrożenia maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="311a2-135">Problemy między mających hello konta magazynu w różnych zasobów umożliwia hello magazynu tooaccept dane z różnych wdrażania maszyn wirtualnych, dzięki czemu można łatwo tootroubleshoot hello różne wersje.</span><span class="sxs-lookup"><span data-stu-id="311a2-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="311a2-136">W przypadku utworzenia szablonu maszyny wirtualnej systemu windows z programu Visual Studio hello domyślne konto magazynu może być ustawiony toouse hello tego samego konta magazynu, w którym przekazaniu hello dysk VHD maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="311a2-137">Jest to toosimplify wstępnej instalacji hello maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="311a2-138">Należy ponownie współczynnika hello szablonu toouse innego konta magazynu, który może być przekazany jako parametr.</span><span class="sxs-lookup"><span data-stu-id="311a2-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="311a2-139">Zmienne konfiguracji diagnostyki</span><span class="sxs-lookup"><span data-stu-id="311a2-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="311a2-140">Definiuje Hello diagnostyki rozszerzenia json fragment powyżej *accountid* toosimplify zmiennej pobierania hello klucz konta magazynu dla magazynu diagnostyki hello:</span><span class="sxs-lookup"><span data-stu-id="311a2-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="311a2-141">Witaj *xmlcfg* właściwości rozszerzenia diagnostyki hello jest definiowana za pomocą wielu zmiennych, które są połączone ze sobą.</span><span class="sxs-lookup"><span data-stu-id="311a2-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="311a2-142">Hello wartości tych zmiennych są w formacie xml, więc potrzebna jest prawidłowo wpisywany podczas ustawiania zmiennych json hello toobe.</span><span class="sxs-lookup"><span data-stu-id="311a2-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="311a2-143">Witaj poniżej opisano hello diagnostyki konfiguracji xml, który zbiera dane liczników wydajności poziomu standardowych systemowych oraz niektóre dzienniki zdarzeń systemu windows i dzienników infrastruktury Diagnostyka.</span><span class="sxs-lookup"><span data-stu-id="311a2-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="311a2-144">Ma zostały zmienione znaczenie i prawidłowo sformatowane, dzięki czemu hello konfiguracji można bezpośrednio wkleić do hello sekcji zmiennych szablonu.</span><span class="sxs-lookup"><span data-stu-id="311a2-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="311a2-145">Zobacz hello [schemat konfiguracji diagnostyki](https://msdn.microsoft.com/library/azure/dn782207.aspx) więcej człowieka przykład czytelny hello konfiguracji XML.</span><span class="sxs-lookup"><span data-stu-id="311a2-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="311a2-146">węzeł xml definicji metryk Hello w hello powyżej konfiguracji jest element konfiguracji ważne, ponieważ definiuje sposób hello liczników wydajności zdefiniowanych we wcześniejszej części hello xml w *PerformanceCounter* zostaną zagregowane węzłów i przechowywane.</span><span class="sxs-lookup"><span data-stu-id="311a2-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="311a2-147">Te metryki dysku hello monitorowania wykresów i alertach w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="311a2-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="311a2-148">Witaj **metryki** węzła o hello *resourceID* i **MetricAggregation** muszą być zawarte w hello konfiguracji diagnostyki dla maszyny Wirtualnej, jeśli chcesz hello toosee maszyny Wirtualnej dane monitorowania w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="311a2-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="311a2-149">Witaj poniżej znajduje się przykład hello xml definicji metryk:</span><span class="sxs-lookup"><span data-stu-id="311a2-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="311a2-150">Witaj *resourceID* atrybutu unikatowo identyfikuje hello maszyny wirtualnej w ramach subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="311a2-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="311a2-151">Upewnij się, że subscription() hello toouse i resourceGroup() działa tak, aby hello szablonu automatycznie aktualizuje te wartości na podstawie grupy subskrypcji i zasobu hello, który jest wdrażany z.</span><span class="sxs-lookup"><span data-stu-id="311a2-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="311a2-152">Jeśli tworzysz wiele maszyn wirtualnych w pętli, konieczne będzie toopopulate hello *resourceID* wartości z toocorrectly funkcji copyIndex() rozróżnianie każdego poszczególnych maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="311a2-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="311a2-153">Witaj *xmlCfg* wartość może być zaktualizowany toosupport to w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="311a2-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="311a2-154">Witaj wartość MetricAggregation *PT1H* i *PT1M* oznaczającego agregacji na minutę i agregacji ponad godzinę.</span><span class="sxs-lookup"><span data-stu-id="311a2-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="311a2-155">Tabele WADMetrics w magazynie</span><span class="sxs-lookup"><span data-stu-id="311a2-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="311a2-156">Konfiguracja metryki Hello powyżej wygeneruje tabel na koncie magazynu diagnostyki z hello następującej konwencji nazewnictwa:</span><span class="sxs-lookup"><span data-stu-id="311a2-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="311a2-157">**WADMetrics** : standardowego prefiksu dla wszystkich tabel WADMetrics</span><span class="sxs-lookup"><span data-stu-id="311a2-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="311a2-158">**PT1H** lub **PT1M** : oznacza, że hello zawierającej agregowanie danych ponad 1 godzina lub 1 minuta</span><span class="sxs-lookup"><span data-stu-id="311a2-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="311a2-159">**P10D** : oznacza, że tabela hello będzie zawierać danych dla 10 dni od uruchomienia tabeli hello na zbieranie danych</span><span class="sxs-lookup"><span data-stu-id="311a2-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="311a2-160">**V2S** : stała znakowa</span><span class="sxs-lookup"><span data-stu-id="311a2-160">**V2S** : String constant</span></span>
* <span data-ttu-id="311a2-161">**RRRRMMDD** : hello Data, w których hello tabeli rozpoczęcia, zbieranie danych</span><span class="sxs-lookup"><span data-stu-id="311a2-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="311a2-162">Przykład: *WADMetricsPT1HP10DV2S20151108* zawierają zagregowane ponad godzinę 10 dni, począwszy od dnia 2015-11-lis dane metryk</span><span class="sxs-lookup"><span data-stu-id="311a2-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="311a2-163">Każda tabela WADMetrics będzie zawierać hello następujące kolumny:</span><span class="sxs-lookup"><span data-stu-id="311a2-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="311a2-164">**PartitionKey**: hello partitionkey jest tworzony na podstawie na powitania *resourceID* toouniquely wartość zidentyfikować hello zasobu maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="311a2-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="311a2-165">na przykład: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="311a2-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="311a2-166">**RowKey** : format hello następujące <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="311a2-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="311a2-167">Hello malejącej obliczanie osi czasu jest Takty maksymalny czas minus hello godzina rozpoczęcia hello hello agregacji okresu.</span><span class="sxs-lookup"><span data-stu-id="311a2-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="311a2-168">Na przykład</span><span class="sxs-lookup"><span data-stu-id="311a2-168">E.g.</span></span> <span data-ttu-id="311a2-169">Jeśli okres próbkowania hello uruchomione w dniu 2015-10-lis i będzie Obliczanie czasu UTC, a następnie hello 00:00Hrs: DateTime.MaxValue.Ticks - (DateTime(2015,11,10,0,0,0,DateTimeKind.Utc) nowe. Znaczniki).</span><span class="sxs-lookup"><span data-stu-id="311a2-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="311a2-170">Dla klucz wiersza hello licznika wydajności hello pamięci dostępne bajty będzie wyglądała, takich jak: 2519551871999999999__:005CMemory:005CAvailable:0020 bajtów</span><span class="sxs-lookup"><span data-stu-id="311a2-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="311a2-171">**CounterName** : jest nazwą hello hello licznika wydajności.</span><span class="sxs-lookup"><span data-stu-id="311a2-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="311a2-172">Odpowiada to hello *counterSpecifier* zdefiniowane w pliku konfiguracji xml hello.</span><span class="sxs-lookup"><span data-stu-id="311a2-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="311a2-173">**Maksymalna** : hello maksymalna wartość licznika wydajności hello okresie hello agregacji.</span><span class="sxs-lookup"><span data-stu-id="311a2-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="311a2-174">**Minimalna** : hello minimalną wartość licznika wydajności hello okresie hello agregacji.</span><span class="sxs-lookup"><span data-stu-id="311a2-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="311a2-175">**Całkowita liczba** : hello sumę wszystkich wartości licznika wydajności hello zgłoszone w okresie agregacji hello.</span><span class="sxs-lookup"><span data-stu-id="311a2-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="311a2-176">**Liczba** : zgłosił hello łączna liczba wartości licznika wydajności hello.</span><span class="sxs-lookup"><span data-stu-id="311a2-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="311a2-177">**Średnia** : hello średniej (łączna/liczba) wartości licznika wydajności hello okresie hello agregacji.</span><span class="sxs-lookup"><span data-stu-id="311a2-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="311a2-178">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="311a2-178">Next Steps</span></span>
* <span data-ttu-id="311a2-179">Dla kompletnego przykładowego szablonu maszyny wirtualnej systemu Windows z rozszerzeniem diagnostyki [201-rozszerzenia maszyny wirtualnej — monitorowanie diagnostycznych](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="311a2-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="311a2-180">Wdróż hello resource manager szablonu przy użyciu [programu Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) lub [wiersza polecenia platformy Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="311a2-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="311a2-181">Dowiedz się więcej o [tworzenia szablonów usługi Azure Resource Manager](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="311a2-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

