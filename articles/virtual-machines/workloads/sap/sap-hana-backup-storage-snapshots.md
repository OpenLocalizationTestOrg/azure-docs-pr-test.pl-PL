---
title: Kopia zapasowa SAP HANA Azure oparte na magazynu migawek | Dokumentacja firmy Microsoft
description: "Istnieją dwa główne kopii zapasowej możliwości SAP HANA na maszynach wirtualnych Azure, w tym artykule omówiono SAP HANA kopię zapasową pamięci masowej migawki"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: f332b8ac091b75a23489ac27f15ad1fd10d24ec6
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="e558d-103">Kopie zapasowe oprogramowania SAP HANA na podstawie migawek magazynu</span><span class="sxs-lookup"><span data-stu-id="e558d-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="e558d-104">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="e558d-104">Introduction</span></span>

<span data-ttu-id="e558d-105">To jest częścią serii trzyczęściowej pokrewne artykuły kopii zapasowej SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="e558d-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="e558d-106">[Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md) zawiera omówienie i informacje wprowadzające, i [SAP HANA kopia zapasowa Azure na poziomie plików](sap-hana-backup-file-level.md) obejmuje opartych na plikach opcję tworzenia kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="e558d-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>

<span data-ttu-id="e558d-107">W przypadku używania funkcji Kopia zapasowa maszyny Wirtualnej dla systemu jednego wystąpienia w jednym demonstracyjnej, co należy rozważyć, wykonanie kopii zapasowej maszyny Wirtualnej, zamiast zarządzania HANA tworzenia kopii zapasowych na poziomie systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="e558d-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at the OS level.</span></span> <span data-ttu-id="e558d-108">Alternatywą jest migawek obiektów blob platformy Azure można utworzyć kopie poszczególnych dysków wirtualnych, które są dołączone do maszyny wirtualnej, i przechowywać pliki danych HANA.</span><span class="sxs-lookup"><span data-stu-id="e558d-108">An alternative is to take Azure blob snapshots to create copies of individual virtual disks, which are attached to a virtual machine, and keep the HANA data files.</span></span> <span data-ttu-id="e558d-109">Ale punktu krytycznego spójności aplikacji podczas tworzenia migawki kopii zapasowej lub dysku maszyny Wirtualnej, gdy system jest uruchomiony i uruchomiony.</span><span class="sxs-lookup"><span data-stu-id="e558d-109">But a critical point is app consistency when creating a VM backup or disk snapshot while the system is up and running.</span></span> <span data-ttu-id="e558d-110">Zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w powiązanego artykułu [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="e558d-110">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="e558d-111">SAP HANA jest funkcją, która obsługuje następujące rodzaje pamięci masowej migawki.</span><span class="sxs-lookup"><span data-stu-id="e558d-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="e558d-112">SAP HANA migawki</span><span class="sxs-lookup"><span data-stu-id="e558d-112">SAP HANA snapshots</span></span>

<span data-ttu-id="e558d-113">Brak funkcji w SAP HANA, który obsługuje tworzenie migawki magazynu.</span><span class="sxs-lookup"><span data-stu-id="e558d-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="e558d-114">Jednak począwszy od grudnia 2016 r. istnieje ograniczenie do pojedynczego kontenera systemów.</span><span class="sxs-lookup"><span data-stu-id="e558d-114">However, as of December 2016, there is a restriction to single-container systems.</span></span> <span data-ttu-id="e558d-115">Konfiguracje wielodostępnym kontenera nie obsługują tego rodzaju migawki bazy danych (zobacz [tworzenia magazynu migawek (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="e558d-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="e558d-116">Działa on w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="e558d-116">It works as follows:</span></span>

- <span data-ttu-id="e558d-117">Przygotowanie do migawki magazynu inicjując SAP HANA migawki</span><span class="sxs-lookup"><span data-stu-id="e558d-117">Prepare for a storage snapshot by initiating the SAP HANA snapshot</span></span>
- <span data-ttu-id="e558d-118">Uruchom magazynu migawek (Azure blob migawki, na przykład)</span><span class="sxs-lookup"><span data-stu-id="e558d-118">Run the storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="e558d-119">Potwierdź SAP HANA migawki</span><span class="sxs-lookup"><span data-stu-id="e558d-119">Confirm the SAP HANA snapshot</span></span>

![Ten zrzut ekranu pokazuje, że migawki danych SAP HANA można tworzyć za pomocą instrukcji SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="e558d-121">Ten zrzut ekranu pokazuje, że migawki danych SAP HANA można tworzyć za pomocą instrukcji SQL.</span><span class="sxs-lookup"><span data-stu-id="e558d-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![Migawki również pojawia się w katalogu kopii zapasowej w SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="e558d-123">Migawki następnie pojawia się również w katalogu kopii zapasowej w SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="e558d-123">The snapshot then also appears in the backup catalog in SAP HANA Studio.</span></span>

![Na dysku migawki zostaną wyświetlone w katalogu danych SAP HANA](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="e558d-125">Na dysku migawki zostaną wyświetlone w katalogu danych SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="e558d-125">On disk, the snapshot shows up in the SAP HANA data directory.</span></span>

<span data-ttu-id="e558d-126">Jeden ma upewnij się, że spójności systemu plików jest gwarantowana przed uruchomieniem migawki magazynu, gdy SAP HANA jest w trybie przygotowania migawki.</span><span class="sxs-lookup"><span data-stu-id="e558d-126">One has to ensure that the file system consistency is also guaranteed before running the storage snapshot while SAP HANA is in the snapshot preparation mode.</span></span> <span data-ttu-id="e558d-127">Zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w powiązanego artykułu [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="e558d-127">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="e558d-128">Po zakończeniu migawki magazynu jest krytyczne, aby potwierdzić migawki SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="e558d-128">Once the storage snapshot is done, it is critical to confirm the SAP HANA snapshot.</span></span> <span data-ttu-id="e558d-129">Brak odpowiedniej instrukcji SQL do uruchomienia: Zamknij MIGAWKI danych kopii zapasowej (zobacz [danych zamknij MIGAWKI instrukcji BACKUP (kopii zapasowych i odzyskiwania)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="e558d-129">There is a corresponding SQL statement to run: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e558d-130">Potwierdź migawki HANA.</span><span class="sxs-lookup"><span data-stu-id="e558d-130">Confirm the HANA snapshot.</span></span> <span data-ttu-id="e558d-131">Ze względu na &quot;kopii przy zapisie,&quot; SAP HANA mogą wymagać dodatkowego miejsca na dysku w migawki — przygotowanie trybu i nie jest możliwe jej uruchomienie nowych kopii zapasowych, dopóki migawki SAP HANA został potwierdzony.</span><span class="sxs-lookup"><span data-stu-id="e558d-131">Due to &quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="e558d-132">Maszyna wirtualna HANA tworzenia kopii zapasowej za pomocą usługi Kopia zapasowa Azure</span><span class="sxs-lookup"><span data-stu-id="e558d-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="e558d-133">Począwszy od grudnia 2016 r. agenta kopii zapasowej usługi Kopia zapasowa Azure nie jest dostępna dla maszyn wirtualnych systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="e558d-133">As of December 2016, the backup agent of the Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="e558d-134">Aby korzystanie z kopii zapasowej platformy Azure na poziomie pliku/katalogu, co będzie skopiuj pliki kopii zapasowej SAP HANA do maszyny Wirtualnej systemu Windows, a następnie użyć agenta kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="e558d-134">To make use of Azure backup on the file/directory level, one would copy SAP HANA backup files to a Windows VM and then use the backup agent.</span></span> <span data-ttu-id="e558d-135">W przeciwnym razie tylko pełna kopia maszyny Wirtualnej systemu Linux jest możliwe za pomocą usługi Kopia zapasowa Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-135">Otherwise, only a full Linux VM backup is possible via the Azure Backup service.</span></span> <span data-ttu-id="e558d-136">Zobacz [omówienie funkcji Kopia zapasowa Azure](../../../backup/backup-introduction-to-azure-backup.md) Aby dowiedzieć się więcej.</span><span class="sxs-lookup"><span data-stu-id="e558d-136">See [Overview of the features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) to find out more.</span></span>

<span data-ttu-id="e558d-137">Usługa Kopia zapasowa Azure udostępnia opcję kopii zapasowej i przywracania maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="e558d-137">The Azure Backup service offers an option to back up and restore a VM.</span></span> <span data-ttu-id="e558d-138">Więcej informacji na temat tej usługi oraz sposób jej działania można znaleźć w artykule [Zaplanuj infrastrukturę kopii zapasowej maszyny Wirtualnej na platformie Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="e558d-138">More information about this service and how it works can be found in the article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="e558d-139">Istnieją dwa istotne kwestie, zgodnie z tym artykułem:</span><span class="sxs-lookup"><span data-stu-id="e558d-139">There are two important considerations according to that article:</span></span>

<span data-ttu-id="e558d-140">_&quot;Dla maszyn wirtualnych systemu Linux tylko plik spójne kopie zapasowe są możliwe, ponieważ systemu Linux nie ma równoważnej platformy do usługi VSS.&quot;_</span><span class="sxs-lookup"><span data-stu-id="e558d-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform to VSS.&quot;_</span></span>

<span data-ttu-id="e558d-141">_&quot;Aplikacje muszą implementować własnych &quot;konfigurowania&quot; mechanizmu, na przywróconych danych.&quot;_</span><span class="sxs-lookup"><span data-stu-id="e558d-141">_&quot;Applications need to implement their own &quot;fix-up&quot; mechanism on the restored data.&quot;_</span></span>

<span data-ttu-id="e558d-142">W związku z tym co ma upewnij się, że SAP HANA jest spójna na dysku podczas uruchamiania kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="e558d-142">Therefore, one has to make sure SAP HANA is in a consistent state on disk when the backup starts.</span></span> <span data-ttu-id="e558d-143">Zobacz _migawki SAP HANA_ opisem we wcześniejszej części dokumentu.</span><span class="sxs-lookup"><span data-stu-id="e558d-143">See _SAP HANA snapshots_ described earlier in the document.</span></span> <span data-ttu-id="e558d-144">Potencjalny problem występuje, gdy SAP HANA pozostaje w tym trybie przygotowania migawki</span><span class="sxs-lookup"><span data-stu-id="e558d-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="e558d-145">Zobacz [tworzenia magazynu migawek (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) Aby uzyskać więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="e558d-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="e558d-146">Ten artykuł stanowi:</span><span class="sxs-lookup"><span data-stu-id="e558d-146">That article states:</span></span>

<span data-ttu-id="e558d-147">_&quot;Zdecydowanie zalecane jest aby potwierdzić, lub Porzuć migawki magazynu jak najszybciej po jego utworzeniu. Podczas tworzenia migawki magazynu przetworzone lub utworzone, migawkę odpowiednich danych jest zablokowana. Podczas migawkę odpowiednich danych jest zablokowany, może nadal być zmian w bazie danych. Takie zmiany nie spowodują zablokowane odpowiednich migawka danych zostanie zmieniony. Zamiast tego zmiany są zapisywane do pozycji w obszarze danych, które są niezależne od magazynu migawek. Zmiany są także zapisywane w dzienniku. Jednak im dłuższy migawkę odpowiednich danych jest przechowywana zablokowane, tym bardziej może zwiększyć ilość danych.&quot;_</span><span class="sxs-lookup"><span data-stu-id="e558d-147">_&quot;It is strongly recommended to confirm or abandon a storage snapshot as soon as possible after it has been created. While the storage snapshot is being prepared or created, the snapshot-relevant data is frozen. While the snapshot-relevant data remains frozen, changes can still be made in the database. Such changes will not cause the frozen snapshot-relevant data to be changed. Instead, the changes are written to positions in the data area that are separate from the storage snapshot. Changes are also written to the log. However, the longer the snapshot-relevant data is kept frozen, the more the data volume can grow.&quot;_</span></span>

<span data-ttu-id="e558d-148">Kopia zapasowa Azure zapewnia obsługę spójności systemu plików za pośrednictwem rozszerzenia maszyny Wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-148">Azure Backup takes care of the file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="e558d-149">Rozszerzenia te nie są dostępne autonomicznej i działa tylko w połączeniu z usługą kopia zapasowa Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="e558d-150">Niemniej jednak nadal jest wymagane do zarządzania migawki SAP HANA w celu zagwarantowania spójności aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e558d-150">Nevertheless, it is still a requirement to manage an SAP HANA snapshot to guarantee app consistency.</span></span>

<span data-ttu-id="e558d-151">Kopia zapasowa Azure ma dwa główne fazy:</span><span class="sxs-lookup"><span data-stu-id="e558d-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="e558d-152">Utwórz migawkę</span><span class="sxs-lookup"><span data-stu-id="e558d-152">Take Snapshot</span></span>
- <span data-ttu-id="e558d-153">Przesyłanie danych do magazynu</span><span class="sxs-lookup"><span data-stu-id="e558d-153">Transfer data to vault</span></span>

<span data-ttu-id="e558d-154">Dlatego można potwierdzić migawki SAP HANA po zakończeniu fazy usługi Kopia zapasowa Azure wykonywania migawki.</span><span class="sxs-lookup"><span data-stu-id="e558d-154">So one could confirm the SAP HANA snapshot once the Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="e558d-155">Może upłynąć kilka minut, aby zobaczyć w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-155">It might take several minutes to see in the Azure portal.</span></span>

![Na poniższym rysunku pokazano częścią listy zadania tworzenia kopii zapasowych usługi Kopia zapasowa Azure](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="e558d-157">Na poniższym rysunku pokazano częścią listy zadania tworzenia kopii zapasowych usługi Kopia zapasowa Azure, który został użyty do kopii zapasowych HANA test maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="e558d-157">This figure shows part of the backup job list of an Azure Backup service, which was used to back up the HANA test VM.</span></span>

![Aby wyświetlić szczegóły zadania, kliknij zadanie tworzenia kopii zapasowej w portalu Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="e558d-159">Aby wyświetlić szczegóły zadania, kliknij zadanie tworzenia kopii zapasowej w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-159">To show the job details, click the backup job in the Azure portal.</span></span> <span data-ttu-id="e558d-160">W tym miejscu jedną Zobacz dwóch faz.</span><span class="sxs-lookup"><span data-stu-id="e558d-160">Here, one can see the two phases.</span></span> <span data-ttu-id="e558d-161">Może upłynąć kilka minut, aż będzie wyświetlana na etapie migawki jako ukończone.</span><span class="sxs-lookup"><span data-stu-id="e558d-161">It might take a few minutes until it shows the snapshot phase as completed.</span></span> <span data-ttu-id="e558d-162">W większości przypadków rozkłada się na etapie transferu danych.</span><span class="sxs-lookup"><span data-stu-id="e558d-162">Most of the time is spent in the data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="e558d-163">Maszyna wirtualna HANA automatyzacji tworzenia kopii zapasowej za pomocą usługi Kopia zapasowa Azure</span><span class="sxs-lookup"><span data-stu-id="e558d-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="e558d-164">Co można potwierdzić ręcznie migawki SAP HANA po zakończeniu fazy migawki kopii zapasowej Azure, zgodnie z wcześniejszym opisem, ale warto wziąć pod uwagę automatyzacji, ponieważ administrator nie może monitorować listy zadanie tworzenia kopii zapasowej w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-164">One could manually confirm the SAP HANA snapshot once the Azure Backup snapshot phase is completed, as described earlier, but it is helpful to consider automation because an admin might not monitor the backup job list in the Azure portal.</span></span>

<span data-ttu-id="e558d-165">W tym miejscu jest wyjaśnienie, jak można można zrealizować przy użyciu poleceń cmdlet programu Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e558d-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Usługa Kopia zapasowa Azure została utworzona nazwa hana-magazynie kopii zapasowej —](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="e558d-167">Usługa Kopia zapasowa Azure została utworzona o nazwie &quot;magazynu w przypadku kopii zapasowych hana.&quot; Polecenie PS **Get AzureRmRecoveryServicesVault-nazwa magazynu w przypadku kopii zapasowych hana** pobiera odpowiedni obiekt.</span><span class="sxs-lookup"><span data-stu-id="e558d-167">An Azure Backup service was created with the name &quot;hana-backup-vault.&quot; The PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves the corresponding object.</span></span> <span data-ttu-id="e558d-168">Ten obiekt jest następnie używany do Ustaw kontekst kopii zapasowych, jak pokazano na rysunku dalej.</span><span class="sxs-lookup"><span data-stu-id="e558d-168">This object is then used to set the backup context as seen on the next figure.</span></span>

![Jeden sprawdzić, czy zadanie tworzenia kopii zapasowej w toku](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="e558d-170">Po ustawieniu poprawny kontekst, jeden Sprawdź, czy zadanie tworzenia kopii zapasowej w toku, a następnie wyszukaj jego szczegóły zadania.</span><span class="sxs-lookup"><span data-stu-id="e558d-170">After setting the correct context, one can check for the backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="e558d-171">Na liście podzadanie przedstawiono, jeśli fazy migawki zadanie tworzenia kopii zapasowej systemu Azure jest już ukończone:</span><span class="sxs-lookup"><span data-stu-id="e558d-171">The subtask list shows if the snapshot phase of the Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Sondowanie wartość w pętlę aż stanie się na ukończone](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="e558d-173">Po szczegóły zadania są przechowywane w zmiennej, jest po prostu PS składnię, aby uzyskać dostęp do pierwszej pozycji tablicy i pobrać wartość stanu.</span><span class="sxs-lookup"><span data-stu-id="e558d-173">Once the job details are stored in a variable, it is simply PS syntax to get to the first array entry and retrieve the status value.</span></span> <span data-ttu-id="e558d-174">Do wykonania skryptu automatyzacji, sondowanie wartość w pętli do momentu przechodzi on w &quot;ukończone.&quot;</span><span class="sxs-lookup"><span data-stu-id="e558d-174">To complete the automation script, poll the value in a loop until it turns to &quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="e558d-175">Klucz licencji HANA i wirtualna przywrócić za pomocą usługi Kopia zapasowa Azure</span><span class="sxs-lookup"><span data-stu-id="e558d-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="e558d-176">Usługa Kopia zapasowa Azure jest przeznaczone do tworzenia nowej maszyny Wirtualnej podczas przywracania.</span><span class="sxs-lookup"><span data-stu-id="e558d-176">The Azure Backup service is designed to create a new VM during restore.</span></span> <span data-ttu-id="e558d-177">Nie jest od razu planowane czy &quot;w miejscu&quot; przywracania istniejącej maszyny Wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-177">There is no plan right now to do an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Na poniższym rysunku pokazano opcja przywracania usługi Azure w portalu Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="e558d-179">Tej ilustracji przedstawiono opcja przywracania usługi Azure w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-179">This figure shows the restore option of the Azure service in the Azure portal.</span></span> <span data-ttu-id="e558d-180">Można między tworzenia maszyny Wirtualnej podczas przywracania lub przywracanie dyski.</span><span class="sxs-lookup"><span data-stu-id="e558d-180">One can choose between creating a VM during restore or restoring the disks.</span></span> <span data-ttu-id="e558d-181">Po przywróceniu dysków, jest nadal niezbędnych do utworzenia nowej maszyny Wirtualnej znajdujący się na nim.</span><span class="sxs-lookup"><span data-stu-id="e558d-181">After restoring the disks, it is still necessary to create a new VM on top of it.</span></span> <span data-ttu-id="e558d-182">Zawsze, gdy nowej maszyny Wirtualnej jest tworzony na platformie Azure Unikatowy identyfikator maszyny Wirtualnej zmienia (zobacz [dostęp i przy użyciu usługi Azure VM Unikatowy identyfikator](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="e558d-182">Whenever a new VM gets created on Azure the unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Na poniższym rysunku pokazano Unikatowy identyfikator maszyny Wirtualnej platformy Azure, przed i po przywróceniu za pomocą usługi Kopia zapasowa Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="e558d-184">Na poniższym rysunku pokazano Unikatowy identyfikator maszyny Wirtualnej platformy Azure, przed i po przywróceniu za pomocą usługi Kopia zapasowa Azure.</span><span class="sxs-lookup"><span data-stu-id="e558d-184">This figure shows the Azure VM unique ID before and after the restore via Azure Backup service.</span></span> <span data-ttu-id="e558d-185">Klucz sprzętu SAP, który jest używany do licencjonowania SAP, używa tego Unikatowy identyfikator maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="e558d-185">The SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="e558d-186">W konsekwencji nowej licencji SAP musi być zainstalowany po przywracanie maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="e558d-186">As a consequence, a new SAP license has to be installed after a VM restore.</span></span>

<span data-ttu-id="e558d-187">Nowa funkcja Kopia zapasowa Azure został przedstawiony w wersji zapoznawczej podczas tworzenia kopii zapasowej przewodnika.</span><span class="sxs-lookup"><span data-stu-id="e558d-187">A new Azure Backup feature was presented in preview mode during the creation of this backup guide.</span></span> <span data-ttu-id="e558d-188">Umożliwia przywrócenie poziomu pliku oparte na migawki maszyny Wirtualnej, która została wykonana dla maszyny Wirtualnej kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="e558d-188">It allows a file level restore based on the VM snapshot that was taken for the VM backup.</span></span> <span data-ttu-id="e558d-189">Dzięki temu można uniknąć konieczności wdrażania nowej maszyny Wirtualnej i w związku z tym pozostaje taki sam Unikatowy identyfikator maszyny Wirtualnej, a nie nowy klucz licencji SAP HANA jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="e558d-189">This avoids the need to deploy a new VM, and therefore the unique VM ID stays the same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="e558d-190">Więcej dokumentacji na ta funkcja będzie dostępna po został w pełni przetestowany.</span><span class="sxs-lookup"><span data-stu-id="e558d-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="e558d-191">Kopia zapasowa Azure ostatecznie umożliwi kopii zapasowej poszczególnych dysków wirtualnych platformy Azure, oraz pliki i katalogi z wewnątrz maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="e558d-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside the VM.</span></span> <span data-ttu-id="e558d-192">Główną zaletą usługi Kopia zapasowa Azure jest jego zarządzania wszystkie kopie zapasowe, zapisywanie klienta z konieczności to robić.</span><span class="sxs-lookup"><span data-stu-id="e558d-192">A major advantage of Azure Backup is its management of all the backups, saving the customer from having to do it.</span></span> <span data-ttu-id="e558d-193">Jeśli niezbędne przywracania kopii zapasowej Azure wybierze poprawne kopii zapasowej do użycia.</span><span class="sxs-lookup"><span data-stu-id="e558d-193">If a restore becomes necessary, Azure Backup will select the correct backup to use.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="e558d-194">Kopia zapasowa maszyny Wirtualnej programu SAP HANA za pomocą migawki ręczne dysku</span><span class="sxs-lookup"><span data-stu-id="e558d-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="e558d-195">Zamiast przy użyciu usługi Kopia zapasowa Azure, co może skonfigurować poszczególnych tworzenia kopii zapasowych przez tworzenie migawek obiektów blob Azure wirtualne dyski twarde ręcznie za pomocą programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e558d-195">Instead of using the Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="e558d-196">Zobacz [migawki obiektu blob korzystanie z programu PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) opis kroków.</span><span class="sxs-lookup"><span data-stu-id="e558d-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of the steps.</span></span>

<span data-ttu-id="e558d-197">Zapewnia większą elastyczność, ale nie rozwiązuje problemy wyjaśniono wcześniej w tym dokumencie:</span><span class="sxs-lookup"><span data-stu-id="e558d-197">It provides more flexibility but does not resolve the issues explained earlier in this document:</span></span>

- <span data-ttu-id="e558d-198">Jeden nadal należy się upewnić, że SAP HANA jest spójne</span><span class="sxs-lookup"><span data-stu-id="e558d-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="e558d-199">Nie można zastąpić dysk systemu operacyjnego, nawet jeśli cofnięciu przydziału maszyny Wirtualnej z powodu komunikat o błędzie informujący, że istnieje dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="e558d-199">The OS disk cannot be overwritten even if the VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="e558d-200">Działa ona tylko po usunięciu maszyny Wirtualnej, co może prowadzić do nowy unikatowy identyfikator maszyny Wirtualnej i konieczności instalowania nowej licencji SAP.</span><span class="sxs-lookup"><span data-stu-id="e558d-200">It only works after deleting the VM, which would lead to a new unique VM ID and the need to install a new SAP license.</span></span>

![Można przywrócić tylko dysków danych maszyny Wirtualnej platformy Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="e558d-202">Jest możliwe przywrócenie tylko dysków danych maszyny Wirtualnej platformy Azure, unikając problem pobierania nowy unikatowy identyfikator maszyny Wirtualnej i, w związku z tym unieważnienie licencji SAP:</span><span class="sxs-lookup"><span data-stu-id="e558d-202">It is possible to restore only the data disks of an Azure VM, avoiding the problem of getting a new unique VM ID and, therefore, invalidated the SAP license:</span></span>

- <span data-ttu-id="e558d-203">Dla testu dwa dyski danych Azure zostały dołączone do maszyn wirtualnych i oprogramowaniem RAID został zdefiniowany oparte na nich</span><span class="sxs-lookup"><span data-stu-id="e558d-203">For the test, two Azure data disks were attached to a VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="e558d-204">Funkcja migawki SAP HANA potwierdzono, że SAP HANA była w spójnym stanie</span><span class="sxs-lookup"><span data-stu-id="e558d-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="e558d-205">Zablokuj systemu plików (zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w powiązanego artykułu [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="e558d-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="e558d-206">Migawki obiektu blob zostały pobrane z obu dysków z danymi</span><span class="sxs-lookup"><span data-stu-id="e558d-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="e558d-207">Odblokuj systemu plików</span><span class="sxs-lookup"><span data-stu-id="e558d-207">File system unfreeze</span></span>
- <span data-ttu-id="e558d-208">Potwierdzenie migawki SAP HANA</span><span class="sxs-lookup"><span data-stu-id="e558d-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="e558d-209">Aby przywrócić dysków z danymi, wyłączenia maszyny Wirtualnej i obydwa dyski odłączone</span><span class="sxs-lookup"><span data-stu-id="e558d-209">To restore the data disks, the VM was shut down and both disks detached</span></span>
- <span data-ttu-id="e558d-210">Po odłączanie dysków, zostały zastąpione z migawkami wcześniejsze obiektów blob</span><span class="sxs-lookup"><span data-stu-id="e558d-210">After detaching the disks, they were overwritten with the former blob snapshots</span></span>
- <span data-ttu-id="e558d-211">Następnie przywrócone dyski wirtualne zostały ponownie dołączyć do maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="e558d-211">Then the restored virtual disks were attached again to the VM</span></span>
- <span data-ttu-id="e558d-212">Po uruchomieniu maszyny Wirtualnej, wszystko na oprogramowanie RAID działał prawidłowo i został ponownie ustawiony na czas migawki obiektu blob</span><span class="sxs-lookup"><span data-stu-id="e558d-212">After starting the VM, everything on the software RAID worked fine and was set back to the blob snapshot time</span></span>
- <span data-ttu-id="e558d-213">HANA była ustawiana dla migawki HANA</span><span class="sxs-lookup"><span data-stu-id="e558d-213">HANA was set back to the HANA snapshot</span></span>

<span data-ttu-id="e558d-214">Jeśli było możliwe, zamknij SAP HANA przed migawki obiektu blob, procedura może być mniej złożona.</span><span class="sxs-lookup"><span data-stu-id="e558d-214">If it was possible to shut down SAP HANA before the blob snapshots, the procedure would be less complex.</span></span> <span data-ttu-id="e558d-215">W takim przypadku jeden można pominąć migawki HANA i, jeśli nic dzieje się w systemie, również pominąć zablokować systemu plików.</span><span class="sxs-lookup"><span data-stu-id="e558d-215">In that case, one could skip the HANA snapshot and, if nothing else is going on in the system, also skip the file system freeze.</span></span> <span data-ttu-id="e558d-216">Dodano złożoności wejścia obrazu, gdy jest to niezbędne wykonać migawki, podczas wszystko jest w trybie online.</span><span class="sxs-lookup"><span data-stu-id="e558d-216">Added complexity comes into the picture when it is necessary to do snapshots while everything is online.</span></span> <span data-ttu-id="e558d-217">Zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w powiązanego artykułu [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="e558d-217">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e558d-218">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="e558d-218">Next steps</span></span>
* <span data-ttu-id="e558d-219">[Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md) zapewnia przegląd oraz informacje o wprowadzenie.</span><span class="sxs-lookup"><span data-stu-id="e558d-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="e558d-220">[Kopia zapasowa SAP HANA oparte na poziomie plików](sap-hana-backup-file-level.md) obejmuje opartych na plikach opcję tworzenia kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="e558d-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>
* <span data-ttu-id="e558d-221">Aby dowiedzieć się jak ustanowić wysokiej dostępności i planu odzyskiwania po awarii programu SAP HANA na platformie Azure (wystąpienia duże), zobacz [SAP HANA (duże wystąpień) wysokiej dostępności i odzyskiwania po awarii na platformie Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="e558d-221">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
