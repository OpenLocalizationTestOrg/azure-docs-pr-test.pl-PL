---
title: Kopia zapasowa HANA Azure aaaSAP oparte na magazynu migawek | Dokumentacja firmy Microsoft
description: "Istnieją dwa główne kopii zapasowej możliwości SAP HANA na maszynach wirtualnych Azure, w tym artykule omówiono SAP HANA kopię zapasową pamięci masowej migawki"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="8b2a8-103">Kopie zapasowe oprogramowania SAP HANA na podstawie migawek magazynu</span><span class="sxs-lookup"><span data-stu-id="8b2a8-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="8b2a8-104">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="8b2a8-104">Introduction</span></span>

<span data-ttu-id="8b2a8-105">To jest częścią serii trzyczęściowej pokrewne artykuły kopii zapasowej SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="8b2a8-106">[Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md) zawiera omówienie i informacje wprowadzające, i [SAP HANA kopia zapasowa Azure na poziomie plików](sap-hana-backup-file-level.md) obejmuje hello opcję tworzenia kopii zapasowych opartych na plikach.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="8b2a8-107">W przypadku używania funkcji Kopia zapasowa maszyny Wirtualnej dla systemu jednego wystąpienia w jednym demonstracyjnej, co należy rozważyć, wykonanie kopii zapasowej maszyny Wirtualnej, zamiast zarządzania HANA tworzenia kopii zapasowych na powitania poziomu systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="8b2a8-108">Alternatywą jest tootake obiektów blob platformy Azure migawki toocreate kopie poszczególnych dysków wirtualnych, które są dołączone tooa maszyny wirtualnej, a także zapewnić hello HANA dane plików.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="8b2a8-109">Ale punktu krytycznego spójności aplikacji podczas tworzenia migawki kopii zapasowej lub dysku maszyny Wirtualnej, gdy hello system jest uruchomiony i uruchomiony.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="8b2a8-110">Zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w artykule pokrewne hello [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="8b2a8-111">SAP HANA jest funkcją, która obsługuje następujące rodzaje pamięci masowej migawki.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="8b2a8-112">SAP HANA migawki</span><span class="sxs-lookup"><span data-stu-id="8b2a8-112">SAP HANA snapshots</span></span>

<span data-ttu-id="8b2a8-113">Brak funkcji w SAP HANA, który obsługuje tworzenie migawki magazynu.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="8b2a8-114">Jednak począwszy od grudnia 2016 r. istnieje ograniczenie systemów toosingle kontenera.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="8b2a8-115">Konfiguracje wielodostępnym kontenera nie obsługują tego rodzaju migawki bazy danych (zobacz [tworzenia magazynu migawek (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="8b2a8-116">Działa on w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-116">It works as follows:</span></span>

- <span data-ttu-id="8b2a8-117">Przygotowanie do migawki magazynu inicjując hello SAP HANA migawki</span><span class="sxs-lookup"><span data-stu-id="8b2a8-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="8b2a8-118">Uruchom hello magazynu migawek (Azure blob migawki, na przykład)</span><span class="sxs-lookup"><span data-stu-id="8b2a8-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="8b2a8-119">Potwierdź hello SAP HANA migawki</span><span class="sxs-lookup"><span data-stu-id="8b2a8-119">Confirm hello SAP HANA snapshot</span></span>

![Ten zrzut ekranu pokazuje, że migawki danych SAP HANA można tworzyć za pomocą instrukcji SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="8b2a8-121">Ten zrzut ekranu pokazuje, że migawki danych SAP HANA można tworzyć za pomocą instrukcji SQL.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![następnie migawki Hello jest także wyświetlany w katalogu kopii zapasowej hello w SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="8b2a8-123">następnie migawki Hello jest także wyświetlany w katalogu kopii zapasowej hello w SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![Na dysku hello migawki zostaną wyświetlone w katalogu danych SAP HANA hello](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="8b2a8-125">Na dysku hello migawki zostaną wyświetlone w katalogu danych SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="8b2a8-126">Jeden ma tooensure, który spójności systemu plików hello jest gwarantowana przed uruchomieniem hello pamięci masowej migawki podczas w trybie przygotowania migawki hello SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="8b2a8-127">Zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w artykule pokrewne hello [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="8b2a8-128">Po zakończeniu hello pamięci masowej migawki jest krytyczne tooconfirm hello SAP HANA migawki.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="8b2a8-129">Brak odpowiedniego toorun instrukcji SQL: Zamknij MIGAWKI danych kopii zapasowej (zobacz [danych zamknij MIGAWKI instrukcji BACKUP (kopii zapasowych i odzyskiwania)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8b2a8-130">Potwierdź hello HANA migawki.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="8b2a8-131">Z powodu zbyt&quot;kopii przy zapisie,&quot; SAP HANA mogą wymagać dodatkowego miejsca na dysku w migawki — przygotowanie trybu i nie jest możliwe toostart nowych kopii zapasowych do momentu hello SAP HANA migawki został potwierdzony.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="8b2a8-132">Maszyna wirtualna HANA tworzenia kopii zapasowej za pomocą usługi Kopia zapasowa Azure</span><span class="sxs-lookup"><span data-stu-id="8b2a8-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="8b2a8-133">Począwszy od grudnia 2016 r. hello agenta kopii zapasowej hello usługi Kopia zapasowa Azure nie jest dostępna dla maszyn wirtualnych systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="8b2a8-134">toomake korzystanie z platformy Azure kopii zapasowej na poziomie pliku/katalogu hello, czy jeden skopiuj SAP HANA tooa pliki kopii zapasowej maszyny Wirtualnej systemu Windows i następnie użyj hello agenta kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="8b2a8-135">W przeciwnym razie tylko pełna kopia maszyny Wirtualnej systemu Linux jest możliwe za pomocą usługi Kopia zapasowa Azure hello.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="8b2a8-136">Zobacz [omówienie hello funkcji w usłudze Kopia zapasowa Azure](../../../backup/backup-introduction-to-azure-backup.md) toofind się więcej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="8b2a8-137">Witaj usługi Kopia zapasowa Azure zapewnia tooback opcji i przywracania maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="8b2a8-138">Więcej informacji na temat tej usługi oraz sposób jej działania można znaleźć w artykule hello [Zaplanuj infrastrukturę kopii zapasowej maszyny Wirtualnej na platformie Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="8b2a8-139">Istnieją dwa istotne kwestie, zgodnie z artykułem toothat:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="8b2a8-140">_&quot;Dla maszyn wirtualnych systemu Linux tylko plik spójne kopie zapasowe są możliwe, ponieważ systemu Linux nie ma tooVSS równoważnej platformy.&quot;_</span><span class="sxs-lookup"><span data-stu-id="8b2a8-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="8b2a8-141">_&quot;Aplikacje muszą tooimplement własnych &quot;konfigurowania&quot; mechanizmu na powitania przywrócić dane.&quot;_</span><span class="sxs-lookup"><span data-stu-id="8b2a8-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="8b2a8-142">W związku z tym jeden ma toomake się, że SAP HANA jest spójna na dysku, po uruchomieniu hello kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="8b2a8-143">Zobacz _migawki SAP HANA_ opisem we wcześniejszej części hello dokumentu.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="8b2a8-144">Potencjalny problem występuje, gdy SAP HANA pozostaje w tym trybie przygotowania migawki</span><span class="sxs-lookup"><span data-stu-id="8b2a8-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="8b2a8-145">Zobacz [tworzenia magazynu migawek (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) Aby uzyskać więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="8b2a8-146">Ten artykuł stanowi:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-146">That article states:</span></span>

<span data-ttu-id="8b2a8-147">_&quot;Zdecydowanie zaleca się tooconfirm lub Porzuć migawki magazynu jak najszybciej po jego utworzeniu. Podczas hello pamięci masowej migawki są przygotowywane lub utworzone, hello migawkę odpowiednich danych jest zablokowana. Gdy hello migawkę odpowiednich danych jest zablokowany, nadal zmian w hello bazy danych. Takie zmiany nie spowoduje hello zablokowane zmienić toobe migawkę odpowiednich danych. Zamiast tego zmiany hello są zapisywane toopositions w obszarze danych hello, które są niezależne od hello pamięci masowej migawki. Zmiany są także zapisywane toohello dziennika. Jednak hello dłużej hello migawkę odpowiednich danych jest przechowywana zablokowane, hello więcej powitalne może zwiększyć ilość danych.&quot;_</span><span class="sxs-lookup"><span data-stu-id="8b2a8-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="8b2a8-148">Kopia zapasowa Azure zapewnia obsługę hello spójności systemu plików za pośrednictwem rozszerzenia maszyny Wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="8b2a8-149">Rozszerzenia te nie są dostępne autonomicznej i działa tylko w połączeniu z usługą kopia zapasowa Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="8b2a8-150">Niemniej jednak nadal jest wymaganie toomanage SAP HANA migawki tooguarantee aplikacji spójności.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="8b2a8-151">Kopia zapasowa Azure ma dwa główne fazy:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="8b2a8-152">Utwórz migawkę</span><span class="sxs-lookup"><span data-stu-id="8b2a8-152">Take Snapshot</span></span>
- <span data-ttu-id="8b2a8-153">Transfer danych toovault</span><span class="sxs-lookup"><span data-stu-id="8b2a8-153">Transfer data toovault</span></span>

<span data-ttu-id="8b2a8-154">Dlatego można potwierdzić hello SAP HANA migawki po zakończeniu hello kopia zapasowa Azure usługa fazy wykonywania migawki.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="8b2a8-155">Może upłynąć kilka minut toosee w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-155">It might take several minutes toosee in hello Azure portal.</span></span>

![Na poniższym rysunku pokazano hello zadanie tworzenia kopii zapasowej listy usługi Kopia zapasowa Azure](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="8b2a8-157">Na poniższym rysunku pokazano hello zadanie tworzenia kopii zapasowej listy usługi Kopia zapasowa Azure, która była używana tooback się hello HANA testowej maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![Szczegóły zadania hello tooshow, kliknij przycisk hello zadanie tworzenia kopii zapasowej w hello portalu Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="8b2a8-159">tooshow hello szczegóły zadania, kliknij zadanie tworzenia kopii zapasowej hello w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="8b2a8-160">Tutaj jedną zobaczyć Witaj dwie fazy.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="8b2a8-161">Może upłynąć kilka minut, aż fazy migawki hello będzie wyświetlana jako ukończone.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="8b2a8-162">W większości przypadków hello jest poświęcony na etapie hello transferu danych.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="8b2a8-163">Maszyna wirtualna HANA automatyzacji tworzenia kopii zapasowej za pomocą usługi Kopia zapasowa Azure</span><span class="sxs-lookup"><span data-stu-id="8b2a8-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="8b2a8-164">Jeden można potwierdzić ręcznie hello SAP HANA migawki po kopia zapasowa Azure faza migawki hello jest zakończona, jak opisano wcześniej, ale jest automatyzacji tooconsider przydatne, ponieważ administrator nie może monitorować zadanie tworzenia kopii zapasowej hello na liście hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="8b2a8-165">W tym miejscu jest wyjaśnienie, jak można można zrealizować przy użyciu poleceń cmdlet programu Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Usługa Kopia zapasowa Azure została utworzona przy hello nazwa hana magazynu kopii zapasowej —](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="8b2a8-167">Usługa Kopia zapasowa Azure została utworzona o nazwie hello &quot;hana-kopii zapasowej-magazynu.&quot; hello polecenia PS **Get AzureRmRecoveryServicesVault-nazwa magazynu w przypadku kopii zapasowych hana** pobiera hello odpowiedni obiekt.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="8b2a8-168">Ten obiekt jest następnie używane tooset hello kontekstu kopii zapasowych, jak pokazano na rysunku dalej hello.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![Jeden sprawdzaj hello zadanie tworzenia kopii zapasowej w toku](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="8b2a8-170">Po ustawienie hello poprawny kontekst jedna Sprawdź, czy zadanie tworzenia kopii zapasowej hello w toku i poszukaj jego szczegóły zadania.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="8b2a8-171">Lista podzadanie Hello zawiera, jeśli fazy migawki hello hello Azure zadanie tworzenia kopii zapasowej jest już ukończone:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Wartość hello sondowania w pętli do momentu Monitor przechodzi w stan tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="8b2a8-173">Po hello szczegóły zadania są przechowywane w zmiennej, to po prostu PS składni tooget toohello pierwszy wpisem w tablicy i pobrać wartość stanu hello.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="8b2a8-174">skrypt automatyzacji hello toocomplete, wartość hello sondowania w pętli, dopóki powoduje zbyt&quot;ukończone.&quot;</span><span class="sxs-lookup"><span data-stu-id="8b2a8-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="8b2a8-175">Klucz licencji HANA i wirtualna przywrócić za pomocą usługi Kopia zapasowa Azure</span><span class="sxs-lookup"><span data-stu-id="8b2a8-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="8b2a8-176">Witaj usługi Kopia zapasowa Azure jest zaprojektowana toocreate nowej maszyny Wirtualnej podczas przywracania.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="8b2a8-177">Brak nie plan prawym teraz toodo &quot;w miejscu&quot; przywracania istniejącej maszyny Wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Na poniższym rysunku pokazano opcji przywracania hello hello usługi Azure w portalu Azure hello](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="8b2a8-179">Na poniższym rysunku pokazano opcji przywracania hello hello usługi Azure w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="8b2a8-180">Można między tworzenia maszyny Wirtualnej podczas przywracania lub przywracanie hello dysków.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="8b2a8-181">Po przywróceniu hello dysków, jest nadal konieczne toocreate nowej maszyny Wirtualnej znajdujący się na nim.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="8b2a8-182">Po każdej zmianie nowej maszyny Wirtualnej jest tworzony na Azure hello Unikatowy identyfikator maszyny Wirtualnej zmiany (zobacz [dostęp i przy użyciu usługi Azure VM Unikatowy identyfikator](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Na poniższym rysunku pokazano Unikatowy identyfikator maszyny Wirtualnej Azure hello przed i po przywróceniu hello za pomocą usługi Kopia zapasowa Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="8b2a8-184">Na poniższym rysunku pokazano Unikatowy identyfikator maszyny Wirtualnej Azure hello przed i po przywróceniu hello za pomocą usługi Kopia zapasowa Azure.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="8b2a8-185">Witaj SAP sprzętu klucz, który jest używany do licencjonowania SAP, używa to unikatowy identyfikator maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="8b2a8-186">W konsekwencji nowej licencji SAP ma toobe zainstalowane po przywróceniu maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="8b2a8-187">Nowa funkcja Kopia zapasowa Azure został przedstawiony w wersji zapoznawczej podczas tworzenia hello niniejszego przewodnika tworzenia kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="8b2a8-188">Umożliwia przywrócenie poziomu pliku oparte na powitania migawki maszyny Wirtualnej, która została wykonana dla maszyny Wirtualnej hello kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="8b2a8-189">Dzięki temu można uniknąć toodeploy potrzeby hello nowej maszyny Wirtualnej i w związku z tym hello Unikatowy identyfikator maszyny Wirtualnej pozostaje hello takie same i jest wymagane nie nowy klucz licencji SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="8b2a8-190">Więcej dokumentacji na ta funkcja będzie dostępna po został w pełni przetestowany.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="8b2a8-191">Kopia zapasowa Azure ostatecznie umożliwi kopii zapasowej poszczególnych dysków wirtualnych platformy Azure, a także pliki i katalogi z wewnątrz hello maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="8b2a8-192">Główną zaletą usługi Kopia zapasowa Azure jest jego zarządzania wszystkie kopie zapasowe hello, zapisywanie powitania klienta z konieczności toodo go.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="8b2a8-193">Jeśli niezbędne przywracania kopii zapasowej Azure wybierze hello poprawne toouse kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="8b2a8-194">Kopia zapasowa maszyny Wirtualnej programu SAP HANA za pomocą migawki ręczne dysku</span><span class="sxs-lookup"><span data-stu-id="8b2a8-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="8b2a8-195">Zamiast przy użyciu usługi Kopia zapasowa Azure hello, co może skonfigurować poszczególnych tworzenia kopii zapasowych przez tworzenie migawek obiektów blob Azure wirtualne dyski twarde ręcznie za pomocą programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="8b2a8-196">Zobacz [migawki obiektu blob korzystanie z programu PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) opis kroków hello.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="8b2a8-197">Zapewnia większą elastyczność, ale nie rozwiązuje problemy hello wyjaśniono wcześniej w tym dokumencie:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="8b2a8-198">Jeden nadal należy się upewnić, że SAP HANA jest spójne</span><span class="sxs-lookup"><span data-stu-id="8b2a8-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="8b2a8-199">Nie można zastąpić Hello dysk systemu operacyjnego, nawet jeśli istnieje powitalne cofnięciu ze względu na komunikat o błędzie informujący, że dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="8b2a8-200">Działa tylko po usunięcie hello maszynę Wirtualną, co może spowodować tooa nowy unikatowy identyfikator maszyny Wirtualnej i hello potrzeby tooinstall nowej licencji SAP.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![Jest możliwe toorestore tylko hello danych dyski maszyny Wirtualnej platformy Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="8b2a8-202">Jest możliwe toorestore tylko dyski danych hello maszyny Wirtualnej platformy Azure, unikając problem hello pobierania nowy unikatowy identyfikator maszyny Wirtualnej i, w związku z tym unieważnienie licencji SAP hello:</span><span class="sxs-lookup"><span data-stu-id="8b2a8-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="8b2a8-203">Dla testu hello dwóch dysków danych Azure zostały dołączone tooa maszyny Wirtualnej i oprogramowaniem RAID został zdefiniowany oparte na nich</span><span class="sxs-lookup"><span data-stu-id="8b2a8-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="8b2a8-204">Funkcja migawki SAP HANA potwierdzono, że SAP HANA była w spójnym stanie</span><span class="sxs-lookup"><span data-stu-id="8b2a8-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="8b2a8-205">Zablokuj systemu plików (zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w artykule pokrewne hello [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="8b2a8-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="8b2a8-206">Migawki obiektu blob zostały pobrane z obu dysków z danymi</span><span class="sxs-lookup"><span data-stu-id="8b2a8-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="8b2a8-207">Odblokuj systemu plików</span><span class="sxs-lookup"><span data-stu-id="8b2a8-207">File system unfreeze</span></span>
- <span data-ttu-id="8b2a8-208">Potwierdzenie migawki SAP HANA</span><span class="sxs-lookup"><span data-stu-id="8b2a8-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="8b2a8-209">dyski danych hello toorestore, hello maszyny Wirtualnej został zamknięty i obydwa dyski odłączone</span><span class="sxs-lookup"><span data-stu-id="8b2a8-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="8b2a8-210">Po odłączanie hello dysków, zostały zastąpione z migawkami wcześniejsze blob hello</span><span class="sxs-lookup"><span data-stu-id="8b2a8-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="8b2a8-211">Zostały dołączone dyski wirtualne hello przywrócone, a następnie ponownie toohello maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="8b2a8-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="8b2a8-212">Po początkowej hello maszyny Wirtualnej, wszystko na powitania oprogramowania RAID działał prawidłowo i został ponownie ustawiony toohello obiektu blob migawki czasu</span><span class="sxs-lookup"><span data-stu-id="8b2a8-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="8b2a8-213">HANA ustawiono ponownie toohello HANA migawki</span><span class="sxs-lookup"><span data-stu-id="8b2a8-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="8b2a8-214">Jeśli jest możliwe tooshut dół SAP HANA przed migawki obiektu blob hello procedura hello jest mniej złożona.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="8b2a8-215">W takim przypadku jeden można pominąć hello HANA migawki i, jeśli nic dzieje się w systemie hello też pominąć blokowanie system plików hello.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="8b2a8-216">Dodano złożoności wejścia obraz powitania, gdy jest konieczne toodo migawki podczas, gdy wszystko jest w trybie online.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="8b2a8-217">Zobacz _spójność danych SAP HANA podejmując magazynu migawek_ w artykule pokrewne hello [Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="8b2a8-218">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="8b2a8-218">Next steps</span></span>
* <span data-ttu-id="8b2a8-219">[Podręcznik tworzenia kopii zapasowej programu SAP HANA na maszynach wirtualnych Azure](sap-hana-backup-guide.md) zapewnia przegląd oraz informacje o wprowadzenie.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="8b2a8-220">[Kopia zapasowa SAP HANA oparte na poziomie plików](sap-hana-backup-file-level.md) obejmuje hello opcję tworzenia kopii zapasowych opartych na plikach.</span><span class="sxs-lookup"><span data-stu-id="8b2a8-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="8b2a8-221">toolearn jak tooestablish wysokiej dostępności i planu odzyskiwania po awarii programu SAP HANA na platformie Azure (wystąpienia duże), zobacz [SAP HANA (duże wystąpień) wysokiej dostępności i odzyskiwania po awarii na platformie Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="8b2a8-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
