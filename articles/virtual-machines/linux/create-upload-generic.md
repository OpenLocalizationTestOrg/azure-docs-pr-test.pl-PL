---
title: Tworzenie i przekazywanie wirtualnego dysku twardego systemu Linux na platformie Azure
description: "Dowiedz się utworzyć i przekazać Azure wirtualnego dysku twardego (VHD) z systemem operacyjnym Linux."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: ccadf55c492c097ef96f25e469dbf36fc87b6102
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="16b66-103">Informacje o nieobsługiwanych dystrybucjach</span><span class="sxs-lookup"><span data-stu-id="16b66-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="16b66-104">Platforma Azure umowy SLA stosuje się do maszyn wirtualnych z systemem operacyjnym Linux tylko wtedy, gdy jeden z [dystrybucje zatwierdzone](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) jest używany.</span><span class="sxs-lookup"><span data-stu-id="16b66-104">The Azure platform SLA applies to virtual machines running the Linux OS only when one of the [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="16b66-105">Wszystkie dystrybucje systemu Linux, które znajdują się w galerii Azure obrazu są potwierdzony dystrybucji z odpowiednią konfiguracją.</span><span class="sxs-lookup"><span data-stu-id="16b66-105">All Linux distributions that are provided in the Azure image gallery are endorsed distributions with the required configuration.</span></span>

* [<span data-ttu-id="16b66-106">Dystrybucje zatwierdzone na systemie Linux na platformie Azure —</span><span class="sxs-lookup"><span data-stu-id="16b66-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="16b66-107">Obsługa obrazów systemu Linux na platformie Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="16b66-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="16b66-108">Wszystkie dystrybucje działających na platformie Azure należy spełnić kilka wymagań wstępnych, aby mieć możliwość działać poprawnie na platformie.</span><span class="sxs-lookup"><span data-stu-id="16b66-108">All distributions running on Azure will need to meet a number of prerequisites to have a chance to properly run on the platform.</span></span>  <span data-ttu-id="16b66-109">Ten artykuł zawiera kompleksowe w żadnym wypadku nie zgodnie z każdym dystrybucji jest inny, i jest dość możliwe, że nawet jeśli zostały spełnione poniższe kryteria nadal konieczne będzie znacznie dostosowanie systemu Linux, aby upewnić się, że poprawnie działa na platformie.</span><span class="sxs-lookup"><span data-stu-id="16b66-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all the criteria below you will still need to significantly tweak your Linux system to ensure that it properly runs on the platform.</span></span>

<span data-ttu-id="16b66-110">To dlatego zaleca się uruchamiania jednego z naszych [systemu Linux na dystrybucje zatwierdzone Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) Jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="16b66-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="16b66-111">Następujące artykuły przeprowadzi Cię przez proces przygotowania różnych potwierdzony dystrybucje systemu Linux, które są obsługiwane na platformie Azure:</span><span class="sxs-lookup"><span data-stu-id="16b66-111">The following articles will guide you through how to prepare the various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="16b66-112">**[Na podstawie centOS dystrybucji](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="16b66-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="16b66-113">**[Debian systemu Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="16b66-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="16b66-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="16b66-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="16b66-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="16b66-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="16b66-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="16b66-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="16b66-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="16b66-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="16b66-118">Pozostała część ten artykuł koncentruje się na ogólne wskazówki dotyczące uruchamiania dystrybucji systemu Linux na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-118">The rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="16b66-119">Informacje o instalacji ogólne systemu Linux</span><span class="sxs-lookup"><span data-stu-id="16b66-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="16b66-120">VHDX format jest nieobsługiwane w systemie Azure, tylko **stały VHD**.</span><span class="sxs-lookup"><span data-stu-id="16b66-120">The VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="16b66-121">Dysk można przekonwertować na format wirtualnego dysku twardego za pomocą Menedżera funkcji Hyper-V lub polecenia cmdlet convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="16b66-121">You can convert the disk to VHD format using Hyper-V Manager or the convert-vhd cmdlet.</span></span> <span data-ttu-id="16b66-122">Jeśli używasz VirtualBox oznacza to, wybierając **stały rozmiar** zamiast domyślnego dynamicznie przydzielane podczas tworzenia dysku.</span><span class="sxs-lookup"><span data-stu-id="16b66-122">If you are using VirtualBox this means selecting **Fixed size** as opposed to the default dynamically allocated when creating the disk.</span></span>
* <span data-ttu-id="16b66-123">Azure obsługuje tylko maszyny wirtualne generacji 1.</span><span class="sxs-lookup"><span data-stu-id="16b66-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="16b66-124">Maszyny wirtualne generacji 1 można przekonwertować z VHDX do formatu pliku wirtualnego dysku twardego i dynamicznie powiększające się na dysku stałym rozmiarze.</span><span class="sxs-lookup"><span data-stu-id="16b66-124">You can convert a generation 1 virtual machine from VHDX to the VHD file format and from dynamically expanding to a fixed sized disk.</span></span> <span data-ttu-id="16b66-125">Ale nie można zmienić generację maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="16b66-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="16b66-126">Aby uzyskać więcej informacji, zobacz [należy tworzyć maszyny wirtualne generacji 1 lub 2 w funkcji Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="16b66-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="16b66-127">Maksymalny rozmiar dozwolony dla wirtualnego dysku twardego jest 1,023 GB.</span><span class="sxs-lookup"><span data-stu-id="16b66-127">The maximum size allowed for the VHD is 1,023 GB.</span></span>
* <span data-ttu-id="16b66-128">Podczas instalowania systemu Linux jest *zalecane* używasz standardowe partycje, a nie LVM (często domyślnie dla wielu instalacji).</span><span class="sxs-lookup"><span data-stu-id="16b66-128">When installing the Linux system it is *recommended* that you use standard partitions rather than LVM (often the default for many installations).</span></span> <span data-ttu-id="16b66-129">Pozwoli to uniknąć konfliktów nazw LVM sklonowany maszyn wirtualnych, szczególnie, gdy dysk systemu operacyjnego kiedykolwiek musi być dołączona do innego identyczne maszyny Wirtualnej do rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="16b66-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs to be attached to another identical VM for troubleshooting.</span></span> <span data-ttu-id="16b66-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) lub [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) może być używany dla dysków z danymi.</span><span class="sxs-lookup"><span data-stu-id="16b66-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="16b66-131">Wymagana jest obsługa jądra służący do instalowania systemów plików funkcji zdefiniowanej przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="16b66-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="16b66-132">Przy pierwszym uruchomieniu komputera na platformie Azure konfiguracji inicjowania obsługi administracyjnej jest przekazywany do maszyny Wirtualnej systemu Linux za pomocą nośnika sformatowany UDF, dołączonego do gościa.</span><span class="sxs-lookup"><span data-stu-id="16b66-132">At first boot on Azure the provisioning configuration is passed to the Linux VM via UDF-formatted media that is attached to the guest.</span></span> <span data-ttu-id="16b66-133">Agent systemu Linux platformy Azure musi mieć możliwość zainstalowania systemu plików funkcji zdefiniowanej przez użytkownika do odczytu konfiguracji i udostępnić Maszynie wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="16b66-133">The Azure Linux agent must be able to mount the UDF file system to read its configuration and provision the VM.</span></span>
* <span data-ttu-id="16b66-134">Wersje jądra systemu Linux poniżej 2.6.37 nie obsługują NUMA w funkcji Hyper-V o dużym rozmiarze maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="16b66-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="16b66-135">Ten problem wpływa głównie na starszą dystrybucji przy użyciu nadrzędnego Red Hat 2.6.32 jądra i ustalono w RHEL 6.6 (jądra-2.6.32 504).</span><span class="sxs-lookup"><span data-stu-id="16b66-135">This issue primarily impacts older distributions using the upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="16b66-136">Komputerów z systemami niestandardowych jądra starsze niż 2.6.37 lub systemem RHEL jądra starsze niż 2.6.32-504 należy ustawić parametr rozruchowego `numa=off` na wiersza polecenia w grub.conf jądra.</span><span class="sxs-lookup"><span data-stu-id="16b66-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set the boot parameter `numa=off` on the kernel command-line in grub.conf.</span></span> <span data-ttu-id="16b66-137">Aby uzyskać więcej informacji, zobacz Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="16b66-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="16b66-138">Nie należy konfigurować wymiany partycji na dysku systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="16b66-138">Do not configure a swap partition on the OS disk.</span></span> <span data-ttu-id="16b66-139">Aby utworzyć plik wymiany na dysku zasobów można skonfigurować agenta systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="16b66-139">The Linux agent can be configured to create a swap file on the temporary resource disk.</span></span>  <span data-ttu-id="16b66-140">Więcej informacji na ten temat można znaleźć w poniższych krokach.</span><span class="sxs-lookup"><span data-stu-id="16b66-140">More information about this can be found in the steps below.</span></span>
* <span data-ttu-id="16b66-141">Wszystkie wirtualne dyski twarde muszą mieć rozmiary, które są wielokrotności 1 MB.</span><span class="sxs-lookup"><span data-stu-id="16b66-141">All of the VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="16b66-142">Instalowanie modułów jądra bez funkcji Hyper-V</span><span class="sxs-lookup"><span data-stu-id="16b66-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="16b66-143">Azure działa na funkcji hypervisor Hyper-V, więc Linux wymaga zainstalowania niektórych modułów jądra, aby można było uruchomić na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-143">Azure runs on the Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order to run in Azure.</span></span> <span data-ttu-id="16b66-144">Jeśli masz maszynę Wirtualną, która została utworzona poza funkcji Hyper-V, instalatorzy systemu Linux nie może zawierać sterowniki dla funkcji Hyper-V w początkowej ramdisk (initrd lub initramfs), chyba że wykryje, że jest on uruchomiony w środowisku funkcji Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="16b66-144">If you have a VM that was created outside of Hyper-V, the Linux installers may not include the drivers for Hyper-V in the initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="16b66-145">Przygotowywanie obrazu systemu Linux za pomocą różnych wirtualizacji systemu (tj. Virtualbox, KVM itp.), może być konieczne odbudowanie initrd, aby upewnić się, że co najmniej `hv_vmbus` i `hv_storvsc` modułów jądra są dostępne w początkowej ramdisk.</span><span class="sxs-lookup"><span data-stu-id="16b66-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) to prepare your Linux image, you may need to rebuild the initrd to ensure that at least the `hv_vmbus` and `hv_storvsc` kernel modules are available on the initial ramdisk.</span></span>  <span data-ttu-id="16b66-146">To znany problem z co najmniej na systemy oparte na nadrzędnego dystrybucji Red Hat.</span><span class="sxs-lookup"><span data-stu-id="16b66-146">This is a known issue at least on systems based on the upstream Red Hat distribution.</span></span>

<span data-ttu-id="16b66-147">Mechanizm odbudowywania obrazu initrd lub initramfs może się różnić w zależności od dystrybucji.</span><span class="sxs-lookup"><span data-stu-id="16b66-147">The mechanism for rebuilding the initrd or initramfs image may vary depending on the distribution.</span></span> <span data-ttu-id="16b66-148">Dokumentacja programu dystrybucji lub obsługę prawidłowe procedury.</span><span class="sxs-lookup"><span data-stu-id="16b66-148">Please consult your distribution's documentation or support for the proper procedure.</span></span>  <span data-ttu-id="16b66-149">Oto przykład sposobu odbudować przy użyciu initrd `mkinitrd` narzędzie:</span><span class="sxs-lookup"><span data-stu-id="16b66-149">Here is one example for how to rebuild the initrd using the `mkinitrd` utility:</span></span>

<span data-ttu-id="16b66-150">Najpierw należy utworzyć kopię zapasową istniejącego obrazu initrd:</span><span class="sxs-lookup"><span data-stu-id="16b66-150">First, back up the existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="16b66-151">Następnie Odbuduj initrd z `hv_vmbus` i `hv_storvsc` modułów jądra:</span><span class="sxs-lookup"><span data-stu-id="16b66-151">Next, rebuild the initrd with the `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="16b66-152">Zmiana rozmiaru wirtualnych dysków twardych</span><span class="sxs-lookup"><span data-stu-id="16b66-152">Resizing VHDs</span></span>
<span data-ttu-id="16b66-153">Obrazy VHD na platformie Azure muszą mieć rozmiar wirtualny wyrównany do 1MB.</span><span class="sxs-lookup"><span data-stu-id="16b66-153">VHD images on Azure must have a virtual size aligned to 1MB.</span></span>  <span data-ttu-id="16b66-154">Zwykle wirtualne dyski twarde utworzone za pomocą funkcji Hyper-V powinien już być wyrównane poprawnie.</span><span class="sxs-lookup"><span data-stu-id="16b66-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="16b66-155">Jeśli wirtualny dysk twardy nie jest wyrównany prawidłowo, może pojawić się komunikat o błędzie podobny do następującego podczas próby utworzenia *obrazu* z z wirtualnego dysku twardego:</span><span class="sxs-lookup"><span data-stu-id="16b66-155">If the VHD is not aligned correctly then you may receive an error message similar to the following when you attempt to create an *image* from your VHD:</span></span>

    "The VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. The size must be a whole number (in MBs).”

<span data-ttu-id="16b66-156">Aby rozwiązać ten problem można zmienić rozmiar maszyny Wirtualnej przy użyciu konsoli Menedżera funkcji Hyper-V lub [wirtualnego dysku twardego zmiany rozmiaru](http://technet.microsoft.com/library/hh848535.aspx) polecenia cmdlet programu Powershell.</span><span class="sxs-lookup"><span data-stu-id="16b66-156">To remedy this you can resize the VM using either the Hyper-V Manager console or the [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="16b66-157">Jeśli nie zostały uruchomione w środowisku Windows następnie zaleca się qemu img umożliwia konwertowanie (w razie potrzeby), a następnie zmień rozmiar wirtualnego dysku twardego.</span><span class="sxs-lookup"><span data-stu-id="16b66-157">If you are not running in a Windows environment then it is recommended to use qemu-img to convert (if needed) and resize the VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="16b66-158">Jest znaną usterką w wersjach qemu img > = 2.2.1, których wynikiem jest nieprawidłowo sformatowany dysk VHD.</span><span class="sxs-lookup"><span data-stu-id="16b66-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="16b66-159">Problem został rozwiązany w wersji 2.6 QEMU.</span><span class="sxs-lookup"><span data-stu-id="16b66-159">The issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="16b66-160">Zaleca się qemu-img 2.2.0 lub starszego, lub po zaktualizowaniu 2.6 lub nowszy.</span><span class="sxs-lookup"><span data-stu-id="16b66-160">It is recommended to use either qemu-img 2.2.0 or lower, or update to 2.6 or higher.</span></span> <span data-ttu-id="16b66-161">Odwołanie: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="16b66-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="16b66-162">Zmiana rozmiaru wirtualnego dysku twardego bezpośrednio za pomocą narzędzi takich jak `qemu-img` lub `vbox-manage` może spowodować rozruch wirtualnego dysku twardego.</span><span class="sxs-lookup"><span data-stu-id="16b66-162">Resizing the VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="16b66-163">Tak zaleca się pierwszy Konwertuj dysku VHD na obraz dysku RAW.</span><span class="sxs-lookup"><span data-stu-id="16b66-163">So it is recommended to first convert the VHD to a RAW disk image.</span></span>  <span data-ttu-id="16b66-164">Obraz maszyny Wirtualnej został już utworzony jako obraz dysku surowego (domyślnie dla niektórych funkcji hypervisor, takich jak KVM) może pominąć ten krok:</span><span class="sxs-lookup"><span data-stu-id="16b66-164">If the VM image was already created as RAW disk image (the default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="16b66-165">Oblicz wymagany rozmiar obrazu dysku, aby upewnić się, że rozmiar wirtualnego jest wyrównany do 1MB.</span><span class="sxs-lookup"><span data-stu-id="16b66-165">Calculate the required size of the disk image to ensure that the virtual size is aligned to 1MB.</span></span>  <span data-ttu-id="16b66-166">Następujący skrypt powłoki bash może pomóc to.</span><span class="sxs-lookup"><span data-stu-id="16b66-166">The following bash shell script can assist with this.</span></span>  <span data-ttu-id="16b66-167">Skrypt używa "`qemu-img info`" do określenia rozmiaru obrazu dysku wirtualnego, a następnie oblicza rozmiar, aby dalej 1 MB:</span><span class="sxs-lookup"><span data-stu-id="16b66-167">The script uses "`qemu-img info`" to determine the virtual size of the disk image and then calculates the size to the next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="16b66-168">Zmiana rozmiaru dysku raw, przy użyciu $rounded_size zgodnie z powyższym skryptu:</span><span class="sxs-lookup"><span data-stu-id="16b66-168">Resize the raw disk using $rounded_size as set in the above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="16b66-169">Teraz zamiany dysk NIESFORMATOWANY dysk VHD o stałym rozmiarze:</span><span class="sxs-lookup"><span data-stu-id="16b66-169">Now, convert the RAW disk back to a fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="16b66-170">Lub z wersją qemu **2.6 +** obejmują `force_size` opcji:</span><span class="sxs-lookup"><span data-stu-id="16b66-170">Or, with qemu version **2.6+** include the `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="16b66-171">Wymagania dotyczące jądra systemu Linux</span><span class="sxs-lookup"><span data-stu-id="16b66-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="16b66-172">Sterowniki usługi integracji systemu Linux (LIS) dla funkcji Hyper-V i platformy Azure są tworzone bezpośrednio do nadrzędnego jądra systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="16b66-172">The Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly to the upstream Linux kernel.</span></span> <span data-ttu-id="16b66-173">Wiele dystrybucji, które obejmują najnowszej wersji jądra systemu Linux (tj. 3.x) zostały już te sterowniki, które są dostępne lub w inny sposób dostarczyć backported wersje tych sterowników z ich jądra.</span><span class="sxs-lookup"><span data-stu-id="16b66-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="16b66-174">Te sterowniki są stale aktualizowane w nadrzędnym jądra nowe poprawki i funkcje, więc jeśli to możliwe zaleca się uruchomienie [zatwierdzone dystrybucji](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) zawierające te poprawki i aktualizacje.</span><span class="sxs-lookup"><span data-stu-id="16b66-174">These drivers are constantly being updated in the upstream kernel with new fixes and features, so when possible it is recommended to run an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="16b66-175">Jeśli używasz wariant wersji Red Hat Enterprise Linux **6.0 6.3**, a następnie należy zainstalować najnowsze sterowniki usług LIS dla funkcji Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="16b66-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need to install the latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="16b66-176">Sterowniki można znaleźć [w tej lokalizacji](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="16b66-176">The drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="16b66-177">Począwszy od RHEL **6.4 +** (i ich pochodnych) sterowniki LIS są już dołączone do jądra i dlatego żadnych pakietów instalacji dodatkowych nie są wymagane do uruchamiania tych systemów na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-177">As of RHEL **6.4+** (and derivatives) the LIS drivers are already included with the kernel and so no additional installation packages are needed to run those systems on Azure.</span></span>

<span data-ttu-id="16b66-178">Jeśli wymagana jest niestandardowe jądra, zalecane jest Użyj nowszej wersji jądra (tj. **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="16b66-178">If a custom kernel is required, it is recommended to use a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="16b66-179">Dla tych dystrybucji lub dostawców, którzy mają własne jądra wysiłku będą musieli regularnie Poprawka usterki systemu sterowniki LIS z nadrzędnego jądra Twoje niestandardowe jądra.</span><span class="sxs-lookup"><span data-stu-id="16b66-179">For those distributions or vendors who maintain their own kernel, some effort will be required to regularly backport the LIS drivers from the upstream kernel to your custom kernel.</span></span>  <span data-ttu-id="16b66-180">Nawet jeśli już używasz stosunkowo najnowszej wersji jądra, jest zalecane do śledzenia dowolnego nadrzędnego poprawki LIS sterowniki i poprawka usterki systemu tych zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="16b66-180">Even if you are already running a relatively recent kernel version, it is highly recommended to keep track of any upstream fixes in the LIS drivers and backport those as needed.</span></span> <span data-ttu-id="16b66-181">Jest dostępna w lokalizacji plików źródłowych sterownik LIS [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) pliku w drzewie źródła jądra systemu Linux:</span><span class="sxs-lookup"><span data-stu-id="16b66-181">The location of the LIS driver source files is available in the [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in the Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="16b66-182">W bardzo minimalny braku następujące poprawki być znane spowodować problemy w systemie Azure i dlatego te muszą być zawarte w jądra.</span><span class="sxs-lookup"><span data-stu-id="16b66-182">At a very minimum, the absence of the following patches have been known to cause problems on Azure and so these must be included in the kernel.</span></span> <span data-ttu-id="16b66-183">Ta lista w żadnym wypadku nie jest kompletną lub zakończenie wszystkich dystrybucji:</span><span class="sxs-lookup"><span data-stu-id="16b66-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="16b66-184">ata_piix: odroczenie dysków sterowników funkcji Hyper-V domyślnie</span><span class="sxs-lookup"><span data-stu-id="16b66-184">ata_piix: defer disks to the Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="16b66-185">storvsc: konto dla pakietów w drodze w ścieżce RESETOWANIA</span><span class="sxs-lookup"><span data-stu-id="16b66-185">storvsc: Account for in-transit packets in the RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="16b66-186">storvsc: unikaj użycia WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="16b66-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="16b66-187">storvsc: Wyłącz zapisu w tej samej macierzy RAID i sterowniki karty hosta wirtualnego</span><span class="sxs-lookup"><span data-stu-id="16b66-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="16b66-188">storvsc: poprawka wyłuskania wskaźnika o wartości NULL</span><span class="sxs-lookup"><span data-stu-id="16b66-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="16b66-189">storvsc: błędy bufora pierścień może spowodować blokowanie operacji We/Wy</span><span class="sxs-lookup"><span data-stu-id="16b66-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="16b66-190">scsi_sysfs: ochronę przed podwójnego wykonywania __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="16b66-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="the-azure-linux-agent"></a><span data-ttu-id="16b66-191">Azure agenta systemu Linux</span><span class="sxs-lookup"><span data-stu-id="16b66-191">The Azure Linux Agent</span></span>
<span data-ttu-id="16b66-192">[Agenta systemu Linux Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (agenta waagent) wymagany prawidłowo obsługi maszyny wirtualnej systemu Linux na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-192">The [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required to properly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="16b66-193">Można pobrać najnowszą wersję, problemów plików lub przesyłania żądań ściągnięcia w [repozytorium GitHub agenta systemu Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="16b66-193">You can get the latest version, file issues or submit pull requests at the [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="16b66-194">Agent systemu Linux jest publikowany w ramach licencji Apache 2.0.</span><span class="sxs-lookup"><span data-stu-id="16b66-194">The Linux agent is released under the Apache 2.0 license.</span></span> <span data-ttu-id="16b66-195">Wiele dystrybucji już Podaj obr. / min lub deb pakietów dla agenta, a więc w niektórych przypadkach to można instalować i aktualizowane przy minimalnym nakładzie pracy.</span><span class="sxs-lookup"><span data-stu-id="16b66-195">Many distributions already provide RPM or deb packages for the agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="16b66-196">Agent systemu Linux Azure wymaga Python v2.6 +.</span><span class="sxs-lookup"><span data-stu-id="16b66-196">The Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="16b66-197">Agent wymaga również moduł pyasn1 języka python.</span><span class="sxs-lookup"><span data-stu-id="16b66-197">The agent also requires the python-pyasn1 module.</span></span> <span data-ttu-id="16b66-198">Większości dystrybucji zapewniają jako osobny pakiet, który może zostać zainstalowany.</span><span class="sxs-lookup"><span data-stu-id="16b66-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="16b66-199">W niektórych przypadkach agenta systemu Linux platformy Azure może nie być zgodna z NetworkManager.</span><span class="sxs-lookup"><span data-stu-id="16b66-199">In some cases the Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="16b66-200">Wiele pakietów RPM/Deb dostarczonych przez dystrybucje skonfigurować NetworkManager jako konflikt pakietu agenta waagent i w związku z tym odinstaluje NetworkManager po zainstalowaniu pakietu agenta systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="16b66-200">Many of the RPM/Deb packages provided by distributions configure NetworkManager as a conflict to the waagent package, and thus will uninstall NetworkManager when you install the Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="16b66-201">Wymagania ogólne systemu Linux</span><span class="sxs-lookup"><span data-stu-id="16b66-201">General Linux System Requirements</span></span>

* <span data-ttu-id="16b66-202">Zmodyfikuj wiersza rozruchu jądra w CHODNIKÓW lub GRUB2, aby uwzględnić następujące parametry.</span><span class="sxs-lookup"><span data-stu-id="16b66-202">Modify the kernel boot line in GRUB or GRUB2 to include the following parameters.</span></span> <span data-ttu-id="16b66-203">Dzięki konsoli komunikaty są wysyłane do pierwszego portu szeregowego może pomóc Azure pomocy dotyczącej debugowanie problemów:</span><span class="sxs-lookup"><span data-stu-id="16b66-203">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="16b66-204">Dzięki konsoli komunikaty są wysyłane do pierwszego portu szeregowego może pomóc Azure pomocy dotyczącej debugowanie problemów.</span><span class="sxs-lookup"><span data-stu-id="16b66-204">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="16b66-205">Oprócz powyższego, zaleca się *Usuń* następujących parametrów, jeśli istnieją:</span><span class="sxs-lookup"><span data-stu-id="16b66-205">In addition to the above, it is recommended to *remove* the following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="16b66-206">Graficznego i cichy rozruchu nie są przydatne w środowisku chmury, gdy chcemy, aby wszystkie dzienniki, które mają być wysyłane do portu szeregowego.</span><span class="sxs-lookup"><span data-stu-id="16b66-206">Graphical and quiet boot are not useful in a cloud environment where we want all the logs to be sent to the serial port.</span></span> <span data-ttu-id="16b66-207">`crashkernel` Opcja może być skonfigurowany w razie potrzeby po lewej, ale należy pamiętać, że ten parametr zmniejsza ilość dostępnej pamięci w maszynie Wirtualnej najmniej 128 MB, które mogą być problemy na mniejsze rozmiary maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="16b66-207">The `crashkernel` option may be left configured if desired, but note that this parameter will reduce the amount of available memory in the VM by 128MB or more, which may be problematic on the smaller VM sizes.</span></span>

* <span data-ttu-id="16b66-208">Instalowanie agenta programu Azure systemu Linux</span><span class="sxs-lookup"><span data-stu-id="16b66-208">Installing the Azure Linux Agent</span></span>
  
    <span data-ttu-id="16b66-209">Agenta systemu Linux platformy Azure jest wymagany do obsługi obraz systemu Linux na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-209">The Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="16b66-210">Wiele dystrybucji zapewniają agenta jako pakiet RPM lub Deb (pakiet jest zwykle nazywane "WALinuxAgent" lub "walinuxagent").</span><span class="sxs-lookup"><span data-stu-id="16b66-210">Many distributions provide the agent as an RPM or Deb package (the package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="16b66-211">Agenta można także zainstalować ręcznie, wykonując kroki opisane w [przewodnik agenta systemu Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="16b66-211">The agent can also be installed manually by following the steps in the [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="16b66-212">Upewnij się, że serwer SSH jest zainstalowany i skonfigurowany do uruchamiania w czasie rozruchu.</span><span class="sxs-lookup"><span data-stu-id="16b66-212">Ensure that the SSH server is installed and configured to start at boot time.</span></span>  <span data-ttu-id="16b66-213">Zazwyczaj jest to wartość domyślna.</span><span class="sxs-lookup"><span data-stu-id="16b66-213">This is usually the default.</span></span>

* <span data-ttu-id="16b66-214">Nie należy tworzyć zamiany miejsca na dysku systemu operacyjnego</span><span class="sxs-lookup"><span data-stu-id="16b66-214">Do not create swap space on the OS disk</span></span>
  
    <span data-ttu-id="16b66-215">Agent systemu Linux platformy Azure mogą automatycznie konfigurować obszar wymiany przy użyciu dysku zasób lokalny, który jest dołączony do maszyny Wirtualnej po zainicjowaniu obsługi administracyjnej na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-215">The Azure Linux Agent can automatically configure swap space using the local resource disk that is attached to the VM after provisioning on Azure.</span></span> <span data-ttu-id="16b66-216">Należy zauważyć, że dysk lokalny zasób *tymczasowego* na dysku i może opróżnić, gdy maszyna wirtualna jest anulowana.</span><span class="sxs-lookup"><span data-stu-id="16b66-216">Note that the local resource disk is a *temporary* disk, and might be emptied when the VM is deprovisioned.</span></span> <span data-ttu-id="16b66-217">Po zainstalowaniu agenta systemu Linux platformy Azure (zobacz poprzedni krok) i zmodyfikuj odpowiednio w /etc/waagent.conf następujące parametry:</span><span class="sxs-lookup"><span data-stu-id="16b66-217">After installing the Azure Linux Agent (see previous step), modify the following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

* <span data-ttu-id="16b66-218">Jako ostatni krok Uruchom następujące polecenia, aby anulowanie zastrzeżenia maszyny wirtualnej:</span><span class="sxs-lookup"><span data-stu-id="16b66-218">As a final step, run the following commands to deprovision the virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="16b66-219">Na Virtualbox zostanie wyświetlony następujący błąd po uruchomieniu "agenta waagent-force - deprovision": `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="16b66-219">On Virtualbox you may see the following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="16b66-220">Ten komunikat o błędzie nie ma znaczenia krytycznego i można zignorować.</span><span class="sxs-lookup"><span data-stu-id="16b66-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="16b66-221">Następnie należy wyłączyć maszynę wirtualną i przekazywanie wirtualnego dysku twardego na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="16b66-221">You will then need to shut down the virtual machine and upload the VHD to Azure.</span></span>

