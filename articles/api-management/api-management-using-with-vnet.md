---
title: "Jak używać usługi Azure API Management z sieciami wirtualnymi"
description: "Dowiedz się, jak nawiązanie połączenia z siecią wirtualną w Azure API Management i dostęp do usług sieci web za jego pośrednictwem."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 268cee739188d81feffc36ac07fcdfa18ff95a4d
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-use-azure-api-management-with-virtual-networks"></a><span data-ttu-id="6a6eb-103">Jak używać usługi Azure API Management z sieciami wirtualnymi</span><span class="sxs-lookup"><span data-stu-id="6a6eb-103">How to use Azure API Management with virtual networks</span></span>
<span data-ttu-id="6a6eb-104">Sieci wirtualnych platformy Azure (sieci wirtualne) umożliwiają umieszczać zasobów platformy Azure w kontroli dostępu do sieci routeable z systemem innym niż internet.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-104">Azure Virtual Networks (VNETs) allow you to place any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="6a6eb-105">Te sieci następnie mogą być połączone z sieciami lokalnymi przy użyciu różnych technologii sieci VPN.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-105">These networks can then be connected to your on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="6a6eb-106">Aby dowiedzieć się więcej o sieciach wirtualnych platformy Azure Uruchom z informacjami w tym miejscu: [omówienie sieci wirtualnych Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="6a6eb-106">To learn more about Azure Virtual Networks start with the information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="6a6eb-107">Zarządzanie interfejsami API Azure można wdrożyć w sieci wirtualnej (VNET), więc można uzyskać dostęp do usług zaplecza w sieci.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-107">Azure API Management can be deployed inside the virtual network (VNET), so it can access backend services within the network.</span></span> <span data-ttu-id="6a6eb-108">Portalu dla deweloperów i bramy interfejsu API, można skonfigurować jako dostępny z Internetu lub tylko w ramach sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-108">The developer portal and API gateway, can be configured to be accessible either from the Internet or only within the virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="6a6eb-109">Zarządzanie interfejsami API Azure obsługuje sieci wirtualnych Menedżera zasobów klasycznych jak Azure.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="6a6eb-110"><a name="enable-vpn"></a>Połączenia włączyć sieci Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="6a6eb-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="6a6eb-111">Łączność sieci Wirtualnej jest dostępna w **Premium** i **Developer** warstw.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-111">VNET connectivity is available in the **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="6a6eb-112">Aby przełączyć się między warstwami, otwórz usługi Zarządzanie interfejsami API w portalu Azure, a następnie otwórz **skali i cenach** kartę. W obszarze **warstwa cenowa** sekcji, wybierz warstwę Premium lub deweloperem i kliknij przycisk Zapisz.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-112">To switch between the tiers, open your API Management service in the Azure portal and then open the **Scale and pricing** tab. Under the **Pricing tier** section, select the Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="6a6eb-113">Aby włączyć łączność w sieci Wirtualnej, należy otworzyć usługi Zarządzanie interfejsami API na platformie Azure, portalu i Otwórz **sieci wirtualnej** strony.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-113">To enable VNET connectivity, open your API Management service in the Azure portal and open the **Virtual network** page.</span></span>

![Zarządzanie interfejsami API menu sieci wirtualnej][api-management-using-vnet-menu]

<span data-ttu-id="6a6eb-115">Wybierz typ żądany dostęp:</span><span class="sxs-lookup"><span data-stu-id="6a6eb-115">Select the desired access type:</span></span>

* <span data-ttu-id="6a6eb-116">**Zewnętrzne**: portal bramy i deweloperów zarządzanie interfejsami API są dostępne z publicznego Internetu za pomocą zewnętrznej usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-116">**External**: the API Management gateway and developer portal are accessible from the public internet via an external load balancer.</span></span> <span data-ttu-id="6a6eb-117">Bramy mogą uzyskiwać dostęp do zasobów w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-117">The gateway can access resources within the virtual network.</span></span>

![Publiczna komunikacja równorzędna][api-management-vnet-public]

* <span data-ttu-id="6a6eb-119">**Wewnętrzny**: portalu bramy i deweloperów interfejsu API zarządzania jest dostępny tylko w obrębie sieci wirtualnej za pomocą wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-119">**Internal**: the API Management gateway and developer portal are accessible only from within the virtual network via an internal load balancer.</span></span> <span data-ttu-id="6a6eb-120">Bramy mogą uzyskiwać dostęp do zasobów w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-120">The gateway can access resources within the virtual network.</span></span>

![Prywatna komunikacja równorzędna][api-management-vnet-private]

<span data-ttu-id="6a6eb-122">Teraz zostanie wyświetlona lista wszystkich regionów, których obsługa została zainicjowana usługi Zarządzanie interfejsami API.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="6a6eb-123">Wybierz sieć Wirtualną i podsieć dla każdego regionu.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="6a6eb-124">Lista zostanie wypełniona z klasycznym i dostępne w Twojej subskrypcji platformy Azure, które są skonfigurowane w regionie, który jest konfigurowany sieci wirtualnych Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-124">The list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in the region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="6a6eb-125">**Punkt końcowy usługi** na powyższym diagramie obejmuje bramy/serwera Proxy, Portal wydawcy portalu dla deweloperów, GIT i bezpośredniego zarządzania punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-125">**Service Endpoint** in the above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and the Direct Management Endpoint.</span></span>
> <span data-ttu-id="6a6eb-126">**Punkt końcowy zarządzania** na powyższym diagramie jest punktem końcowym hostowanych w usłudze, aby zarządzać konfiguracją za pośrednictwem portalu Azure i programu Powershell.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-126">**Management Endpoint** in the above diagram is the endpoint hosted on the service to manage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="6a6eb-127">Należy również zauważyć, że mimo, że na diagramie przedstawiono adresów IP dla swoich różnych punktów końcowych usługi Zarządzanie interfejsami API **tylko** reaguje na jego skonfigurowanych nazwy hostów.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-127">Also, note, that, even though, the diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6a6eb-128">Podczas wdrażania wystąpienia zarządzanie interfejsami API Azure Resource Manager sieci Wirtualnej, usługa musi być w dedykowanym podsieć, która nie zawiera żadnych innych zasobów, z wyjątkiem wystąpienia usługi Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-128">When deploying an Azure API Management instance to a Resource Manager VNET, the service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="6a6eb-129">Jeśli próby wdrożenie wystąpienia usługi Azure API Management do podsieci sieci Wirtualnej Resource Manager zawierający inne zasoby, wdrożenie zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-129">If an attempt is made to deploy an Azure API Management instance to a Resource Manager VNET subnet that contains other resources, the deployment will fail.</span></span>
>
>

![Wybierz sieci VPN][api-management-setup-vpn-select]

<span data-ttu-id="6a6eb-131">Kliknij przycisk **zapisać** w górnej części ekranu.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-131">Click **Save** at the top of the screen.</span></span>

> [!NOTE]
> <span data-ttu-id="6a6eb-132">Adres VIP wystąpienia interfejsu API zarządzania zmieni zawsze sieci Wirtualnej jest włączone lub wyłączone.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-132">The VIP address of the API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="6a6eb-133">Po przeniesieniu z interfejsu API zarządzania spowoduje również zmianę adresu VIP **zewnętrznych** do **wewnętrzne** lub na odwrót</span><span class="sxs-lookup"><span data-stu-id="6a6eb-133">The VIP address will also change when API Management is moved from **External** to **Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="6a6eb-134">Usuń API Management z sieci Wirtualnej lub zmienić ten, który został wdrożony w uprzednio używanych sieci Wirtualnej mogą pozostać zablokowane przez 4 godziny.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-134">If you remove API Management from a VNET or change the one it is deployed in, the previously used VNET can remain locked for up to 4 hours.</span></span> <span data-ttu-id="6a6eb-135">W tym okresie nie będzie można usunąć sieci Wirtualnej lub wdrożyć nowy zasób.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-135">During this period it will not be possible to delete the VNET or deploy a new resource to it.</span></span>

## <span data-ttu-id="6a6eb-136"><a name="enable-vnet-powershell"></a>Połączenia Włącz sieć Wirtualną przy użyciu poleceń cmdlet programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="6a6eb-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="6a6eb-137">Można również włączyć łączność sieci Wirtualnej przy użyciu poleceń cmdlet programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="6a6eb-137">You can also enable VNET connectivity using the PowerShell cmdlets</span></span>

* <span data-ttu-id="6a6eb-138">**Tworzenie usługi Zarządzanie interfejsami API w sieci Wirtualnej**: Użyj polecenia cmdlet [AzureRmApiManagement nowy](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) można utworzyć usługi Azure API Management w sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-138">**Create an API Management service inside a VNET**: Use the cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) to create an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="6a6eb-139">**Wdrażanie istniejącej usługi Zarządzanie interfejsami API w sieci Wirtualnej**: Użyj polecenia cmdlet [AzureRmApiManagementDeployment aktualizacji](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) Aby przenieść istniejącą usługę Azure API Management w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-139">**Deploy an existing API Management service inside a VNET**: Use the cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) to move an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="6a6eb-140"><a name="connect-vnet"></a>Nawiązywanie połączenia z usługą sieci web hostowanych w sieci wirtualnej</span><span class="sxs-lookup"><span data-stu-id="6a6eb-140"><a name="connect-vnet"> </a>Connect to a web service hosted within a virtual Network</span></span>
<span data-ttu-id="6a6eb-141">Po usługi API Management jest podłączony do sieci Wirtualnej, dostęp do usług zaplecza w nim nie różni się od uzyskiwanie dostępu do usług publicznego.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-141">After your API Management service is connected to the VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="6a6eb-142">Po prostu wpisz lokalny adres IP lub nazwę hosta (Jeśli serwer DNS jest skonfigurowany dla sieci Wirtualnej) usługi sieci web do **adres URL usługi sieci Web** pole podczas tworzenia nowego interfejsu API lub edytowanie istniejących.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-142">Just type in the local IP address or the host name (if a DNS server is configured for the VNET) of your web service into the **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Dodawanie interfejsu API z sieci VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="6a6eb-144"><a name="network-configuration-issues"></a>Typowe problemy z konfiguracją sieci</span><span class="sxs-lookup"><span data-stu-id="6a6eb-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="6a6eb-145">Poniżej znajduje się lista typowych problemów z błędem konfiguracji, które mogą wystąpić podczas wdrażania usługi Zarządzanie interfejsami API w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="6a6eb-146">**Niestandardowe ustawienia serwera DNS**: Usługa interfejsu API zarządzania zależy od wielu usług Azure.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-146">**Custom DNS server setup**: The API Management service depends on several Azure services.</span></span> <span data-ttu-id="6a6eb-147">Zarządzanie interfejsami API znajduje się w sieci Wirtualnej przy użyciu niestandardowego serwera DNS, musi rozpoznać nazwy hostów tych usług Azure.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-147">When API Management is hosted in a VNET with a custom DNS server, it needs to resolve the hostnames of those Azure services.</span></span> <span data-ttu-id="6a6eb-148">Wykonaj [to](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) wytyczne dotyczące niestandardowych ustawień DNS.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="6a6eb-149">Znajdują się w poniższej tabeli portów i inne wymagania dotyczące sieci dla odwołania.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-149">See the ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6a6eb-150">Zaleca się, że jeśli używasz niestandardowych serwerów DNS dla sieci Wirtualnej, skonfigurowaniu który **przed** wdrażania usługi API Management do niego.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-150">It is recommended that, if you are using a Custom DNS Server(s) for the VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="6a6eb-151">W przeciwnym razie należy zaktualizować usługi Zarządzanie interfejsami API każdej zmianie serwerów DNS (s), uruchamiając [zastosować operacji konfiguracji sieciowej](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="6a6eb-151">Otherwise you need to update the API Management service each time you change the DNS Servers(s) by running the [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="6a6eb-152">**Porty wymagane przez interfejs API zarządzania**: ruchu przychodzącego i wychodzącego do podsieci, w której jest wdrażane zarządzanie interfejsami API można kontrolować przy użyciu [sieciowej grupy zabezpieczeń][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="6a6eb-152">**Ports required for API Management**: Inbound and Outbound traffic into the Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="6a6eb-153">Jeśli którekolwiek z tych portów są niedostępne, interfejsu API zarządzania może nie działać prawidłowo i może stać się niedostępne.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="6a6eb-154">Co najmniej jeden z tych portów zablokowane jest posiadanie innego typowe problemy z błędem konfiguracji podczas korzystania z usługi API Management z sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="6a6eb-155">Gdy wystąpienie usługi API Management znajduje się w sieci Wirtualnej, są używane porty w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-155">When an API Management service instance is hosted in a VNET, the ports in the following table are used.</span></span>

| <span data-ttu-id="6a6eb-156">Źródłowego / docelowego porty</span><span class="sxs-lookup"><span data-stu-id="6a6eb-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="6a6eb-157">Kierunek</span><span class="sxs-lookup"><span data-stu-id="6a6eb-157">Direction</span></span> | <span data-ttu-id="6a6eb-158">Protokół transportu</span><span class="sxs-lookup"><span data-stu-id="6a6eb-158">Transport protocol</span></span> | <span data-ttu-id="6a6eb-159">Przeznaczenie</span><span class="sxs-lookup"><span data-stu-id="6a6eb-159">Purpose</span></span> | <span data-ttu-id="6a6eb-160">Źródłowego / docelowego</span><span class="sxs-lookup"><span data-stu-id="6a6eb-160">Source / Destination</span></span> | <span data-ttu-id="6a6eb-161">Typ dostępu</span><span class="sxs-lookup"><span data-stu-id="6a6eb-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="6a6eb-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="6a6eb-162">* / 80, 443</span></span> |<span data-ttu-id="6a6eb-163">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-163">Inbound</span></span> |<span data-ttu-id="6a6eb-164">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-164">TCP</span></span> |<span data-ttu-id="6a6eb-165">Zarządzanie interfejsami API komunikacji klienta</span><span class="sxs-lookup"><span data-stu-id="6a6eb-165">Client communication to API Management</span></span> |<span data-ttu-id="6a6eb-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="6a6eb-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="6a6eb-167">Zewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-167">External</span></span> |
| <span data-ttu-id="6a6eb-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="6a6eb-168">* / 3443</span></span> |<span data-ttu-id="6a6eb-169">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-169">Inbound</span></span> |<span data-ttu-id="6a6eb-170">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-170">TCP</span></span> |<span data-ttu-id="6a6eb-171">Punkt końcowy zarządzania dla portalu Azure i programu Powershell</span><span class="sxs-lookup"><span data-stu-id="6a6eb-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="6a6eb-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="6a6eb-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="6a6eb-173">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-173">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="6a6eb-174">* / 80, 443</span></span> |<span data-ttu-id="6a6eb-175">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-175">Outbound</span></span> |<span data-ttu-id="6a6eb-176">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-176">TCP</span></span> |<span data-ttu-id="6a6eb-177">Zależność od usługi Azure Storage i Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="6a6eb-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="6a6eb-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="6a6eb-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="6a6eb-179">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-179">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="6a6eb-180">* / 1433</span></span> |<span data-ttu-id="6a6eb-181">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-181">Outbound</span></span> |<span data-ttu-id="6a6eb-182">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-182">TCP</span></span> |<span data-ttu-id="6a6eb-183">Zależność Azure SQL</span><span class="sxs-lookup"><span data-stu-id="6a6eb-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="6a6eb-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="6a6eb-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="6a6eb-185">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-185">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="6a6eb-186">* / 11000 - 11999</span></span> |<span data-ttu-id="6a6eb-187">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-187">Outbound</span></span> |<span data-ttu-id="6a6eb-188">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-188">TCP</span></span> |<span data-ttu-id="6a6eb-189">Zależność Azure SQL w wersji 12</span><span class="sxs-lookup"><span data-stu-id="6a6eb-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="6a6eb-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="6a6eb-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="6a6eb-191">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-191">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="6a6eb-192">* / 14000 - 14999</span></span> |<span data-ttu-id="6a6eb-193">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-193">Outbound</span></span> |<span data-ttu-id="6a6eb-194">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-194">TCP</span></span> |<span data-ttu-id="6a6eb-195">Zależność Azure SQL w wersji 12</span><span class="sxs-lookup"><span data-stu-id="6a6eb-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="6a6eb-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="6a6eb-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="6a6eb-197">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-197">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="6a6eb-198">* / 5671</span></span> |<span data-ttu-id="6a6eb-199">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-199">Outbound</span></span> |<span data-ttu-id="6a6eb-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-200">AMQP</span></span> |<span data-ttu-id="6a6eb-201">Zależność od dziennika zasad Centrum zdarzeń i agenta monitorowania</span><span class="sxs-lookup"><span data-stu-id="6a6eb-201">Dependency for Log to Event Hub policy and monitoring agent</span></span> |<span data-ttu-id="6a6eb-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="6a6eb-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="6a6eb-203">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-203">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="6a6eb-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="6a6eb-205">Dla ruchu przychodzącego i wychodzącego</span><span class="sxs-lookup"><span data-stu-id="6a6eb-205">Inbound & Outbound</span></span> |<span data-ttu-id="6a6eb-206">UDP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-206">UDP</span></span> |<span data-ttu-id="6a6eb-207">Zależności w pamięci podręcznej Redis</span><span class="sxs-lookup"><span data-stu-id="6a6eb-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="6a6eb-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="6a6eb-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="6a6eb-209">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-209">External & Internal</span></span> |-
| <span data-ttu-id="6a6eb-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="6a6eb-210">* / 445</span></span> |<span data-ttu-id="6a6eb-211">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-211">Outbound</span></span> |<span data-ttu-id="6a6eb-212">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-212">TCP</span></span> |<span data-ttu-id="6a6eb-213">Zależności w udziale plików platformy Azure dla GIT</span><span class="sxs-lookup"><span data-stu-id="6a6eb-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="6a6eb-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="6a6eb-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="6a6eb-215">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-215">External & Internal</span></span> |
| <span data-ttu-id="6a6eb-216">* / *</span><span class="sxs-lookup"><span data-stu-id="6a6eb-216">* / *</span></span> | <span data-ttu-id="6a6eb-217">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="6a6eb-217">Inbound</span></span> |<span data-ttu-id="6a6eb-218">TCP</span><span class="sxs-lookup"><span data-stu-id="6a6eb-218">TCP</span></span> |<span data-ttu-id="6a6eb-219">Moduł równoważenia obciążenia infrastruktury platformy Azure</span><span class="sxs-lookup"><span data-stu-id="6a6eb-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="6a6eb-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="6a6eb-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="6a6eb-221">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="6a6eb-221">External & Internal</span></span> |

* <span data-ttu-id="6a6eb-222">**Funkcje protokołu SSL**: Aby umożliwić tworzenie łańcucha certyfikatów SSL i sprawdzania poprawności zarządzanie interfejsami API usługi musi mieć łączność sieciową wychodzących ocsp.msocsp.com, mscrl.microsoft.com i crl.microsoft.com. Ta zależność nie jest wymagana, jeśli dowolny certyfikat, które zostaną przesłane do interfejsu API zarządzania zawierają pełny łańcuch do głównego urzędu certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-222">**SSL functionality**: To enable SSL certificate chain building and validation the API Management service needs Outbound network connectivity to ocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload to API Management contain the full chain to the CA root.</span></span>

* <span data-ttu-id="6a6eb-223">**Dostęp DNS**: wychodzący dostęp przez port 53 jest wymagana do komunikacji przy użyciu serwerów DNS.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="6a6eb-224">Jeśli istnieje niestandardowy serwer DNS na drugim końcu bramy sieci VPN, serwer DNS musi być dostępny w podsieci hostingu API Management.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-224">If a custom DNS server exists on the other end of a VPN gateway, the DNS server must be reachable from the subnet hosting API Management.</span></span>

* <span data-ttu-id="6a6eb-225">**Monitorowanie kondycji i metryki**: połączenie sieciowe ruchu wychodzącego Azure punktów końcowych monitorowania, które rozwiązanie w następujących domen: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-225">**Metrics and Health Monitoring**: Outbound network connectivity to Azure Monitoring endpoints, which resolve under the following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="6a6eb-226">**Trasy Instalacja ekspresowa**: Typowa konfiguracja klienta jest określenie własnych trasa domyślna (0.0.0.0/0), co zmusza wychodzący ruch internetowy, zamiast niego przepływ lokalnymi.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-226">**Express Route Setup**: A common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="6a6eb-227">Ten przepływ ruchu niezmiennie dzieli łączność z usługą Azure API Management ruch wychodzący zablokowanych lokalnie, ponieważ NAT czy nierozpoznawalną zbiór adresów, które nie będą działać z różnymi punkty końcowe systemu Azure.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-227">This traffic flow invariably breaks connectivity with Azure API Management because the outbound traffic is either blocked on-premises, or NAT'd to an unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="6a6eb-228">Rozwiązanie jest określenie jednego (lub więcej) trasy zdefiniowane przez użytkownika ([Udr][UDRs]) w podsieci, która zawiera Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-228">The solution is to define one (or more) user-defined routes ([UDRs][UDRs]) on the subnet that contains the Azure API Management.</span></span> <span data-ttu-id="6a6eb-229">PRZEZ definiuje tras specyficzne dla podsieci, które będą honorowane zamiast trasy domyślnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-229">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>
  <span data-ttu-id="6a6eb-230">Jeśli to możliwe zaleca się następującej konfiguracji:</span><span class="sxs-lookup"><span data-stu-id="6a6eb-230">If possible, it is recommended to use the following configuration:</span></span>
 * <span data-ttu-id="6a6eb-231">Konfiguracji usługi ExpressRoute anonsuje 0.0.0.0/0 i domyślnie życie tuneli wszystkich ruch wychodzący lokalnymi.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-231">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="6a6eb-232">PRZEZ stosowana do podsieci, zawierający Azure API Management definiuje 0.0.0.0/0 z Internetu Typ następnego przeskoku.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-232">The UDR applied to the subnet containing the Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="6a6eb-233">Łączna tych kroków powoduje, że poziomie podsieci przez ma pierwszeństwo przed ExpressRoute, wymuszone tunelowanie, w związku z tym zapewnienie wychodzący dostęp do Internetu z usługi Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-233">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="6a6eb-234">Azure API Management nie jest obsługiwany w konfiguracji usługi ExpressRoute który **niepoprawnie cross anonsować tras z publicznej komunikacji równorzędnej ścieżki do ścieżki prywatnej komunikacji równorzędnej**.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="6a6eb-235">Konfiguracji usługi ExpressRoute, które mają publicznej komunikacji równorzędnej skonfigurowane, otrzyma anonsów tras firmy Microsoft dla dużych zestawów zakresów adresów IP firmy Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="6a6eb-236">Jeśli te zakresy adresów są niepoprawnie cross anonsowany w ścieżce prywatnej komunikacji równorzędnej, wynik końcowy są wszystkie pakiety wychodzącego z podsieci wystąpienia usługi Azure API Management niepoprawnie force-tunneled do sieci lokalnej klienta infrastruktura.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-236">If these address ranges are incorrectly cross-advertised on the private peering path, the end result is that all outbound network packets from the Azure API Management instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="6a6eb-237">Ten przepływ sieci dzieli Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="6a6eb-238">Rozwiązanie tego problemu jest zatrzymanie tras między reklam z publicznej komunikacji równorzędnej ścieżki do ścieżki prywatnej komunikacji równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-238">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


## <span data-ttu-id="6a6eb-239"><a name="troubleshooting"></a>Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="6a6eb-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="6a6eb-240">Podczas wprowadzania zmian w sieci, zapoznaj się [NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), aby sprawdzić, czy usługi Zarządzanie interfejsami API utracił dostęp do wszystkich kluczowych zasobów, których ona zależy.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-240">When making changes to your network, refer to [NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), to validate if the API Management service has not lost access to any of the critical resources which it depends upon.</span></span> <span data-ttu-id="6a6eb-241">Stan powinien być aktualizowany co 15 minut.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-241">The connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="6a6eb-242"><a name="limitations"></a>Ograniczenia</span><span class="sxs-lookup"><span data-stu-id="6a6eb-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="6a6eb-243">W podsieci zawierającej wystąpienia interfejsu API zarządzania nie może zawierać innych typów zasobów platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="6a6eb-244">Podsieć i usługi API Management musi być w tej samej subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-244">The subnet and the API Management service must be in the same subscription.</span></span>
* <span data-ttu-id="6a6eb-245">Nie można przenieść w podsieci zawierającej wystąpienia interfejsu API zarządzania różnych subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="6a6eb-246">W wewnętrznej sieci wirtualnej, tylko wewnętrzny adres IP będą dostępne z zakresu w [RFC 1918](https://tools.ietf.org/html/rfc1918), nie można podać publicznego adresu IP.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-246">When using an internal virtual network, only an internal IP address will be available from the range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="6a6eb-247">W przypadku wdrożeń w przypadku interfejsu API zarządzania z wewnętrzne sieci wirtualne skonfigurowane, użytkownicy są odpowiedzialne za zarządzanie własnych równoważenia zgodnie z nich DNS obciążenia.</span><span class="sxs-lookup"><span data-stu-id="6a6eb-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own the DNS.</span></span>


## <span data-ttu-id="6a6eb-248"><a name="related-content"></a>Związane z zawartością</span><span class="sxs-lookup"><span data-stu-id="6a6eb-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="6a6eb-249">Połączenie wirtualnej sieci do wewnętrznej bazy danych przy użyciu bramy sieci Vpn</span><span class="sxs-lookup"><span data-stu-id="6a6eb-249">Connecting a Virtual Network to backend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="6a6eb-250">Łączenie z różne modele wdrażania sieci wirtualnej</span><span class="sxs-lookup"><span data-stu-id="6a6eb-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="6a6eb-251">Sposób użycia interfejsu API inspektora śledzenia wywołań w usłudze Azure API Management</span><span class="sxs-lookup"><span data-stu-id="6a6eb-251">How to use the API Inspector to trace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect to a web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
