---
title: aaaHow toouse Azure API Management z sieciami wirtualnymi
description: "Dowiedz się, jak toosetup tooa połączenia wirtualnej sieci w sieci web Azure API Management i dostęp do usług za jego pośrednictwem."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="644a9-103">Jak toouse Azure API Management z sieciami wirtualnymi</span><span class="sxs-lookup"><span data-stu-id="644a9-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="644a9-104">Sieci wirtualnych platformy Azure (sieci wirtualne) pozwalają tooplace, który żadnego z zasobów platformy Azure w sieci internet nie routeable, przez Ciebie dostęp do.</span><span class="sxs-lookup"><span data-stu-id="644a9-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="644a9-105">Sieci te można następnie tooyour połączonych sieciach lokalnych przy użyciu różnych technologii sieci VPN.</span><span class="sxs-lookup"><span data-stu-id="644a9-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="644a9-106">więcej informacji o sieciach wirtualnych platformy Azure zaczynają tutaj informacje hello toolearn: [omówienie sieci wirtualnych Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="644a9-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="644a9-107">Zarządzanie interfejsami API Azure można wdrożyć wewnątrz hello sieć wirtualną (VNET), więc można uzyskać dostęp do usług zaplecza w sieci hello.</span><span class="sxs-lookup"><span data-stu-id="644a9-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="644a9-108">Witaj portalu dla deweloperów i interfejsu API bramy, może być dostępny z Internetu hello lub tylko w ramach sieci wirtualnej hello toobe skonfigurowany.</span><span class="sxs-lookup"><span data-stu-id="644a9-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="644a9-109">Zarządzanie interfejsami API Azure obsługuje sieci wirtualnych Menedżera zasobów klasycznych jak Azure.</span><span class="sxs-lookup"><span data-stu-id="644a9-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="644a9-110"><a name="enable-vpn"></a>Połączenia włączyć sieci Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="644a9-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="644a9-111">Łączność sieci Wirtualnej jest dostępna w hello **Premium** i **Developer** warstw.</span><span class="sxs-lookup"><span data-stu-id="644a9-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="644a9-112">tooswitch między warstwami hello Otwórz usługi Zarządzanie interfejsami API w hello portalu Azure, a następnie otwórz hello **skali i cenach** kartę. W obszarze hello **warstwa cenowa** sekcji, wybierz warstwę Premium lub deweloperem hello i kliknij przycisk Zapisz.</span><span class="sxs-lookup"><span data-stu-id="644a9-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="644a9-113">Otwórz usługi Zarządzanie interfejsami API w portalu Azure hello tooenable łączność sieci Wirtualnej, a hello **sieci wirtualnej** strony.</span><span class="sxs-lookup"><span data-stu-id="644a9-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Zarządzanie interfejsami API menu sieci wirtualnej][api-management-using-vnet-menu]

<span data-ttu-id="644a9-115">Wybierz typ dostępu do żądanego hello:</span><span class="sxs-lookup"><span data-stu-id="644a9-115">Select hello desired access type:</span></span>

* <span data-ttu-id="644a9-116">**Zewnętrzne**: hello interfejsu API zarządzania bramy i developer portal są dostępne z hello publicznej sieci internet za pomocą zewnętrznej usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="644a9-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="644a9-117">Brama Hello dostęp do zasobów w sieci wirtualnej hello.</span><span class="sxs-lookup"><span data-stu-id="644a9-117">hello gateway can access resources within hello virtual network.</span></span>

![Publiczna komunikacja równorzędna][api-management-vnet-public]

* <span data-ttu-id="644a9-119">**Wewnętrzny**: hello interfejsu API zarządzania bramy i developer portal jest dostępny tylko w obrębie hello sieci wirtualnej za pomocą wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="644a9-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="644a9-120">Brama Hello dostęp do zasobów w sieci wirtualnej hello.</span><span class="sxs-lookup"><span data-stu-id="644a9-120">hello gateway can access resources within hello virtual network.</span></span>

![Prywatna komunikacja równorzędna][api-management-vnet-private]

<span data-ttu-id="644a9-122">Teraz zostanie wyświetlona lista wszystkich regionów, których obsługa została zainicjowana usługi Zarządzanie interfejsami API.</span><span class="sxs-lookup"><span data-stu-id="644a9-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="644a9-123">Wybierz sieć Wirtualną i podsieć dla każdego regionu.</span><span class="sxs-lookup"><span data-stu-id="644a9-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="644a9-124">Lista Hello jest wypełniana zarówno classic i dostępne w Twojej subskrypcji platformy Azure, które są skonfigurowane w regionie hello, który jest konfigurowany sieci wirtualnych Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="644a9-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="644a9-125">**Punkt końcowy usługi** w hello powyżej diagram zawiera bramy/serwera Proxy, Portal wydawcy portalu dla deweloperów, GIT i hello bezpośredniego zarządzania punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="644a9-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="644a9-126">**Punkt końcowy zarządzania** hello powyżej diagramu jest punkt końcowy hello hostowanych na powitania konfiguracji toomanage usługi za pośrednictwem portalu Azure i programu Powershell.</span><span class="sxs-lookup"><span data-stu-id="644a9-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="644a9-127">Należy również zauważyć, że mimo że hello diagram przedstawia adresów IP dla swoich różnych punktów końcowych usługi Zarządzanie interfejsami API **tylko** reaguje na jego skonfigurowanych nazwy hostów.</span><span class="sxs-lookup"><span data-stu-id="644a9-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="644a9-128">Podczas wdrażania usługi Azure API Management tooa wystąpienia menedżera zasobów w sieci Wirtualnej, usługa hello musi być w dedykowanym podsieć, która nie zawiera żadnych innych zasobów, z wyjątkiem wystąpienia usługi Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="644a9-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="644a9-129">Jeśli toodeploy podejmowana jest próba tooa wystąpienia usługi Azure API Management podsieci sieci Wirtualnej Resource Manager, która zawiera inne zasoby, hello wdrożenie zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="644a9-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Wybierz sieci VPN][api-management-setup-vpn-select]

<span data-ttu-id="644a9-131">Kliknij przycisk **zapisać** u góry hello hello ekranu.</span><span class="sxs-lookup"><span data-stu-id="644a9-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="644a9-132">Hello adres VIP wystąpienia interfejsu API zarządzania hello zmieni zawsze sieci Wirtualnej jest włączone lub wyłączone.</span><span class="sxs-lookup"><span data-stu-id="644a9-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="644a9-133">Po przeniesieniu z interfejsu API zarządzania spowoduje również zmianę Hello adres VIP **zewnętrznych** za**wewnętrzne** lub na odwrót</span><span class="sxs-lookup"><span data-stu-id="644a9-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="644a9-134">Usunięcie interfejsu API zarządzania z sieci Wirtualnej lub zmienić hello nie została wdrożona w jednym, hello wcześniej używanych sieci Wirtualnej może pozostać zablokowane dla too4 godzin.</span><span class="sxs-lookup"><span data-stu-id="644a9-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="644a9-135">W tym okresie go nie zostanie hello możliwe toodelete sieci Wirtualnej ani Wdrażanie nowego tooit zasobów.</span><span class="sxs-lookup"><span data-stu-id="644a9-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="644a9-136"><a name="enable-vnet-powershell"></a>Połączenia Włącz sieć Wirtualną przy użyciu poleceń cmdlet programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="644a9-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="644a9-137">Można również włączyć łączność sieci Wirtualnej przy użyciu poleceń cmdlet programu PowerShell hello</span><span class="sxs-lookup"><span data-stu-id="644a9-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="644a9-138">**Tworzenie usługi Zarządzanie interfejsami API w sieci Wirtualnej**: Użyj polecenia cmdlet hello [AzureRmApiManagement nowy](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate usługi Zarządzanie interfejsami API Azure w sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="644a9-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="644a9-139">**Wdrażanie istniejącej usługi Zarządzanie interfejsami API w sieci Wirtualnej**: Użyj polecenia cmdlet hello [AzureRmApiManagementDeployment aktualizacji](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove istniejącej usługi Zarządzanie interfejsami API Azure w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="644a9-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="644a9-140"><a name="connect-vnet"></a>Połączyć tooa usługi sieci web hostowanych w sieci wirtualnej</span><span class="sxs-lookup"><span data-stu-id="644a9-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="644a9-141">Uzyskiwanie dostępu do usług zaplecza w nim nie różni się niż dostęp do usług publicznych się usługi API Management po toohello połączonych sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="644a9-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="644a9-142">Po prostu wpisz hello lokalny adres IP lub hello nazwę hosta (Jeśli serwer DNS jest skonfigurowany do hello sieci Wirtualnej) usługi sieci web do hello **adres URL usługi sieci Web** pole podczas tworzenia nowego interfejsu API lub edytowanie istniejących.</span><span class="sxs-lookup"><span data-stu-id="644a9-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Dodawanie interfejsu API z sieci VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="644a9-144"><a name="network-configuration-issues"></a>Typowe problemy z konfiguracją sieci</span><span class="sxs-lookup"><span data-stu-id="644a9-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="644a9-145">Poniżej znajduje się lista typowych problemów z błędem konfiguracji, które mogą wystąpić podczas wdrażania usługi Zarządzanie interfejsami API w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="644a9-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="644a9-146">**Niestandardowe ustawienia serwera DNS**: hello usługi Zarządzanie interfejsami API zależy od wielu usług Azure.</span><span class="sxs-lookup"><span data-stu-id="644a9-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="644a9-147">Zarządzanie interfejsami API znajduje się w sieci Wirtualnej przy użyciu niestandardowego serwera DNS, konieczne jest nazwy hostów hello tooresolve tych usług Azure.</span><span class="sxs-lookup"><span data-stu-id="644a9-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="644a9-148">Wykonaj [to](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) wytyczne dotyczące niestandardowych ustawień DNS.</span><span class="sxs-lookup"><span data-stu-id="644a9-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="644a9-149">Znajdują się w poniższej tabeli porty hello i inne wymagania dotyczące sieci dla odwołania.</span><span class="sxs-lookup"><span data-stu-id="644a9-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="644a9-150">Zaleca się, korzystając z serwerów DNS niestandardowe dla hello sieci Wirtualnej, jest skonfigurowanie który **przed** wdrażania usługi API Management do niego.</span><span class="sxs-lookup"><span data-stu-id="644a9-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="644a9-151">W przeciwnym razie należy zbyt aktualizacji usługi Zarządzanie interfejsami API hello każdej zmianie hello serwerów DNS (s), uruchamiając hello [zastosować operacji konfiguracji sieciowej](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="644a9-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="644a9-152">**Porty wymagane przez interfejs API zarządzania**: ruchu przychodzącego i wychodzącego do podsieci hello, w której jest wdrażane zarządzanie interfejsami API można kontrolować przy użyciu [sieciowej grupy zabezpieczeń][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="644a9-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="644a9-153">Jeśli którekolwiek z tych portów są niedostępne, interfejsu API zarządzania może nie działać prawidłowo i może stać się niedostępne.</span><span class="sxs-lookup"><span data-stu-id="644a9-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="644a9-154">Co najmniej jeden z tych portów zablokowane jest posiadanie innego typowe problemy z błędem konfiguracji podczas korzystania z usługi API Management z sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="644a9-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="644a9-155">Gdy wystąpienie usługi API Management znajduje się w sieci Wirtualnej, są używane porty hello hello w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="644a9-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="644a9-156">Źródłowego / docelowego porty</span><span class="sxs-lookup"><span data-stu-id="644a9-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="644a9-157">Kierunek</span><span class="sxs-lookup"><span data-stu-id="644a9-157">Direction</span></span> | <span data-ttu-id="644a9-158">Protokół transportu</span><span class="sxs-lookup"><span data-stu-id="644a9-158">Transport protocol</span></span> | <span data-ttu-id="644a9-159">Przeznaczenie</span><span class="sxs-lookup"><span data-stu-id="644a9-159">Purpose</span></span> | <span data-ttu-id="644a9-160">Źródłowego / docelowego</span><span class="sxs-lookup"><span data-stu-id="644a9-160">Source / Destination</span></span> | <span data-ttu-id="644a9-161">Typ dostępu</span><span class="sxs-lookup"><span data-stu-id="644a9-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="644a9-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="644a9-162">* / 80, 443</span></span> |<span data-ttu-id="644a9-163">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-163">Inbound</span></span> |<span data-ttu-id="644a9-164">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-164">TCP</span></span> |<span data-ttu-id="644a9-165">TooAPI komunikacji klienta zarządzania</span><span class="sxs-lookup"><span data-stu-id="644a9-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="644a9-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="644a9-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="644a9-167">Zewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-167">External</span></span> |
| <span data-ttu-id="644a9-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="644a9-168">* / 3443</span></span> |<span data-ttu-id="644a9-169">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-169">Inbound</span></span> |<span data-ttu-id="644a9-170">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-170">TCP</span></span> |<span data-ttu-id="644a9-171">Punkt końcowy zarządzania dla portalu Azure i programu Powershell</span><span class="sxs-lookup"><span data-stu-id="644a9-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="644a9-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="644a9-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="644a9-173">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-173">External & Internal</span></span> |
| <span data-ttu-id="644a9-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="644a9-174">* / 80, 443</span></span> |<span data-ttu-id="644a9-175">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-175">Outbound</span></span> |<span data-ttu-id="644a9-176">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-176">TCP</span></span> |<span data-ttu-id="644a9-177">Zależność od usługi Azure Storage i Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="644a9-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="644a9-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="644a9-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="644a9-179">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-179">External & Internal</span></span> |
| <span data-ttu-id="644a9-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="644a9-180">* / 1433</span></span> |<span data-ttu-id="644a9-181">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-181">Outbound</span></span> |<span data-ttu-id="644a9-182">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-182">TCP</span></span> |<span data-ttu-id="644a9-183">Zależność Azure SQL</span><span class="sxs-lookup"><span data-stu-id="644a9-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="644a9-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="644a9-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="644a9-185">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-185">External & Internal</span></span> |
| <span data-ttu-id="644a9-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="644a9-186">* / 11000 - 11999</span></span> |<span data-ttu-id="644a9-187">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-187">Outbound</span></span> |<span data-ttu-id="644a9-188">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-188">TCP</span></span> |<span data-ttu-id="644a9-189">Zależność Azure SQL w wersji 12</span><span class="sxs-lookup"><span data-stu-id="644a9-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="644a9-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="644a9-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="644a9-191">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-191">External & Internal</span></span> |
| <span data-ttu-id="644a9-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="644a9-192">* / 14000 - 14999</span></span> |<span data-ttu-id="644a9-193">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-193">Outbound</span></span> |<span data-ttu-id="644a9-194">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-194">TCP</span></span> |<span data-ttu-id="644a9-195">Zależność Azure SQL w wersji 12</span><span class="sxs-lookup"><span data-stu-id="644a9-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="644a9-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="644a9-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="644a9-197">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-197">External & Internal</span></span> |
| <span data-ttu-id="644a9-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="644a9-198">* / 5671</span></span> |<span data-ttu-id="644a9-199">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-199">Outbound</span></span> |<span data-ttu-id="644a9-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="644a9-200">AMQP</span></span> |<span data-ttu-id="644a9-201">Zależności dla zasad Centrum tooEvent dziennika i agent monitorowania</span><span class="sxs-lookup"><span data-stu-id="644a9-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="644a9-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="644a9-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="644a9-203">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-203">External & Internal</span></span> |
| <span data-ttu-id="644a9-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="644a9-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="644a9-205">Dla ruchu przychodzącego i wychodzącego</span><span class="sxs-lookup"><span data-stu-id="644a9-205">Inbound & Outbound</span></span> |<span data-ttu-id="644a9-206">UDP</span><span class="sxs-lookup"><span data-stu-id="644a9-206">UDP</span></span> |<span data-ttu-id="644a9-207">Zależności w pamięci podręcznej Redis</span><span class="sxs-lookup"><span data-stu-id="644a9-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="644a9-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="644a9-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="644a9-209">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-209">External & Internal</span></span> |-
| <span data-ttu-id="644a9-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="644a9-210">* / 445</span></span> |<span data-ttu-id="644a9-211">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-211">Outbound</span></span> |<span data-ttu-id="644a9-212">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-212">TCP</span></span> |<span data-ttu-id="644a9-213">Zależności w udziale plików platformy Azure dla GIT</span><span class="sxs-lookup"><span data-stu-id="644a9-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="644a9-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="644a9-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="644a9-215">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-215">External & Internal</span></span> |
| <span data-ttu-id="644a9-216">* / *</span><span class="sxs-lookup"><span data-stu-id="644a9-216">* / *</span></span> | <span data-ttu-id="644a9-217">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="644a9-217">Inbound</span></span> |<span data-ttu-id="644a9-218">TCP</span><span class="sxs-lookup"><span data-stu-id="644a9-218">TCP</span></span> |<span data-ttu-id="644a9-219">Moduł równoważenia obciążenia infrastruktury platformy Azure</span><span class="sxs-lookup"><span data-stu-id="644a9-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="644a9-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="644a9-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="644a9-221">Zewnętrzne i wewnętrzne</span><span class="sxs-lookup"><span data-stu-id="644a9-221">External & Internal</span></span> |

* <span data-ttu-id="644a9-222">**Funkcje protokołu SSL**: certyfikat SSL tooenable łańcucha budynku i sprawdzania poprawności hello zarządzanie interfejsami API usługi musi tooocsp.msocsp.com połączenia wychodzącego, mscrl.microsoft.com i crl.microsoft.com. Ta zależność nie jest wymagana, jeśli żadnych certyfikatów, możesz przekazać tooAPI zarządzania zawierają hello pełnego łańcucha toohello urzędu certyfikacji głównego.</span><span class="sxs-lookup"><span data-stu-id="644a9-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="644a9-223">**Dostęp DNS**: wychodzący dostęp przez port 53 jest wymagana do komunikacji przy użyciu serwerów DNS.</span><span class="sxs-lookup"><span data-stu-id="644a9-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="644a9-224">Jeśli istnieje niestandardowy serwer DNS na hello drugiej bramy sieci VPN, hello serwer DNS musi być dostępny podsieci hello hostingu API Management.</span><span class="sxs-lookup"><span data-stu-id="644a9-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="644a9-225">**Monitorowanie kondycji i metryki**: wychodzącego łączności tooAzure monitorowania punktów końcowych, które rozwiązanie w obszarze hello następujące domeny: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="644a9-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="644a9-226">**Trasy Instalacja ekspresowa**: Typowa konfiguracja klienta jest toodefine własnych trasa domyślna (0.0.0.0/0), co zmusza wychodzącego Internet ruchu tooinstead przepływu lokalnymi.</span><span class="sxs-lookup"><span data-stu-id="644a9-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="644a9-227">Tego przepływu ruchu niezmiennie dzieli łączność z usługą Azure API Management, ponieważ ruch wychodzący hello jest zablokowane lokalnie lub NAT d tooan nierozpoznawalną zbiór adresów, które nie będą działać z różnymi punkty końcowe systemu Azure.</span><span class="sxs-lookup"><span data-stu-id="644a9-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="644a9-228">Witaj rozwiązanie jest toodefine jednej (lub więcej) trasy zdefiniowane przez użytkownika ([Udr][UDRs]) na powitania podsieci, która zawiera hello Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="644a9-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="644a9-229">PRZEZ definiuje tras specyficzne dla podsieci, które będą honorowane zamiast hello trasy domyślnej.</span><span class="sxs-lookup"><span data-stu-id="644a9-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="644a9-230">Jeśli to możliwe zaleca się hello toouse następującej konfiguracji:</span><span class="sxs-lookup"><span data-stu-id="644a9-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="644a9-231">konfiguracji usługi ExpressRoute Hello anonsuje 0.0.0.0/0 i domyślnie życie tuneli wszystkich ruch wychodzący lokalnymi.</span><span class="sxs-lookup"><span data-stu-id="644a9-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="644a9-232">podsieci toohello przez zastosowane Hello zawierającej hello Azure API Management definiuje 0.0.0.0/0 z Internetu Typ następnego przeskoku.</span><span class="sxs-lookup"><span data-stu-id="644a9-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="644a9-233">Witaj połączony wpływ tych kroków jest hello na poziomie podsieci przez ma pierwszeństwo przed hello ExpressRoute wymuszone tunelowanie, w związku z tym zapewnienie wychodzący dostęp do Internetu z hello Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="644a9-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="644a9-234">Azure API Management nie jest obsługiwany w konfiguracji usługi ExpressRoute który **niepoprawnie cross anonsowanie trasy z hello publicznej komunikacji równorzędnej ścieżka toohello prywatnej komunikacji równorzędnej ścieżka**.</span><span class="sxs-lookup"><span data-stu-id="644a9-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="644a9-235">Konfiguracji usługi ExpressRoute, które mają publicznej komunikacji równorzędnej skonfigurowane, otrzyma anonsów tras firmy Microsoft dla dużych zestawów zakresów adresów IP firmy Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="644a9-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="644a9-236">Jeśli te zakresy adresów są niepoprawnie cross anonsowany w ścieżki prywatnej komunikacji równorzędnej hello, wynik końcowy hello są wszystkich pakietów sieciowych wychodzące z wystąpienia usługi Azure API Management hello podsieci sieci lokalnej klienta niepoprawnie tunneled życie tooa infrastruktura.</span><span class="sxs-lookup"><span data-stu-id="644a9-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="644a9-237">Ten przepływ sieci dzieli Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="644a9-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="644a9-238">problem toothis rozwiązania Hello jest toostop tras między reklamy hello publicznej komunikacji równorzędnej ścieżka toohello prywatnej komunikacji równorzędnej ścieżka.</span><span class="sxs-lookup"><span data-stu-id="644a9-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="644a9-239"><a name="troubleshooting"></a>Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="644a9-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="644a9-240">Podczas wprowadzania zmian tooyour sieci, zapoznaj się zbyt[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate Jeśli hello usługi Zarządzanie interfejsami API utracił tooany dostępu z hello kluczowych zasobów, których ona zależy.</span><span class="sxs-lookup"><span data-stu-id="644a9-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="644a9-241">Stan łączności Hello powinny być aktualizowane co 15 minut.</span><span class="sxs-lookup"><span data-stu-id="644a9-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="644a9-242"><a name="limitations"></a>Ograniczenia</span><span class="sxs-lookup"><span data-stu-id="644a9-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="644a9-243">W podsieci zawierającej wystąpienia interfejsu API zarządzania nie może zawierać innych typów zasobów platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="644a9-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="644a9-244">Witaj podsieci i hello zarządzanie interfejsami API usługi musi być w hello tej samej subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="644a9-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="644a9-245">Nie można przenieść w podsieci zawierającej wystąpienia interfejsu API zarządzania różnych subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="644a9-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="644a9-246">W wewnętrznej sieci wirtualnej, wewnętrzny adres IP będą dostępne tylko zakres hello już wspomniano w [RFC 1918](https://tools.ietf.org/html/rfc1918), nie można podać publicznego adresu IP.</span><span class="sxs-lookup"><span data-stu-id="644a9-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="644a9-247">W przypadku wdrożeń w przypadku interfejsu API zarządzania z wewnętrzne sieci wirtualne skonfigurowane, użytkownicy są odpowiedzialne za zarządzanie własnych równoważenia zgodnie z nich hello DNS obciążenia.</span><span class="sxs-lookup"><span data-stu-id="644a9-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="644a9-248"><a name="related-content"></a>Związane z zawartością</span><span class="sxs-lookup"><span data-stu-id="644a9-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="644a9-249">Łączenie toobackend sieci wirtualnej przy użyciu bramy sieci Vpn</span><span class="sxs-lookup"><span data-stu-id="644a9-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="644a9-250">Łączenie z różne modele wdrażania sieci wirtualnej</span><span class="sxs-lookup"><span data-stu-id="644a9-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="644a9-251">Jak wywołuje hello toouse tootrace inspektora interfejsu API w usłudze Azure API Management</span><span class="sxs-lookup"><span data-stu-id="644a9-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
