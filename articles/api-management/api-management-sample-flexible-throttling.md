---
title: "żądanie aaaAdvanced ograniczania z usługą Azure API Management"
description: "Dowiedz się, jak toocreate i stosować elastyczny przydział i szybkość ograniczenia zasad z usługą Azure API Management."
services: api-management
documentationcenter: 
author: darrelmiller
manager: erikre
editor: 
ms.assetid: fc813a65-7793-4c17-8bb9-e387838193ae
ms.service: api-management
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: ac87f83118a37bd587fddf044e5c2d6fc2af9031
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-request-throttling-with-azure-api-management"></a><span data-ttu-id="3f6ce-103">Zaawansowane żądanie ograniczania z usługą Azure API Management</span><span class="sxs-lookup"><span data-stu-id="3f6ce-103">Advanced request throttling with Azure API Management</span></span>
<span data-ttu-id="3f6ce-104">Trwa toothrottle stanie przychodzących żądań jest kluczową rolę usługi Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-104">Being able toothrottle incoming requests is a key role of Azure API Management.</span></span> <span data-ttu-id="3f6ce-105">Przekazywane przez kontrolowanie hello współczynnika żądań lub hello całkowita liczba żądań/danych, umożliwia zarządzanie interfejsami API tooprotect dostawcy interfejsu API ich interfejsów API z nadużyć i utworzyć wartości dla różnych warstw produktu interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-105">Either by controlling hello rate of requests or hello total requests/data transferred, API Management allows API providers tooprotect their APIs from abuse and create value for different API product tiers.</span></span>

## <a name="product-based-throttling"></a><span data-ttu-id="3f6ce-106">Ograniczanie produktu w oparciu</span><span class="sxs-lookup"><span data-stu-id="3f6ce-106">Product based throttling</span></span>
<span data-ttu-id="3f6ce-107">toodate, szybkość hello ograniczanie możliwości ma została ograniczona toobeing zakres tooa konkretnego produktu subskrypcji (zasadniczo klucza), zdefiniowane w hello API Management portal wydawcy.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-107">toodate, hello rate throttling capabilities have been limited toobeing scoped tooa particular Product subscription (essentially a key), defined in hello API Management publisher portal.</span></span> <span data-ttu-id="3f6ce-108">Jest to przydatne hello interfejsu API dostawcy tooapply limitów na powitania deweloperów, którzy utworzyli konto toouse ich interfejsu API, jednak nie pomaga, na przykład w ograniczania indywidualnych użytkowników końcowych z hello interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-108">This is useful for hello API provider tooapply limits on hello developers who have signed up toouse their API, however, it does not help, for example, in throttling individual end-users of hello API.</span></span> <span data-ttu-id="3f6ce-109">Jest to możliwe, że dla pojedynczego użytkownika tooconsume aplikacji hello developer hello całego przydziału a następnie uniemożliwić innych klientów hello Deweloper aplikacji hello toouse stanie.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-109">It is possible that for single user of hello developer's application tooconsume hello entire quota and then prevent other customers of hello developer from being able toouse hello application.</span></span> <span data-ttu-id="3f6ce-110">Ponadto wielu klientów, którzy mogą generować dużą liczbę żądań może ograniczyć dostępu toooccasional użytkowników.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-110">Also, several customers who might generate a high volume of requests may limit access toooccasional users.</span></span>

## <a name="custom-key-based-throttling"></a><span data-ttu-id="3f6ce-111">Klucz niestandardowy na podstawie ograniczania przepustowości</span><span class="sxs-lookup"><span data-stu-id="3f6ce-111">Custom key based throttling</span></span>
<span data-ttu-id="3f6ce-112">Hello nowe [szybkość limit przez klucz](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) i [limitu przydziału przez klucz](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) udostępniają formantu tootraffic znacznie bardziej elastyczne rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-112">hello new [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies provide a significantly more flexible solution tootraffic control.</span></span> <span data-ttu-id="3f6ce-113">Te nowe zasady pozwalają toodefine wyrażenia tooidentify hello klucze, które będą używane tootrack ruchu użycia.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-113">These new policies allow you toodefine expressions tooidentify hello keys that will be used tootrack traffic usage.</span></span> <span data-ttu-id="3f6ce-114">działa to sposób Hello easiest przedstawiono przykład.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-114">hello way this works is easiest illustrated with an example.</span></span> 

## <a name="ip-address-throttling"></a><span data-ttu-id="3f6ce-115">Ograniczenia adresów IP</span><span class="sxs-lookup"><span data-stu-id="3f6ce-115">IP Address throttling</span></span>
<span data-ttu-id="3f6ce-116">Hello następujące zasady ograniczyć pojedynczy tooonly adres IP klienta 10 wywołuje co minutę, w sumie 1 000 000 wywołań i 10 000 kilobajtów przepustowości miesięcznie.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-116">hello following policies restrict a single client IP address tooonly 10 calls every minute, with a total of 1,000,000 calls and 10,000 kilobytes of bandwidth per month.</span></span> 

```xml
<rate-limit-by-key  calls="10"
          renewal-period="60"
          counter-key="@(context.Request.IpAddress)" />

<quota-by-key calls="1000000"
          bandwidth="10000"
          renewal-period="2629800"
          counter-key="@(context.Request.IpAddress)" />
```

<span data-ttu-id="3f6ce-117">Jeśli wszyscy klienci na powitania Internet używany unikatowy adres IP, może to być efektywnym sposobem ograniczenia użycia przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-117">If all clients on hello Internet used a unique IP address, this might be an effective way of limiting usage by user.</span></span> <span data-ttu-id="3f6ce-118">Jednak jest bardzo prawdopodobne, że wielu użytkowników będzie udostępnianie jeden publiczny adres IP powodu toothem podczas uzyskiwania dostępu do hello Internet za pośrednictwem urządzenia translatora adresów Sieciowych.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-118">However, it is quite likely that multiple users will sharing a single public IP address due toothem accessing hello Internet via a NAT device.</span></span> <span data-ttu-id="3f6ce-119">Mimo to dla interfejsów API, które umożliwia dostęp nieuwierzytelniony hello `IpAddress` może być hello najlepszym rozwiązaniem.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-119">Despite this, for APIs that allow unauthenticated access hello `IpAddress` might be hello best option.</span></span>

## <a name="user-identity-throttling"></a><span data-ttu-id="3f6ce-120">Ograniczenie tożsamości użytkownika</span><span class="sxs-lookup"><span data-stu-id="3f6ce-120">User identity throttling</span></span>
<span data-ttu-id="3f6ce-121">Jeśli użytkownik jest uwierzytelniony, ograniczenie klucza mogą być generowane na podstawie informacji, który unikatowo identyfikuje, który użytkownik.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-121">If an end user is authenticated then a throttling key can be generated based on information that uniquely identifies an that user.</span></span>

```xml
<rate-limit-by-key calls="10"
    renewal-period="60"
    counter-key="@(context.Request.Headers.GetValueOrDefault("Authorization","").AsJwt()?.Subject)" />
```

<span data-ttu-id="3f6ce-122">W tym przykładzie mamy wyodrębnić hello nagłówek autoryzacji, należy konwertować go za`JWT` obiekt i Użyj tematu hello hello tokenu tooidentify hello użytkownika i używać go jako szybkość hello ograniczenie klucza.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-122">In this example we extract hello Authorization header, convert it too`JWT` object and use hello subject of hello token tooidentify hello user and use that as hello rate limiting key.</span></span> <span data-ttu-id="3f6ce-123">Jeśli hello tożsamości użytkownika jest przechowywany w hello `JWT` zgodnie z jedną hello innych oświadczeń następnie czy można użyć wartości w jego miejscu.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-123">If hello user identity is stored in hello `JWT` as one of hello other claims then that value could be used in its place.</span></span>

## <a name="combined-policies"></a><span data-ttu-id="3f6ce-124">Łączna zasad</span><span class="sxs-lookup"><span data-stu-id="3f6ce-124">Combined policies</span></span>
<span data-ttu-id="3f6ce-125">Mimo że hello ograniczania nowe zasady zapewniają większą kontrolę niż hello istniejące zasady ograniczania przepustowości, występuje nadal łączenie możliwości obu wartości.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-125">Although hello new throttling policies provide more control than hello existing throttling policies, there is still value combining both capabilities.</span></span> <span data-ttu-id="3f6ce-126">Ograniczanie przez klucz produktu subskrypcji ([Limit szybkości wywołanie przez subskrypcji](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) i [przydział użycia zestawu subskrypcji](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) to dobry sposób tooenable monetizing interfejsu API, pobierając oparte na poziomy użycia.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-126">Throttling by product subscription key ([Limit call rate by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) and [Set usage quota by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) is a great way tooenable monetizing of an API by charging based on usage levels.</span></span> <span data-ttu-id="3f6ce-127">Witaj skuteczniejszą kontrolę ich stanie toothrottle przez użytkownika uzupełnia i zapobiega zachowanie jednego użytkownika pogorszenia jakości związku środowisko hello innego.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-127">hello finer grained control of being able toothrottle by user is complementary and prevents one user's behavior from degrading hello experience of another.</span></span> 

## <a name="client-driven-throttling"></a><span data-ttu-id="3f6ce-128">Klient zmiennych ograniczania przepustowości</span><span class="sxs-lookup"><span data-stu-id="3f6ce-128">Client driven throttling</span></span>
<span data-ttu-id="3f6ce-129">Gdy hello ograniczania klucza jest definiowana za pomocą [wyrażenie zasad](https://msdn.microsoft.com/library/azure/dn910913.aspx), wówczas jest dostawcy hello interfejsu API, który jest wybór sposobu ograniczania hello ma zakres.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-129">When hello throttling key is defined using a [policy expression](https://msdn.microsoft.com/library/azure/dn910913.aspx), then it is hello API provider that is choosing how hello throttling is scoped.</span></span> <span data-ttu-id="3f6ce-130">Jednak może być deweloperem toocontrol jak szybkości ograniczyć własnych klientów.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-130">However, a developer might want toocontrol how they rate limit their own customers.</span></span> <span data-ttu-id="3f6ce-131">Może zostać włączona przez dostawcę interfejsu API hello dzięki zastosowaniu niestandardowy nagłówek tooallow hello dewelopera klienta aplikacji toocommunicate hello klucza toohello interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-131">This could be enabled by hello API provider by introducing a custom header tooallow hello developer's client application toocommunicate hello key toohello API.</span></span>

```xml
<rate-limit-by-key calls="100"
          renewal-period="60"
          counter-key="@(request.Headers.GetValueOrDefault("Rate-Key",""))"/>
```

<span data-ttu-id="3f6ce-132">Dzięki temu deweloper powitania klienta aplikacji toochoose jak chcą szybkość hello toocreate ograniczenie klucza.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-132">This enables hello developer's client application toochoose how they want toocreate hello rate limiting key.</span></span> <span data-ttu-id="3f6ce-133">Z niewielki ingenuity deweloperowi klienta można utworzyć własne warstwy stawki przydzielając zestawy kluczy toousers i obracanie hello użycia klucza.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-133">With a little bit of ingenuity a client developer could create their own rate tiers by allocating sets of keys toousers and rotating hello key usage.</span></span>

## <a name="summary"></a><span data-ttu-id="3f6ce-134">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="3f6ce-134">Summary</span></span>
<span data-ttu-id="3f6ce-135">Zarządzanie interfejsami API Azure zapewnia szybkość i oferty ograniczania tooboth ochrony i Dodaj wartości tooyour interfejsu API usługi.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-135">Azure API Management provides rate and quote throttling tooboth protect and add value tooyour API service.</span></span> <span data-ttu-id="3f6ce-136">Ograniczanie nowych zasad za pomocą reguł niestandardowych zakresu Hello zezwala na system można bardziej precyzyjną kontrolę nad tooenable tych zasad aplikacji jeszcze bardziej poprawić jakość toobuild klientów.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-136">hello new throttling policies with custom scoping rules allow you finer grained control over those policies tooenable your customers toobuild even better applications.</span></span> <span data-ttu-id="3f6ce-137">Przykłady Hello w tym artykule przedstawiają hello stosowania tych nowych zasad przez współczynnik produkcyjnym ograniczanie klucze z adresów IP klientów, tożsamość użytkownika i wartości klientów wygenerowany.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-137">hello examples in this article demonstrate hello use of these new policies by manufacturing rate limiting keys with client IP addresses, user identity, and client generated values.</span></span> <span data-ttu-id="3f6ce-138">Istnieje jednak wiele innych części wiadomości powitania, które mogą zostać użyte, takich jak agent użytkownika, adres URL ścieżki fragmenty, rozmiar wiadomości.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-138">However, there are many other parts of hello message that could be used such as user agent, URL path fragments, message size.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3f6ce-139">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="3f6ce-139">Next steps</span></span>
<span data-ttu-id="3f6ce-140">Daj nam swoją opinię w wątku Disqus hello tego tematu.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-140">Please give us your feedback in hello Disqus thread for this topic.</span></span> <span data-ttu-id="3f6ce-141">Jest bardzo toohear o innych potencjalnych wartości kluczy, które zostały logicznej wybór w swoim scenariuszu.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-141">It would be great toohear about other potential key values that have been a logical choice in your scenarios.</span></span>

## <a name="watch-a-video-overview-of-these-policies"></a><span data-ttu-id="3f6ce-142">Obejrzyj film poglądowy dotyczący tych zasad</span><span class="sxs-lookup"><span data-stu-id="3f6ce-142">Watch a video overview of these policies</span></span>
<span data-ttu-id="3f6ce-143">Aby uzyskać więcej informacji na temat hello [szybkość limit przez klucz](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) i [limitu przydziału przez klucz](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) zasady omówione w tym artykule, obserwuj powitania po wideo.</span><span class="sxs-lookup"><span data-stu-id="3f6ce-143">For more information on hello [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies covered in this article, please watch hello following video.</span></span>

> [!VIDEO https://channel9.msdn.com/Blogs/AzureApiMgmt/Advanced-Request-Throttling-with-Azure-API-Management/player]
> 
> 

