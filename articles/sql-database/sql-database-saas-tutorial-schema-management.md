---
title: "Zarządzanie schematami usługi Azure SQL Database w aplikacji z wieloma dzierżawami | Microsoft Docs"
description: "Zarządzanie schematami wielu dzierżaw w aplikacji z wieloma dzierżawami, która korzysta z usługi Azure SQL Database"
keywords: "samouczek usługi sql database"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/28/2017
ms.author: billgib; sstein
ms.openlocfilehash: 78d76efb88bf11fa18a416b59e6f881539141232
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="manage-schema-for-multiple-tenants-in-the-wingtip-saas-application"></a><span data-ttu-id="504f9-104">Zarządzanie schematu dla wielu dzierżawców w aplikacji Wingtip SaaS</span><span class="sxs-lookup"><span data-stu-id="504f9-104">Manage schema for multiple tenants in the Wingtip SaaS application</span></span>

<span data-ttu-id="504f9-105">[Pierwszy samouczek Wingtip SaaS](sql-database-saas-tutorial.md) pokazuje, jak udostępnić bazę danych dzierżawy i zarejestruj go w katalogu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="504f9-105">The [first Wingtip SaaS tutorial](sql-database-saas-tutorial.md) shows how the app can provision a tenant database and register it in the catalog.</span></span> <span data-ttu-id="504f9-106">Podobnie jak wszelkie aplikacje aplikacji Wingtip SaaS rozpoczyna się wraz z upływem czasu, a czasem wymaga zmiany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="504f9-106">Like any application, the Wingtip SaaS app will evolve over time, and at times will require changes to the database.</span></span> <span data-ttu-id="504f9-107">Zmiany mogą obejmować nowy lub zmieniony schemat, nowe lub zmienione dane referencyjne, oraz rutynowe zadania konserwacji bazy danych zapewniające optymalną wydajność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="504f9-107">Changes may include new or changed schema, new or changed reference data, and routine database maintenance tasks to ensure optimal app performance.</span></span> <span data-ttu-id="504f9-108">W przypadku aplikacji SaaS zmiany te muszą zostać wprowadzone w sposób skoordynowany — potencjalnie w bardzo wielu bazach danych dzierżaw.</span><span class="sxs-lookup"><span data-stu-id="504f9-108">With a SaaS application, these changes need to be deployed in a coordinated manner across a potentially massive fleet of tenant databases.</span></span> <span data-ttu-id="504f9-109">Aby te zmiany można w przyszłości dzierżawy baz danych muszą należy włączyć do procesu inicjowania obsługi administracyjnej.</span><span class="sxs-lookup"><span data-stu-id="504f9-109">For these changes to be in future tenant databases, they need to be incorporated into the provisioning process.</span></span>

<span data-ttu-id="504f9-110">Ten samouczek analizuje dwa scenariusze — wdrażanie aktualizacji danych referencyjnych dla wszystkich dzierżaw i dostrajanie indeksu tabeli zawierającej dane referencyjne.</span><span class="sxs-lookup"><span data-stu-id="504f9-110">This tutorial explores two scenarios - deploying reference data updates for all tenants, and retuning an index on the table containing the reference data.</span></span> <span data-ttu-id="504f9-111">[Zadania elastyczne](sql-database-elastic-jobs-overview.md) funkcja służy do wykonywania tych operacji we wszystkich dzierżawców i *złotego* bazy danych dzierżawy, który służy jako szablon dla nowych baz danych.</span><span class="sxs-lookup"><span data-stu-id="504f9-111">The [Elastic jobs](sql-database-elastic-jobs-overview.md) feature is used to execute these operations across all tenants, and the *golden* tenant database that is used as a template for new databases.</span></span>

<span data-ttu-id="504f9-112">Ten samouczek zawiera informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="504f9-112">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="504f9-113">Tworzenie zadania konta</span><span class="sxs-lookup"><span data-stu-id="504f9-113">Create a job account</span></span>
> * <span data-ttu-id="504f9-114">Wysyłanie zapytań na wielu dzierżawców</span><span class="sxs-lookup"><span data-stu-id="504f9-114">Query across multiple tenants</span></span>
> * <span data-ttu-id="504f9-115">Aktualizowanie danych we wszystkich bazach danych dzierżaw</span><span class="sxs-lookup"><span data-stu-id="504f9-115">Update data in all tenant databases</span></span>
> * <span data-ttu-id="504f9-116">Tworzenie indeksu tabeli we wszystkich bazach danych dzierżaw</span><span class="sxs-lookup"><span data-stu-id="504f9-116">Create an index on a table in all tenant databases</span></span>


<span data-ttu-id="504f9-117">Do wykonania zadań opisanych w tym samouczku niezbędne jest spełnienie następujących wymagań wstępnych:</span><span class="sxs-lookup"><span data-stu-id="504f9-117">To complete this tutorial, make sure the following prerequisites are met:</span></span>

* <span data-ttu-id="504f9-118">Aplikacja Wingtip SaaS jest wdrażana.</span><span class="sxs-lookup"><span data-stu-id="504f9-118">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="504f9-119">Aby wdrożyć w mniej niż 5 minut, zobacz [wdrażania i aplikacji Wingtip SaaS](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="504f9-119">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="504f9-120">Zainstalowany jest program Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="504f9-120">Azure PowerShell is installed.</span></span> <span data-ttu-id="504f9-121">Aby uzyskać szczegółowe informacje, zobacz [Rozpoczynanie pracy z programem Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="504f9-121">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="504f9-122">Zainstalowano najnowszą wersję programu SSMS (SQL Server Management Studio).</span><span class="sxs-lookup"><span data-stu-id="504f9-122">The latest version of SQL Server Management Studio (SSMS) is installed.</span></span> [<span data-ttu-id="504f9-123">Pobieranie i instalowanie programu SSMS</span><span class="sxs-lookup"><span data-stu-id="504f9-123">Download and Install SSMS</span></span>](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms)

<span data-ttu-id="504f9-124">*Ten samouczek zakłada użycie funkcji usługi SQL Database, które znajdują się w ograniczonej wersji zapoznawczej (zadania Elastic Database). Aby skorzystać z tego samouczka, prześlij identyfikator swojej subskrypcji na adres SaaSFeedback@microsoft.com z tematem Elastic Job Preview. Po otrzymaniu potwierdzenia, że Twoja subskrypcja została włączona, [pobierz i zainstaluj najnowsze polecenia cmdlet zadań w wersji wstępnej](https://github.com/jaredmoo/azure-powershell/releases). Ta wersja zapoznawcza jest ograniczony, więc skontaktuj się z SaaSFeedback@microsoft.com pytania związane z lub pomocy technicznej.*</span><span class="sxs-lookup"><span data-stu-id="504f9-124">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>


## <a name="introduction-to-saas-schema-management-patterns"></a><span data-ttu-id="504f9-125">Wprowadzenie do wzorców zarządzania schematami SaaS</span><span class="sxs-lookup"><span data-stu-id="504f9-125">Introduction to SaaS Schema Management patterns</span></span>

<span data-ttu-id="504f9-126">Wzorzec SaaS pojedynczej dzierżawy na bazę danych korzysta na wiele sposobów z izolacji danych, ale jednocześnie cechuje się zwiększoną złożonością obsługi i zarządzania w przypadku wielu baz danych.</span><span class="sxs-lookup"><span data-stu-id="504f9-126">The single tenant per database SaaS pattern benefits in many ways from the data isolation that results, but at the same time introduces the additional complexity of maintaining and managing many databases.</span></span> <span data-ttu-id="504f9-127">Funkcja [Zadania elastyczne](sql-database-elastic-jobs-overview.md) ułatwia administrowanie i zarządzanie warstwą danych programu SQL.</span><span class="sxs-lookup"><span data-stu-id="504f9-127">[Elastic Jobs](sql-database-elastic-jobs-overview.md) facilitates administration and management of the SQL data tier.</span></span> <span data-ttu-id="504f9-128">Zadania umożliwiają bezpieczne i niezawodne uruchamiania zleceń (skryptów T-SQL) na grupie baz danych niezależnie od interakcji z użytkownikiem lub danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="504f9-128">Jobs enable you to securely and reliably, run tasks (T-SQL scripts) independent of user interaction or input, against a group of databases.</span></span> <span data-ttu-id="504f9-129">Tej metody można użyć do wdrożenia schematu i zmiany wspólnych danych referencyjnych we wszystkich dzierżawach w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="504f9-129">This method can be used to deploy schema and common reference data changes across all tenants in an application.</span></span> <span data-ttu-id="504f9-130">Zadania elastyczne służą do konserwacji *wzorcowej* kopii bazy danych używanej do tworzenia nowych dzierżaw, dzięki czemu zawsze zawiera ona najnowszy schemat i dane referencyjne.</span><span class="sxs-lookup"><span data-stu-id="504f9-130">Elastic Jobs can also be used to maintain a *golden* copy of the database used to create new tenants, ensuring it always has the latest schema and reference data.</span></span>

![ekran](media/sql-database-saas-tutorial-schema-management/schema-management.png)


## <a name="elastic-jobs-limited-preview"></a><span data-ttu-id="504f9-132">Ograniczona wersja zapoznawcza Zadań elastycznych</span><span class="sxs-lookup"><span data-stu-id="504f9-132">Elastic Jobs limited preview</span></span>

<span data-ttu-id="504f9-133">Istnieje nowa wersja Zadań elastycznych, która jest teraz zintegrowaną funkcją usługi Azure SQL Database (nie wymaga żadnych dodatkowych usług ani składników).</span><span class="sxs-lookup"><span data-stu-id="504f9-133">There is a new version of Elastic Jobs that is now an integrated feature of Azure SQL Database (that requires no additional services or components).</span></span> <span data-ttu-id="504f9-134">Nowa wersja Zadań elastycznych jest obecnie dostępna w ograniczonej wersji zapoznawczej.</span><span class="sxs-lookup"><span data-stu-id="504f9-134">This new version of Elastic Jobs is currently in limited preview.</span></span> <span data-ttu-id="504f9-135">Ograniczona wersja zapoznawcza obsługuje obecnie program PowerShell do tworzenia kont zadań, oraz oprogramowanie T-SQL do tworzenia zadań i zarządzania nimi.</span><span class="sxs-lookup"><span data-stu-id="504f9-135">This limited preview currently supports PowerShell to create job accounts, and T-SQL to create and manage jobs.</span></span>

> [!NOTE]
> <span data-ttu-id="504f9-136">*Ten samouczek zakłada użycie funkcji usługi SQL Database, które znajdują się w ograniczonej wersji zapoznawczej (zadania Elastic Database). Aby skorzystać z tego samouczka, prześlij identyfikator swojej subskrypcji na adres SaaSFeedback@microsoft.com z tematem Elastic Job Preview. Po otrzymaniu potwierdzenia, że Twoja subskrypcja została włączona, [pobierz i zainstaluj najnowsze polecenia cmdlet zadań w wersji wstępnej](https://github.com/jaredmoo/azure-powershell/releases). Ta wersja zapoznawcza jest ograniczony, więc skontaktuj się z SaaSFeedback@microsoft.com pytania związane z lub pomocy technicznej.*</span><span class="sxs-lookup"><span data-stu-id="504f9-136">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>

## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="504f9-137">Pobieranie skryptów aplikacji Wingtip</span><span class="sxs-lookup"><span data-stu-id="504f9-137">Get the Wingtip application scripts</span></span>

<span data-ttu-id="504f9-138">Wingtip SaaS skrypty i kod źródłowy aplikacji są dostępne w [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) repozytorium github.</span><span class="sxs-lookup"><span data-stu-id="504f9-138">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="504f9-139">[Kroki, aby pobrać skrypty Wingtip SaaS](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="504f9-139">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-a-job-account-database-and-new-job-account"></a><span data-ttu-id="504f9-140">Tworzenie bazy danych konta zadania oraz nowego konta zadania</span><span class="sxs-lookup"><span data-stu-id="504f9-140">Create a job account database and new job account</span></span>

<span data-ttu-id="504f9-141">Ten samouczek wymaga użycia programu PowerShell w celu utworzenia bazy danych konta zadania oraz samego konta zadania.</span><span class="sxs-lookup"><span data-stu-id="504f9-141">This tutorial requires you use PowerShell to create the job account database and job account.</span></span> <span data-ttu-id="504f9-142">Podobnie jak w przypadku aplikacji MSDB i SQL Agent, Zadania elastyczne używają usługi Azure SQL Database do przechowywania definicji zadań, ich stanu i historii.</span><span class="sxs-lookup"><span data-stu-id="504f9-142">Like MSDB and SQL Agent, Elastic Jobs uses an Azure SQL database to store job definitions, job status, and history.</span></span> <span data-ttu-id="504f9-143">Po utworzeniu konta zadania można natychmiast przystąpić do tworzenia i monitorowania zadań.</span><span class="sxs-lookup"><span data-stu-id="504f9-143">Once the job account is created, you can create and monitor jobs immediately.</span></span>

1. <span data-ttu-id="504f9-144">Otwórz pozycję …\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1* w programie **PowerShell ISE**.</span><span class="sxs-lookup"><span data-stu-id="504f9-144">Open …\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1* in the **PowerShell ISE**.</span></span>
1. <span data-ttu-id="504f9-145">Naciśnij klawisz **F5**, aby uruchomić skrypt.</span><span class="sxs-lookup"><span data-stu-id="504f9-145">Press **F5** to run the script.</span></span>

<span data-ttu-id="504f9-146">Skrypt *Demo-SchemaManagement.ps1* wywołuje skrypt *Deploy-SchemaManagement.ps1* w celu utworzenia bazy danych typu *S2* o nazwie **jobaccount** na serwerze wykazu.</span><span class="sxs-lookup"><span data-stu-id="504f9-146">The *Demo-SchemaManagement.ps1* script calls the *Deploy-SchemaManagement.ps1* script to create an *S2* database named **jobaccount** on the catalog server.</span></span> <span data-ttu-id="504f9-147">Następnie tworzy konto zadania, przekazując bazę danych jobaccount jako parametr wywołania tworzenia konta zadania.</span><span class="sxs-lookup"><span data-stu-id="504f9-147">It then creates the job account, passing the jobaccount database as a parameter to the job account creation call.</span></span>

## <a name="create-a-job-to-deploy-new-reference-data-to-all-tenants"></a><span data-ttu-id="504f9-148">Tworzenie zadania służącego do wdrożenia nowych danych referencyjnych we wszystkich dzierżawach</span><span class="sxs-lookup"><span data-stu-id="504f9-148">Create a job to deploy new reference data to all tenants</span></span>

<span data-ttu-id="504f9-149">Każda baza danych dzierżawy obejmuje zestaw typów miejsc, które definiują rodzaj zdarzeń obsługiwanych w danym miejscu.</span><span class="sxs-lookup"><span data-stu-id="504f9-149">Each tenant database includes a set of venue types that define the kind of events that are hosted at a venue.</span></span> <span data-ttu-id="504f9-150">W tym ćwiczeniu wdrożysz i uaktualnisz wszystkie bazy danych dzierżaw w celu dodania dwóch dodatkowych typów miejsc: *Motorcycle Racing* i *Swimming Club*.</span><span class="sxs-lookup"><span data-stu-id="504f9-150">In this exercise, you deploy an update to all the tenant databases to add two additional venue types: *Motorcycle Racing* and *Swimming Club*.</span></span> <span data-ttu-id="504f9-151">Te typy miejsc odpowiadają obrazom tła, które widzisz w aplikacji zdarzeń dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="504f9-151">These venue types correspond to the background image you see in the tenant events app.</span></span>

<span data-ttu-id="504f9-152">Kliknij menu rozwijane typu miejsca i upewnij się, że jest dostępnych tylko 10 opcji typów miejsc — a w szczególności, że na liście brakuje opcji „Motorcycle Racing” i „Swimming Club”.</span><span class="sxs-lookup"><span data-stu-id="504f9-152">Click the Venue Type drop down menu and validate that only 10 venue type options are available, and specifically that ‘Motorcycle Racing’ and ‘Swimming Club’ are not included in the list.</span></span>

<span data-ttu-id="504f9-153">Utwórz teraz zadanie służące do zaktualizowania tabeli *VenueTypes* we wszystkich bazach danych dzierżawy i dodania nowych typów miejsc.</span><span class="sxs-lookup"><span data-stu-id="504f9-153">Now let’s create a job to update the *VenueTypes* table in all the tenant databases and add the new venue types.</span></span>

<span data-ttu-id="504f9-154">Aby utworzyć nowe zadanie, użyjemy zestawu procedur składowanych systemu zadań utworzonych w bazie danych jobaccount podczas tworzenia konta zadania.</span><span class="sxs-lookup"><span data-stu-id="504f9-154">To create a new job, we use a set of jobs system stored procedures created in the jobaccount database when the job account was created.</span></span>

1. <span data-ttu-id="504f9-155">Otwórz program SSMS i połącz się z serwerem wykazu: catalog-\<użytkownik\>.database.windows.net.</span><span class="sxs-lookup"><span data-stu-id="504f9-155">Open SSMS and connect to the catalog server: catalog-\<user\>.database.windows.net server</span></span>
1. <span data-ttu-id="504f9-156">Połącz się również z serwerem dzierżaw: tenants1-\<użytkownik\>.database.windows.net.</span><span class="sxs-lookup"><span data-stu-id="504f9-156">Also connect to the tenant server: tenants1-\<user\>.database.windows.net</span></span>
1. <span data-ttu-id="504f9-157">Przejdź do bazy danych *contosoconcerthall* na serwerze *tenants1* i utwórz zapytanie dla tabeli *VenueTypes*, aby upewnić się, że na liście wyników nie ma pozycji *Motorcycle Racing* i *Swimming Club* ****.</span><span class="sxs-lookup"><span data-stu-id="504f9-157">Browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are not** in the results list.</span></span>
1. <span data-ttu-id="504f9-158">Otwórz plik …\\Learning Modules\\Schema Management\\DeployReferenceData.sql.</span><span class="sxs-lookup"><span data-stu-id="504f9-158">Open the file …\\Learning Modules\\Schema Management\\DeployReferenceData.sql</span></span>
1. <span data-ttu-id="504f9-159">Modyfikowanie instrukcji: Ustaw @wtpUser = &lt;użytkownika&gt; i zastąp wartość użytkownika używane w przypadku wdrażania aplikacji Wingtip</span><span class="sxs-lookup"><span data-stu-id="504f9-159">Modify the statement: SET @wtpUser = &lt;user&gt; and substitute the User value used when you deployed the Wingtip app</span></span>
1. <span data-ttu-id="504f9-160">Upewnij się, że masz połączenie z bazą danych jobaccount, a następnie naciśnij klawisz **F5**, aby uruchomić skrypt.</span><span class="sxs-lookup"><span data-stu-id="504f9-160">Ensure you are connected to the jobaccount database and press **F5** to run the script</span></span>

* <span data-ttu-id="504f9-161">**sp\_add\_target\_group** tworzy nazwę grupy docelowej DemoServerGroup. Teraz należy dodać członków docelowych.</span><span class="sxs-lookup"><span data-stu-id="504f9-161">**sp\_add\_target\_group** creates the target group name DemoServerGroup, now we need to add target members.</span></span>
* <span data-ttu-id="504f9-162">**SP\_dodać\_docelowej\_grupy\_elementu członkowskiego** dodaje *serwera* docelowy typ elementu członkowskiego, które uzna za wszystkie bazy danych w ramach tego serwera (Uwaga to tenants1&lt; Użytkownik&gt; serwer zawierający dzierżawy baz danych) w czasie zadania wykonywania powinny być uwzględnione w zadaniu, polega na dodaniu drugiego *bazy danych* docelowy typ elementu członkowskiego, w szczególności "złotego" bazy danych (basetenantdb) który znajduje się w katalogu -&lt;użytkownika&gt; serwera, a na koniec innego *bazy danych* docelowy typ elementu członkowskiego grupy, aby uwzględnić adhocanalytics bazy danych, używany w samouczku nowsze.</span><span class="sxs-lookup"><span data-stu-id="504f9-162">**sp\_add\_target\_group\_member** adds a *server* target member type, which deems all databases within that server (note this is the tenants1-&lt;User&gt; server containing the tenant databases) at time of job execution should be included in the job, the second is adding a *database* target member type, specifically the ‘golden’ database (basetenantdb) that resides on catalog-&lt;User&gt; server, and lastly another *database* target group member type to include the adhocanalytics database that is used in a later tutorial.</span></span>
* <span data-ttu-id="504f9-163">**sp\_add\_job** tworzy zadanie o nazwie „Reference Data Deployment”.</span><span class="sxs-lookup"><span data-stu-id="504f9-163">**sp\_add\_job** creates a job called “Reference Data Deployment”</span></span>
* <span data-ttu-id="504f9-164">**SP\_dodać\_etap zadania** tworzy etap zadania zawierające tekst polecenia T-SQL, aby zaktualizować tabeli referencyjnej VenueTypes</span><span class="sxs-lookup"><span data-stu-id="504f9-164">**sp\_add\_jobstep** creates the job step containing T-SQL command text to update the reference table, VenueTypes</span></span>
* <span data-ttu-id="504f9-165">Pozostałe widoki w skrypcie dotyczą istnienia obiektów i monitorowania wykonania zadań.</span><span class="sxs-lookup"><span data-stu-id="504f9-165">The remaining views in the script display the existence of the objects and monitor job execution.</span></span> <span data-ttu-id="504f9-166">Aby przejrzeć wartość stanu, użyj tych zapytań **cyklu życia** kolumnę, aby określić, kiedy zadanie pomyślnie zakończył się na wszystkie dzierżawy i dwóch dodatkowych baz danych zawierających tabeli referencyjnej.</span><span class="sxs-lookup"><span data-stu-id="504f9-166">Use these queries to review the status value in the **lifecycle** column to determine when the job has successfully finished on all tenant databases and the two additional databases containing the reference table.</span></span>

1. <span data-ttu-id="504f9-167">W programie SSMS przejdź do bazy danych *contosoconcerthall* na serwerze *tenants1* i utwórz zapytanie dla tabeli *VenueTypes*, aby upewnić się, że na liście wyników znajdują się teraz pozycje *Motorcycle Racing* i *Swimming Club* ****.</span><span class="sxs-lookup"><span data-stu-id="504f9-167">In SSMS, browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are** now in the results list.</span></span>


## <a name="create-a-job-to-manage-the-reference-table-index"></a><span data-ttu-id="504f9-168">Tworzenie zadania do zarządzania indeksem tabeli referencyjnej</span><span class="sxs-lookup"><span data-stu-id="504f9-168">Create a job to manage the reference table index</span></span>

<span data-ttu-id="504f9-169">Podobnie jak w poprzednim ćwiczeniu, w tym zostanie utworzone zadanie służące do odbudowania indeksu klucza podstawowego tabeli referencyjnej — typowej operacji z zakresu zarządzania bazą danych, którą administrator może wykonać po załadowaniu dużej ilości danych do tabeli.</span><span class="sxs-lookup"><span data-stu-id="504f9-169">Similar to the previous exercise, this exercise creates a job to rebuild the index on the reference table primary key, a typical database management operation an administrator might perform after a large data load into a table.</span></span>

<span data-ttu-id="504f9-170">Utwórz zadanie, używając tych samych procedur składowanych „system”.</span><span class="sxs-lookup"><span data-stu-id="504f9-170">Create a job using the same jobs 'system' stored procedures.</span></span>

1. <span data-ttu-id="504f9-171">Otwórz SSMS i połącz się katalogu -&lt;użytkownika&gt;. database.windows.net serwera</span><span class="sxs-lookup"><span data-stu-id="504f9-171">Open SSMS and connect to the catalog-&lt;User&gt;.database.windows.net server</span></span>
1. <span data-ttu-id="504f9-172">Otwórz plik …\\Learning Modules\\Schema Management\\OnlineReindex.sql.</span><span class="sxs-lookup"><span data-stu-id="504f9-172">Open the file …\\Learning Modules\\Schema Management\\OnlineReindex.sql</span></span>
1. <span data-ttu-id="504f9-173">Kliknij prawym przyciskiem myszy, wybierz połączenie i połącz się katalogu -&lt;użytkownika&gt;. database.windows.net serwera, jeśli nie został jeszcze połączony</span><span class="sxs-lookup"><span data-stu-id="504f9-173">Right click, select Connection, and connect to the catalog-&lt;User&gt;.database.windows.net server, if not already connected</span></span>
1. <span data-ttu-id="504f9-174">Upewnij się, że masz połączenie z bazą danych jobaccount, a następnie naciśnij klawisz F5, aby uruchomić skrypt.</span><span class="sxs-lookup"><span data-stu-id="504f9-174">Ensure you are connected to the jobaccount database and press F5 to run the script</span></span>

* <span data-ttu-id="504f9-175">sp\_add\_job tworzy nowe zadanie o nazwie „Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885”.</span><span class="sxs-lookup"><span data-stu-id="504f9-175">sp\_add\_job creates a new job called “Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885”</span></span>
* <span data-ttu-id="504f9-176">sp\_add\_jobstep tworzy krok zadania zawierający tekst polecenia T-SQL służącego do aktualizacji indeksu.</span><span class="sxs-lookup"><span data-stu-id="504f9-176">sp\_add\_jobstep creates the job step containing T-SQL command text to update the index</span></span>




## <a name="next-steps"></a><span data-ttu-id="504f9-177">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="504f9-177">Next steps</span></span>

<span data-ttu-id="504f9-178">W tym samouczku zawarto informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="504f9-178">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="504f9-179">Utworzenie konta zadania do tworzenia zapytań dotyczących wielu dzierżaw</span><span class="sxs-lookup"><span data-stu-id="504f9-179">Create a job account to query across multiple tenants</span></span>
> * <span data-ttu-id="504f9-180">Aktualizowanie danych we wszystkich bazach danych dzierżaw</span><span class="sxs-lookup"><span data-stu-id="504f9-180">Update data in all tenant databases</span></span>
> * <span data-ttu-id="504f9-181">Tworzenie indeksu tabeli we wszystkich bazach danych dzierżaw</span><span class="sxs-lookup"><span data-stu-id="504f9-181">Create an index on a table in all tenant databases</span></span>

[<span data-ttu-id="504f9-182">Samouczek analitycznych zapytań ad-hoc</span><span class="sxs-lookup"><span data-stu-id="504f9-182">Ad-hoc analytics tutorial</span></span>](sql-database-saas-tutorial-adhoc-analytics.md)


## <a name="additional-resources"></a><span data-ttu-id="504f9-183">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="504f9-183">Additional resources</span></span>

* [<span data-ttu-id="504f9-184">Dodatkowe samouczki, które zależą od wdrożenia aplikacji Wingtip SaaS</span><span class="sxs-lookup"><span data-stu-id="504f9-184">Additional tutorials that build upon the Wingtip SaaS application deployment</span></span>](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [<span data-ttu-id="504f9-185">Zarządzanie skalowaną w poziomie bazą danych w chmurze</span><span class="sxs-lookup"><span data-stu-id="504f9-185">Managing scaled-out cloud databases</span></span>](sql-database-elastic-jobs-overview.md)
* [<span data-ttu-id="504f9-186">Tworzenie baz danych skalowanych w poziomie i zarządzanie nimi</span><span class="sxs-lookup"><span data-stu-id="504f9-186">Create and manage scaled-out cloud databases</span></span>](sql-database-elastic-jobs-create-and-manage.md)
