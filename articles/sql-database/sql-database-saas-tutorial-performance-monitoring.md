---
title: "Monitorowanie wydajności wiele baz danych Azure SQL w wielodostępnych aplikacji SaaS | Dokumentacja firmy Microsoft"
description: "Monitorowanie i zarządzanie nimi wydajności baz danych i pul aplikacji SaaS Wingtip bazy danych SQL Azure"
keywords: "samouczek usługi sql database"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: 42f727aa40e744916b1a8adf634c10d55880bef0
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-performance-of-the-wingtip-saas-application"></a><span data-ttu-id="87b09-104">Monitorowanie wydajności aplikacji Wingtip SaaS</span><span class="sxs-lookup"><span data-stu-id="87b09-104">Monitor performance of the Wingtip SaaS application</span></span>

<span data-ttu-id="87b09-105">W tym samouczku są przedstawione kilka kluczowych scenariuszy zarządzania używana w aplikacji SaaS.</span><span class="sxs-lookup"><span data-stu-id="87b09-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="87b09-106">Za pomocą generatora obciążenia, aby symulować działanie dla wszystkich baz danych dzierżawy, wbudowaną funkcję monitorowania oraz alertów funkcje bazy danych SQL i pule elastyczne przedstawiono.</span><span class="sxs-lookup"><span data-stu-id="87b09-106">Using a load generator to simulate activity across all tenant databases, the built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="87b09-107">Aplikacja Wingtip SaaS używa modelu danych pojedynczej dzierżawy, gdzie każdy miejscową (dzierżawcy) ma własne bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-107">The Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="87b09-108">Podobnie jak w przypadku wielu innych aplikacji SaaS, oczekiwany wzorzec obciążenia dzierżawy charakteryzuje się nieprzewidywalnością i sporadycznością występowania.</span><span class="sxs-lookup"><span data-stu-id="87b09-108">Like many SaaS applications, the anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="87b09-109">Innymi słowy, sprzedaż biletów może nastąpić w dowolnej chwili.</span><span class="sxs-lookup"><span data-stu-id="87b09-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="87b09-110">Aby jak najlepiej wykorzystać ten typowy wzorzec korzystania z bazy danych, bazy danych dzierżaw zostały wdrożone w elastycznych pulach baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-110">To take advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="87b09-111">Elastyczne pule umożliwiają optymalizację kosztu rozwiązania dzięki udostępnieniu zasobów pomiędzy wieloma bazami danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-111">Elastic pools optimize the cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="87b09-112">W przypadku tego typu wzorca ważne jest, aby monitorować użycie zasobów bazy danych i puli, co ma na celu rozsądne równoważenie obciążenia między pulami.</span><span class="sxs-lookup"><span data-stu-id="87b09-112">With this type of pattern, it's important to monitor database and pool resource usage to ensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="87b09-113">Należy także upewnić się, że pojedyncze bazy danych posiadają odpowiednie zasoby, i że pule nie zbliżają się do swoich limitów liczby jednostek [eDTU](sql-database-what-is-a-dtu.md).</span><span class="sxs-lookup"><span data-stu-id="87b09-113">You also need to ensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="87b09-114">W tym samouczku przedstawiono metody monitorowania baz danych i pul oraz zarządzania nimi, a także wykonywanie akcji naprawczych w odpowiedzi na wahania obciążenia.</span><span class="sxs-lookup"><span data-stu-id="87b09-114">This tutorial explores ways to monitor and manage databases and pools, and how to take corrective action in response to variations in workload.</span></span>

<span data-ttu-id="87b09-115">Ten samouczek zawiera informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="87b09-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="87b09-116">Symulowanie korzystania z baz danych dzierżaw przy użyciu dostarczonego generatora obciążenia</span><span class="sxs-lookup"><span data-stu-id="87b09-116">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="87b09-117">Monitorowanie reakcji baz danych dzierżaw na wzrost obciążenia</span><span class="sxs-lookup"><span data-stu-id="87b09-117">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="87b09-118">Skalowanie w górę elastycznej puli w reakcji na zwiększone obciążenie bazy danych</span><span class="sxs-lookup"><span data-stu-id="87b09-118">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="87b09-119">Aprowizacja drugiej elastycznej puli w celu równoważenia aktywności baz danych</span><span class="sxs-lookup"><span data-stu-id="87b09-119">Provision a second Elastic pool to load balance database activity</span></span>


<span data-ttu-id="87b09-120">Do wykonania zadań opisanych w tym samouczku niezbędne jest spełnienie następujących wymagań wstępnych:</span><span class="sxs-lookup"><span data-stu-id="87b09-120">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="87b09-121">Aplikacja Wingtip SaaS jest wdrażana.</span><span class="sxs-lookup"><span data-stu-id="87b09-121">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="87b09-122">Aby wdrożyć w mniej niż 5 minut, zobacz [wdrażania i aplikacji Wingtip SaaS](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="87b09-122">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="87b09-123">Zainstalowany jest program Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="87b09-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="87b09-124">Aby uzyskać szczegółowe informacje, zobacz [Rozpoczynanie pracy z programem Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="87b09-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-saas-performance-management-patterns"></a><span data-ttu-id="87b09-125">Wprowadzenie do wzorców Zarządzanie wydajności SaaS</span><span class="sxs-lookup"><span data-stu-id="87b09-125">Introduction to SaaS performance management patterns</span></span>

<span data-ttu-id="87b09-126">Zarządzanie wydajnością bazy danych polega na zbieraniu danych dotyczących wydajności i analizowaniu ich, a następnie reagowaniu na te dane przez dostosowanie parametrów w celu zachowania akceptowalnego czasu odpowiedzi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="87b09-126">Managing database performance consists of compiling and analyzing performance data, and then reacting to this data by adjusting parameters to maintain an acceptable response time for your application.</span></span> <span data-ttu-id="87b09-127">W przypadku hostowania wielu dzierżaw elastyczne pule baz danych stanowią ekonomiczny sposób udostępniania zasobów i zarządzania nimi dla grupy baz danych obciążanych w nieprzewidywalny sposób.</span><span class="sxs-lookup"><span data-stu-id="87b09-127">When hosting multiple tenants, Elastic database pools are a cost-effective way to provide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="87b09-128">Przy pewnych wzorcach obciążenia korzyści mogą się pojawić przy zarządzaniu w puli zaledwie dwoma bazami danych S3.</span><span class="sxs-lookup"><span data-stu-id="87b09-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![nośnik](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="87b09-130">Pul i baz danych w puli, powinny być monitorowane w celu zapewnienia, że te komputery pozostaną w dopuszczalnych zakresach wydajności.</span><span class="sxs-lookup"><span data-stu-id="87b09-130">Pools, and the databases in pools, should be monitored to ensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="87b09-131">Dostrajania konfiguracji puli na potrzeby agregacji obciążenia wszystkich baz danych, zapewnienie odpowiedniej dla obciążenia ogólną jednostek Edtu puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-131">Tune the pool configuration to meet the needs of the aggregate workload of all databases, ensuring that the pool eDTUs are appropriate for the overall workload.</span></span> <span data-ttu-id="87b09-132">Dostosuj minimalne i maksymalne wartości eDTU dla bazy danych do wartości odpowiadających wymaganiom konkretnych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="87b09-132">Adjust the per-database min and per-database max eDTU values to appropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="87b09-133">Strategie zarządzania wydajnością</span><span class="sxs-lookup"><span data-stu-id="87b09-133">Performance management strategies</span></span>

* <span data-ttu-id="87b09-134">Aby uniknąć konieczności ręcznego monitorować wydajność, jest najbardziej efektywne **ustawić alerty, które są wyzwalane w razie baz danych lub pul Zabłąkana poza normalne zakresy**.</span><span class="sxs-lookup"><span data-stu-id="87b09-134">To avoid having to manually monitor performance, it’s most effective to **set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="87b09-135">Odpowiedzią na krótkoterminowe wahania zagregowanego poziomu wydajności puli **może być skalowanie w górę lub w dół poziomu jednostek eDTU puli**.</span><span class="sxs-lookup"><span data-stu-id="87b09-135">To respond to short-term fluctuations in the aggregate performance level of a pool, the **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="87b09-136">Jeśli takie wahania występują regularnie lub są przewidywalne, **można zaplanować automatyczne skalowanie puli**.</span><span class="sxs-lookup"><span data-stu-id="87b09-136">If this fluctuation occurs on a regular or predictable basis, **scaling the pool can be scheduled to occur automatically**.</span></span> <span data-ttu-id="87b09-137">Na przykład skalowanie w dół może nastąpić, kiedy przewidywane jest niskie obciążenie — w nocy lub podczas weekendów.</span><span class="sxs-lookup"><span data-stu-id="87b09-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="87b09-138">Odpowiedzią na wahania długoterminowe lub zmiany liczby baz danych jest **przeniesienie pojedynczych baz danych do innych pul**.</span><span class="sxs-lookup"><span data-stu-id="87b09-138">To respond to longer-term fluctuations, or changes in the number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="87b09-139">Odpowiedzieć na krótkoterminowa wzrost *poszczególnych* obciążenie bazy danych **pojedynczych baz danych można znaleźć poza puli i przypisane poziom wydajności poszczególnych**.</span><span class="sxs-lookup"><span data-stu-id="87b09-139">To respond to short term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="87b09-140">Po zmniejszeniu obciążenia można zwrócić bazę danych do puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-140">Once the load is reduced, the database can then be returned to the pool.</span></span> <span data-ttu-id="87b09-141">Jeśli jest to znane z wyprzedzeniem, baz danych można przenieść pre-emptively upewnij się, że baza danych ma zawsze zasoby, które są niezbędne i uniknąć wpływu na innych baz danych w puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-141">When this is known in advance, databases can be moved pre-emptively to ensure the database always has the resources it needs, and to avoid impact on other databases in the pool.</span></span> <span data-ttu-id="87b09-142">Jeśli takie wymaganie jest przewidywalne, na przykład w przypadku oczekiwania na wzmożone zakupy biletów na popularną imprezę, wówczas takie działanie funkcji zarządzania można uwzględnić w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="87b09-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into the application.</span></span>

<span data-ttu-id="87b09-143">Witryna [Azure Portal](https://portal.azure.com) udostępnia wbudowane funkcje monitorowania i alertów dla większości zasobów.</span><span class="sxs-lookup"><span data-stu-id="87b09-143">The [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="87b09-144">W usłudze SQL Database funkcje monitorowania i zgłaszania alertów są dostępne na poziomie baz danych i pul.</span><span class="sxs-lookup"><span data-stu-id="87b09-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="87b09-145">Ten wbudowaną funkcję monitorowania i alertów jest określonych zasobów, dlatego jest łatwe w użyciu dla małej liczby zasobów, ale nie jest wygodną podczas pracy z wielu zasobów.</span><span class="sxs-lookup"><span data-stu-id="87b09-145">This built-in monitoring and alerting is resource-specific, so it's convenient to use for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="87b09-146">W scenariuszach dużych którym pracujesz z wielu reources [analizy dzienników (OMS)](sql-database-saas-tutorial-log-analytics.md) mogą być używane.</span><span class="sxs-lookup"><span data-stu-id="87b09-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="87b09-147">Jest to oddzielne usługa Azure, która udostępnia analityka w porównaniu z emitowany dzienniki diagnostyczne i dane telemetryczne zebrane w obszarze roboczym analizy dzienników.</span><span class="sxs-lookup"><span data-stu-id="87b09-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="87b09-148">Analiza dzienników może zbierać dane telemetryczne z wielu usług i służyć do wykonywania zapytań i Ustaw alerty.</span><span class="sxs-lookup"><span data-stu-id="87b09-148">Log Analytics can collect telemetry from many services and be used to query and set alerts.</span></span>

## <a name="get-the-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="87b09-149">Pobieranie kodu źródłowego aplikacji Wingtip i skryptów</span><span class="sxs-lookup"><span data-stu-id="87b09-149">Get the Wingtip application source code and scripts</span></span>

<span data-ttu-id="87b09-150">Wingtip SaaS skrypty i kod źródłowy aplikacji są dostępne w [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) repozytorium github.</span><span class="sxs-lookup"><span data-stu-id="87b09-150">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="87b09-151">[Kroki, aby pobrać skrypty Wingtip SaaS](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="87b09-151">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="87b09-152">Aprowizacja dodatkowych dzierżaw</span><span class="sxs-lookup"><span data-stu-id="87b09-152">Provision additional tenants</span></span>

<span data-ttu-id="87b09-153">Pule stają się opłacalne nawet w przypadku zaledwie dwóch baz danych nas poziomie S3, a związane z nimi oszczędności wzrastają wraz ze zwiększeniem liczby baz danych w puli, co jest spowodowane efektem uśredniania.</span><span class="sxs-lookup"><span data-stu-id="87b09-153">While pools can be cost-effective with just two S3 databases, the more databases that are in the pool the more cost-effective the averaging effect becomes.</span></span> <span data-ttu-id="87b09-154">Aby dobrze zrozumieć działanie monitorowania wydajności i zarządzania nią w dużej skali, w tym samouczku zalecamy wdrożenie co najmniej 20 baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="87b09-155">Jeśli partii dzierżawców jest już przydzielona w poprzednich instrukcji, przejdź do [Symulacja użycie na wszystkich baz danych dzierżawy](#simulate-usage-on-all-tenant-databases) sekcji.</span><span class="sxs-lookup"><span data-stu-id="87b09-155">If you already provisioned a batch of tenants in a prior tutorial, skip to the [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="87b09-156">Otwórz... \\Modułów szkoleniowych\\zarządzania i monitorowania wydajności\\*PerformanceMonitoringAndManagement.ps1 pokaz* w *programu PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="87b09-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="87b09-157">Nie zamykaj tego skryptu, gdyż w ramach tego samouczka będzie konieczne uruchomienie kilku scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="87b09-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="87b09-158">Ustaw zmienną **$DemoScenario** = **1**, **Provision a batch of tenants** (Aprowizacja partii dzierżaw)</span><span class="sxs-lookup"><span data-stu-id="87b09-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="87b09-159">Naciśnij klawisz **F5**, aby uruchomić skrypt.</span><span class="sxs-lookup"><span data-stu-id="87b09-159">Press **F5** to run the script.</span></span>

<span data-ttu-id="87b09-160">Ten skrypt wdroży 17 dzierżaw w czasie krótszym niż pięć minut.</span><span class="sxs-lookup"><span data-stu-id="87b09-160">The script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="87b09-161">*TenantBatch nowy* skrypt używa zestawu połączonych lub zagnieżdżone [Resource Manager](../azure-resource-manager/index.md) szablonów, które tworzenia partii dzierżawcy, która domyślnie kopiuje bazę danych **basetenantdb**na serwerze katalogu do utworzenia nowej dzierżawy baz danych, następnie rejestruje je w katalogu, a ostatecznie inicjuje je z typem dzierżawy nazwę i miejsce.</span><span class="sxs-lookup"><span data-stu-id="87b09-161">The *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies the database **basetenantdb** on the catalog server to create the new tenant databases, then registers these in the catalog, and finally initializes them with the tenant name and venue type.</span></span> <span data-ttu-id="87b09-162">Jest to zgodne z sposób aplikacja udostępnia nową dzierżawę.</span><span class="sxs-lookup"><span data-stu-id="87b09-162">This is consistent with the way the app provisions a new tenant.</span></span> <span data-ttu-id="87b09-163">Wszelkie zmiany wprowadzone do *basetenantdb* są stosowane do dowolnego nowi dzierżawcy następnie udostępniane.</span><span class="sxs-lookup"><span data-stu-id="87b09-163">Any changes made to *basetenantdb* are applied to any new tenants provisioned thereafter.</span></span> <span data-ttu-id="87b09-164">Zobacz [samouczek Zarządzanie schematami](sql-database-saas-tutorial-schema-management.md) na temat sposobu wprowadzania zmian schematu *istniejących* dzierżawy baz danych (w tym *basetenantdb* bazy danych).</span><span class="sxs-lookup"><span data-stu-id="87b09-164">See the [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) to see how to make schema changes to *existing* tenant databases (including the *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="87b09-165">Symulowanie użycia we wszystkich baz danych dzierżaw</span><span class="sxs-lookup"><span data-stu-id="87b09-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="87b09-166">*PerformanceMonitoringAndManagement.ps1 pokaz* skryptów jest pod warunkiem że symuluje pracą dzierżawy w przypadku wszystkich baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-166">The *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="87b09-167">Obciążenie jest generowana z użyciem jednego ze scenariuszy dostępnych obciążenia:</span><span class="sxs-lookup"><span data-stu-id="87b09-167">The load is generated using one of the available load scenarios:</span></span>

| <span data-ttu-id="87b09-168">Demonstracja</span><span class="sxs-lookup"><span data-stu-id="87b09-168">Demo</span></span> | <span data-ttu-id="87b09-169">Scenariusz</span><span class="sxs-lookup"><span data-stu-id="87b09-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="87b09-170">2</span><span class="sxs-lookup"><span data-stu-id="87b09-170">2</span></span> | <span data-ttu-id="87b09-171">Generowanie obciążenia o normalnym natężeniu (ok. 40 jednostek DTU)</span><span class="sxs-lookup"><span data-stu-id="87b09-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="87b09-172">3</span><span class="sxs-lookup"><span data-stu-id="87b09-172">3</span></span> | <span data-ttu-id="87b09-173">Generowanie obciążenia z dłuższymi i częstszymi skokami wartości dla każdej bazy danych</span><span class="sxs-lookup"><span data-stu-id="87b09-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="87b09-174">4</span><span class="sxs-lookup"><span data-stu-id="87b09-174">4</span></span> | <span data-ttu-id="87b09-175">Generowanie obciążenia o wyższych skokach wartości DTU dla każdej bazy danych (ok. 80 jednostek DTU)</span><span class="sxs-lookup"><span data-stu-id="87b09-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="87b09-176">5</span><span class="sxs-lookup"><span data-stu-id="87b09-176">5</span></span> | <span data-ttu-id="87b09-177">Generowanie normalnego obciążenia oraz wysokiego obciążenia dla jednej dzierżawy (ok. 95 jednostek DTU)</span><span class="sxs-lookup"><span data-stu-id="87b09-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="87b09-178">6</span><span class="sxs-lookup"><span data-stu-id="87b09-178">6</span></span> | <span data-ttu-id="87b09-179">Generowanie niezrównoważonego obciążenia dla wielu pul</span><span class="sxs-lookup"><span data-stu-id="87b09-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="87b09-180">Generator obciążenia stosuje obciążenie *syntetyczne* wyłącznie do procesorów dla każdej bazy danych dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="87b09-180">The load generator applies a *synthetic* CPU-only load to every tenant database.</span></span> <span data-ttu-id="87b09-181">Generator uruchamia zadanie dla każdej bazy danych dzierżawy, co powoduje cykliczne wywołanie procedury składowanej, która generuje obciążenie.</span><span class="sxs-lookup"><span data-stu-id="87b09-181">The generator starts a job for each tenant database, which calls a stored procedure periodically that generates the load.</span></span> <span data-ttu-id="87b09-182">Poziomy obciążenia (mierzone w jednostkach eDTU), czas trwania i interwały są zróżnicowane dla wszystkich baz danych, co symuluje nieprzewidywalną aktywność dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="87b09-182">The load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="87b09-183">Otwórz... \\Modułów szkoleniowych\\zarządzania i monitorowania wydajności\\*PerformanceMonitoringAndManagement.ps1 pokaz* w *programu PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="87b09-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="87b09-184">Nie zamykaj tego skryptu, gdyż w ramach tego samouczka będzie konieczne uruchomienie kilku scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="87b09-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="87b09-185">Ustaw **$DemoScenario** = **2**, *Generuj normalnym natężeniu obciążenia*.</span><span class="sxs-lookup"><span data-stu-id="87b09-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="87b09-186">Naciśnij klawisz **F5**, aby zastosować obciążenie do wszystkich baz danych dzierżaw.</span><span class="sxs-lookup"><span data-stu-id="87b09-186">Press **F5** to apply a load to all your tenant databases.</span></span>

<span data-ttu-id="87b09-187">Wingtip jest to aplikacja SaaS i rzeczywiste obciążenie aplikacji SaaS jest zazwyczaj sporadyczne i nieprzewidywalny.</span><span class="sxs-lookup"><span data-stu-id="87b09-187">Wingtip is a SaaS app, and the real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="87b09-188">Aby to zasymulować, generator w sposób losowy obciąża wszystkie dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="87b09-188">To simulate this, the load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="87b09-189">Kilka minut są wymagane dla wzorca obciążenia się, więc uruchomienie generatora obciążenia 3 – 5 minut przed podjęciem próby wykonania do monitorowania obciążenia w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="87b09-189">Several minutes are needed for the load pattern to emerge, so run the load generator for 3-5 minutes before attempting to monitor the load in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="87b09-190">Generator obciążenia działa jako seria zadań w lokalnej sesji programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="87b09-190">The load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="87b09-191">Karta *Demo-PerformanceMonitoringAndManagement.ps1* musi pozostać otwarta!</span><span class="sxs-lookup"><span data-stu-id="87b09-191">Keep the *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="87b09-192">Zamknięcie karty lub wstrzymanie pracy komputera spowoduje zatrzymanie generatora obciążenia.</span><span class="sxs-lookup"><span data-stu-id="87b09-192">If you close the tab, or suspend your machine, the load generator stops.</span></span> <span data-ttu-id="87b09-193">Generator obciążenia pozostaje w *wywoływania zadania* stanu, w którym generuje obciążenie nowi dzierżawcy, które są udostępniane po rozpoczęciu generatora.</span><span class="sxs-lookup"><span data-stu-id="87b09-193">The load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after the generator is started.</span></span> <span data-ttu-id="87b09-194">Użyj *Ctrl-C* powoduje zatrzymanie wywoływania nowe zadania i zamknięcie skryptu.</span><span class="sxs-lookup"><span data-stu-id="87b09-194">Use *Ctrl-C* to stop invoking new jobs and exit the script.</span></span> <span data-ttu-id="87b09-195">Generator obciążenia będzie nadal działać, ale tylko na istniejący dzierżawcy.</span><span class="sxs-lookup"><span data-stu-id="87b09-195">The load generator will continue to run, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-the-azure-portal"></a><span data-ttu-id="87b09-196">Monitorowanie użycia zasobów przy użyciu portalu Azure</span><span class="sxs-lookup"><span data-stu-id="87b09-196">Monitor resource usage using the Azure portal</span></span>

<span data-ttu-id="87b09-197">Aby monitorować użycie zasobów, będącą wynikiem obciążenia są stosowane, Otwórz portal do puli zawierającej baz danych dzierżawy:</span><span class="sxs-lookup"><span data-stu-id="87b09-197">To monitor the resource usage that results from the load being applied, open the portal to the pool containing the tenant databases:</span></span>

1. <span data-ttu-id="87b09-198">Otwórz [portalu Azure](https://portal.azure.com) i przejdź do *tenants1 -&lt;użytkownika&gt;*  serwera.</span><span class="sxs-lookup"><span data-stu-id="87b09-198">Open the [Azure portal](https://portal.azure.com) and browse to the *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="87b09-199">Przewiń w dół, zlokalizuj elastyczne pule i kliknij pozycję **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="87b09-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="87b09-200">Ta pula zawiera wszystkie bazy danych dzierżaw utworzone dotychczas.</span><span class="sxs-lookup"><span data-stu-id="87b09-200">This pool contains all the tenant databases created so far.</span></span>

<span data-ttu-id="87b09-201">Obserwować **monitorowania puli elastycznej** i **elastycznej bazy danych monitorowania** wykresów.</span><span class="sxs-lookup"><span data-stu-id="87b09-201">Observe the **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="87b09-202">Użycie zasobów w puli jest użycie agregacji bazy danych dla wszystkich baz danych w puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-202">The pool's resource utilization is the aggregate database utilization for all databases in the pool.</span></span> <span data-ttu-id="87b09-203">Wykres bazy danych zawiera pięć najnowszych baz danych:</span><span class="sxs-lookup"><span data-stu-id="87b09-203">The database chart shows the five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="87b09-204">Ponieważ w puli powyżej najwyższego pięć dodatkowych baz danych, użycie puli zawiera działanie, które nie zostaną uwzględnione w górnym wykresu pięć baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-204">Because there are additional databases in the pool beyond the top five, the pool utilization shows activity that is not reflected in the top five databases chart.</span></span> <span data-ttu-id="87b09-205">Aby uzyskać więcej informacji, kliknij przycisk **wykorzystania zasobów bazy danych**:</span><span class="sxs-lookup"><span data-stu-id="87b09-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-the-pool"></a><span data-ttu-id="87b09-206">Ustawianie alertów wydajności dla puli</span><span class="sxs-lookup"><span data-stu-id="87b09-206">Set performance alerts on the pool</span></span>

<span data-ttu-id="87b09-207">Ustaw alert w puli, który wyzwala na \>75% wykorzystania w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="87b09-207">Set an alert on the pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="87b09-208">Otwórz blok *Pool1* (na serwerze *tenants1-\<użytkownik\>*) w witrynie [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="87b09-208">Open *Pool1* (on the *tenants1-\<user\>* server) in the [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="87b09-209">Kliknij pozycję **Reguły alertów**, a następnie kliknij przycisk **+ Dodaj alert**:</span><span class="sxs-lookup"><span data-stu-id="87b09-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![dodawanie alertu](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="87b09-211">Podaj nazwę, taką jak **Wysoki poziom jednostek DTU**,</span><span class="sxs-lookup"><span data-stu-id="87b09-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="87b09-212">Ustaw następujące wartości:</span><span class="sxs-lookup"><span data-stu-id="87b09-212">Set the following values:</span></span>
   * <span data-ttu-id="87b09-213">**Metryka = Procent eDTU**</span><span class="sxs-lookup"><span data-stu-id="87b09-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="87b09-214">**Warunek = większa niż**.</span><span class="sxs-lookup"><span data-stu-id="87b09-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="87b09-215">**Próg = 75**.</span><span class="sxs-lookup"><span data-stu-id="87b09-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="87b09-216">**Okres = W ciągu ostatnich 30 minut**.</span><span class="sxs-lookup"><span data-stu-id="87b09-216">**Period = Over the last 30 minutes**.</span></span>
1. <span data-ttu-id="87b09-217">Dodaj adres e-mail do *email(s) dodatkowe administratora* polu i kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="87b09-217">Add an email address to the *Additional administrator email(s)* box and click **OK**.</span></span>

   ![ustawianie alertu](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="87b09-219">Skalowanie mocno obciążonej puli w górę</span><span class="sxs-lookup"><span data-stu-id="87b09-219">Scale up a busy pool</span></span>

<span data-ttu-id="87b09-220">Jeśli poziom zagregowanego obciążenia puli zwiększy się do poziomu maksymalnych możliwości puli i osiągnie 100 % wykorzystania jednostek eDTU, będzie to miało wpływ na wydajność poszczególnych baz danych, co potencjalnie może wydłużyć czasy odpowiedzi na zapytania dla wszystkich baz danych w puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-220">If the aggregate load level increases on a pool to the point that it maxes out the pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in the pool.</span></span>

<span data-ttu-id="87b09-221">**Krótka termin**, należy wziąć pod uwagę skalowaniu pulę, aby zapewnić dodatkowe zasoby lub usunięcia baz danych z puli (przeniesienie ich do innej puli lub z puli do warstwy usług autonomicznej).</span><span class="sxs-lookup"><span data-stu-id="87b09-221">**Short term**, consider scaling up the pool to provide additional resources, or removing databases from the pool (moving them to other pools, or out of the pool to a stand-alone service tier).</span></span>

<span data-ttu-id="87b09-222">**Dłuższym okresie**, należy wziąć pod uwagę optymalizacji zapytań lub indeksu użycia w celu poprawy wydajności bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-222">**Longer term**, consider optimizing queries or index usage to improve database performance.</span></span> <span data-ttu-id="87b09-223">W zależności od wrażliwości aplikacji na problemy wydajnościowe najlepszym rozwiązaniem jest skalowanie puli w górę przed osiągnięciem przez nią wykorzystania jednostek eDTU równego 100%.</span><span class="sxs-lookup"><span data-stu-id="87b09-223">Depending on the application's sensitivity to performance issues its best practice to scale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="87b09-224">Użyj alertów do wczesnego ostrzegania.</span><span class="sxs-lookup"><span data-stu-id="87b09-224">Use an alert to warn you in advance.</span></span>

<span data-ttu-id="87b09-225">Zajętość puli można zasymulować, zwiększając obciążenia wytwarzane przez generator.</span><span class="sxs-lookup"><span data-stu-id="87b09-225">You can simulate a busy pool by increasing the load produced by the generator.</span></span> <span data-ttu-id="87b09-226">Powoduje baz danych do serii, częściej, a także zwiększenia łącznej obciążenia w puli bez zmiany wymagań dotyczących poszczególnych baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-226">Causing the databases to burst more frequently, and for longer, increasing the aggregate load on the pool without changing the requirements of the individual databases.</span></span> <span data-ttu-id="87b09-227">Skalowanie puli w górę można łatwo przeprowadzić w portalu lub z programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="87b09-227">Scaling up the pool is easily done in the portal or from PowerShell.</span></span> <span data-ttu-id="87b09-228">W tym ćwiczeniu użyto portalu.</span><span class="sxs-lookup"><span data-stu-id="87b09-228">This exercise uses the portal.</span></span>

1. <span data-ttu-id="87b09-229">Ustaw wartość zmiennej *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ (Generowanie obciążenia z dłuższymi i częstszymi skokami wartości dla każdej bazy danych) w celu zwiększenia intensywności zagregowanego obciążenia w puli bez zmiany szczytowego obciążenia wymaganego dla każdej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ to increase the intensity of the aggregate load on the pool without changing the peak load required by each database.</span></span>
1. <span data-ttu-id="87b09-230">Naciśnij klawisz **F5**, aby zastosować obciążenie do wszystkich baz danych dzierżaw.</span><span class="sxs-lookup"><span data-stu-id="87b09-230">Press **F5** to apply a load to all your tenant databases.</span></span>

1. <span data-ttu-id="87b09-231">Przejdź do **Pool1** w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="87b09-231">Go to **Pool1** in the Azure portal.</span></span>

<span data-ttu-id="87b09-232">Monitoruj użycie w jednostkach eDTU puli zwiększona na wykresie górnej.</span><span class="sxs-lookup"><span data-stu-id="87b09-232">Monitor the increased pool eDTU usage on the upper chart.</span></span> <span data-ttu-id="87b09-233">Zajmuje kilka minut na nowe obciążenia wyższej zaczną działać, ale powinny pojawić szybko rozpocząć osiągnęła maksymalny wykorzystania puli, a jako steadies obciążenia na nowy wzorzec, szybko overloads puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-233">It takes a few minutes for the new higher load to kick in, but you should quickly see the pool start to hit max utilization, and as the load steadies into the new pattern, it rapidly overloads the pool.</span></span>

1. <span data-ttu-id="87b09-234">Aby skalować do puli, kliknij przycisk **Konfigurowanie puli** w górnej części **Pool1** strony.</span><span class="sxs-lookup"><span data-stu-id="87b09-234">To scale up the pool, click **Configure pool** at the top of the **Pool1** page.</span></span>
1. <span data-ttu-id="87b09-235">Dostosuj **eDTU puli** ustawienie **100**.</span><span class="sxs-lookup"><span data-stu-id="87b09-235">Adjust the **Pool eDTU** setting to **100**.</span></span> <span data-ttu-id="87b09-236">Zmiana liczby jednostek eDTU puli nie zmienia ustawienia poszczególnych baz danych (które nadal ma maksymalną wartość 50 jednostek eDTU na bazę danych).</span><span class="sxs-lookup"><span data-stu-id="87b09-236">Changing the pool eDTU does not change the per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="87b09-237">Można wyświetlić ustawienia na bazę danych po prawej stronie **Konfigurowanie puli** strony.</span><span class="sxs-lookup"><span data-stu-id="87b09-237">You can see the per-database settings on the right side of the **Configure pool** page.</span></span>
1. <span data-ttu-id="87b09-238">Kliknij przycisk **zapisać** Aby przesłać żądanie skalowania puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-238">Click **Save** to submit the request to scale the pool.</span></span>

<span data-ttu-id="87b09-239">Wróć do **Pool1** > **omówienie** Aby przeglądać wykres monitorowania.</span><span class="sxs-lookup"><span data-stu-id="87b09-239">Go back to **Pool1** > **Overview** to view the monitoring charts.</span></span> <span data-ttu-id="87b09-240">Monitorowanie efektu działania zapewnia więcej zasobów do puli (chociaż z kilku baz danych i losowego obciążenia nie zawsze jest łatwo sprawdzić ostatecznie, dopóki nie zostanie uruchomione przez pewien czas).</span><span class="sxs-lookup"><span data-stu-id="87b09-240">Monitor the effect of providing the pool with more resources (although with few databases and a randomized load it’s not always easy to see conclusively until you run for some time).</span></span> <span data-ttu-id="87b09-241">Patrząc na wykresy należy sobie zdawać sprawę, że 100% na górnym wykresie odpowiada teraz 100 jednostkom eDTU, podczas gdy na dolnym wykresie 100% nadal odpowiada 50 jednostkom eDTU, gdyż maksymalna wartość dla pojedynczej bazy danych nadal wynosi 50 jednostek eDTU.</span><span class="sxs-lookup"><span data-stu-id="87b09-241">While you are looking at the charts bear in mind that 100% on the upper chart now represents 100 eDTUs, while on the lower chart 100% is still 50 eDTUs as the per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="87b09-242">Bazy danych pozostają w trybie online i są w pełni dostępne podczas całego procesu.</span><span class="sxs-lookup"><span data-stu-id="87b09-242">Databases remain online and fully available throughout the process.</span></span> <span data-ttu-id="87b09-243">W ostatniej chwili przed włączeniem dla każdej bazy danych nowej wartości eDTU dla puli wszystkie aktywne połączenia zostają przerwane.</span><span class="sxs-lookup"><span data-stu-id="87b09-243">At the last moment as each database is ready to be enabled with the new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="87b09-244">Kod aplikacji powinien być napisany w taki sposób, aby zawsze próbować ponownie nawiązać przerwane połączenie, by móc ponownie połączyć się z bazą danych w puli przeskalowanej w górę.</span><span class="sxs-lookup"><span data-stu-id="87b09-244">Application code should always be written to retry dropped connections, and so will reconnect to the database in the scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="87b09-245">Równoważenie obciążenia między zestawami</span><span class="sxs-lookup"><span data-stu-id="87b09-245">Load balance between pools</span></span>

<span data-ttu-id="87b09-246">Alternatywnym rozwiązaniem w stosunku do skalowania puli w górę jest utworzenie drugiej puli i przeniesienie do niej baz danych w celu zrównoważenia obciążenia między dwoma pulami.</span><span class="sxs-lookup"><span data-stu-id="87b09-246">As an alternative to scaling up the pool, create a second pool and move databases into it to balance the load between the two pools.</span></span> <span data-ttu-id="87b09-247">Aby to rozwiązanie zadziałało, nowa pula musi zostać utworzona na tym samym serwerze co pierwsza.</span><span class="sxs-lookup"><span data-stu-id="87b09-247">To do this the new pool must be created on the same server as the first.</span></span>

1. <span data-ttu-id="87b09-248">W [portalu Azure](https://portal.azure.com), otwórz **tenants1 -&lt;użytkownika&gt;**  serwera.</span><span class="sxs-lookup"><span data-stu-id="87b09-248">In the [Azure portal](https://portal.azure.com), open the **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="87b09-249">Kliknij przycisk **+ nowej puli** Aby utworzyć pulę na bieżącym serwerze.</span><span class="sxs-lookup"><span data-stu-id="87b09-249">Click **+ New pool** to create a pool on the current server.</span></span>
1. <span data-ttu-id="87b09-250">Na **elastycznej puli baz danych** szablonu:</span><span class="sxs-lookup"><span data-stu-id="87b09-250">On the **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="87b09-251">Ustaw **nazwa** do *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="87b09-251">Set **Name** to *Pool2*.</span></span>
    1. <span data-ttu-id="87b09-252">Pozostaw warstwę cenową **Pula Standardowa**.</span><span class="sxs-lookup"><span data-stu-id="87b09-252">Leave the pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="87b09-253">Kliknij przycisk **Konfiguruj pulę**,</span><span class="sxs-lookup"><span data-stu-id="87b09-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="87b09-254">Ustaw **eDTU puli** do *50 eDTU*.</span><span class="sxs-lookup"><span data-stu-id="87b09-254">Set **Pool eDTU** to *50 eDTU*.</span></span>
    1. <span data-ttu-id="87b09-255">Kliknij przycisk **dodać bazy danych** umożliwia wyświetlenie listy baz danych na serwerze, który można dodać do *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="87b09-255">Click **Add databases** to see a list of databases on the server that can be added to *Pool2*.</span></span>
    1. <span data-ttu-id="87b09-256">Zaznacz wszystkie 10 bazy danych, aby przenieść je do nowej puli, a następnie kliknij przycisk **wybierz**.</span><span class="sxs-lookup"><span data-stu-id="87b09-256">Select any 10 databases to move these to the new pool, and then click **Select**.</span></span> <span data-ttu-id="87b09-257">Jeśli działała generator obciążenia, usługa już wie, że Twój profil wydajności wymaga puli większych niż 50 eDTU domyślny rozmiar i zaleca, począwszy od 100 ustawienia liczby jednostek eDTU.</span><span class="sxs-lookup"><span data-stu-id="87b09-257">If you've been running the load generator, the service already knows that your performance profile requires a larger pool than the default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![Zalecenia](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="87b09-259">W tym samouczku, pozostaw wartość domyślną w Edtu 50, a następnie kliknij przycisk **wybierz** ponownie.</span><span class="sxs-lookup"><span data-stu-id="87b09-259">For this tutorial, leave the default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="87b09-260">Wybierz **OK** Utwórz nową pulę i przejść do niej wybranych baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-260">Select **OK** to create the new pool and to move the selected databases into it.</span></span>

<span data-ttu-id="87b09-261">Tworzenie puli i przenoszenie bazy danych zajmuje kilka minut.</span><span class="sxs-lookup"><span data-stu-id="87b09-261">Creating the pool and moving the databases takes a few minutes.</span></span> <span data-ttu-id="87b09-262">Jak pozostają online i jest całkowicie dostępny do momentu ostatnio przenoszeniu baz danych, w którym wszystkie otwarte połączenia są zamykane.</span><span class="sxs-lookup"><span data-stu-id="87b09-262">As databases are moved they remain online and fully accessible until the very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="87b09-263">Tak długo, jak masz logikę ponawiania klienci będą następnie połączenia z bazą danych w nowej puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-263">As long as you have some retry logic, clients will then connect to the database in the new pool.</span></span>

<span data-ttu-id="87b09-264">Przejdź do **Pool2** (na *tenants1* serwera) do otwierania puli i monitorować jego wydajność.</span><span class="sxs-lookup"><span data-stu-id="87b09-264">Browse to **Pool2** (on the *tenants1* server) to open the pool and monitor its performance.</span></span> <span data-ttu-id="87b09-265">Jeśli nie widzisz, poczekaj, aż Inicjowanie obsługi administracyjnej nowej puli, aby zakończyć.</span><span class="sxs-lookup"><span data-stu-id="87b09-265">If you don't see it, wait for provisioning of the new pool to complete.</span></span>

<span data-ttu-id="87b09-266">Pojawi się że użycie zasobów na *Pool1* spadła oraz że *Pool2* podobnie jest załadowane.</span><span class="sxs-lookup"><span data-stu-id="87b09-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="87b09-267">Zarządzanie wydajności pojedynczej bazy danych</span><span class="sxs-lookup"><span data-stu-id="87b09-267">Manage performance of a single database</span></span>

<span data-ttu-id="87b09-268">Jeśli stałe zwiększone obciążenie dotyczy pojedynczej bazy danych w puli, to w zależności od konfiguracji puli może ona zdominować zasoby w puli i wpływać na pozostałe bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-268">If a single database in a pool experiences a sustained high load, depending on the pool configuration, it may tend to dominate the resources in the pool and impact other databases.</span></span> <span data-ttu-id="87b09-269">Działanie będzie prawdopodobnie będą kontynuowane przez pewien czas, bazy danych można tymczasowo przeniesiony poza puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-269">If the activity is likely to continue for some time, the database can be temporarily moved out of the pool.</span></span> <span data-ttu-id="87b09-270">Dzięki temu bazy danych ma dodatkowe zasoby musi i izoluje go od innych baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-270">This allows the database to have the extra resources it needs, and isolates it from the other databases.</span></span>

<span data-ttu-id="87b09-271">W tym ćwiczeniu zostanie zasymulowane zwiększone obciążenie dotyczące miejsca Contoso Concert Hall wywołane wzmożonym pobytem na bilety na popularny koncert.</span><span class="sxs-lookup"><span data-stu-id="87b09-271">This exercise simulates the effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="87b09-272">Otwórz... \\ *PerformanceMonitoringAndManagement.ps1 pokaz* skryptu.</span><span class="sxs-lookup"><span data-stu-id="87b09-272">Open the …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="87b09-273">Ustaw wartość zmiennej **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU)** (Generowanie normalnego obciążenia oraz wysokiego obciążenia dla jednej dzierżawy (ok. 95 jednostek DTU)).</span><span class="sxs-lookup"><span data-stu-id="87b09-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="87b09-274">Ustaw wartość zmiennej **$SingleTenantDatabaseName = contosoconcerthall**</span><span class="sxs-lookup"><span data-stu-id="87b09-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="87b09-275">Wykonaj skrypt, używając klawisza **F5**.</span><span class="sxs-lookup"><span data-stu-id="87b09-275">Execute the script using **F5**.</span></span>


1. <span data-ttu-id="87b09-276">W [portalu Azure](https://portal.azure.com) Otwórz **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="87b09-276">In the [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="87b09-277">Sprawdź **monitorowania puli elastycznej** wykresu i poszukaj użycie w jednostkach eDTU puli zwiększona.</span><span class="sxs-lookup"><span data-stu-id="87b09-277">Inspect the **Elastic pool monitoring** chart and look for the increased pool eDTU usage.</span></span> <span data-ttu-id="87b09-278">Po minucie lub dwóch powinno być widoczne wyższe obciążenie, które wkrótce osiągnie poziom 100% wykorzystania puli.</span><span class="sxs-lookup"><span data-stu-id="87b09-278">After a minute or two, the higher load should start to kick in, and you should quickly see that the pool hits 100% utilization.</span></span>
1. <span data-ttu-id="87b09-279">Sprawdź **elastycznej bazy danych monitorowania** wyświetlania, która zawiera najnowszych baz danych w ciągu ostatnich godzin.</span><span class="sxs-lookup"><span data-stu-id="87b09-279">Inspect the **Elastic database monitoring** display which shows the hottest databases in the past hour.</span></span> <span data-ttu-id="87b09-280">*Contosoconcerthall* bazy danych wkrótce powinny się wyświetlać jako jednej z pięciu najnowszych baz danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-280">The *contosoconcerthall* database should soon appear as one of the five hottest databases.</span></span>
1. <span data-ttu-id="87b09-281">**Kliknij pozycję Monitorowanie elastycznej bazy danych** **wykresu** i otwiera **wykorzystania zasobów bazy danych** strony, których można monitorować żadnego z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-281">**Click on the Elastic database monitoring** **chart** and it opens the **Database Resource Utilization** page where you can monitor any of the databases.</span></span> <span data-ttu-id="87b09-282">W ten sposób można odizolować wyświetlania dla *contosoconcerthall* bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-282">This lets you isolate the display for the *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="87b09-283">Z listy baz danych, kliknij przycisk **contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="87b09-283">From the list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="87b09-284">Kliknij przycisk **warstwy cenowej (skala Dtu)** otworzyć **skonfigurować wydajności** strony, w którym można ustawić poziomu wydajności autonomicznej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-284">Click **Pricing Tier (scale DTUs)** to open the **Configure performance** page where you can set a stand-alone performance level for the database.</span></span>
1. <span data-ttu-id="87b09-285">Kliknij kartę **Standardowa**, aby otworzyć opcje skalowania w warstwie Standardowa.</span><span class="sxs-lookup"><span data-stu-id="87b09-285">Click on the **Standard** tab to open the scale options in the Standard tier.</span></span>
1. <span data-ttu-id="87b09-286">Slajd **jednostek dtu w warstwie suwaka** prawo, aby wybrać **100** Dtu.</span><span class="sxs-lookup"><span data-stu-id="87b09-286">Slide the **DTU slider** to right to select **100** DTUs.</span></span> <span data-ttu-id="87b09-287">Uwaga odpowiada cel usługi **S3**.</span><span class="sxs-lookup"><span data-stu-id="87b09-287">Note this corresponds to the service objective, **S3**.</span></span>
1. <span data-ttu-id="87b09-288">Kliknij przycisk **Zastosuj** Aby przenieść bazę danych z puli i zapewnić ich *standardowa S3* bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-288">Click **Apply** to move the database out of the pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="87b09-289">Po zakończeniu skalowanie monitorowanie wpływu na bazie contosoconcerthall i Pool1 na elastyczne bloków puli i bazy danych.</span><span class="sxs-lookup"><span data-stu-id="87b09-289">Once scaling is complete, monitor the effect on the contosoconcerthall database and Pool1 on the elastic pool and database blades.</span></span>

<span data-ttu-id="87b09-290">Po zaspokojenie wysokie obciążenie bazy danych contosoconcerthall należy niezwłocznie powraca do puli, aby zmniejszyć koszt.</span><span class="sxs-lookup"><span data-stu-id="87b09-290">Once the high load on the contosoconcerthall database subsides you should promptly return it to the pool to reduce its cost.</span></span> <span data-ttu-id="87b09-291">Jeśli nie jest jasne podczas którego nastąpi można ustawić alert w bazie danych który zostanie wyzwolone w momencie jego użycie jednostek DTU spadnie poniżej na bazę danych w puli max.</span><span class="sxs-lookup"><span data-stu-id="87b09-291">If it’s unclear when that will happen you could set an alert on the database that will trigger when its DTU usage drops below the per-database max on the pool.</span></span> <span data-ttu-id="87b09-292">Przenoszenie bazy danych do puli opisano w ćwiczeniu 5.</span><span class="sxs-lookup"><span data-stu-id="87b09-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="87b09-293">Inne wzorce zarządzania wydajnością</span><span class="sxs-lookup"><span data-stu-id="87b09-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="87b09-294">**Skalowanie uprzedzające** w wykonywaniu powyżej której zostały przedstawione jak skalować izolowanej bazy danych, wiedziały bazę danych, która ma zostać wyszukane.</span><span class="sxs-lookup"><span data-stu-id="87b09-294">**Pre-emptive scaling** In the exercise above where you explored how to scale an isolated database, you knew which database to look for.</span></span> <span data-ttu-id="87b09-295">Jeśli zarządzanie Hall porozumieniu Contoso poinformowała Wingtips o zbliżającym się sprzedaży biletów, bazy danych może zostały usunięte z puli pre-emptively.</span><span class="sxs-lookup"><span data-stu-id="87b09-295">If the management of Contoso Concert Hall had informed Wingtips of the impending ticket sale, the database could have been moved out of the pool pre-emptively.</span></span> <span data-ttu-id="87b09-296">W przeciwnym razie konieczne byłoby skonfigurowanie alertów dla puli lub bazy danych w celu informowania o zmieniającej się sytuacji.</span><span class="sxs-lookup"><span data-stu-id="87b09-296">Otherwise, it would likely have required an alert on the pool or the database to spot what was happening.</span></span> <span data-ttu-id="87b09-297">Byłoby wysoce nieprzyjemne, gdyby wiadomość o zdarzeniu pochodziła od innych dzierżawców w puli, skarżących się na pogorszenie wydajności.</span><span class="sxs-lookup"><span data-stu-id="87b09-297">You wouldn’t want to learn about this from the other tenants in the pool complaining of degraded performance.</span></span> <span data-ttu-id="87b09-298">Jeśli jednak dzierżawca może przewidzieć, jak długo będą mu potrzebne dodatkowe zasoby, możesz tak skonfigurować element Runbook usługi Azure Automation, aby przenieść bazę danych z puli, a następnie z powrotem do puli zgodnie z ustalonym harmonogramem.</span><span class="sxs-lookup"><span data-stu-id="87b09-298">And if the tenant can predict how long they will need additional resources you can set up an Azure Automation runbook to move the database out of the pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="87b09-299">**Samoobsługowe skalowanie przez dzierżawcę** Ponieważ skalowanie jest zadaniem łatwo wywoływanym za pośrednictwem interfejsu API zarządzania, można w prosty sposób wbudować możliwość skalowania baz danych dzierżawy w aplikację używaną przez dzierżawcę i zaoferować ją jako funkcję usługi SaaS.</span><span class="sxs-lookup"><span data-stu-id="87b09-299">**Tenant self-service scaling** Because scaling is a task easily called via the management API, you can easily build the ability to scale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="87b09-300">Na przykład, można umożliwić dzierżawcom samodzielne administrowanie skalowaniem w górę i w dół, być może bezpośrednio powiązane z ich rozliczeniami!</span><span class="sxs-lookup"><span data-stu-id="87b09-300">For example, let tenants self-administer scaling up and down, perhaps linked directly to their billing!</span></span>

<span data-ttu-id="87b09-301">**Skalowanie puli w górę i w dół zgodnie z harmonogramem, aby dopasować wzorców użycia**</span><span class="sxs-lookup"><span data-stu-id="87b09-301">**Scaling a pool up and down on a schedule to match usage patterns**</span></span>

<span data-ttu-id="87b09-302">W przypadku, gdy zagregowane wykorzystanie dzierżaw jest zgodne z przewidywalnymi wzorcami użycia można użyć usługi Azure Automation do skalowania puli w górę i w dół zgodnie z harmonogramem.</span><span class="sxs-lookup"><span data-stu-id="87b09-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation to scale a pool up and down on a schedule.</span></span> <span data-ttu-id="87b09-303">Na przykład pulę można skalować w dół po godzinie 18:00 i ponownie w górę przed godziną 6:00 w dni robocze, jeśli wiadomo, że pomiędzy tymi godzinami występuje spadek wymagań dotyczących zasobów.</span><span class="sxs-lookup"><span data-stu-id="87b09-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="87b09-304">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="87b09-304">Next steps</span></span>

<span data-ttu-id="87b09-305">Ten samouczek zawiera informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="87b09-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="87b09-306">Symulowanie korzystania z baz danych dzierżaw przy użyciu dostarczonego generatora obciążenia</span><span class="sxs-lookup"><span data-stu-id="87b09-306">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="87b09-307">Monitorowanie reakcji baz danych dzierżaw na wzrost obciążenia</span><span class="sxs-lookup"><span data-stu-id="87b09-307">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="87b09-308">Skalowanie w górę elastycznej puli w reakcji na zwiększone obciążenie bazy danych</span><span class="sxs-lookup"><span data-stu-id="87b09-308">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="87b09-309">Aprowizacja drugiej elastycznej puli w celu równoważenia aktywności baz danych</span><span class="sxs-lookup"><span data-stu-id="87b09-309">Provision a second Elastic pool to load balance the database activity</span></span>

[<span data-ttu-id="87b09-310">Samouczek przywracania pojedynczej dzierżawy</span><span class="sxs-lookup"><span data-stu-id="87b09-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="87b09-311">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="87b09-311">Additional resources</span></span>

* <span data-ttu-id="87b09-312">Dodatkowe [samouczki, które zależą od wdrożenia aplikacji Wingtip SaaS](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="87b09-312">Additional [tutorials that build upon the Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="87b09-313">Pule elastyczne SQL</span><span class="sxs-lookup"><span data-stu-id="87b09-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="87b09-314">Azure Automation</span><span class="sxs-lookup"><span data-stu-id="87b09-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="87b09-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) — samouczek konfigurowania usługi Log Analytics i korzystania z niej</span><span class="sxs-lookup"><span data-stu-id="87b09-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>
