---
title: "Wprowadzanie uaktualnień aplikacji — baza danych SQL Azure | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak używać replikacja geograficzna bazy danych SQL Azure w celu obsługi online uaktualnień aplikacji w chmurze."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 4b59c8aa3dea3e8fba692ab66420295a09210d3b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="845ec-103">Zarządzanie stopniowe aplikacji w chmurze przy użyciu aktywna replikacja geograficzna bazy danych SQL</span><span class="sxs-lookup"><span data-stu-id="845ec-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="845ec-104">[Aktywna replikacja geograficzna](sql-database-geo-replication-overview.md) jest teraz dostępna dla wszystkich baz danych w warstwach wszystkie.</span><span class="sxs-lookup"><span data-stu-id="845ec-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="845ec-105">Dowiedz się, jak używać [— replikacja geograficzna](sql-database-geo-replication-overview.md) w bazie danych SQL umożliwia stopniowe aplikacji chmury.</span><span class="sxs-lookup"><span data-stu-id="845ec-105">Learn how to use [geo-replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="845ec-106">Ponieważ uaktualnienie jest dużo operacji, należy go części projektowania i planowania ciągłości biznesowej.</span><span class="sxs-lookup"><span data-stu-id="845ec-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="845ec-107">W tym artykule możemy Spójrz na dwóch różnych metod organizowanie proces uaktualniania i omówimy korzyści i kompromisy każdej z nich.</span><span class="sxs-lookup"><span data-stu-id="845ec-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="845ec-108">Do celów w tym artykule używamy prostą aplikację, która składa się z witryną sieci web podłączony do pojedynczej bazy danych jako jego warstwy danych.</span><span class="sxs-lookup"><span data-stu-id="845ec-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span></span> <span data-ttu-id="845ec-109">Naszym celem jest uaktualnienie wersji 1 aplikacji w wersji 2 bez jakiegokolwiek znaczącego wpływu na środowisko pracy użytkownika końcowego.</span><span class="sxs-lookup"><span data-stu-id="845ec-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end-user experience.</span></span> 

<span data-ttu-id="845ec-110">Podczas obliczania opcji uaktualnienia należy uwzględnić następujące czynniki:</span><span class="sxs-lookup"><span data-stu-id="845ec-110">When evaluating the upgrade options you should consider the following factors:</span></span>

* <span data-ttu-id="845ec-111">Wpływ na dostępność aplikacji podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="845ec-112">Jak długo funkcja aplikacji może być ograniczony lub nieprawidłowego działania.</span><span class="sxs-lookup"><span data-stu-id="845ec-112">How long the application function may be limited or degraded.</span></span>
* <span data-ttu-id="845ec-113">Możliwość wycofać w przypadku niepowodzenia uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="845ec-113">Ability to roll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="845ec-114">Luki w zabezpieczeniach aplikacji po wystąpieniu błędu krytycznego niepowiązanych podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span></span>
* <span data-ttu-id="845ec-115">Dolar całkowity koszt.</span><span class="sxs-lookup"><span data-stu-id="845ec-115">Total dollar cost.</span></span>  <span data-ttu-id="845ec-116">Obejmuje to dodatkowa Redundancja i przyrostowe kosztów składników tymczasowy używany przez proces uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="845ec-117">Uaktualnianie aplikacji, które opierają się na kopie zapasowe bazy danych dla odzyskiwania po awarii</span><span class="sxs-lookup"><span data-stu-id="845ec-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="845ec-118">Jeśli aplikacji opiera się na automatyczne bazy danych kopii zapasowych i używa geograficzne do odzyskiwania po awarii, zazwyczaj jest wdrażany jeden region platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="845ec-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span></span> <span data-ttu-id="845ec-119">W takim przypadku proces uaktualnienia obejmuje utworzenie kopii zapasowej wdrożenia wszystkich składników aplikacji objętego uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="845ec-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span></span> <span data-ttu-id="845ec-120">Aby zminimalizować zakłócenia użytkownika końcowego Menedżera ruchu Azure (WATM) będzie korzystać z profilem trybu failover.</span><span class="sxs-lookup"><span data-stu-id="845ec-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span></span>  <span data-ttu-id="845ec-121">Na poniższym diagramie przedstawiono środowisku operacyjnym przed procesu uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-121">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="845ec-122">Punkt końcowy <i>contoso 1.azurewebsites.net</i> reprezentuje gnieździe produkcyjnym aplikacji, która musi zostać uaktualniony.</span><span class="sxs-lookup"><span data-stu-id="845ec-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span></span> <span data-ttu-id="845ec-123">Aby włączyć możliwość wycofać uaktualnienie, ma potrzeby tworzenia miejsca etap z pełni zsynchronizowanej kopii aplikacji.</span><span class="sxs-lookup"><span data-stu-id="845ec-123">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="845ec-124">Poniższe kroki są wymagane w celu przygotowania aplikacji do uaktualnienia:</span><span class="sxs-lookup"><span data-stu-id="845ec-124">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="845ec-125">Utwórz miejsce etapu dla uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="845ec-125">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="845ec-126">Aby tworzenia pomocniczej bazy danych (1), a następnie wdrożona identyczne witryny sieci web, w tym samym regionie Azure.</span><span class="sxs-lookup"><span data-stu-id="845ec-126">To do that create a secondary database (1) and deploy an identical web site in the same Azure region.</span></span> <span data-ttu-id="845ec-127">Monitorowanie lokacji dodatkowej, aby zobaczyć, jeśli proces rozmieszczania kończy się.</span><span class="sxs-lookup"><span data-stu-id="845ec-127">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="845ec-128">Utwórz profil trybu failover w WATM z <i>contoso 1.azurewebsites.net</i> jako punkt końcowy w trybie online i <i>contoso 2.azurewebsites.net</i> w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="845ec-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="845ec-129">Należy pamiętać, procedura przygotowująca nie będą miały wpływ aplikacji w miejscu produkcyjnym oraz mogą działać w trybie pełnego dostępu.</span><span class="sxs-lookup"><span data-stu-id="845ec-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
>  

![Konfiguracja replikacji Przejdź bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="845ec-132">Po wykonaniu czynności przygotowujące aplikacja jest gotowa do rzeczywistego uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="845ec-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span></span> <span data-ttu-id="845ec-133">Na poniższym diagramie przedstawiono etapy procesu uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-133">The following diagram illustrates the steps involved in the upgrade process.</span></span> 

1. <span data-ttu-id="845ec-134">Ustaw podstawowej bazy danych w tryb tylko do odczytu (3) do miejsca produkcji.</span><span class="sxs-lookup"><span data-stu-id="845ec-134">Set the primary database in the production slot to read-only mode (3).</span></span> <span data-ttu-id="845ec-135">Gwarantuje to, że produkcji wystąpienie aplikacji (wersja 1) pozostanie tylko do odczytu podczas uaktualniania, co uniemożliwia rozbieżności danych między V1 i V2 wystąpień bazy danych.</span><span class="sxs-lookup"><span data-stu-id="845ec-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="845ec-136">Odłącz pomocniczej bazy danych przy użyciu trybu planowane zakończenie (4).</span><span class="sxs-lookup"><span data-stu-id="845ec-136">Disconnect the secondary database using the planned termination mode (4).</span></span> <span data-ttu-id="845ec-137">Utworzy on pełni zsynchronizowanej niezależnych kopii podstawowej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="845ec-137">It will create a fully synchronized independent copy of the primary database.</span></span> <span data-ttu-id="845ec-138">Ta baza danych zostanie uaktualniona.</span><span class="sxs-lookup"><span data-stu-id="845ec-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="845ec-139">Włącz podstawowej bazy danych w trybie odczytu i zapisu, a następnie uruchom skrypt uaktualnienia w miejscu etap [5].</span><span class="sxs-lookup"><span data-stu-id="845ec-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span></span>     

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="845ec-142">Jeśli uaktualnienie zakończone pomyślnie możesz teraz przystąpić do przełącznika użytkowników końcowych do przemieszczanego kopii aplikacji.</span><span class="sxs-lookup"><span data-stu-id="845ec-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span></span> <span data-ttu-id="845ec-143">Teraz będzie gotowa do miejsca produkcji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="845ec-143">It will now become the production slot of the application.</span></span>  <span data-ttu-id="845ec-144">Ten proces obejmuje kilka kroków więcej, jak pokazano na poniższym diagramie.</span><span class="sxs-lookup"><span data-stu-id="845ec-144">This involves a few more steps as illustrated on the following diagram.</span></span>

1. <span data-ttu-id="845ec-145">W profilu WATM, aby zmienić online punktu końcowego <i>contoso 2.azurewebsites.net</i>, który wskazuje wersji V2 witryny sieci web (6).</span><span class="sxs-lookup"><span data-stu-id="845ec-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span></span> <span data-ttu-id="845ec-146">Staje się teraz gniazda produkcyjnego z aplikacją V2 i ruchu przez użytkownika końcowego jest kierowany do niego.</span><span class="sxs-lookup"><span data-stu-id="845ec-146">It now becomes the production slot with the V2 application and the end-user traffic is directed to it.</span></span>  
2. <span data-ttu-id="845ec-147">Jeśli nie są już potrzebne składniki aplikacji V1, możesz bezpiecznie usunąć je (7).</span><span class="sxs-lookup"><span data-stu-id="845ec-147">If you no longer need the V1 application components so you can safely remove them (7).</span></span>   

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="845ec-150">Jeśli proces uaktualniania zakończy się niepowodzeniem, na przykład z powodu błędu skryptu uaktualniania miejsca etapie należy traktować jako naruszenia zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="845ec-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="845ec-151">Aby wycofać aplikację do stanu sprzed uaktualnienia po prostu przywrócić aplikacji w miejscu produkcyjnym pełny dostęp.</span><span class="sxs-lookup"><span data-stu-id="845ec-151">To roll back the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span></span> <span data-ttu-id="845ec-152">Czynności procedury są wyświetlane na diagramie dalej.</span><span class="sxs-lookup"><span data-stu-id="845ec-152">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="845ec-153">Ustawić kopii bazy danych w trybie odczytu i zapisu (8).</span><span class="sxs-lookup"><span data-stu-id="845ec-153">Set the database copy to read-write mode (8).</span></span> <span data-ttu-id="845ec-154">Spowoduje to przywrócenie pełne V1 funkcjonalnie w gnieździe produkcyjnym.</span><span class="sxs-lookup"><span data-stu-id="845ec-154">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="845ec-155">Wykonaj analiza głównych przyczyn i usunąć składniki ze złamanymi zabezpieczeniami w gnieździe etap (9).</span><span class="sxs-lookup"><span data-stu-id="845ec-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span></span> 

<span data-ttu-id="845ec-156">W tym momencie aplikacja jest w pełni funkcjonalny i można powtórzyć kroki uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-156">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="845ec-157">Wycofywanie nie wymaga zmian w profilu WATM on już wskazuje <i>contoso 1.azurewebsites.net</i> jako aktywny punkt końcowy.</span><span class="sxs-lookup"><span data-stu-id="845ec-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="845ec-160">Klucz **korzyści** tej opcji jest uaktualnienie aplikacji w pojedynczym regionie przy użyciu zestawu prostych krokach.</span><span class="sxs-lookup"><span data-stu-id="845ec-160">The key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="845ec-161">Koszt dolara uaktualnienia jest stosunkowo niska.</span><span class="sxs-lookup"><span data-stu-id="845ec-161">The dollar cost of the upgrade is relatively low.</span></span> <span data-ttu-id="845ec-162">Głównym **zależnościami** jest, że jeśli wystąpi błąd krytyczny podczas uaktualniania odzyskiwania do stanu sprzed uaktualnienia będzie obejmować ponownego wdrażania aplikacji w innym regionie i przywracanie bazy danych z kopii zapasowej za pomocą przywracaniem geograficznym.</span><span class="sxs-lookup"><span data-stu-id="845ec-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span></span> <span data-ttu-id="845ec-163">Ten proces spowoduje znaczne przestoju.</span><span class="sxs-lookup"><span data-stu-id="845ec-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="845ec-164">Uaktualnianie aplikacji, które zależą od bazy danych — replikacja geograficzna odzyskiwania po awarii</span><span class="sxs-lookup"><span data-stu-id="845ec-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="845ec-165">Jeśli aplikacja korzysta z georeplikacji ciągłość prowadzenia działalności biznesowej, jest wdrażana na co najmniej dwóch różnych regionach z aktywnym wdrożeniu w regionie podstawowym i rezerwy wdrożenia w regionie kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="845ec-165">If your application leverages geo-replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="845ec-166">Oprócz czynników, o których wspomniano wcześniej proces uaktualniania należy zagwarantować, że:</span><span class="sxs-lookup"><span data-stu-id="845ec-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span></span>

* <span data-ttu-id="845ec-167">Aplikacja pozostaje chroniona przed poważnej awarii przez cały czas w trakcie procesu uaktualniania</span><span class="sxs-lookup"><span data-stu-id="845ec-167">The application remains protected from catastrophic failures at all times during the upgrade process</span></span>
* <span data-ttu-id="845ec-168">Uaktualnienia równoległe ze składnikami programu active geograficznie nadmiarowego składniki aplikacji</span><span class="sxs-lookup"><span data-stu-id="845ec-168">The geo-redundant components of the application are upgraded in parallel with the active components</span></span>

<span data-ttu-id="845ec-169">Na osiągnięcie tych celów będzie korzystać przy użyciu profilu trybu failover z jedna aktualizacja aktywna i trzy punkty końcowe kopii zapasowej Azure ruchu Manager (WATM).</span><span class="sxs-lookup"><span data-stu-id="845ec-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="845ec-170">Na poniższym diagramie przedstawiono środowisku operacyjnym przed procesu uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-170">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="845ec-171">Witryny sieci web <i>contoso 1.azurewebsites.net</i> i <i>contoso dr.azurewebsites.net</i> reprezentują gnieździe produkcyjnym aplikacji z nadmiarowością pełnej geograficznych.</span><span class="sxs-lookup"><span data-stu-id="845ec-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span></span> <span data-ttu-id="845ec-172">Aby włączyć możliwość wycofać uaktualnienie, ma potrzeby tworzenia miejsca etap z pełni zsynchronizowanej kopii aplikacji.</span><span class="sxs-lookup"><span data-stu-id="845ec-172">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="845ec-173">Ponieważ należy się upewnić, aplikacja szybko można odzyskać w przypadku, gdy wystąpi błąd krytyczny podczas procesu uaktualniania, gniazdo etapie należy geograficznie nadmiarowego również.</span><span class="sxs-lookup"><span data-stu-id="845ec-173">Because you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process, the stage slot needs to be geo-redundant as well.</span></span> <span data-ttu-id="845ec-174">Poniższe kroki są wymagane w celu przygotowania aplikacji do uaktualnienia:</span><span class="sxs-lookup"><span data-stu-id="845ec-174">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="845ec-175">Utwórz miejsce etapu dla uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="845ec-175">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="845ec-176">Aby tworzenia pomocniczej bazy danych (1), a następnie wdrożona identyczne kopię witryny sieci web, w tym samym regionie Azure.</span><span class="sxs-lookup"><span data-stu-id="845ec-176">To do that create a secondary database (1) and deploy an identical copy of the web site in the same Azure region.</span></span> <span data-ttu-id="845ec-177">Monitorowanie lokacji dodatkowej, aby zobaczyć, jeśli proces rozmieszczania kończy się.</span><span class="sxs-lookup"><span data-stu-id="845ec-177">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="845ec-178">Utwórz geograficznie nadmiarowego pomocniczej bazy danych w miejscu etap poprzez replikację geograficzną dodatkowej bazy danych do obszaru tworzenia kopii zapasowej (jest to nazywane "łańcuchowej — replikacja geograficzna").</span><span class="sxs-lookup"><span data-stu-id="845ec-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="845ec-179">Monitorowanie kopii zapasowej dodatkowej czy Proces rozmieszczania jest wypełniony (3).</span><span class="sxs-lookup"><span data-stu-id="845ec-179">Monitor the backup secondary to see if the seeding process is completed (3).</span></span>
3. <span data-ttu-id="845ec-180">Utwórz kopię rezerwy witryny sieci web w regionie kopii zapasowej i połączyć ją pomocniczej geograficznie nadmiarowego (4).</span><span class="sxs-lookup"><span data-stu-id="845ec-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="845ec-181">Dodaj dodatkowe punkty końcowe <i>contoso 2.azurewebsites.net</i> i <i>contoso 3.azurewebsites.net</i> do profilu trybu failover w WATM jako punktów końcowych w trybie offline (5).</span><span class="sxs-lookup"><span data-stu-id="845ec-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="845ec-182">Należy pamiętać, procedura przygotowująca nie będą miały wpływ aplikacji w miejscu produkcyjnym oraz mogą działać w trybie pełnego dostępu.</span><span class="sxs-lookup"><span data-stu-id="845ec-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="845ec-185">Po wykonaniu czynności przygotowujące miejsce etap jest gotowy do uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="845ec-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span></span> <span data-ttu-id="845ec-186">Na poniższym diagramie przedstawiono kroki uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-186">The following diagram illustrates the upgrade steps.</span></span>

1. <span data-ttu-id="845ec-187">Ustaw podstawowej bazy danych w gnieździe produkcyjnym do trybu tylko do odczytu (6).</span><span class="sxs-lookup"><span data-stu-id="845ec-187">Set the primary database in the production slot to read-only mode (6).</span></span> <span data-ttu-id="845ec-188">Gwarantuje to, że produkcji wystąpienie aplikacji (wersja 1) pozostanie tylko do odczytu podczas uaktualniania, co uniemożliwia rozbieżności danych między V1 i V2 wystąpień bazy danych.</span><span class="sxs-lookup"><span data-stu-id="845ec-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="845ec-189">Odłącz dodatkowej bazy danych w tym samym regionie, w trybie planowane zakończenie (7).</span><span class="sxs-lookup"><span data-stu-id="845ec-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span></span> <span data-ttu-id="845ec-190">Utworzy on pełni zsynchronizowanej niezależnych kopii podstawowej bazy danych, którego podstawowy automatycznie stanie się po zakończeniu.</span><span class="sxs-lookup"><span data-stu-id="845ec-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span></span> <span data-ttu-id="845ec-191">Ta baza danych zostanie uaktualniona.</span><span class="sxs-lookup"><span data-stu-id="845ec-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="845ec-192">Włącz podstawowej bazy danych w miejscu etap w trybie odczytu i zapisu, a następnie uruchom skrypt uaktualnienia (8).</span><span class="sxs-lookup"><span data-stu-id="845ec-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span></span>    

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="845ec-195">Jeśli uaktualnienie zostało ukończone pomyślnie możesz teraz przystąpić do przełącznika użytkowników końcowych do wersji V2 aplikacji.</span><span class="sxs-lookup"><span data-stu-id="845ec-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span></span> <span data-ttu-id="845ec-196">Na poniższym diagramie przedstawiono etapy.</span><span class="sxs-lookup"><span data-stu-id="845ec-196">The following diagram illustrates the steps involved.</span></span>

1. <span data-ttu-id="845ec-197">Przełączyć się aktywny punkt końcowy w profilu WATM <i>contoso 2.azurewebsites.net</i>, które teraz wskazuje wersji V2 witryny sieci web (9).</span><span class="sxs-lookup"><span data-stu-id="845ec-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span></span> <span data-ttu-id="845ec-198">Staje się teraz gnieździe produkcyjnym z aplikacją V2 i ruchu przez użytkownika końcowego jest kierowany do niego.</span><span class="sxs-lookup"><span data-stu-id="845ec-198">It now becomes a production slot with the V2 application and end-user traffic is directed to it.</span></span> 
2. <span data-ttu-id="845ec-199">Jeśli nie są już potrzebne aplikacji V1, możesz bezpiecznie usunąć go (10 i 11).</span><span class="sxs-lookup"><span data-stu-id="845ec-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span></span>  

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="845ec-202">Jeśli proces uaktualniania zakończy się niepowodzeniem, na przykład z powodu błędu skryptu uaktualniania miejsca etapie należy traktować jako naruszenia zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="845ec-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="845ec-203">Aby wycofać aplikację do stanu sprzed uaktualnienia można po prostu przywrócić w gnieździe produkcyjnym z pełnym dostępem przy użyciu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="845ec-203">To roll back the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span></span> <span data-ttu-id="845ec-204">Czynności procedury są wyświetlane na diagramie dalej.</span><span class="sxs-lookup"><span data-stu-id="845ec-204">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="845ec-205">Ustaw kopii podstawowej bazy danych w trybie odczytu i zapisu (12) miejsca produkcji.</span><span class="sxs-lookup"><span data-stu-id="845ec-205">Set the primary database copy in the production slot to read-write mode (12).</span></span> <span data-ttu-id="845ec-206">Spowoduje to przywrócenie pełne V1 funkcjonalnie w gnieździe produkcyjnym.</span><span class="sxs-lookup"><span data-stu-id="845ec-206">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="845ec-207">Wykonaj analiza głównych przyczyn i usunąć składniki ze złamanymi zabezpieczeniami w gnieździe etap (13 i 14).</span><span class="sxs-lookup"><span data-stu-id="845ec-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span></span> 

<span data-ttu-id="845ec-208">W tym momencie aplikacja jest w pełni funkcjonalny i można powtórzyć kroki uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-208">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="845ec-209">Wycofywanie nie wymaga zmian w profilu WATM on już wskazuje <i>contoso 1.azurewebsites.net</i> jako aktywny punkt końcowy.</span><span class="sxs-lookup"><span data-stu-id="845ec-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Konfiguracja — replikacja geograficzna bazy danych SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="845ec-212">Klucz **korzyści** tej opcji jest można uaktualnić zarówno aplikacji, jak i jego geograficznie nadmiarowego kopiowania równolegle w bez naruszania ciągłość prowadzenia działalności biznesowej podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span></span> <span data-ttu-id="845ec-213">Głównym **zależnościami** wymaga nadmiarowości dwa razy każdego składnika aplikacji i w związku z tym generuje wyższy koszt dolara ($).</span><span class="sxs-lookup"><span data-stu-id="845ec-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="845ec-214">Obejmuje ona również bardziej skomplikowanych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="845ec-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="845ec-215">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="845ec-215">Summary</span></span>
<span data-ttu-id="845ec-216">Te dwie metody uaktualniania opisaną w artykule różnią się złożoność i dolara kosztów, ale ich obu skupić się na skrócenie czasu, gdy użytkownik końcowy jest ograniczona do operacji tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="845ec-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span></span> <span data-ttu-id="845ec-217">Ta godzina bezpośrednio jest zdefiniowana przez czas trwania uaktualniania skryptów.</span><span class="sxs-lookup"><span data-stu-id="845ec-217">That time is directly defined by the duration of the upgrade script.</span></span> <span data-ttu-id="845ec-218">Nie są zależne od rozmiaru bazy danych, wybranej warstwy usług, konfiguracji witryny sieci web i innych czynników, które nie można łatwo zarządzać.</span><span class="sxs-lookup"><span data-stu-id="845ec-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="845ec-219">Jest to spowodowane wszystkie kroki przygotowania jest całkowicie niezależna od kroki uaktualniania i mogą być przeprowadzane bez wpływu na aplikacji produkcyjnej.</span><span class="sxs-lookup"><span data-stu-id="845ec-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span></span> <span data-ttu-id="845ec-220">Wydajność skryptów uaktualniania jest kluczowym czynnikiem, który określa środowisko użytkownika końcowego podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="845ec-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span></span> <span data-ttu-id="845ec-221">Dlatego najlepiej mogła ją udoskonalać jest koncentrujące się wysiłków na tworzenie jak najbardziej efektywne skrypt uaktualnienia skryptu.</span><span class="sxs-lookup"><span data-stu-id="845ec-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="845ec-222">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="845ec-222">Next steps</span></span>
* <span data-ttu-id="845ec-223">Omówienie ciągłości działalności biznesowej i scenariuszy, zobacz [omówienie ciągłości działalności biznesowej](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="845ec-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="845ec-224">Aby dowiedzieć się więcej na temat usługi Azure SQL bazy danych automatycznego tworzenia kopii zapasowych, zobacz [bazy danych SQL automatycznego tworzenia kopii zapasowych](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="845ec-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="845ec-225">Aby dowiedzieć się więcej o używaniu kopie zapasowe automatycznego odzyskiwania, zobacz [przywrócić bazę danych z automatycznych kopii zapasowych](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="845ec-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="845ec-226">Informacje na temat opcji odzyskiwania szybsze, zobacz [aktywna replikacja geograficzna](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="845ec-226">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


