---
title: zapytania analityczne ad hoc aaaRun przez wiele baz danych Azure SQL | Dokumentacja firmy Microsoft
description: "Uruchamianie zapytań ad hoc analytics przez wiele baz danych w hello Wingtip SaaS wielodostępnych aplikacji."
keywords: "samouczek usługi sql database"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="4ee78-104">Uruchamianie zapytań analytics ad hoc we wszystkich dzierżaw Wingtip SaaS</span><span class="sxs-lookup"><span data-stu-id="4ee78-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="4ee78-105">W tym samouczku można spotkać zapytań rozproszonych hello cały zestaw baz danych dzierżawy tooenable ad hoc analytics.</span><span class="sxs-lookup"><span data-stu-id="4ee78-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="4ee78-106">Elastyczne zapytanie jest używane tooenable rozproszonych zapytań, co wymaga dalszej analizy bazy danych jest wdrażany (serwer wykazu toohello).</span><span class="sxs-lookup"><span data-stu-id="4ee78-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="4ee78-107">Te zapytania można wyodrębnić wgląd w codziennych danych operacyjnych hello aplikacji Wingtip SaaS hello stosie.</span><span class="sxs-lookup"><span data-stu-id="4ee78-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="4ee78-108">Ten samouczek zawiera informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="4ee78-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="4ee78-109">O hello widoki globalne w każdej bazie danych, które umożliwiają wydajne wykonywanie zapytań w dzierżawców</span><span class="sxs-lookup"><span data-stu-id="4ee78-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="4ee78-110">Jak toodeploy bazy danych analizy ad hoc</span><span class="sxs-lookup"><span data-stu-id="4ee78-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="4ee78-111">Toorun rozkład zapytania dla wszystkich baz danych dzierżawy</span><span class="sxs-lookup"><span data-stu-id="4ee78-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="4ee78-112">toocomplete ukończenia tego samouczka, Utwórz hello się, że następujące wymagania wstępne:</span><span class="sxs-lookup"><span data-stu-id="4ee78-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="4ee78-113">Aplikacja Wingtip SaaS Hello jest wdrażana.</span><span class="sxs-lookup"><span data-stu-id="4ee78-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="4ee78-114">Zobacz toodeploy w mniej niż pięć minut [wdrażania i aplikacji Wingtip SaaS hello](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="4ee78-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="4ee78-115">Zainstalowany jest program Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="4ee78-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="4ee78-116">Aby uzyskać szczegółowe informacje, zobacz [Rozpoczynanie pracy z programem Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="4ee78-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="4ee78-117">SQL Server Management Studio (SSMS) jest zainstalowany.</span><span class="sxs-lookup"><span data-stu-id="4ee78-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="4ee78-118">toodownload i zainstaluj narzędzia SSMS, zobacz [pobierania programu SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="4ee78-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="4ee78-119">Wzorzec analytics ad hoc</span><span class="sxs-lookup"><span data-stu-id="4ee78-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="4ee78-120">Jedną z możliwości dużą hello z aplikacjami SaaS jest toouse hello ogromnych ilości danych dzierżawy przechowywane w chmurze hello.</span><span class="sxs-lookup"><span data-stu-id="4ee78-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="4ee78-121">Użyj tego danych toogain wgląd w informacje hello operacji i użycie aplikacji dzierżawcom, ich użytkowników, preferencje, zachowania, itp. Te szczegółowe informacje można przeprowadzają opracowanie funkcji, ulepszenia użyteczność i innych inwestycji w aplikacji i usług.</span><span class="sxs-lookup"><span data-stu-id="4ee78-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="4ee78-122">Uzyskiwanie dostępu do tych danych w jednej wielodostępnej bazie danych jest łatwe, ale nie jest tak proste, gdy są one znacznie rozproszone, potencjalnie nawet na tysiące baz danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="4ee78-123">Jednym z podejść jest toouse [elastycznej zapytania](sql-database-elastic-query-overview.md), które umożliwia wykonywanie zapytań w rozproszonej zestaw baz danych z wspólny schemat.</span><span class="sxs-lookup"><span data-stu-id="4ee78-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="4ee78-124">Elastyczne zapytanie używa pojedynczego *head* bazy danych, w którym zdefiniowano tabel zewnętrznych czy dublowany tabele lub widoki hello rozproszonych bazy danych (dzierżawcy).</span><span class="sxs-lookup"><span data-stu-id="4ee78-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="4ee78-125">Zapytania przesłane toothis head bazy danych są skompilowane tooproduce planu zapytania rozproszonego z części zapytania hello przesuwana toohello dzierżawcy z bazy danych, zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="4ee78-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="4ee78-126">Elastyczne zapytanie używa mapy niezależnego fragmentu hello w lokalizacji bazy danych katalogu hello hello tooprovide hello dzierżawy z baz danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="4ee78-127">Instalator i zapytania są oczywiste, przy użyciu standardu [języka Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference)i obsługuje zapytań ad hoc z narzędzi, takich jak usługi Power BI i Excel.</span><span class="sxs-lookup"><span data-stu-id="4ee78-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="4ee78-128">Przekazując zapytania hello dzierżawcy z bazy danych, elastyczne zapytania zapewnia natychmiastowego wgląd w danych produkcyjnych na żywo.</span><span class="sxs-lookup"><span data-stu-id="4ee78-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="4ee78-129">Jednak jak elastycznej zapytanie pobiera dane z potencjalnie wiele baz danych, zapytań, czas oczekiwania czasami może być większa niż równoważne zapytań przesłać tooa pojedynczej bazy danych wielu dzierżawców.</span><span class="sxs-lookup"><span data-stu-id="4ee78-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="4ee78-130">Należy zachować ostrożność podczas projektowania zapytań toominimize hello danych zwracanych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="4ee78-131">Elastyczne zapytania jest często najlepiej dopasowane do badania niewielkich ilości danych w czasie rzeczywistym, min. toobuilding często używane lub analytics złożonych zapytań i raportów.</span><span class="sxs-lookup"><span data-stu-id="4ee78-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="4ee78-132">Jeśli kwerendy nie również wykonać, obejrzyj hello [plan wykonania](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee części zapytania hello ma zostać przesuwana toohello zdalnej bazy danych i ilość danych, które zostały zwrócone.</span><span class="sxs-lookup"><span data-stu-id="4ee78-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="4ee78-133">Zapytania, które wymagają złożonych przetwarzania analitycznego mogą być lepiej obsłużone w niektórych przypadkach wyodrębniając danych dzierżawy na dedykowany bazy danych lub magazyn danych, zoptymalizowana pod kątem zapytania analityczne.</span><span class="sxs-lookup"><span data-stu-id="4ee78-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="4ee78-134">Ten wzorzec jest szczegółowo hello [samouczek analizy dzierżawy](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="4ee78-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="4ee78-135">Pobierz skrypty aplikacji hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="4ee78-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="4ee78-136">Witaj Wingtip SaaS skrypty i kod źródłowy aplikacji są dostępne w hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) repozytorium github.</span><span class="sxs-lookup"><span data-stu-id="4ee78-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="4ee78-137">[Kroki skrypty Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="4ee78-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="4ee78-138">Tworzenie danych sprzedaży biletów</span><span class="sxs-lookup"><span data-stu-id="4ee78-138">Create ticket sales data</span></span>

<span data-ttu-id="4ee78-139">toorun zapytania względem bardziej interesującego zestawu danych, Utwórz danych sprzedaży biletów, uruchamiając hello generatora biletu.</span><span class="sxs-lookup"><span data-stu-id="4ee78-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="4ee78-140">W hello *PowerShell ISE*, otwórz hello... \\Modułów uczenia\\operacyjne Analytics\\Analytics ad hoc\\*AdhocAnalytics.ps1 pokaz* skryptów i ustaw następujące wartości hello:</span><span class="sxs-lookup"><span data-stu-id="4ee78-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="4ee78-141">**$DemoScenario** = 1, **zakupu biletów zdarzeń na wszystkich miejsc**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="4ee78-142">Naciśnij klawisz **F5** do uruchamiania skryptu hello i generowanie sprzedaży biletów.</span><span class="sxs-lookup"><span data-stu-id="4ee78-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="4ee78-143">Po uruchomieniu skryptu hello nadal hello kroków w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="4ee78-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="4ee78-144">dane biletu Hello jest poddawany kwerendzie w hello *uruchamianie zapytań ad hoc distributed* sekcji, więc Zaczekaj hello biletu generator toocomplete, jeśli wciąż działa po przejściu toothat wykonywania.</span><span class="sxs-lookup"><span data-stu-id="4ee78-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="4ee78-145">Eksploruj hello widoki globalne</span><span class="sxs-lookup"><span data-stu-id="4ee78-145">Explore hello global views</span></span>

<span data-ttu-id="4ee78-146">Hello aplikacji Wingtip SaaS jest utworzony przy użyciu modelu dzierżawy na bazę danych, więc schematu bazy danych dzierżawy hello jest zdefiniowana z punktu widzenia pojedynczej dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="4ee78-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="4ee78-147">Informacje dotyczące dzierżawy istnieje w jednej tabeli, *miejscową*, który zawsze pojedynczy wiersz i jest zaimplementowany jako sterty, bez klucza podstawowego.</span><span class="sxs-lookup"><span data-stu-id="4ee78-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="4ee78-148">Inne tabele w schemacie hello nie ma potrzeby związane z toobe toohello *miejscową* tabeli, ponieważ podczas normalnego użytkowania, nigdy nie jest wątpliwości dane hello dzierżawy, które należy do.</span><span class="sxs-lookup"><span data-stu-id="4ee78-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="4ee78-149">Jednak podczas wykonywania zapytania dla wszystkich baz danych, ważne jest elastyczny zapytania można traktować hello danych tak, jakby była częścią jednej logicznej bazy danych podzielonej przez dzierżawcę.</span><span class="sxs-lookup"><span data-stu-id="4ee78-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="4ee78-150">tooachieve to zestaw widoków "global" są dodane toohello bazy danych dzierżawy, która projektu identyfikator dzierżawcy do każdej z tabel hello, które będą pytani globalnie.</span><span class="sxs-lookup"><span data-stu-id="4ee78-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="4ee78-151">Na przykład Witaj *VenueEvents* widoku dodaje obliczanej *VenueId* toohello kolumn zaprojektowana z hello *zdarzenia* tabeli.</span><span class="sxs-lookup"><span data-stu-id="4ee78-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="4ee78-152">Poprzez definiowanie tabeli zewnętrznej hello hello head bazy danych za pośrednictwem *VenueEvents* (zamiast bazowy hello *zdarzenia* tabeli), elastyczne zapytanie jest możliwe toopush dół sprzężenia na podstawie *VenueId* , mogą być wykonywane równolegle na każdym zdalnej bazy danych (a nie na powitania head bazy danych).</span><span class="sxs-lookup"><span data-stu-id="4ee78-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="4ee78-153">Zmniejsza to znacznie hello ilość danych, które ma zostać zwrócona, co powoduje znaczne zwiększenie wydajności dla wielu zapytań.</span><span class="sxs-lookup"><span data-stu-id="4ee78-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="4ee78-154">Widoki globalne te zostały utworzone wcześniej w wszystkich baz danych dzierżawy (i w *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="4ee78-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="4ee78-155">Otwórz w programie SSMS i [połączyć toohello tenants1 -&lt;użytkownika&gt; serwera](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="4ee78-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="4ee78-156">Rozwiń węzeł **baz danych**, kliknij prawym przyciskiem myszy **contosoconcerthall**i wybierz **nowe zapytanie**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="4ee78-157">Uruchom następujące kwerendy tooexplore hello różnica między hello pojedynczej dzierżawy tabele i widoki globalne hello hello:</span><span class="sxs-lookup"><span data-stu-id="4ee78-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="4ee78-158">W tych widokach hello *VenueId* jest obliczany jako skrót hello miejscową nazwy, ale jakiejkolwiek metody mogą być używane toointroduce unikatową wartość.</span><span class="sxs-lookup"><span data-stu-id="4ee78-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="4ee78-159">Ta metoda jest podobny sposób toohello hello klucz dzierżawy jest obliczana do użycia w katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="4ee78-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="4ee78-160">Definicja hello tooexamine hello *miejsc* widoku:</span><span class="sxs-lookup"><span data-stu-id="4ee78-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="4ee78-161">W **Eksplorator obiektów**, rozwiń węzeł **contosoconcethall** > **widoków**:</span><span class="sxs-lookup"><span data-stu-id="4ee78-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![Widoki](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="4ee78-163">Kliknij prawym przyciskiem myszy **dbo. Miejsc**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="4ee78-164">Wybierz **skryptu widoku w postaci** > **utworzyć** > **nowe okno edytora zapytań**</span><span class="sxs-lookup"><span data-stu-id="4ee78-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="4ee78-165">Wszelkie inne hello skryptu *miejscową* widoków toosee sposób dodawania hello *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="4ee78-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="4ee78-166">Wdrażanie hello bazy danych używane do zapytań ad hoc rozproszonych</span><span class="sxs-lookup"><span data-stu-id="4ee78-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="4ee78-167">Tego ćwiczenia wdraża hello *adhocanalytics* bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="4ee78-168">Jest to hello head bazy danych, który będzie zawierać schemat hello używane do wykonywania zapytań dla wszystkich baz danych dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="4ee78-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="4ee78-169">Baza danych Hello jest wdrożony toohello istniejącego serwera katalogu, który jest serwerem hello używane dla wszystkich związanych z zarządzaniem baz danych w hello przykładowej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="4ee78-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="4ee78-170">Otwórz... \\Modułów uczenia\\operacyjne Analytics\\Analytics ad hoc\\*AdhocAnalytics.ps1 pokaz* w hello *PowerShell ISE* i hello zestawu następujące wartości:</span><span class="sxs-lookup"><span data-stu-id="4ee78-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="4ee78-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="4ee78-172">Naciśnij klawisz **F5** toorun hello skryptu i utworzenia hello *adhocanalytics* bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="4ee78-173">W następnej sekcji hello możesz dodać bazy danych toohello schematu, może być używane toorun rozproszonych zapytań.</span><span class="sxs-lookup"><span data-stu-id="4ee78-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="4ee78-174">Skonfiguruj bazę danych hello do uruchamiania zapytań rozproszonych</span><span class="sxs-lookup"><span data-stu-id="4ee78-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="4ee78-175">Tego ćwiczenia dodaje schematu (hello zewnętrznego źródła danych i definicji tabeli zewnętrznej) toohello ad hoc analytics bazy danych, która umożliwia wykonywanie zapytania dla wszystkich baz danych dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="4ee78-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="4ee78-176">Otwórz program SQL Server Management Studio i połącz toohello bazy danych analizy ad hoc, utworzony w poprzednim kroku hello.</span><span class="sxs-lookup"><span data-stu-id="4ee78-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="4ee78-177">Nazwa Hello hello bazy danych będzie adhocanalytics.</span><span class="sxs-lookup"><span data-stu-id="4ee78-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="4ee78-178">Otwórz ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *AdhocAnalyticsDB.sql zainicjować* w programie SSMS.</span><span class="sxs-lookup"><span data-stu-id="4ee78-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="4ee78-179">Przejrzyj skrypt SQL hello i zanotuj następujące hello:</span><span class="sxs-lookup"><span data-stu-id="4ee78-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="4ee78-180">Elastyczne zapytanie używa poświadczeń o zakresie bazy danych tooaccess każdego hello dzierżawy z baz danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="4ee78-181">To poświadczenie musi toobe dostępne w wszystkich hello baz danych i zwykle należy udzielić minimalnych uprawnień hello wymagane tooenable tych zapytań ad hoc.</span><span class="sxs-lookup"><span data-stu-id="4ee78-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![Tworzenie poświadczeń](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="4ee78-183">Witaj zewnętrznego źródła danych, która jest zdefiniowane toouse hello dzierżawy niezależnego fragmentu mapy hello katalogu bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="4ee78-184">Korzystając z niniejszego jako hello zewnętrznego źródła danych, zapytania są rozproszone tooall bazy danych zarejestrowany w wykazie powitania po uruchomieniu kwerendy hello.</span><span class="sxs-lookup"><span data-stu-id="4ee78-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="4ee78-185">Ponieważ nazwy serwerów są różne dla każdego wdrożenia, ten skrypt inicjacji pobiera hello lokalizacji bazy danych katalogu hello pobierając hello bieżącego serwera (@@servername) gdzie hello skrypt zostanie wykonany.</span><span class="sxs-lookup"><span data-stu-id="4ee78-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![Tworzenie zewnętrznego źródła danych](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="4ee78-187">Witaj tabel zewnętrznych odwołujące się do widoki globalne hello opisanego w poprzedniej sekcji hello oraz zdefiniowana z **dystrybucji = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="4ee78-188">Ponieważ każdy *VenueId* mapy tooa pojedynczej bazy danych, poprawia to wydajność w wielu scenariuszach, jak pokazano w następnej sekcji hello.</span><span class="sxs-lookup"><span data-stu-id="4ee78-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![Tworzenie tabel zewnętrznych](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="4ee78-190">Tabela lokalne powitania *VenueTypes* które jest tworzone i wypełniane.</span><span class="sxs-lookup"><span data-stu-id="4ee78-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="4ee78-191">Tej tabeli danych odwołania jest typowe w przypadku wszystkich dzierżawy baz danych, więc może być reprezentowany jako lokalnej tabeli i wypełnione z hello wspólnych danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="4ee78-192">Dla niektórych kwerend może to zmniejszyć hello ilości danych są przenoszone między hello dzierżawcy z bazy danych oraz hello *adhocanalytics* bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![Tworzenie tabeli](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="4ee78-194">Jeśli dołączysz tabele odwołań w ten sposób można się, że schemat tabeli hello tooupdate i dane po zaktualizowaniu hello dzierżawcy z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="4ee78-195">Naciśnij klawisz **F5** toorun hello skryptu i zainicjuj hello *adhocanalytics* bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="4ee78-196">Teraz można uruchomić zapytania rozproszone i zbieranie szczegółowych informacji we wszystkich dzierżawców!</span><span class="sxs-lookup"><span data-stu-id="4ee78-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="4ee78-197">Uruchamianie zapytań ad hoc rozproszonych</span><span class="sxs-lookup"><span data-stu-id="4ee78-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="4ee78-198">Teraz tego hello *adhocanalytics* baza danych jest skonfigurowany, przejdź dalej i uruchamiania niektórych zapytań rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="4ee78-199">Zawiera hello wykonanie planu w celu lepszego zrozumienia, z którym dzieje hello przetwarzania zapytania.</span><span class="sxs-lookup"><span data-stu-id="4ee78-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="4ee78-200">Podczas sprawdzania plan wykonania hello, umieść kursor nad hello planu ikony, aby uzyskać szczegółowe informacje.</span><span class="sxs-lookup"><span data-stu-id="4ee78-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="4ee78-201">To ustawienie jest ważne toonote **dystrybucji = SHARDED(VenueId)** podczas zdefiniowanego hello zewnętrznego źródła danych, zwiększa wydajność w różnych scenariuszach.</span><span class="sxs-lookup"><span data-stu-id="4ee78-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="4ee78-202">Ponieważ każdy *VenueId* mapy tooa pojedynczej bazy danych, filtrowania jest łatwo gotowe zdalnie, zwracająca hello tylko danych należy.</span><span class="sxs-lookup"><span data-stu-id="4ee78-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="4ee78-203">Otwórz plik ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* w narzędziu SSMS.</span><span class="sxs-lookup"><span data-stu-id="4ee78-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="4ee78-204">Upewnij się, są połączone toohello **adhocanalytics** bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4ee78-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="4ee78-205">Wybierz hello **zapytania** menu i kliknij przycisk **obejmują rzeczywisty Plan wykonania**</span><span class="sxs-lookup"><span data-stu-id="4ee78-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="4ee78-206">Wyróżnij hello *miejsc, które są obecnie zarejestrowane?* zapytania, a następnie naciśnij klawisz **F5**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="4ee78-207">Hello zapytanie zwraca listę całe miejsce hello, pokazujący, jak szybko i łatwo jest tooquery we wszystkich dzierżaw i zwracanych danych z każdej dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="4ee78-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="4ee78-208">Zbadaj hello planu i kosztów całej hello jest zapytania zdalnego hello ponieważ jesteśmy po prostu będzie tooeach dzierżawcy w bazie danych i wybierając hello miejscową informacji.</span><span class="sxs-lookup"><span data-stu-id="4ee78-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![Wybierz * z dbo. Miejsc](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="4ee78-210">Wybierz hello dalej zapytania, a następnie naciśnij klawisz **F5**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="4ee78-211">To zapytanie sprzężenia danych z baz danych dzierżawy hello i lokalne powitania *VenueTypes* tabeli (lokalny, w jakiej jest tabelą w hello *adhocanalytics* bazy danych).</span><span class="sxs-lookup"><span data-stu-id="4ee78-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="4ee78-212">Zbadaj hello planu i zobacz tego hello większość koszt jest hello zapytania zdalnego, ponieważ będziemy kwerendy informacji o miejscu każdego dzierżawcy (dbo. Miejsc), a następnie wykonaj szybkie sprzężenie lokalne powitania lokalnych *VenueTypes* tabeli toodisplay hello przyjazną nazwę.</span><span class="sxs-lookup"><span data-stu-id="4ee78-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Dołącz do danych zdalnych i lokalnych](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="4ee78-214">Teraz wybierz hello *na dzień zostały hello sprzedanych biletów większości?* zapytania, a następnie naciśnij klawisz **F5**.</span><span class="sxs-lookup"><span data-stu-id="4ee78-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="4ee78-215">To zapytanie jest bardziej złożonych przyłączanie i agregacji.</span><span class="sxs-lookup"><span data-stu-id="4ee78-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="4ee78-216">Co to jest ważne toonote jest najbardziej przetwarzania hello jest wykonywane zdalnie, czy ponownie, możemy przywrócić tylko wiersze hello potrzebne, zwracanie tylko jednego wiersza dla każdego miejscową agregacji biletu sprzedaży liczba na dzień.</span><span class="sxs-lookup"><span data-stu-id="4ee78-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![query](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="4ee78-218">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="4ee78-218">Next steps</span></span>

<span data-ttu-id="4ee78-219">W tym samouczku zawarto informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="4ee78-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="4ee78-220">Uruchamiania rozproszonych zapytań dla wszystkich baz danych dzierżawy</span><span class="sxs-lookup"><span data-stu-id="4ee78-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="4ee78-221">Wdrażanie bazy danych analizy ad hoc i dodawanie zapytań rozproszonych toorun tooit schematu.</span><span class="sxs-lookup"><span data-stu-id="4ee78-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="4ee78-222">Teraz spróbuj hello [samouczek analizy dzierżawy](sql-database-saas-tutorial-tenant-analytics.md) tooexplore wyodrębniania danych bazy danych analytics oddzielne tooa bardziej złożonych przetwarzania analizy...</span><span class="sxs-lookup"><span data-stu-id="4ee78-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="4ee78-223">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="4ee78-223">Additional resources</span></span>

* <span data-ttu-id="4ee78-224">Dodatkowe [samouczki, które zależą od hello aplikacji Wingtip SaaS](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="4ee78-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="4ee78-225">Elastyczne zapytanie</span><span class="sxs-lookup"><span data-stu-id="4ee78-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
