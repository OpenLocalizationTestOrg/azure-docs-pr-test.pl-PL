---
title: "Projektowanie usługi wysokiej dostępności przy użyciu usługi Azure SQL Database | Dokumentacja firmy Microsoft"
description: "Więcej informacji na temat projektowania aplikacji dla usługi wysokiej dostępności przy użyciu bazy danych SQL Azure."
keywords: "w chmurze odzyskiwania po awarii, rozwiązania w zakresie odzyskiwania po awarii, kopia zapasowa danych aplikacji, replikacja geograficzna, planowanie ciągłości biznesowej"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 40fe0ae04eb94322356ed19773512e3bc383639c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="3f042-104">Projektowanie usługi wysokiej dostępności przy użyciu bazy danych SQL Azure</span><span class="sxs-lookup"><span data-stu-id="3f042-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="3f042-105">Podczas tworzenia i wdrażania usług wysokiej dostępności w bazie danych SQL Azure, użyj [trybu failover grupy i aktywna replikacja geograficzna](sql-database-geo-replication-overview.md) do zapewnienia odporności na awarie regionalnych i poważnej awarii i Włącz szybkie odzyskiwanie pomocniczej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional failures and catastrophic outages and enable fast recovery to the secondary databases.</span></span> <span data-ttu-id="3f042-106">Ten artykuł skupia się na typowe wzorce aplikacji i omówiono zalety i możliwości poszczególnych opcji, w zależności od wymagań wdrażania aplikacji, Umowa dotycząca poziomu usług przeznaczonych, opóźnienia ruchu i koszty.</span><span class="sxs-lookup"><span data-stu-id="3f042-106">This article focuses on common application patterns and discusses the benefits and trade-offs of each option depending on the application deployment requirements, the service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="3f042-107">Informacje aktywna replikacja geograficzna z pule elastyczne, zobacz [strategii odzyskiwania danych w puli elastycznej](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="3f042-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="3f042-108">Wzorzec projektowy 1: aktywny / pasywny wdrożenia do chmury odzyskiwania po awarii z tej samej lokalizacji bazy danych</span><span class="sxs-lookup"><span data-stu-id="3f042-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="3f042-109">Ta opcja jest najbardziej odpowiednie dla aplikacji o następującej charakterystyce:</span><span class="sxs-lookup"><span data-stu-id="3f042-109">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="3f042-110">Wystąpienia aktywne w pojedynczym regionie Azure</span><span class="sxs-lookup"><span data-stu-id="3f042-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="3f042-111">Silne zależność od odczytu i zapisu (RW) dostęp do danych</span><span class="sxs-lookup"><span data-stu-id="3f042-111">Strong dependency on read-write (RW) access to data</span></span>
* <span data-ttu-id="3f042-112">Łączność między region aplikacji sieci web i bazy danych nie jest akceptowany z powodu opóźnienia i ruchu koszt</span><span class="sxs-lookup"><span data-stu-id="3f042-112">Cross-region connectivity between the web application and the database is not acceptable due to latency and traffic cost</span></span>    

<span data-ttu-id="3f042-113">W takim przypadku topologii wdrożenia aplikacji jest zoptymalizowany do obsługi regionalnej awarii, gdy wszystkie składniki aplikacji ma wpływ i do trybu failover jako jednostka.</span><span class="sxs-lookup"><span data-stu-id="3f042-113">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span></span> <span data-ttu-id="3f042-114">W celu zapewnienia nadmiarowości geograficznej logiki aplikacji i bazy danych są replikowane do innego regionu, ale nie są używane dla obciążenia aplikacji w normalnych warunkach.</span><span class="sxs-lookup"><span data-stu-id="3f042-114">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span></span> <span data-ttu-id="3f042-115">Aplikacja w regionie pomocniczym powinien skonfigurowana do używania ciągu połączenia SQL do pomocniczej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-115">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span></span> <span data-ttu-id="3f042-116">Menedżer ruchu jest skonfigurowany do użycia [metody routingu dla trybu failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="3f042-116">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="3f042-117">[Menedżer ruchu Azure](../traffic-manager/traffic-manager-overview.md) jest używany w tym artykule wyłącznie dla celów ilustracyjnych.</span><span class="sxs-lookup"><span data-stu-id="3f042-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="3f042-118">Można użyć dowolnego równoważenia obciążenia rozwiązania, które obsługuje metody routingu dla trybu failover.</span><span class="sxs-lookup"><span data-stu-id="3f042-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="3f042-119">Na poniższym diagramie przedstawiono tę konfigurację przed awarią.</span><span class="sxs-lookup"><span data-stu-id="3f042-119">The following diagram shows this configuration before an outage.</span></span>

![Konfiguracja — replikacja geograficzna bazy danych SQL.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="3f042-122">Po awarii w regionie podstawowym usługi SQL Database wykrywa, że podstawowa baza danych nie jest dostępny i wyzwolić tryb failover w pomocniczej bazie danych na podstawie parametrów zasady automatycznej pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="3f042-122">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and trigger a failover to the secondary database based on the parameters of the automatic failover policy.</span></span> <span data-ttu-id="3f042-123">W zależności od Twojego umowy SLA dla aplikacji można zdecydować skonfigurować okres karencji między wykrywania awarii i pracy awaryjnej, sama.</span><span class="sxs-lookup"><span data-stu-id="3f042-123">Depending on your application SLA, you can decide to configure a grace period between the detection of the outage and the failover itself.</span></span> <span data-ttu-id="3f042-124">Konfigurowanie okresu prolongaty zmniejsza ryzyko utraty danych do przypadków, w którym jest poważnej awarii i dostępności w regionie nie można szybko przywrócić.</span><span class="sxs-lookup"><span data-stu-id="3f042-124">Configuring a grace period reduces the risk of data loss to the cases where the outage is catastrophic and availability in the region cannot be quickly restored.</span></span> <span data-ttu-id="3f042-125">Jeśli punkt końcowy trybu failover jest inicjowane przez Menedżera ruchu przed grupy pracy awaryjnej wyzwala trybu failover bazy danych, aplikacji sieci web nie będzie mógł ponownie połączyć się z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-125">If the endpoint failover is initiated by the traffic manager before the failover group triggers the failover of the database, the web application is not able to reconnect to the database.</span></span> <span data-ttu-id="3f042-126">Próba aplikacji automatycznie ponownie połączenie kończy się powodzeniem, natychmiast po zakończeniu trybu failover bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-126">The application’s attempt to reconnect automatically succeeds as soon as the database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="3f042-127">Aby osiągnąć całkowicie koordynowanym pracy awaryjnej aplikacji i baz danych, należy opracować metodę monitorowania i użyć ręcznego przełączania trybu failover punktów końcowych aplikacji sieci web i baz danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-127">To achieve fully coordinated failover of the application and the databases, you should devise your own monitoring method and use manual failover of the web application endpoints and the databases.</span></span>
>

<span data-ttu-id="3f042-128">Po zakończeniu pracy awaryjnej zarówno punkty końcowe aplikacji, jak i bazy danych, aplikacja zostanie rozpoczęte przetwarzanie żądania użytkownika w regionie B i pozostanie wspólnie z bazą danych, ponieważ podstawowej bazy danych jest teraz w regionie B. W tym scenariuszu przedstawiono na poniższym diagramie.</span><span class="sxs-lookup"><span data-stu-id="3f042-128">After the failover of both the application’s endpoints and the database completes, the application will re-start processing the user requests in the region B and will remain co-located with the database because the primary database is now in region B. This scenario is illustrated in the following diagram.</span></span> <span data-ttu-id="3f042-129">W wszystkie diagramy aktywnych połączeń wskazuje linia ciągła, linie przerywana wskazują wstrzymaną połączeń i znaki stop wskazać wyzwalaczy akcji.</span><span class="sxs-lookup"><span data-stu-id="3f042-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Replikacja geograficzna: Tryb Failover dodatkowej bazy danych.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="3f042-132">Jeśli wystąpi awaria w regionie pomocniczym, łącze replikacji między serwerem podstawowym i pomocniczym bazy danych jest wstrzymana, ale przejście w tryb failover nie jest wyzwalany, ponieważ nie ma wpływu na podstawowej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-132">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended but the failover is not triggered because the primary database is not impacted.</span></span> <span data-ttu-id="3f042-133">Dostępność aplikacji nie ulega zmianie w takim przypadku, ale aplikacja działa narażonych i w związku z tym bardziej narażony w przypadku obu regionów awarii w przedziale czasu.</span><span class="sxs-lookup"><span data-stu-id="3f042-133">The application's availability is not changed in this case, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="3f042-134">Do odzyskiwania po awarii zalecamy konfiguracji z wdrożeniem aplikacji jest ograniczona do dwóch regionach.</span><span class="sxs-lookup"><span data-stu-id="3f042-134">For disaster recovery we recommend the configuration with application deployment limited to two regions.</span></span> <span data-ttu-id="3f042-135">Jest to spowodowane większość Azure lokalizacji geograficznych mają tylko dwóch regionach.</span><span class="sxs-lookup"><span data-stu-id="3f042-135">This is because most of the Azure geographies have only two regions.</span></span> <span data-ttu-id="3f042-136">Ta konfiguracja nie będzie chronić aplikacji z jednoczesnych poważnej awarii obu regionów.</span><span class="sxs-lookup"><span data-stu-id="3f042-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="3f042-137">W przypadku mało prawdopodobnego takiej awarii, można odzyskać bazy danych za pomocą trzeci region [operacji przywracania geograficznie](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="3f042-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="3f042-138">Po awarii jest niewielkie, dodatkowej bazy danych zostanie automatycznie ponownie wykonywać synchronizację z serwera podstawowego.</span><span class="sxs-lookup"><span data-stu-id="3f042-138">Once the outage is mitigated, the secondary database will automatically re-synchronize with the primary.</span></span> <span data-ttu-id="3f042-139">Podczas synchronizacji wydajności serwera podstawowego może dotyczyć nieco w zależności od ilości danych, które muszą być zsynchronizowane.</span><span class="sxs-lookup"><span data-stu-id="3f042-139">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="3f042-140">Na poniższym diagramie przedstawiono awaria w regionie pomocniczym.</span><span class="sxs-lookup"><span data-stu-id="3f042-140">The following diagram illustrates an outage in the secondary region.</span></span>

![Dodatkowej bazy danych są synchronizowane z podstawowym.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="3f042-143">Klucz **zalety** tego wzorca projektu są:</span><span class="sxs-lookup"><span data-stu-id="3f042-143">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="3f042-144">Ta sama aplikacja sieci web jest wdrażana na obu regionów, bez żadnej konfiguracji określonego regionu i nie dodatkowe logiki reagowanie na przejście w tryb failover.</span><span class="sxs-lookup"><span data-stu-id="3f042-144">The same web application is deployed to both regions without any region-specific configuration and no additional logic to react to the failover.</span></span> 
* <span data-ttu-id="3f042-145">Wydajność aplikacji nie ma wpływu na pracy awaryjnej jako aplikacji sieci web i bazy danych są zawsze wspólnie.</span><span class="sxs-lookup"><span data-stu-id="3f042-145">The application's performance is not impacted by failover as the web application and the database are always co-located.</span></span>

<span data-ttu-id="3f042-146">Głównym **zależnościami** jest nadmiarowy aplikację w regionie pomocniczym jest używana tylko do odzyskiwania po awarii.</span><span class="sxs-lookup"><span data-stu-id="3f042-146">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="3f042-147">Wzorzec projektowy 2: Wdrażanie aktywny aktywny w programie Równoważenie obciążenia aplikacji</span><span class="sxs-lookup"><span data-stu-id="3f042-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="3f042-148">Ta opcja odzyskiwania po awarii chmury jest najbardziej odpowiednie dla aplikacji o następującej charakterystyce:</span><span class="sxs-lookup"><span data-stu-id="3f042-148">This cloud disaster recovery option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="3f042-149">Wysoki współczynnik odczytów bazy danych do zapisu</span><span class="sxs-lookup"><span data-stu-id="3f042-149">High ratio of database reads to writes</span></span>
* <span data-ttu-id="3f042-150">Baza danych opóźnienie odczytu jest dla użytkownika końcowego ważniejsze niż opóźnienie zapisu</span><span class="sxs-lookup"><span data-stu-id="3f042-150">Database read latency is more critical for the end-user experience than the write latency</span></span> 
* <span data-ttu-id="3f042-151">Logika tylko do odczytu mogą być oddzielone od logiki odczytu i zapisu przy użyciu innego połączenia ciągu</span><span class="sxs-lookup"><span data-stu-id="3f042-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="3f042-152">Logika tylko do odczytu nie zależy od danych pełni synchronizowana z najnowszymi aktualizacjami</span><span class="sxs-lookup"><span data-stu-id="3f042-152">Read-only logic does not depend on data being fully synchronized with the latest updates</span></span>  

<span data-ttu-id="3f042-153">Jeśli aplikacje te właściwości, równoważenie obciążenia połączeń użytkowników końcowych w wielu wystąpień aplikacji w różnych regionach znacznie może zwiększyć ogólną środowisko użytkownika końcowego.</span><span class="sxs-lookup"><span data-stu-id="3f042-153">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can substantially improve the overall end-user experience.</span></span> <span data-ttu-id="3f042-154">Dwa regionów należy wybrać jako para odzyskiwania po awarii i trybu failover powinny znajdować się w grupie baz danych w tych obszarach.</span><span class="sxs-lookup"><span data-stu-id="3f042-154">Two of the regions should be selected as the DR pair and the failover group should include the databases in these regions.</span></span> <span data-ttu-id="3f042-155">Aby zaimplementować równoważenia obciążenia, każdego regionu ma active wystąpienie aplikacji logiki (RW) odczytu i zapisu, połączony z punktem końcowym odczytu i zapisu odbiornika grupy pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="3f042-155">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the read-write listener endpoint of the failover group.</span></span> <span data-ttu-id="3f042-156">Zostanie gwarantuje, że trybu failover zostanie automatycznie zainicjowany Jeśli podstawowa baza danych jest wpływ awaria.</span><span class="sxs-lookup"><span data-stu-id="3f042-156">It will guarantee that the failover will be automatically initiated if the primary database is impacted by an outage.</span></span> <span data-ttu-id="3f042-157">Tylko do odczytu logiki (RO) w aplikacji sieci web należy łączyć bezpośrednio z bazą danych w tym regionie.</span><span class="sxs-lookup"><span data-stu-id="3f042-157">The read-only logic (RO) in the web application should connect directly to the database in that region.</span></span> <span data-ttu-id="3f042-158">Usługi Traffic manager można skonfigurować do używania [wydajności routingu](../traffic-manager/traffic-manager-configure-performance-routing-method.md) z [punkt końcowy monitorowania](../traffic-manager/traffic-manager-monitoring.md) włączony dla każdego wystąpienia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3f042-158">Traffic manager should be set up to use [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="3f042-159">Jak wzorzec #1 należy rozważyć wdrożenie podobne monitorowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3f042-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="3f042-160">Jednak w przeciwieństwie do wzorca #1 monitorowania aplikacji nie będzie odpowiedzialna za wyzwolenie pracy awaryjnej punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="3f042-160">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="3f042-161">Ten wzorzec korzysta z więcej niż jednej pomocniczej bazy danych, pomocniczej w regionie B będzie używany na potrzeby trybu failover i powinna być częścią grupy pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="3f042-161">While this pattern uses more than one secondary database, only the secondary in Region B  would be used for failover and should be part of the failover group.</span></span>
>

<span data-ttu-id="3f042-162">Menedżer ruchu należy skonfigurować dla wydajności routingu do kierowania połączeń użytkowników do wystąpienia aplikacji najbliżej użytkownika lokalizacji geograficznej.</span><span class="sxs-lookup"><span data-stu-id="3f042-162">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span></span> <span data-ttu-id="3f042-163">Na poniższym diagramie przedstawiono tę konfigurację przed awarią.</span><span class="sxs-lookup"><span data-stu-id="3f042-163">The following diagram illustrates this configuration before an outage.</span></span>

![Nie przestoju: wydajności routingu do najbliższej aplikacji.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="3f042-166">Wykrycie awarii bazy danych w regionie, A grupy pracy awaryjnej zainicjuje automatycznie pracy awaryjnej z podstawowej bazy danych w regionie A na serwerze pomocniczym w regionie B. On również automatycznie zaktualizuje punktu końcowego odbiornika odczytu i zapisu do regionu B tak połączenia odczytu i zapisu w aplikacji sieci web nie jest ograniczona.</span><span class="sxs-lookup"><span data-stu-id="3f042-166">If a database outage is detected in the region A, the failover group will automatically initiate failover of the primary database in region A to the secondary in region B. It will also automatically update the read-write listener endpoint to region B so read-write connections in the web application will not be impacted.</span></span> <span data-ttu-id="3f042-167">Menedżer ruchu powoduje wyłączenie punktu końcowego w trybie offline z tabeli routingu, ale będzie kontynuowane, routingu ruchu przez użytkownika końcowego do pozostałych wystąpień online.</span><span class="sxs-lookup"><span data-stu-id="3f042-167">The traffic manager will exclude the offline end-point from the routing table but will continue routing the end-user traffic to the remaining online instances.</span></span> <span data-ttu-id="3f042-168">Nie wpłynie parametry połączenia SQL tylko do odczytu, ponieważ zawsze punktu, w bazie danych w tym samym regionie.</span><span class="sxs-lookup"><span data-stu-id="3f042-168">The read-only SQL connection strings will not be impacted as they always point to the database in the same region.</span></span> 

<span data-ttu-id="3f042-169">Na poniższym diagramie przedstawiono nowej konfiguracji po przejściu w tryb failover.</span><span class="sxs-lookup"><span data-stu-id="3f042-169">The following diagram illustrates the new configuration after the failover.</span></span>

![Konfiguracja po pracy awaryjnej.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="3f042-172">W przypadku wystąpienia awarii w jednej dodatkowej regionów usługi traffic manager spowoduje automatyczne usunięcie punktu końcowego w trybie offline w tym regionie z tabeli routingu.</span><span class="sxs-lookup"><span data-stu-id="3f042-172">In case of an outage in one of the secondary regions, the traffic manager will automatically remove the offline end-point in that region from the routing table.</span></span> <span data-ttu-id="3f042-173">Kanał replikację do dodatkowej bazy danych w tym regionie zostanie zawieszona.</span><span class="sxs-lookup"><span data-stu-id="3f042-173">The replication channel to the secondary database in that region will be suspended.</span></span> <span data-ttu-id="3f042-174">Ponieważ pozostałe regiony dodatkowe ruchu danych w tym scenariuszu, wydajność aplikacji jest ograniczona w awarii.</span><span class="sxs-lookup"><span data-stu-id="3f042-174">Because the remaining regions get additional user traffic in this scenario, the application's performance will be impacted during the outage.</span></span> <span data-ttu-id="3f042-175">Po awarii jest niewielkie, dodatkowej bazy danych w regionie wpływ na będą natychmiast synchronizowane z serwerem podstawowym.</span><span class="sxs-lookup"><span data-stu-id="3f042-175">Once the outage is mitigated, the secondary database in the impacted region will be immediately synchronized with the primary.</span></span> <span data-ttu-id="3f042-176">Podczas synchronizacji wydajności serwera podstawowego może dotyczyć nieco w zależności od ilości danych, które muszą być zsynchronizowane.</span><span class="sxs-lookup"><span data-stu-id="3f042-176">During the synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="3f042-177">Na poniższym diagramie przedstawiono awaria w regionie B.</span><span class="sxs-lookup"><span data-stu-id="3f042-177">The following diagram illustrates an outage in region B.</span></span>

![Awaria w regionie pomocniczym.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="3f042-180">Klucz **korzyści** projektu tego wzorca jest skalowanie obciążenia aplikacji na wiele pomocniczych baz danych, aby uzyskać optymalne wydajność.</span><span class="sxs-lookup"><span data-stu-id="3f042-180">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span></span> <span data-ttu-id="3f042-181">**Wady i zalety** tej opcji są:</span><span class="sxs-lookup"><span data-stu-id="3f042-181">The **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="3f042-182">Odczyt i zapis połączenia między wystąpieniami aplikacji a bazy danych mają różnych opóźnienia i kosztów</span><span class="sxs-lookup"><span data-stu-id="3f042-182">Read-write connections between the application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="3f042-183">Wydajność aplikacji jest ograniczona w awarii</span><span class="sxs-lookup"><span data-stu-id="3f042-183">Application performance is impacted during the outage</span></span>

> [!NOTE]
> <span data-ttu-id="3f042-184">Podejście podobne umożliwia offload obciążeń specjalnych, takich jak raportowanie zadania, narzędzia do analizy biznesowej lub tworzenie kopii zapasowych.</span><span class="sxs-lookup"><span data-stu-id="3f042-184">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="3f042-185">Zazwyczaj te obciążenia użycie zasobów znaczących bazy danych z tego powodu zaleca się wyznaczyć jednej pomocniczej bazy danych dla nich z poziomu wydajności do poziomu pasuje do oczekiwanego obciążenia.</span><span class="sxs-lookup"><span data-stu-id="3f042-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="3f042-186">Wzorzec projektowy 3: Wdrażanie aktywny / pasywny konserwacji danych</span><span class="sxs-lookup"><span data-stu-id="3f042-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="3f042-187">Ta opcja jest najbardziej odpowiednie dla aplikacji o następującej charakterystyce:</span><span class="sxs-lookup"><span data-stu-id="3f042-187">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="3f042-188">Utraty danych jest biznesowych wysokiego ryzyka.</span><span class="sxs-lookup"><span data-stu-id="3f042-188">Any data loss is high business risk.</span></span> <span data-ttu-id="3f042-189">Tryb failover bazy danych można tylko w ostateczności przypadku poważnej awarii.</span><span class="sxs-lookup"><span data-stu-id="3f042-189">The database failover can only be used as a last resort if the outage is catastrophic.</span></span>
* <span data-ttu-id="3f042-190">Aplikacja obsługuje tylko do odczytu i zapisu i odczytu tryby operacji i może działać w trybie"tylko do odczytu" przez pewien czas.</span><span class="sxs-lookup"><span data-stu-id="3f042-190">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="3f042-191">W tym wzorcu aplikacji przełącza na tryb tylko do odczytu po rozpoczęciu połączenia odczytu i zapisu występują błędy przekroczenia limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="3f042-191">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span></span> <span data-ttu-id="3f042-192">Aplikacja sieci Web jest wdrażana na obu regionów i obejmują połączenia z punktem końcowym odbiornika odczytu i zapisu oraz innego połączenia z punktem końcowym odbiornika tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="3f042-192">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint.</span></span> <span data-ttu-id="3f042-193">Traffic manager można skonfigurować do używania [routingu trybu failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md) z [punkt końcowy monitorowania](../traffic-manager/traffic-manager-monitoring.md) włączone dla punktu końcowego aplikacji w każdym regionie.</span><span class="sxs-lookup"><span data-stu-id="3f042-193">The Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for the application endpoint in each region.</span></span>

<span data-ttu-id="3f042-194">Na poniższym diagramie przedstawiono tę konfigurację przed awarią.</span><span class="sxs-lookup"><span data-stu-id="3f042-194">The following diagram illustrates this configuration before an outage.</span></span>

![Aktywny / pasywny wdrożenia przed trybu failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="3f042-197">Menedżer ruchu wykrycie awarii łączności do regionu A automatycznie przełączenie ruchu użytkowników do wystąpienia aplikacji w regionie B. Ten wzorzec ważne jest ustawienie okresu prolongaty utraty danych wystarczająco dużą wartość, np. 24 godziny.</span><span class="sxs-lookup"><span data-stu-id="3f042-197">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="3f042-198">Zapewni on zapobiec utracie danych w przypadku awarii skuteczność została osłabiona w tym czasie.</span><span class="sxs-lookup"><span data-stu-id="3f042-198">It will ensure that data loss is prevented if the outage is mitigated within that time.</span></span> <span data-ttu-id="3f042-199">Po aktywowaniu aplikacji sieci Web w regionie B operacje odczytu i zapisu rozpocznie się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="3f042-199">When the Web application in the region B is activated the read-write operations will start failing.</span></span> <span data-ttu-id="3f042-200">W tym momencie należy przełączyć do trybu tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="3f042-200">At that point, it should switch to the read-only mode.</span></span> <span data-ttu-id="3f042-201">W tym trybie żądania zostanie automatycznie kierowane do dodatkowej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-201">In this mode the requests will be automatically routed to the secondary database.</span></span> <span data-ttu-id="3f042-202">W przypadku poważnej awarii awarii nie zostaną skorygowane w trakcie okresu prolongaty i grupy pracy awaryjnej jest wyzwalane w tryb failover.</span><span class="sxs-lookup"><span data-stu-id="3f042-202">In the case of a catastrophic failure the outage will not be mitigated within the grace period and the failover group will trigger the failover.</span></span> <span data-ttu-id="3f042-203">Po odbiornika odczytu i zapisu staną się dostępne i wywołania do niego zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="3f042-203">After that the read-write listener will become available and the calls to it will stop failing.</span></span> <span data-ttu-id="3f042-204">Jest to zilustrowane w poniższym diagramie.</span><span class="sxs-lookup"><span data-stu-id="3f042-204">This is illustrated by the following diagram.</span></span>

![Awaria: Aplikacja w trybie tylko do odczytu.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="3f042-207">Jeśli w trakcie okresu prolongaty skuteczność została osłabiona awaria w regionie podstawowym, Menedżera ruchu wykrywa przywrócenia łączności w regionie podstawowym i zmienia ruchu użytkowników do wystąpienia aplikacji w regionie A. To wystąpienie aplikacji zostanie wznowione, a także działa w trybie odczytu i zapisu przy użyciu podstawowej bazy danych w regionie A.</span><span class="sxs-lookup"><span data-stu-id="3f042-207">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A.</span></span>

<span data-ttu-id="3f042-208">W przypadku wystąpienia awarii w regionie B Menedżera ruchu wykrywa błąd punktu końcowego aplikacji w regionie B i odbiornika trybu failover grupy przełączników tylko do odczytu do regionu A. Ta awaria nie ma wpływu na środowisko pracy użytkownika końcowego, ale mają być widoczne podstawowej bazy danych podczas awarii.</span><span class="sxs-lookup"><span data-stu-id="3f042-208">In case of an outage in the region B, the traffic manager detects the failure of the application end-point in region B and the failover group switches the read-only listener to region A. This outage does not impact the end-user experience but the primary database will be exposed during the outage.</span></span> <span data-ttu-id="3f042-209">Jest to zilustrowane w poniższym diagramie.</span><span class="sxs-lookup"><span data-stu-id="3f042-209">This is illustrated by the following diagram.</span></span>

![Awaria: Dodatkowej bazy danych.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="3f042-212">Po awarii jest niewielkie, dodatkowej bazy danych jest natychmiast synchronizowane z serwera podstawowego i przełączeniu odbiornika tylko do odczytu w pomocniczej bazie danych w regionie B. Podczas synchronizacji wydajności serwera podstawowego może dotyczyć nieco w zależności od ilości danych, które muszą być zsynchronizowane.</span><span class="sxs-lookup"><span data-stu-id="3f042-212">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

<span data-ttu-id="3f042-213">Ten wzorzec projektowy ma kilka **zalety**:</span><span class="sxs-lookup"><span data-stu-id="3f042-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="3f042-214">Pozwala ona na uniknięcie utraty danych podczas tymczasowych przestojów.</span><span class="sxs-lookup"><span data-stu-id="3f042-214">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="3f042-215">Czas przestoju tylko zależy szybkość Menedżera ruchu wykrywa awarii łączności, które można skonfigurować.</span><span class="sxs-lookup"><span data-stu-id="3f042-215">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="3f042-216">**Zależnościami** jest:</span><span class="sxs-lookup"><span data-stu-id="3f042-216">The **tradeoff** is:</span></span>

* <span data-ttu-id="3f042-217">Aplikacja musi mieć możliwość pracy w trybie tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="3f042-217">Application must be able to operate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="3f042-218">W przypadku awarii usługi trwałe w regionie należy ręcznie uaktywnić trybu failover bazy danych i zaakceptować utraty danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-218">In case of a permanent service outage in the region, you manually activate database failover and accept the data loss.</span></span> <span data-ttu-id="3f042-219">Aplikacja będzie działała w regionie pomocniczym z dostępem do odczytu i zapisu do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3f042-219">The application will be functional in the secondary region with read-write access to the database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="3f042-220">Planowanie ciągłości biznesowej: Wybierz projekt aplikacji do chmury odzyskiwania po awarii</span><span class="sxs-lookup"><span data-stu-id="3f042-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="3f042-221">Strategię odzyskiwania po awarii określonej chmury można łączyć lub rozszerzyć te wzorce projektowe, aby najlepiej odpowiadać potrzebom aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3f042-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="3f042-222">Jak wspomniano wcześniej, strategii wybrane opiera się na umowie SLA chcesz zaoferować klientom i topologii wdrożenia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3f042-222">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="3f042-223">W celu ułatwienia decyzji w poniższej tabeli porównano opcje, w zależności od utraty danych szacowany lub odzyskiwania (RPO) cel punktu i szacowany czas odzyskiwania (Wstaw).</span><span class="sxs-lookup"><span data-stu-id="3f042-223">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="3f042-224">wzorzec</span><span class="sxs-lookup"><span data-stu-id="3f042-224">Pattern</span></span> | <span data-ttu-id="3f042-225">CEL PUNKTU ODZYSKIWANIA</span><span class="sxs-lookup"><span data-stu-id="3f042-225">RPO</span></span> | <span data-ttu-id="3f042-226">WSTAW</span><span class="sxs-lookup"><span data-stu-id="3f042-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="3f042-227">Aktywny / pasywny wdrożenia dla odzyskiwania po awarii z dostępem do tej samej lokalizacji bazy danych</span><span class="sxs-lookup"><span data-stu-id="3f042-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="3f042-228">Dostęp do odczytu zapisu < 5 s</span><span class="sxs-lookup"><span data-stu-id="3f042-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="3f042-229">Czas wykrywania awarii + czas wygaśnięcia DNS</span><span class="sxs-lookup"><span data-stu-id="3f042-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="3f042-230">Aktywny aktywny wdrożenia aplikacji Równoważenie obciążenia sieciowego</span><span class="sxs-lookup"><span data-stu-id="3f042-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="3f042-231">Dostęp do odczytu zapisu < 5 s</span><span class="sxs-lookup"><span data-stu-id="3f042-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="3f042-232">Czas wykrywania awarii + czas wygaśnięcia DNS</span><span class="sxs-lookup"><span data-stu-id="3f042-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="3f042-233">Aktywny / pasywny wdrożenia do przechowywania danych</span><span class="sxs-lookup"><span data-stu-id="3f042-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="3f042-234">Dostęp tylko do odczytu < 5 s</span><span class="sxs-lookup"><span data-stu-id="3f042-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="3f042-235">Dostęp tylko do odczytu = 0</span><span class="sxs-lookup"><span data-stu-id="3f042-235">Read-only access = 0</span></span> |
||<span data-ttu-id="3f042-236">Dostęp do odczytu zapisu = zero</span><span class="sxs-lookup"><span data-stu-id="3f042-236">Read-write access = zero</span></span> | <span data-ttu-id="3f042-237">Dostęp do odczytu zapisu = czas wykrycia błędu + okres prolongaty przy utracie danych</span><span class="sxs-lookup"><span data-stu-id="3f042-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="3f042-238">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="3f042-238">Next steps</span></span>
* <span data-ttu-id="3f042-239">Aby dowiedzieć się więcej na temat usługi Azure SQL bazy danych automatycznego tworzenia kopii zapasowych, zobacz [bazy danych SQL automatycznego tworzenia kopii zapasowych](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="3f042-239">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="3f042-240">Omówienie ciągłości działalności biznesowej i scenariuszy, zobacz [omówienie ciągłości działalności biznesowej](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="3f042-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="3f042-241">Aby dowiedzieć się więcej o używaniu kopie zapasowe automatycznego odzyskiwania, zobacz [przywrócić bazę danych z kopii zapasowych inicjowane przez usługę](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="3f042-241">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="3f042-242">Informacje na temat opcji odzyskiwania szybsze, zobacz [aktywna replikacja geograficzna](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="3f042-242">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="3f042-243">Aby dowiedzieć się, za pomocą automatycznych kopii zapasowej do archiwizacji, zobacz [kopiowanie bazy danych](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="3f042-243">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="3f042-244">Informacje aktywna replikacja geograficzna z pule elastyczne, zobacz [strategii odzyskiwania danych w puli elastycznej](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="3f042-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
