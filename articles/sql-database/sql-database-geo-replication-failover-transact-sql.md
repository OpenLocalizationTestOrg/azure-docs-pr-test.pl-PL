---
title: Baza danych SQL Azure w trybie failover TSQL:initiate | Dokumentacja firmy Microsoft
description: "Zainicjuj tryb failover planowane lub nieplanowane bazy danych SQL Azure przy użyciu języka Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="f98a7-103">Zainicjuj tryb failover planowane lub nieplanowane bazy danych SQL Azure z Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f98a7-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="f98a7-104">W tym artykule opisano sposób tooa pracy awaryjnej tooinitiate pomocniczej bazy danych SQL przy użyciu języka Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="f98a7-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="f98a7-105">tooconfigure replikacja geograficzna, zobacz [skonfigurować — replikacja geograficzna bazy danych SQL Azure](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="f98a7-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="f98a7-106">tooinitiate trybu failover, potrzebne są następujące hello:</span><span class="sxs-lookup"><span data-stu-id="f98a7-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="f98a7-107">Nazwy logowania, która jest dbmanager: na powitania podstawowego</span><span class="sxs-lookup"><span data-stu-id="f98a7-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="f98a7-108">Ma db_ownership lokalnej bazy danych hello że będzie replikacja geograficzna</span><span class="sxs-lookup"><span data-stu-id="f98a7-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="f98a7-109">Można na powitania partnera serwery toowhich dbmanager: Skonfiguruj — replikacja geograficzna</span><span class="sxs-lookup"><span data-stu-id="f98a7-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="f98a7-110">Najnowsza wersja programu SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="f98a7-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f98a7-111">Zalecane jest, aby zawsze używała hello najnowszej wersji programu Management Studio tooremain synchronizowane z tooMicrosoft aktualizacje, Azure i bazy danych SQL.</span><span class="sxs-lookup"><span data-stu-id="f98a7-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="f98a7-112">[Zaktualizuj program SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="f98a7-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="f98a7-113">Zainicjuj planowany tryb failover podwyższania poziomu nowego podstawowego hello toobecome dodatkowej bazy danych</span><span class="sxs-lookup"><span data-stu-id="f98a7-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="f98a7-114">Można użyć hello **ALTER DATABASE** toopromote instrukcji nowego podstawowego hello toobecome dodatkowej bazy danych bazy danych w sposób planowane obniżenie hello istniejącej głównej toobecome pomocniczego.</span><span class="sxs-lookup"><span data-stu-id="f98a7-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="f98a7-115">Ta instrukcja jest wykonywana na powitania głównej bazy danych na serwerze logicznym usługi Azure SQL Database hello hello, które znajdują się replikowane geograficznie pomocnicze bazy danych, która jest której poziom jest podwyższany.</span><span class="sxs-lookup"><span data-stu-id="f98a7-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="f98a7-116">Ta funkcja jest przeznaczona dla planowanego trybu failover, takie jak podczas ćwiczeń hello odzyskiwania po awarii i wymaga podstawowej bazy danych tej hello być niedostępne.</span><span class="sxs-lookup"><span data-stu-id="f98a7-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="f98a7-117">polecenie Hello wykonuje hello następującego przepływu pracy:</span><span class="sxs-lookup"><span data-stu-id="f98a7-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="f98a7-118">Tymczasowo tryb toosynchronous replikacji przełączników powoduje wszystkie transakcje oczekujące toobe opróżnionych pomocniczy toohello i blokuje wszystkie nowe transakcje;</span><span class="sxs-lookup"><span data-stu-id="f98a7-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="f98a7-119">Przełączniki hello ról hello dwóch baz danych w partnerstwie — replikacja geograficzna hello.</span><span class="sxs-lookup"><span data-stu-id="f98a7-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="f98a7-120">Ta sekwencja gwarantuje, że Witaj dwie bazy danych są synchronizowane, przed Przełącz role hello i w związku z tym nie dane zostaną utracone.</span><span class="sxs-lookup"><span data-stu-id="f98a7-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="f98a7-121">Istnieje krótki okres, podczas którego obie bazy danych są niedostępne (w kolejności hello 0 sekund too25) podczas przełączania hello ról.</span><span class="sxs-lookup"><span data-stu-id="f98a7-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="f98a7-122">Jeśli hello podstawowej bazy danych ma wiele baz danych w dodatkowej, polecenie hello zostanie automatycznie ponownej konfiguracji hello innych pomocniczych tooconnect toohello nową podstawową.</span><span class="sxs-lookup"><span data-stu-id="f98a7-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="f98a7-123">cała operacja Hello powinno zająć mniej niż minutę toocomplete w normalnych okolicznościach.</span><span class="sxs-lookup"><span data-stu-id="f98a7-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="f98a7-124">Aby uzyskać więcej informacji, zobacz [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) i [warstwy usług](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="f98a7-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="f98a7-125">Użyj hello następujące kroki tooinitiate planowany tryb failover.</span><span class="sxs-lookup"><span data-stu-id="f98a7-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="f98a7-126">W Management Studio Połącz z bazy danych SQL Azure serwera logicznego toohello, w której znajduje się pomocniczej bazy danych replikacją geograficzną.</span><span class="sxs-lookup"><span data-stu-id="f98a7-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="f98a7-127">Otwórz folder baz danych hello, rozwiń węzeł hello **systemowych baz danych** folderu, kliknij prawym przyciskiem myszy **wzorca**, a następnie kliknij przycisk **nowe zapytanie**.</span><span class="sxs-lookup"><span data-stu-id="f98a7-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="f98a7-128">Użyj następujących hello **ALTER DATABASE** instrukcji tooswitch hello dodatkowej bazy danych toohello podstawową rolą.</span><span class="sxs-lookup"><span data-stu-id="f98a7-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="f98a7-129">Kliknij przycisk **Execute** toorun hello zapytania.</span><span class="sxs-lookup"><span data-stu-id="f98a7-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="f98a7-130">W rzadkich przypadkach jest możliwe, że operacja hello nie może ukończyć i mogą być zablokowane.</span><span class="sxs-lookup"><span data-stu-id="f98a7-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="f98a7-131">W takim przypadku użytkownik hello można wykonać polecenie hello wymuszenia pracy awaryjnej i zaakceptować utraty danych.</span><span class="sxs-lookup"><span data-stu-id="f98a7-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="f98a7-132">Zainicjuj nieplanowanego trybu failover z dodatkowej bazy danych hello podstawowej bazy danych toohello</span><span class="sxs-lookup"><span data-stu-id="f98a7-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="f98a7-133">Można użyć hello **ALTER DATABASE** toopromote instrukcji nowego podstawowego hello toobecome dodatkowej bazy danych bazy danych w sposób nieplanowane wymuszania obniżania hello hello istniejącej głównej toobecome pomocniczego w czasie gdy hello Podstawowa baza danych nie jest już dostępny.</span><span class="sxs-lookup"><span data-stu-id="f98a7-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="f98a7-134">Ta instrukcja jest wykonywana na powitania głównej bazy danych na serwerze logicznym usługi Azure SQL Database hello hello, które znajdują się replikowane geograficznie pomocnicze bazy danych, która jest której poziom jest podwyższany.</span><span class="sxs-lookup"><span data-stu-id="f98a7-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="f98a7-135">Ta funkcja jest przeznaczona dla odzyskiwania po awarii podczas przywracania dostępność bazy danych hello jest szczególnie ważne i utratę danych jest akceptowany.</span><span class="sxs-lookup"><span data-stu-id="f98a7-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="f98a7-136">Po wywołaniu wymuszenia pracy awaryjnej hello określone dodatkowej bazy danych natychmiast staje się hello podstawowej bazy danych i rozpoczyna się akceptowanie transakcjach zapisu.</span><span class="sxs-lookup"><span data-stu-id="f98a7-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="f98a7-137">Jak hello oryginalnego podstawowej bazy danych jest możliwe tooreconnect z tej nowej podstawowej bazy danych, podjęto na powitania oryginalnego podstawowej bazy danych przyrostowej kopii zapasowej i hello starego podstawowej bazy danych odbywa się do pomocniczej bazy danych dla hello nowe podstawowej bazy danych; następnie jest jedynie Synchronizowanie replik hello nową podstawową.</span><span class="sxs-lookup"><span data-stu-id="f98a7-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="f98a7-138">Jednak ponieważ punktu w przywrócić czasu nie jest obsługiwany na powitania pomocniczej bazy danych, jeśli użytkownik hello żąda danych toorecover zatwierdzone toohello starego głównej bazy danych, która nie została replikowane toohello nowe podstawowej bazy danych przed wystąpieniem hello wymuszone trybu failover, Witaj użytkownik będzie musiał toorecover Obsługa tooengage to utraty danych.</span><span class="sxs-lookup"><span data-stu-id="f98a7-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="f98a7-139">Jeśli hello podstawowej bazy danych ma wiele baz danych w dodatkowej, polecenie hello zostanie automatycznie ponownej konfiguracji hello innych pomocniczych tooconnect toohello nową podstawową.</span><span class="sxs-lookup"><span data-stu-id="f98a7-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="f98a7-140">Użyj hello następujące kroki tooinitiate nieplanowany tryb failover.</span><span class="sxs-lookup"><span data-stu-id="f98a7-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="f98a7-141">W Management Studio Połącz z bazy danych SQL Azure serwera logicznego toohello, w której znajduje się pomocniczej bazy danych replikacją geograficzną.</span><span class="sxs-lookup"><span data-stu-id="f98a7-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="f98a7-142">Otwórz folder baz danych hello, rozwiń węzeł hello **systemowych baz danych** folderu, kliknij prawym przyciskiem myszy **wzorca**, a następnie kliknij przycisk **nowe zapytanie**.</span><span class="sxs-lookup"><span data-stu-id="f98a7-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="f98a7-143">Użyj następujących hello **ALTER DATABASE** instrukcji tooswitch hello dodatkowej bazy danych toohello podstawową rolą.</span><span class="sxs-lookup"><span data-stu-id="f98a7-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="f98a7-144">Kliknij przycisk **Execute** toorun hello zapytania.</span><span class="sxs-lookup"><span data-stu-id="f98a7-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="f98a7-145">Gdy zarówno podstawowy, jak i pomocniczy są w trybie online wydano polecenie hello hello stary serwer podstawowy staną się hello nowym serwerem pomocniczym natychmiast bez synchronizacji danych.</span><span class="sxs-lookup"><span data-stu-id="f98a7-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="f98a7-146">Jeśli podstawowy hello jest przekazywanie transakcji po wydaniu polecenia hello utratę danych mogą wystąpić.</span><span class="sxs-lookup"><span data-stu-id="f98a7-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="f98a7-147">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="f98a7-147">Next steps</span></span>
* <span data-ttu-id="f98a7-148">Po przejściu w tryb failover upewnij się, że hello wymagania dotyczące uwierzytelniania dla serwera i bazy danych są skonfigurowane na powitania nową podstawową.</span><span class="sxs-lookup"><span data-stu-id="f98a7-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="f98a7-149">Aby uzyskać więcej informacji, zobacz [zabezpieczeń bazy danych SQL po awarii](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="f98a7-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="f98a7-150">Zobacz toolearn odzyskiwanie po awarii przy użyciu aktywna replikacja geograficzna, w tym kroki odzyskiwania przed i po odzyskaniu i przejściem do szczegółów odzyskiwania po awarii [odzyskiwania po awarii](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="f98a7-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="f98a7-151">W blogu Sasha Nosov temat aktywnej replikacji geograficznej w temacie [uwagi na nowe możliwości replikacja geograficzna](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="f98a7-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="f98a7-152">Informacje o projektowaniu chmury aplikacji toouse aktywna replikacja geograficzna, zobacz [projektowanie aplikacji w chmurze dla ciągłości przy użyciu — replikacja geograficzna](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="f98a7-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="f98a7-153">Aby uzyskać informacji o korzystaniu z pul elastycznych aktywna replikacja geograficzna, zobacz [strategii odzyskiwania danych w puli elastycznej](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="f98a7-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="f98a7-154">Omówienie ciągłości działalności biznesowej, zobacz [omówienie ciągłości działalności biznesowej](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="f98a7-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

