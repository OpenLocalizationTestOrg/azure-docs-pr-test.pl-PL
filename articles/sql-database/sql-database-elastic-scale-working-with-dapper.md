---
title: Biblioteka klienta elastycznej bazy danych aaaUsing Dapper | Dokumentacja firmy Microsoft
description: "Za pomocą biblioteki klienta elastycznej bazy danych z Dapper."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="14680-103">Korzystanie z biblioteki klienta elastycznej bazy danych z Dapper</span><span class="sxs-lookup"><span data-stu-id="14680-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="14680-104">Ten dokument jest przeznaczony dla deweloperów, które zależą od Dapper toobuild aplikacji, ale również mają tooembrace [narzędzi elastycznej bazy danych](sql-database-elastic-scale-introduction.md) toocreate aplikacji, które implementuje wychodzący tooscale dzielenia na fragmenty ich warstwy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="14680-105">Ten dokument przedstawia hello zmian w aplikacjach opartych na Dapper, które są niezbędne toointegrate z narzędzi elastycznej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="14680-106">Skupiliśmy się na tworzenie hello elastycznej bazy danych niezależnych zarządzania i zależne od danych routingu z Dapper.</span><span class="sxs-lookup"><span data-stu-id="14680-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="14680-107">**Przykładowy kod**: [narzędzi elastycznej bazy danych dla usługi Azure SQL Database — integracja Dapper](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="14680-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="14680-108">Integrowanie **Dapper** i **DapperExtensions** z hello jest łatwe biblioteki klienta elastycznej bazy danych dla bazy danych SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="14680-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="14680-109">Aplikacje można użyć danych zależnych routingu przez zmianę hello tworzenia i otwierania nowych [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello toouse obiektów [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) wywoływać z hello [klienta Biblioteka](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="14680-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="14680-110">Ogranicza to zmiany w Twojej aplikacji tooonly, gdzie utworzony i otworzyć nowe połączenia.</span><span class="sxs-lookup"><span data-stu-id="14680-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="14680-111">Dapper — omówienie</span><span class="sxs-lookup"><span data-stu-id="14680-111">Dapper overview</span></span>
<span data-ttu-id="14680-112">**Dapper** jest mapowania obiektów relacyjnych.</span><span class="sxs-lookup"><span data-stu-id="14680-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="14680-113">Mapuje obiekty .NET z Twojej aplikacji tooa relacyjnej bazy danych (i na odwrót).</span><span class="sxs-lookup"><span data-stu-id="14680-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="14680-114">Hello pierwsza część hello przykładowy kod przedstawia sposób integrowania biblioteki klienta elastycznej bazy danych hello z aplikacji opartych na Dapper.</span><span class="sxs-lookup"><span data-stu-id="14680-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="14680-115">Witaj drugiej części hello przykładowy kod przedstawia sposób toointegrate podczas używania zarówno Dapper i DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="14680-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="14680-116">funkcje mapowania Hello w Dapper udostępnia metody rozszerzenia na połączenia z bazą danych, które upraszczają przesyłanie instrukcje T-SQL do wykonania lub podczas badania hello bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="14680-117">Na przykład Dapper umożliwia łatwe toomap między obiekty .NET i hello parametry instrukcji SQL dla **Execute** wywołania lub tooconsume hello wyników zapytań SQL na obiekty .NET przy użyciu **zapytania**wywołania z Dapper.</span><span class="sxs-lookup"><span data-stu-id="14680-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="14680-118">Korzystając z DapperExtensions, nie są już potrzebne instrukcje SQL hello tooprovide.</span><span class="sxs-lookup"><span data-stu-id="14680-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="14680-119">Metody rozszerzenia, takie jak **GetList** lub **Wstaw** za pośrednictwem połączenia z bazą danych hello utworzyć hello tle hello instrukcje SQL.</span><span class="sxs-lookup"><span data-stu-id="14680-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="14680-120">Kolejną zaletą Dapper, a także DapperExtensions jest, że formanty aplikacji hello hello tworzenia hello połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="14680-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="14680-121">Dzięki temu interakcyjnie hello biblioteki klienta elastycznej bazy danych, która brokerzy przez połączenia na podstawie mapowania hello z shardlets toodatabases bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="14680-122">Zobacz tooget hello Dapper zestawy [Dapper kropka net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="14680-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="14680-123">Witaj Dapper rozszerzeń, zobacz [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="14680-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="14680-124">Krótki przegląd biblioteki klienta elastycznej bazy danych hello</span><span class="sxs-lookup"><span data-stu-id="14680-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="14680-125">Z biblioteki klienta elastycznej bazy danych hello, zdefiniuj partycje danych aplikacji o nazwie *shardlets* zamapowania ich toodatabases i identyfikację przez *klucze dzielenia na fragmenty*.</span><span class="sxs-lookup"><span data-stu-id="14680-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="14680-126">Może mieć dowolną liczbę baz danych i rozpowszechniają shardlets z tych baz danych.</span><span class="sxs-lookup"><span data-stu-id="14680-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="14680-127">Mapowanie Hello baz danych toohello wartości klucza dzielenia na fragmenty jest przechowywany przez mapy niezależnego fragmentu podał hello biblioteki interfejsów API.</span><span class="sxs-lookup"><span data-stu-id="14680-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="14680-128">Ta funkcja jest wywoływana **zarządzania mapy niezależnego fragmentu**.</span><span class="sxs-lookup"><span data-stu-id="14680-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="14680-129">Mapa niezależnego fragmentu Hello służy również jako hello brokera połączeń z bazą danych dla żądań zawierających klucz dzielenia na fragmenty.</span><span class="sxs-lookup"><span data-stu-id="14680-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="14680-130">Ta funkcja jest określony tooas **danych zależnych routingu**.</span><span class="sxs-lookup"><span data-stu-id="14680-130">This capability is referred tooas **data dependent routing**.</span></span>

![Mapy niezależnego fragmentu i danych zależnych routingu][1]

<span data-ttu-id="14680-132">Menedżera map niezależnego fragmentu Hello chroni użytkowników z widoków niespójne w shardlet dane, które mogą wystąpić, gdy shardlet równoczesnych operacji zarządzania są wykonywane na powitania baz danych.</span><span class="sxs-lookup"><span data-stu-id="14680-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="14680-133">toodo Witaj, niezależnych mapy brokera hello połączenia bazy danych dla aplikacji skompilowanej za pomocą biblioteki hello.</span><span class="sxs-lookup"><span data-stu-id="14680-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="14680-134">Operacje zarządzania niezależnego fragmentu może mieć wpływ na powitania shardlet, umożliwia hello niezależnego fragmentu mapy funkcji tooautomatically kill połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="14680-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="14680-135">Zamiast przy użyciu połączenia toocreate tradycyjny sposób hello Dapper, potrzebujemy toouse hello [metody OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="14680-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="14680-136">Dzięki temu wszystkie hello weryfikacji ma miejsce a połączenia są zarządzane prawidłowo, gdy wszystkie dane są przenoszone między fragmentów.</span><span class="sxs-lookup"><span data-stu-id="14680-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="14680-137">Wymagania dotyczące integracji Dapper</span><span class="sxs-lookup"><span data-stu-id="14680-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="14680-138">Podczas pracy z biblioteki klienta elastycznej bazy danych hello i hello Dapper interfejsów API, chcemy hello tooretain następujące właściwości:</span><span class="sxs-lookup"><span data-stu-id="14680-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="14680-139">**Skalowania**: Firma Microsoft ma tooadd lub usunąć bazy danych z warstwy danych hello podzielonej aplikacji hello odpowiednio do potrzeb pojemności hello aplikacji hello.</span><span class="sxs-lookup"><span data-stu-id="14680-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="14680-140">**Spójność**: ponieważ naszej aplikacji jest skalowana w poziomie przy użyciu dzielenia na fragmenty, potrzebujemy tooperform danych zależnych routingu.</span><span class="sxs-lookup"><span data-stu-id="14680-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="14680-141">Dlatego chcemy toouse hello danych zależnych routingu możliwości hello toodo biblioteki.</span><span class="sxs-lookup"><span data-stu-id="14680-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="14680-142">W szczególności chcemy tooretain hello weryfikacji i spójność gwarantuje podał połączeń, które są obsługiwane przez brokera za pośrednictwem Menedżera mapy niezależnego fragmentu hello w kolejności tooavoid uszkodzenie lub wyników zapytania niewłaściwy.</span><span class="sxs-lookup"><span data-stu-id="14680-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="14680-143">Dzięki temu tooa tego połączenia, podane shardlet są odrzucone lub zatrzymana, jeśli (na przykład) hello shardlet jest obecnie przeniesionego tooa inny identyfikator niezależnego fragmentu przy użyciu interfejsów API podziału/Merge.</span><span class="sxs-lookup"><span data-stu-id="14680-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="14680-144">**Mapowanie obiektu**: chcemy wygody hello tooretain mapowań hello dostarczonych przez Dapper tootranslate między klasami w aplikacji hello i hello podstawowej struktury bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="14680-145">Hello Poniższa sekcja zawiera wskazówki dotyczące tych wymagań aplikacji na podstawie **Dapper** i **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="14680-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="14680-146">Wskazówki techniczne</span><span class="sxs-lookup"><span data-stu-id="14680-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="14680-147">Zależne od, routing z Dapper danych</span><span class="sxs-lookup"><span data-stu-id="14680-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="14680-148">Z Dapper aplikacja hello jest zazwyczaj odpowiedzialny za tworzenie i otwieranie toohello połączeń hello podstawowej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="14680-149">Określony typ T aplikacja hello, Dapper zwraca wyniki zapytania kolekcji .NET typu T. Dapper wykonuje mapowanie hello z obiektów wynikowych T-SQL hello toohello wierszy typu T. Podobnie Dapper mapuje obiekty .NET do wartości SQL lub parametrów dla instrukcji języka manipulacji danych.</span><span class="sxs-lookup"><span data-stu-id="14680-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="14680-150">Dapper oferuje tę funkcję za pomocą metod rozszerzenia na powitania regularne [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) obiektu z powitania klienta SQL ADO .NET bibliotek.</span><span class="sxs-lookup"><span data-stu-id="14680-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="14680-151">Hello połączenie SQL zwrócony przez hello interfejsy API elastycznego skalowania dla DDR są także regularne [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) obiektów.</span><span class="sxs-lookup"><span data-stu-id="14680-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="14680-152">Dzięki temu nam rozszerzenia Dapper Użyj toodirectly za pośrednictwem hello zwrócone przez interfejs API DDR powitania klienta biblioteki, jak również jest proste połączenia klienta SQL.</span><span class="sxs-lookup"><span data-stu-id="14680-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="14680-153">Uwagi te umożliwiają połączeń bezpośrednich toouse przez biblioteki klienta elastycznej bazy danych hello obsługiwanych przez brokera dla Dapper.</span><span class="sxs-lookup"><span data-stu-id="14680-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="14680-154">W tym przykładzie kodu (od hello towarzyszące przykładowe) przedstawiono podejście hello gdzie hello dzielenia na fragmenty klucz jest dostarczany przez hello aplikacji toohello biblioteki toobroker hello połączenia toohello prawo niezależnego fragmentu.</span><span class="sxs-lookup"><span data-stu-id="14680-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="14680-155">Witaj wywołania toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) interfejsu API zastępuje hello domyślnego tworzenia i otwierania połączenia klienta SQL.</span><span class="sxs-lookup"><span data-stu-id="14680-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="14680-156">Witaj [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) wywołania przyjmuje hello argumenty, które są wymagane dla danych zależnych routingu:</span><span class="sxs-lookup"><span data-stu-id="14680-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="14680-157">Witaj niezależnego fragmentu mapy tooaccess hello zależnych interfejsów routingu danych</span><span class="sxs-lookup"><span data-stu-id="14680-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="14680-158">Witaj shardlet hello klucza tooidentify dzielenia na fragmenty</span><span class="sxs-lookup"><span data-stu-id="14680-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="14680-159">Witaj poświadczeń (nazwy użytkownika i hasło) tooconnect toohello niezależnych</span><span class="sxs-lookup"><span data-stu-id="14680-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="14680-160">Obiekt mapy niezależnego fragmentu Hello tworzy niezależnych toohello połączenie, zawierający hello shardlet dla hello podany klucz dzielenia na fragmenty.</span><span class="sxs-lookup"><span data-stu-id="14680-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="14680-161">interfejsów API klienta elastycznej bazy danych Hello tagu również hello tooimplement połączenia, który jego spójność gwarantuje.</span><span class="sxs-lookup"><span data-stu-id="14680-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="14680-162">Od hello wywołać zbyt[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) zwraca regularne obiektu połączenia klienta SQL, hello kolejne wywołanie toohello **Execute** — metoda rozszerzenia z Dapper następujące hello Dapper standardowe praktyki.</span><span class="sxs-lookup"><span data-stu-id="14680-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="14680-163">Zapytania pracy znacznie Witaj sam sposób - pierwszym otwarciu hello połączenia za pomocą [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) z powitania klienta interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="14680-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="14680-164">Następnie można użyć hello standardowego rozszerzenia Dapper metody toomap hello wyników kwerendy SQL na obiekty .NET:</span><span class="sxs-lookup"><span data-stu-id="14680-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="14680-165">Należy pamiętać, że hello **przy użyciu** zablokować z zakresami połączenia DDR hello wszystkie operacje bazy danych w ramach hello bloku toohello jeden identyfikator niezależnego fragmentu tam tenantId1 jest przechowywana.</span><span class="sxs-lookup"><span data-stu-id="14680-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="14680-166">Witaj zapytanie zwraca tylko blogi przechowywane na powitania bieżący identyfikator niezależnego fragmentu, ale hello te przechowywane na dowolnej liczbie fragmentów.</span><span class="sxs-lookup"><span data-stu-id="14680-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="14680-167">Zależne od, routing Dapper i DapperExtensions danych</span><span class="sxs-lookup"><span data-stu-id="14680-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="14680-168">Dapper pochodzi z ekosystemem dodatkowe rozszerzenia, które udostępniają dalsze zwiększenie wygody działania i abstrakcji z hello bazy danych podczas opracowywania aplikacji bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14680-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="14680-169">Przykładem jest DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="14680-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="14680-170">W aplikacji przy użyciu DapperExtensions nie zmienia sposób połączenia bazy danych są tworzone i zarządzane.</span><span class="sxs-lookup"><span data-stu-id="14680-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="14680-171">Nadal jest aplikacji hello odpowiedzialność tooopen połączeń, a regularne obiekty połączenia klienta SQL są oczekiwane przez metody rozszerzenia hello.</span><span class="sxs-lookup"><span data-stu-id="14680-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="14680-172">Firma Microsoft może polegać na powitania [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) w sposób opisany powyżej.</span><span class="sxs-lookup"><span data-stu-id="14680-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="14680-173">Jako hello następujące przykłady kodu Pokaż, hello jedyna różnica polega na to, że nie mamy już toowrite instrukcje hello T-SQL:</span><span class="sxs-lookup"><span data-stu-id="14680-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="14680-174">A Oto przykładowy kod hello hello kwerendy:</span><span class="sxs-lookup"><span data-stu-id="14680-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="14680-175">Obsługa błędów przejściowych</span><span class="sxs-lookup"><span data-stu-id="14680-175">Handling transient faults</span></span>
<span data-ttu-id="14680-176">Witaj Microsoft Patterns & rozwiązania zespołu opublikowanych hello [bloku aplikacji obsługi błędów przejściowych](http://msdn.microsoft.com/library/hh680934.aspx) deweloperzy aplikacji toohelp ograniczenia typowe warunki wystąpienia błędu przejściowego napotkała podczas uruchamiania w chmurze hello.</span><span class="sxs-lookup"><span data-stu-id="14680-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="14680-177">Aby uzyskać więcej informacji, zobacz [Perseverance, klucz tajny wszystkie sukcesy: przy użyciu hello bloku aplikacji obsługi błędów przejściowych](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="14680-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="14680-178">Przykładowy kod Hello polega na powitania błędu przejściowego biblioteki tooprotect przed błędów przejściowych.</span><span class="sxs-lookup"><span data-stu-id="14680-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="14680-179">**SqlDatabaseUtils.SqlRetryPolicy** w hello powyższy kod jest zdefiniowany jako **SqlDatabaseTransientErrorDetectionStrategy** z liczbą ponowień równą 10 i 5 sekund oczekiwania czasu między kolejnymi próbami.</span><span class="sxs-lookup"><span data-stu-id="14680-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="14680-180">Jeśli używane są transakcje, upewnij się, ponów próbę zakresu Przechodzi wstecz toohello rozpoczęciem powitalne transakcji w przypadku wystąpienia błędu przejściowego hello.</span><span class="sxs-lookup"><span data-stu-id="14680-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="14680-181">Ograniczenia</span><span class="sxs-lookup"><span data-stu-id="14680-181">Limitations</span></span>
<span data-ttu-id="14680-182">Witaj metod opisanych w tym dokumencie pociąga za sobą kilka ograniczeń:</span><span class="sxs-lookup"><span data-stu-id="14680-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="14680-183">Witaj przykładowy kod dla tego dokumentu nie pokazują, jak schematu toomanage między fragmentów.</span><span class="sxs-lookup"><span data-stu-id="14680-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="14680-184">Biorąc pod uwagę na żądanie, przyjęto założenie, że jego przetwarzanie bazy danych znajduje się w obrębie jednego niezależnego fragmentu określonej za pomocą klucza dzielenia na fragmenty hello dostarczonego przez Żądanie hello.</span><span class="sxs-lookup"><span data-stu-id="14680-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="14680-185">Jednak to założenie nie zawsze przechowuje, na przykład, gdy nie jest możliwe toomake dostępne klucz dzielenia na fragmenty.</span><span class="sxs-lookup"><span data-stu-id="14680-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="14680-186">tooaddress tego hello biblioteki klienta elastycznej bazy danych obejmuje hello [MultiShardQuery klasy](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="14680-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="14680-187">Klasa Hello implementuje abstrakcji połączenia, na potrzeby zapytań przez kilka fragmentów.</span><span class="sxs-lookup"><span data-stu-id="14680-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="14680-188">Przy użyciu MultiShardQuery w połączeniu z Dapper wykracza poza zakres tego dokumentu hello.</span><span class="sxs-lookup"><span data-stu-id="14680-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="14680-189">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="14680-189">Conclusion</span></span>
<span data-ttu-id="14680-190">Aplikacji przy użyciu Dapper i DapperExtensions można łatwo korzystać z narzędzi elastycznej bazy danych dla bazy danych SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="14680-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="14680-191">Hello kroków opisanych w tym dokumencie, tych aplikacji można użyć narzędzia hello możliwości zależnych routingu przez zmianę hello tworzenia i otwierania nowych danych [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello toouse obiektów [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) wywołania biblioteki klienta elastycznej bazy danych hello.</span><span class="sxs-lookup"><span data-stu-id="14680-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="14680-192">To ogranicza hello aplikacji zmiany wymagane toothose miejsca gdzie utworzony i otworzyć nowe połączenia.</span><span class="sxs-lookup"><span data-stu-id="14680-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
