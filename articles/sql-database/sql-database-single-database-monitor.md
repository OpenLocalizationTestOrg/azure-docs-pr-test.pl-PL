---
title: "Monitorowanie wydajności bazy danych w usłudze Azure SQL Database | Microsoft Docs"
description: "Poznaj opcje monitorowania bazy danych za pomocą narzędzi Azure i dynamicznych widoków zarządzania."
keywords: "monitorowanie bazy danych, wydajność bazy danych w chmurze"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: e11ed3275413b428523eef78a5a89b537f6a4afc
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="f88a8-104">Monitorowanie wydajności bazy danych w usłudze Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="f88a8-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="f88a8-105">Monitorowanie wydajności bazy danych SQL na platformie Azure rozpoczyna się od monitorowania wykorzystania zasobów względem wybranego poziomu wydajności bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-105">Monitoring the performance of a SQL database in Azure starts with monitoring the resource utilization relative to the level of database performance you choose.</span></span> <span data-ttu-id="f88a8-106">Monitorowanie pomaga ustalić, czy baza danych nie ma nadmiarowej pojemności lub czy nie występują problemy z powodu maksymalnego wykorzystania zasobów. Następnie na tej podstawie można zdecydować, czy nadszedł czas, aby dostosować poziom wydajności i [warstwę usług](sql-database-service-tiers.md) bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time to adjust the performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="f88a8-107">Bazę danych można monitorować za pomocą narzędzi graficznych w [witrynie Azure Portal](https://portal.azure.com) lub przy użyciu [dynamicznych widoków zarządzania](https://msdn.microsoft.com/library/ms188754.aspx) SQL.</span><span class="sxs-lookup"><span data-stu-id="f88a8-107">You can monitor your database using graphical tools in the [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-the-azure-portal"></a><span data-ttu-id="f88a8-108">Monitorowanie baz danych za pomocą witryny Azure Portal</span><span class="sxs-lookup"><span data-stu-id="f88a8-108">Monitor databases using the Azure portal</span></span>
<span data-ttu-id="f88a8-109">W witrynie [Azure Portal](https://portal.azure.com/) możesz wybrać bazę danych i kliknąć wykres **Monitorowanie**, aby monitorować wykorzystanie pojedynczej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-109">In the [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking the **Monitoring** chart.</span></span> <span data-ttu-id="f88a8-110">Spowoduje to wyświetlenie okna **Metryka**, które możesz zmienić, klikając przycisk **Edytuj wykres**.</span><span class="sxs-lookup"><span data-stu-id="f88a8-110">This brings up a **Metric** window that you can change by clicking the **Edit chart** button.</span></span> <span data-ttu-id="f88a8-111">Dodaj następujące metryki:</span><span class="sxs-lookup"><span data-stu-id="f88a8-111">Add the following metrics:</span></span>

* <span data-ttu-id="f88a8-112">Procent użycia procesora CPU</span><span class="sxs-lookup"><span data-stu-id="f88a8-112">CPU percentage</span></span>
* <span data-ttu-id="f88a8-113">Procent użycia jednostek DTU</span><span class="sxs-lookup"><span data-stu-id="f88a8-113">DTU percentage</span></span>
* <span data-ttu-id="f88a8-114">Procent użycia operacji we/wy na danych</span><span class="sxs-lookup"><span data-stu-id="f88a8-114">Data IO percentage</span></span>
* <span data-ttu-id="f88a8-115">Procent użycia rozmiaru bazy danych</span><span class="sxs-lookup"><span data-stu-id="f88a8-115">Database size percentage</span></span>

<span data-ttu-id="f88a8-116">Po dodaniu tych metryk możesz nadal przeglądać je na wykresie **Monitorowanie** z bardziej szczegółowymi informacjami w oknie **Metryka**.</span><span class="sxs-lookup"><span data-stu-id="f88a8-116">Once you’ve added these metrics, you can continue to view them in the **Monitoring** chart with more details on the **Metric** window.</span></span> <span data-ttu-id="f88a8-117">Wszystkie cztery metryki pokazują średnią wartość procentową wykorzystania względem jednostek **DTU** bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-117">All four metrics show the average utilization percentage relative to the **DTU** of your database.</span></span> <span data-ttu-id="f88a8-118">Zobacz artykuł o [usługach warstw](sql-database-service-tiers.md), aby dowiedzieć się więcej na temat jednostek DTU.</span><span class="sxs-lookup"><span data-stu-id="f88a8-118">See the [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Monitorowanie warstw usług pod względem wydajności bazy danych.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="f88a8-120">Możesz również skonfigurować alerty dotyczące metryk wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-120">You can also configure alerts on the performance metrics.</span></span> <span data-ttu-id="f88a8-121">Kliknij przycisk **Dodaj alert** w oknie **Metryka**.</span><span class="sxs-lookup"><span data-stu-id="f88a8-121">Click the **Add alert** button in the **Metric** window.</span></span> <span data-ttu-id="f88a8-122">Użyj kreatora, aby skonfigurować alert.</span><span class="sxs-lookup"><span data-stu-id="f88a8-122">Follow the wizard to configure your alert.</span></span> <span data-ttu-id="f88a8-123">Istnieje możliwość ustawienia alertu, który będzie wysyłany, gdy metryki przekroczą określony próg lub spadną poniżej określonego progu.</span><span class="sxs-lookup"><span data-stu-id="f88a8-123">You have the option to alert if the metrics exceed a certain threshold or if the metric falls below a certain threshold.</span></span>

<span data-ttu-id="f88a8-124">Jeśli na przykład spodziewasz się, że obciążenie bazy danych wzrośnie, możesz skonfigurować alert polegający na wysłaniu wiadomości e-mail, gdy dowolna z metryk wydajności osiągnie 80%.</span><span class="sxs-lookup"><span data-stu-id="f88a8-124">For example, if you expect the workload on your database to grow, you can choose to configure an email alert whenever your database reaches 80% on any of the performance metrics.</span></span> <span data-ttu-id="f88a8-125">To wczesne ostrzeżenie jest przydatne, ponieważ pozwala zorientować się, kiedy warto zmienić poziom wydajności na kolejny, wyższy.</span><span class="sxs-lookup"><span data-stu-id="f88a8-125">You can use this as an early warning to figure out when you might have to switch to the next higher performance level.</span></span>

<span data-ttu-id="f88a8-126">Metryki wydajności mogą także pomóc określić, czy można obniżyć poziom wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-126">The performance metrics can also help you determine if you are able to downgrade to a lower performance level.</span></span> <span data-ttu-id="f88a8-127">Załóżmy, że używasz bazy danych, której warstwa i poziom to Standardowa S2, a wszystkie metryki wydajności pokazują, że baza danych wykorzystuje średnio nie więcej niż 10% w określonym czasie.</span><span class="sxs-lookup"><span data-stu-id="f88a8-127">Assume you are using a Standard S2 database and all performance metrics show that the database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="f88a8-128">Istnieje prawdopodobieństwo, że baza danych będzie działać równie dobrze na poziomie Standardowa S1.</span><span class="sxs-lookup"><span data-stu-id="f88a8-128">It is likely that the database will work well in Standard S1.</span></span> <span data-ttu-id="f88a8-129">Przed podjęciem decyzji o przeniesieniu na poziom o mniejszej wydajności należy jednak pamiętać o obciążeniach, które chwilowo wzrastają lub zmieniają się w czasie.</span><span class="sxs-lookup"><span data-stu-id="f88a8-129">However, be aware of workloads that spike or fluctuate before making the decision to move to a lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="f88a8-130">Monitorowanie baz danych przy użyciu widoków DMV</span><span class="sxs-lookup"><span data-stu-id="f88a8-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="f88a8-131">Te same metryki, które są przedstawiane w portalu, są również dostępne za pośrednictwem widoków systemowych: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) w logicznej bazie danych **master** na serwerze oraz [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) w bazie danych użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f88a8-131">The same metrics that are exposed in the portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in the logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in the user database.</span></span> <span data-ttu-id="f88a8-132">Użyj widoku **sys.resource_stats**, jeśli chcesz monitorować mniej szczegółowe dane przez dłuższy okres.</span><span class="sxs-lookup"><span data-stu-id="f88a8-132">Use **sys.resource_stats** if you need to monitor less granular data across a longer period of time.</span></span> <span data-ttu-id="f88a8-133">Użyj widoku **sys.dm_db_resource_stats**, jeśli chcesz monitorować bardziej szczegółowe dane w mniejszych odcinkach czasu.</span><span class="sxs-lookup"><span data-stu-id="f88a8-133">Use **sys.dm_db_resource_stats** if you need to monitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="f88a8-134">Aby uzyskać więcej informacji, zobacz [wytyczne dotyczące wydajności usługi Azure SQL Database](sql-database-single-database-monitor.md#monitor-resource-use)</span><span class="sxs-lookup"><span data-stu-id="f88a8-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="f88a8-135">Widok **sys.dm_db_resource_stats** zwraca pusty zestaw wyników w przypadku używania baz danych w wersjach Web i Business, które zostały wycofane.</span><span class="sxs-lookup"><span data-stu-id="f88a8-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="f88a8-136">Monitorowanie użycia zasobów</span><span class="sxs-lookup"><span data-stu-id="f88a8-136">Monitor resource use</span></span>

<span data-ttu-id="f88a8-137">Można monitorować przy użyciu użycia zasobów [Insight wydajności kwerendy bazy danych SQL](sql-database-query-performance.md) i [magazyn zapytań](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="f88a8-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="f88a8-138">Można również monitorować za pomocą tych dwóch widoków użycia:</span><span class="sxs-lookup"><span data-stu-id="f88a8-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="f88a8-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="f88a8-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="f88a8-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="f88a8-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="f88a8-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="f88a8-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="f88a8-142">Można użyć [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) widoku w każdej bazie danych SQL.</span><span class="sxs-lookup"><span data-stu-id="f88a8-142">You can use the [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="f88a8-143">**Sys.dm_db_resource_stats** widok przedstawia dane wykorzystania zasobów względem warstwy usług.</span><span class="sxs-lookup"><span data-stu-id="f88a8-143">The **sys.dm_db_resource_stats** view shows recent resource use data relative to the service tier.</span></span> <span data-ttu-id="f88a8-144">Średni procent dla procesora CPU, dane We/Wy zapisu dziennika i pamięci są rejestrowane co 15 sekund i mają być przechowywane przez godzinę.</span><span class="sxs-lookup"><span data-stu-id="f88a8-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="f88a8-145">Ponieważ ten widok udostępnia szczegółowe przyjrzeć się wykorzystania zasobów, użyj **sys.dm_db_resource_stats** pierwszego dla analizy bieżący stan lub rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="f88a8-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="f88a8-146">Na przykład to zapytanie wyświetla wykorzystanie zasobów średnia i maksymalna w bieżącej bazie danych za pośrednictwem ostatniej godziny:</span><span class="sxs-lookup"><span data-stu-id="f88a8-146">For example, this query shows the average and maximum resource use for the current database over the past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="f88a8-147">Dla innych zapytań, zobacz przykłady w [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="f88a8-147">For other queries, see the examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="f88a8-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="f88a8-148">sys.resource_stats</span></span>
<span data-ttu-id="f88a8-149">[Sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) wyświetlić w **wzorca** bazy danych zawiera dodatkowe informacje, które pomaga monitorować wydajność bazy danych SQL na poziomie warstwy i wydajności określonej usługi.</span><span class="sxs-lookup"><span data-stu-id="f88a8-149">The [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in the **master** database has additional information that can help you monitor the performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="f88a8-150">Dane są zbierane co 5 minut i jest zachowywana na potrzeby około 35 dni.</span><span class="sxs-lookup"><span data-stu-id="f88a8-150">The data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="f88a8-151">Ten widok jest przydatna do długoterminowego historycznej analizy używaniu zasobów bazy danych SQL.</span><span class="sxs-lookup"><span data-stu-id="f88a8-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="f88a8-152">Wykres ukazuje Procesora wykorzystanie zasobów dla bazy danych — warstwa Premium P2 poziom wydajności dla każdej godziny w tygodniu.</span><span class="sxs-lookup"><span data-stu-id="f88a8-152">The following graph shows the CPU resource use for a Premium database with the P2 performance level for each hour in a week.</span></span> <span data-ttu-id="f88a8-153">Ten wykres rozpoczyna się w poniedziałek, pokazuje 5 dni roboczych i następnie przedstawiono weekendy, w przypadku znacznie mniej w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f88a8-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on the application.</span></span>

![Wykorzystanie zasobów bazy danych SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="f88a8-155">Z danych, ta baza danych ma obecnie szczytowego obciążenia procesora CPU około 50 procent użycia Procesora względem P2 poziom wydajności (południe wtorek).</span><span class="sxs-lookup"><span data-stu-id="f88a8-155">From the data, this database currently has a peak CPU load of just over 50 percent CPU use relative to the P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="f88a8-156">Jeśli procesora CPU jest współczynnik dominującą w aplikacji profilu zasobu, można zdecydować, czy P2 jest poziom wydajności prawo, aby zagwarantować, że obciążenie zawsze pasuje do.</span><span class="sxs-lookup"><span data-stu-id="f88a8-156">If CPU is the dominant factor in the application’s resource profile, then you might decide that P2 is the right performance level to guarantee that the workload always fits.</span></span> <span data-ttu-id="f88a8-157">Jeśli aplikacja wraz z upływem czasu, jest warto mieć bufor dodatkowych zasobów, tak aby aplikacja nigdy nie osiągnie limit poziom wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-157">If you expect an application to grow over time, it's a good idea to have an extra resource buffer so that the application doesn't ever reach the performance-level limit.</span></span> <span data-ttu-id="f88a8-158">Jeśli możesz zwiększyć poziom wydajności, możesz pomóc uniknąć błędów widoczne klienta, które mogą wystąpić, gdy baza danych nie ma wystarczająco dużo mocy do przetwarzania żądań skutecznie, szczególnie w środowiskach wrażliwy na opóźnienia.</span><span class="sxs-lookup"><span data-stu-id="f88a8-158">If you increase the performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power to process requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="f88a8-159">Przykładem jest bazy danych, która obsługuje aplikację, która umożliwia malowanie stron sieci Web na podstawie wyników wywołania bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-159">An example is a database that supports an application that paints webpages based on the results of database calls.</span></span>

<span data-ttu-id="f88a8-160">Inne typy aplikacji może interpretować tego samego wykresu.</span><span class="sxs-lookup"><span data-stu-id="f88a8-160">Other application types might interpret the same graph differently.</span></span> <span data-ttu-id="f88a8-161">Na przykład jeśli aplikacja próbuje przetworzyć danych Lista płac każdego dnia i tego samego wykresu, tego rodzaju modelu "zadania wsadowego" może poradzić na poziom wydajności P1.</span><span class="sxs-lookup"><span data-stu-id="f88a8-161">For example, if an application tries to process payroll data each day and has the same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="f88a8-162">Poziom wydajności P1 ma 100 jednostek Dtu w porównaniu do 200 Dtu na poziomie wydajności P2.</span><span class="sxs-lookup"><span data-stu-id="f88a8-162">The P1 performance level has 100 DTUs compared to 200 DTUs at the P2 performance level.</span></span> <span data-ttu-id="f88a8-163">Poziom wydajności P1 zapewnia połowa wydajność P2 poziomu wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-163">The P1 performance level provides half the performance of the P2 performance level.</span></span> <span data-ttu-id="f88a8-164">Tak 50 procent użycia procesora CPU w P2 jest równy 100 procent użycia procesora CPU w P1.</span><span class="sxs-lookup"><span data-stu-id="f88a8-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="f88a8-165">Aplikacja nie ma przekroczeń limitu czasu, może być niezależnie od tego Jeśli zadanie ma 2 godziny lub 2,5 godzin, jeżeli pobiera dzisiaj.</span><span class="sxs-lookup"><span data-stu-id="f88a8-165">If the application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours to finish, if it gets done today.</span></span> <span data-ttu-id="f88a8-166">Prawdopodobnie aplikacji w tej kategorii można użyć poziomu wydajności P1.</span><span class="sxs-lookup"><span data-stu-id="f88a8-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="f88a8-167">Można korzystać z faktu, że są okresów w ciągu dnia, gdy wykorzystanie zasobów jest starsza, tak, aby wszelkie "big szczytu" może być zostaną przeniesione za pośrednictwem do jednego z koryta później w dniu.</span><span class="sxs-lookup"><span data-stu-id="f88a8-167">You can take advantage of the fact that there are periods of time during the day when resource use is lower, so that any "big peak" might spill over into one of the troughs later in the day.</span></span> <span data-ttu-id="f88a8-168">Poziom wydajności P1 może być dobrym dla tego typu aplikacji (i Zapisz pieniędzy), tak długo, jak zakończyć zadania na czas każdego dnia.</span><span class="sxs-lookup"><span data-stu-id="f88a8-168">The P1 performance level might be good for that kind of application (and save money), as long as the jobs can finish on time each day.</span></span>

<span data-ttu-id="f88a8-169">Udostępnia bazę danych SQL Azure używane informacje o zasobie dla każdej bazy danych dla aktywnej w **sys.resource_stats** widoku **wzorca** bazy danych w każdym serwerze.</span><span class="sxs-lookup"><span data-stu-id="f88a8-169">Azure SQL Database exposes consumed resource information for each active database in the **sys.resource_stats** view of the **master** database in each server.</span></span> <span data-ttu-id="f88a8-170">Dane w tabeli są agregowane dla 5-minutowy.</span><span class="sxs-lookup"><span data-stu-id="f88a8-170">The data in the table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="f88a8-171">Z warstwy usług podstawowa, standardowa i Premium danych może być więcej niż 5 minut pojawią się w tabeli, tak aby bardziej użyteczna w przypadku historycznej analizy, a nie w pobliżu czasie rzeczywistym analizy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-171">With the Basic, Standard, and Premium service tiers, the data can take more than 5 minutes to appear in the table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="f88a8-172">Zapytanie **sys.resource_stats** Wyświetl, aby wyświetlić najnowszą historię bazy danych i do zweryfikowania czy rezerwacji została wybrana opcja dostarczonych wydajności będą w razie potrzeby.</span><span class="sxs-lookup"><span data-stu-id="f88a8-172">Query the **sys.resource_stats** view to see the recent history of a database and to validate whether the reservation you chose delivered the performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="f88a8-173">Musi być podłączony do **wzorca** bazy danych logicznych serwera bazy danych SQL w zapytaniu **sys.resource_stats** w poniższych przykładach.</span><span class="sxs-lookup"><span data-stu-id="f88a8-173">You must be connected to the **master** database of your logical SQL database server to query **sys.resource_stats** in the following examples.</span></span>
> 
> 

<span data-ttu-id="f88a8-174">Ten przykład przedstawia, jak jest widoczne dane w tym widoku:</span><span class="sxs-lookup"><span data-stu-id="f88a8-174">This example shows you how the data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![W widoku wykazu sys.resource_stats](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="f88a8-176">W kolejnym przykładzie pokazano różne sposoby, w którym można **sys.resource_stats** widoku w celu uzyskania informacji o używaniu zasobów w bazie danych SQL w katalogu:</span><span class="sxs-lookup"><span data-stu-id="f88a8-176">The next example shows you different ways that you can use the **sys.resource_stats** catalog view to get information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="f88a8-177">Aby przyjrzeć się w poprzednim tygodniu zasobów dla userdb1 bazy danych, można uruchomić tego zapytania:</span><span class="sxs-lookup"><span data-stu-id="f88a8-177">To look at the past week’s resource use for the database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="f88a8-178">Aby ocenić, jak również obciążenie pasuje do poziomu wydajności, należy przejść do każdego aspektu zasobu metryki: procesora CPU, odczyty zapisy, liczbę procesów roboczych i liczba sesji.</span><span class="sxs-lookup"><span data-stu-id="f88a8-178">To evaluate how well your workload fits the performance level, you need to drill down into each aspect of the resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="f88a8-179">Oto poprawione zapytań przy użyciu **sys.resource_stats** zgłoszenia średniego i maksymalnego wartości tych metryk zasobów:</span><span class="sxs-lookup"><span data-stu-id="f88a8-179">Here's a revised query using **sys.resource_stats** to report the average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="f88a8-180">Dzięki tym informacjom o wartości średnia i maksymalna każdego zasobu metryki można ocenić, jak obciążenie jest dopasowywana do wybranego poziomu wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-180">With this information about the average and maximum values of each resource metric, you can assess how well your workload fits into the performance level you chose.</span></span> <span data-ttu-id="f88a8-181">Zazwyczaj średnie wartości z **sys.resource_stats** zapewniają dobrą linii bazowej przeciwko rozmiar docelowy.</span><span class="sxs-lookup"><span data-stu-id="f88a8-181">Usually, average values from **sys.resource_stats** give you a good baseline to use against the target size.</span></span> <span data-ttu-id="f88a8-182">Należy go z dysku podstawowego miary.</span><span class="sxs-lookup"><span data-stu-id="f88a8-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="f88a8-183">Na przykład być może używasz warstwie usług standardowa S2 poziom wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-183">For an example, you might be using the Standard service tier with S2 performance level.</span></span> <span data-ttu-id="f88a8-184">Średnią Użyj wartości procentowe dla procesora CPU i we/wy odczyty i zapisy są poniżej 40 procent, średnia liczba procesów roboczych jest poniżej 50, a średnią liczbę sesji jest poniżej 200.</span><span class="sxs-lookup"><span data-stu-id="f88a8-184">The average use percentages for CPU and I/O reads and writes are below 40 percent, the average number of workers is below 50, and the average number of sessions is below 200.</span></span> <span data-ttu-id="f88a8-185">Obciążenie może mieści się w poziomie wydajności S1.</span><span class="sxs-lookup"><span data-stu-id="f88a8-185">Your workload might fit into the S1 performance level.</span></span> <span data-ttu-id="f88a8-186">Jest łatwo sprawdzić, czy baza danych mieści się w granicach sesji i proces roboczy.</span><span class="sxs-lookup"><span data-stu-id="f88a8-186">It's easy to see whether your database fits in the worker and session limits.</span></span> <span data-ttu-id="f88a8-187">Aby zobaczyć, czy bazy danych mieści się na niższy poziom wydajności w odniesieniu do Procesora, odczyty i zapisy, dzielenie liczby jednostek dtu w warstwie niższej wydajności według liczby jednostek dtu w warstwie aktualny poziom wydajności, a następnie pomnożyć wynik przez 100:</span><span class="sxs-lookup"><span data-stu-id="f88a8-187">To see whether a database fits into a lower performance level with regards to CPU, reads, and writes, divide the DTU number of the lower performance level by the DTU number of your current performance level, and then multiply the result by 100:</span></span>
   
    <span data-ttu-id="f88a8-188">**S1 DTU / S2 JEDNOSTEK DTU W WARSTWIE * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="f88a8-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="f88a8-189">Wynik różni się względną wydajność poziomy wydajności dwóch w procentach.</span><span class="sxs-lookup"><span data-stu-id="f88a8-189">The result is the relative performance difference between the two performance levels in percentage.</span></span> <span data-ttu-id="f88a8-190">Jeśli Twoje użycie zasobów nie przekracza tę wartość, obciążenie może pasuje do niższej wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-190">If your resource use doesn't exceed this amount, your workload might fit into the lower performance level.</span></span> <span data-ttu-id="f88a8-191">Jednak należy przyjrzeć się wszystkie zakresy wartości użycia zasobów i określić wartości procentowej, jak często obciążenie bazy danych mieści się na niższym poziomie wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-191">However, you need to look at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into the lower performance level.</span></span> <span data-ttu-id="f88a8-192">Następujące zapytanie Wyświetla dopasowania procent na wymiarze zasobów do progu 40 procent, możemy obliczona w tym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="f88a8-192">The following query outputs the fit percentage per resource dimension, based on the threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="f88a8-193">Oparty na celu poziomu usługi (SLO) bazy danych, można zdecydować, czy obciążenie jest dopasowywana do niższej wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-193">Based on your database service level objective (SLO), you can decide whether your workload fits into the lower performance level.</span></span> <span data-ttu-id="f88a8-194">Jeśli obciążenie bazy danych usługi jest 99,9 procent i poprzedniego zapytania zwraca wartości większe niż 99,9% dla wszystkich wymiarów zasobów, obciążenie może pasuje do niższej wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-194">If your database workload SLO is 99.9 percent and the preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into the lower performance level.</span></span>
   
    <span data-ttu-id="f88a8-195">Spojrzenie na dopasowania procent daje również wgląd w Określa, czy należy przenieść dalej wyższy poziom wydajności spełnia Twoje SLO.</span><span class="sxs-lookup"><span data-stu-id="f88a8-195">Looking at the fit percentage also gives you insight into whether you should move to the next higher performance level to meet your SLO.</span></span> <span data-ttu-id="f88a8-196">Na przykład userdb1 przedstawia użycie procesora CPU w poprzednim tygodniu:</span><span class="sxs-lookup"><span data-stu-id="f88a8-196">For example, userdb1 shows the following CPU use for the past week:</span></span>
   
   | <span data-ttu-id="f88a8-197">Średni procent procesora CPU</span><span class="sxs-lookup"><span data-stu-id="f88a8-197">Average CPU percent</span></span> | <span data-ttu-id="f88a8-198">Maksymalny procent procesora CPU</span><span class="sxs-lookup"><span data-stu-id="f88a8-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="f88a8-199">24.5</span><span class="sxs-lookup"><span data-stu-id="f88a8-199">24.5</span></span> |<span data-ttu-id="f88a8-200">100.00</span><span class="sxs-lookup"><span data-stu-id="f88a8-200">100.00</span></span> |
   
    <span data-ttu-id="f88a8-201">Średnie wykorzystanie Procesora jest o kwartału limitu poziom wydajności, który mieści się na poziom wydajności bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-201">The average CPU is about a quarter of the limit of the performance level, which would fit well into the performance level of the database.</span></span> <span data-ttu-id="f88a8-202">Jednak wartość maksymalna pokazuje bazy danych nie osiągnie limitu poziom wydajności.</span><span class="sxs-lookup"><span data-stu-id="f88a8-202">But, the maximum value shows that the database reaches the limit of the performance level.</span></span> <span data-ttu-id="f88a8-203">Czy trzeba przenieść dalej wyższy poziom wydajności?</span><span class="sxs-lookup"><span data-stu-id="f88a8-203">Do you need to move to the next higher performance level?</span></span> <span data-ttu-id="f88a8-204">Zobacz, jak wiele razy z osiągnie obciążenia 100 procent, a następnie porównaj je z SLO obciążenie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-204">Look at how many times your workload reaches 100 percent, and then compare it to your database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="f88a8-205">Jeśli ta kwerenda zwraca wartość mniej niż 99,9% dla każdego z wymiarów zasobów, rozważ przeniesienie albo dalej wyższy poziom wydajności lub obniżyć obciążenie bazy danych SQL za pomocą techniki Dostrajanie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f88a8-205">If this query returns a value less than 99.9 percent for any of the three resource dimensions, consider either moving to the next higher performance level or use application-tuning techniques to reduce the load on the SQL database.</span></span>
4. <span data-ttu-id="f88a8-206">Tego ćwiczenia uwzględnia również zwiększenia Twojej planowane obciążenie w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="f88a8-206">This exercise also considers your projected workload increase in the future.</span></span>

<span data-ttu-id="f88a8-207">W przypadku pul elastycznych można monitorować pojedyncze bazy danych w puli za pomocą metod opisanych w tej sekcji.</span><span class="sxs-lookup"><span data-stu-id="f88a8-207">For elastic pools, you can monitor individual databases in the pool with the techniques described in this section.</span></span> <span data-ttu-id="f88a8-208">Można jednak również monitorować pulę jako całość.</span><span class="sxs-lookup"><span data-stu-id="f88a8-208">But you can also monitor the pool as a whole.</span></span> <span data-ttu-id="f88a8-209">Informacje na ten temat znajdziesz w artykule [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md) (Monitorowanie puli elastycznej i zarządzanie nią).</span><span class="sxs-lookup"><span data-stu-id="f88a8-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="f88a8-210">Maksymalna liczba równoczesnych żądań</span><span class="sxs-lookup"><span data-stu-id="f88a8-210">Maximum concurrent requests</span></span>
<span data-ttu-id="f88a8-211">Aby wyświetlić liczbę jednoczesnych żądań, uruchom to zapytanie języka Transact-SQL w bazie danych SQL:</span><span class="sxs-lookup"><span data-stu-id="f88a8-211">To see the number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="f88a8-212">Do analizowania na obciążenie związane z lokalną bazą danych programu SQL Server, zmodyfikuj to zapytanie, aby odfiltrować określonej bazy danych, do przeanalizowania.</span><span class="sxs-lookup"><span data-stu-id="f88a8-212">To analyze the workload of an on-premises SQL Server database, modify this query to filter on the specific database you want to analyze.</span></span> <span data-ttu-id="f88a8-213">Na przykład jeśli masz lokalną bazą danych o nazwie mojabazadanych tego zapytania języka Transact-SQL zwraca liczbę jednoczesnych żądań w tej bazie danych:</span><span class="sxs-lookup"><span data-stu-id="f88a8-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns the count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="f88a8-214">To właśnie migawki w jednym punkcie w czasie.</span><span class="sxs-lookup"><span data-stu-id="f88a8-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="f88a8-215">Aby uzyskać lepsze zrozumienie wymagań dotyczących równoczesnych żądań i obciążenia, na których, należy zebrać wiele próbek w czasie.</span><span class="sxs-lookup"><span data-stu-id="f88a8-215">To get a better understanding of your workload and concurrent request requirements, you'll need to collect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="f88a8-216">Maksymalna równoczesnych logowania</span><span class="sxs-lookup"><span data-stu-id="f88a8-216">Maximum concurrent logins</span></span>
<span data-ttu-id="f88a8-217">Można analizować Twoich wzorców użytkownika i aplikacji, aby poznać częstotliwość logowania.</span><span class="sxs-lookup"><span data-stu-id="f88a8-217">You can analyze your user and application patterns to get an idea of the frequency of logins.</span></span> <span data-ttu-id="f88a8-218">Można również uruchomić rzeczywistych obciążeń w środowisku testowym, aby upewnić się, że użytkownik jest nie naciśnięcie to lub inne ograniczenia, które omówiono w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="f88a8-218">You also can run real-world loads in a test environment to make sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="f88a8-219">Nie ma jednego zapytania lub widoku dynamicznego zarządzania (DMV), który można wyświetlić równoczesnych się, że liczba logowania lub historii.</span><span class="sxs-lookup"><span data-stu-id="f88a8-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="f88a8-220">Jeśli wielu klientów używać tych samych parametrach połączenia, usługa uwierzytelnia każdego logowania.</span><span class="sxs-lookup"><span data-stu-id="f88a8-220">If multiple clients use the same connection string, the service authenticates each login.</span></span> <span data-ttu-id="f88a8-221">Jeśli 10 użytkowników jednocześnie połączyć się z bazą danych przy użyciu tej samej nazwy użytkownika i hasła, może to być 10 równoczesnych logowania.</span><span class="sxs-lookup"><span data-stu-id="f88a8-221">If 10 users simultaneously connect to a database by using the same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="f88a8-222">Ten limit dotyczy tylko w czasie trwania logowania i uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="f88a8-222">This limit applies only to the duration of the login and authentication.</span></span> <span data-ttu-id="f88a8-223">Tej samej 10 użytkowników połączenia z bazą danych po kolei, liczba równoczesnych logowań nigdy nie będzie większa niż 1.</span><span class="sxs-lookup"><span data-stu-id="f88a8-223">If the same 10 users connect to the database sequentially, the number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="f88a8-224">Obecnie ten limit nie ma zastosowania do bazy danych w puli elastycznej.</span><span class="sxs-lookup"><span data-stu-id="f88a8-224">Currently, this limit does not apply to databases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="f88a8-225">Maksymalna liczba sesji</span><span class="sxs-lookup"><span data-stu-id="f88a8-225">Maximum sessions</span></span>
<span data-ttu-id="f88a8-226">Aby wyświetlić liczbę bieżące aktywne sesje, uruchom to zapytanie języka Transact-SQL w bazie danych SQL:</span><span class="sxs-lookup"><span data-stu-id="f88a8-226">To see the number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="f88a8-227">Jeśli jest analiza obciążenia pracą lokalnego programu SQL Server, zmodyfikuj zapytanie, aby skupić się na określonej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f88a8-227">If you're analyzing an on-premises SQL Server workload, modify the query to focus on a specific database.</span></span> <span data-ttu-id="f88a8-228">To zapytanie ułatwia określenie potrzeb możliwe sesji dla bazy danych, planując przeniesienie ich do bazy danych SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="f88a8-228">This query helps you determine possible session needs for the database if you are considering moving it to Azure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="f88a8-229">Ponownie tych zapytań Zwróć liczba punktu w czasie.</span><span class="sxs-lookup"><span data-stu-id="f88a8-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="f88a8-230">W przypadku zebrania wielu próbkach wraz z upływem czasu, będziesz mieć najlepsze zrozumienia sesji, użyj.</span><span class="sxs-lookup"><span data-stu-id="f88a8-230">If you collect multiple samples over time, you’ll have the best understanding of your session use.</span></span>

<span data-ttu-id="f88a8-231">Analizy bazy danych SQL, historycznych statystyki można uzyskać na sesje, badając [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) widoku i przeglądanie **active_session_count** kolumny.</span><span class="sxs-lookup"><span data-stu-id="f88a8-231">For SQL Database analysis, you can get historical statistics on sessions by querying the [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing the **active_session_count** column.</span></span> 
