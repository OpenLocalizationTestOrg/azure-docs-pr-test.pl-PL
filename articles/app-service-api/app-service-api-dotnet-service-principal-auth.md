---
title: "aaaService główna uwierzytelniania dla aplikacji interfejsu API w usłudze Azure App Service | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak aplikacja tooprotect interfejsu API w usłudze Azure App Service dla scenariuszy service-to-service."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="34a31-103">Uwierzytelnianie główną usługi dla aplikacji interfejsu API w usłudze Azure App Service</span><span class="sxs-lookup"><span data-stu-id="34a31-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="34a31-104">Omówienie</span><span class="sxs-lookup"><span data-stu-id="34a31-104">Overview</span></span>
<span data-ttu-id="34a31-105">W tym artykule opisano sposób uwierzytelniania usługi aplikacji toouse dla *wewnętrzny* dostęp do aplikacji tooAPI.</span><span class="sxs-lookup"><span data-stu-id="34a31-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="34a31-106">Scenariusz wewnętrzny jest, gdzie masz aplikację interfejsu API, które mają toobe eksploatacyjny tylko przez kod aplikacji.</span><span class="sxs-lookup"><span data-stu-id="34a31-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="34a31-107">Hello zalecany sposób tooimplement w tym scenariuszu w usłudze aplikacji hello tooprotect toouse usługi Azure AD nosi nazwę aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="34a31-108">Wywołania aplikacji interfejsu API hello chronione przy użyciu tokenu elementu nośnego, który można pobrać z usługi Azure AD przez udostępnienie tożsamość aplikacji poświadczeń (nazwy głównej usługi).</span><span class="sxs-lookup"><span data-stu-id="34a31-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="34a31-109">Aby toousing alternatyw usługi Azure AD, zobacz hello **do usługi uwierzytelniania** sekcji hello [omówienie uwierzytelniania w usłudze Azure App Service](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="34a31-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="34a31-110">W tym artykule dowiesz się:</span><span class="sxs-lookup"><span data-stu-id="34a31-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="34a31-111">Jak aplikacja tooprotect interfejsu API usługi Azure Active Directory (Azure AD) toouse ze nieuwierzytelniony dostępu.</span><span class="sxs-lookup"><span data-stu-id="34a31-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="34a31-112">Jak tooconsume chronionego interfejsu API aplikacji z aplikacji interfejsu API, aplikacji sieci web lub aplikacji mobilnej przy użyciu poświadczeń podmiotu zabezpieczeń (tożsamość aplikacji) usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="34a31-113">Aby uzyskać informacje na temat tooconsume z aplikacji logiki, zobacz [przy użyciu niestandardowego interfejsu API hostowanych w usłudze aplikacji z usługą Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="34a31-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="34a31-114">Jak toomake upewnić się, że hello chronione aplikacji interfejsu API nie można wywołać z poziomu przeglądarki przy zalogowanych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="34a31-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="34a31-115">Jak toomake pewność, że hello chronione aplikacji interfejsu API tylko może być wywoływany przez określony nazwy głównej usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="34a31-116">Witaj artykuł zawiera dwie sekcje:</span><span class="sxs-lookup"><span data-stu-id="34a31-116">hello article contains two sections:</span></span>

* <span data-ttu-id="34a31-117">Witaj [jak tooconfigure usługi podmiotu zabezpieczeń uwierzytelniania w usłudze Azure App Service](#authconfig) sekcji opisano w sposób ogólny tooconfigure uwierzytelniania dla dowolnej aplikacji interfejsu API i jak tooconsume hello chronione aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="34a31-118">Ta sekcja dotyczy jednakowo tooall platform obsługiwanych przez usługę App Service, w tym .NET, Node.js i Java.</span><span class="sxs-lookup"><span data-stu-id="34a31-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="34a31-119">Począwszy od hello [kontynuowanie samouczki dotyczące rozpoczynania pracy .NET hello](#tutorialstart) sekcji hello samouczek przeprowadzi Cię przez konfigurowania scenariusza "dostęp do" przykładową aplikację .NET w aplikacji usługi.</span><span class="sxs-lookup"><span data-stu-id="34a31-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="34a31-120"><a id="authconfig"></a>Jak tooconfigure usługi podmiotu zabezpieczeń uwierzytelniania w usłudze Azure App Service</span><span class="sxs-lookup"><span data-stu-id="34a31-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="34a31-121">Ta sekcja zawiera ogólne instrukcje dotyczące tooany aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="34a31-122">Dla tooDo toohello określonych czynności .NET listy przykładowej aplikacji, przejdź zbyt[kontynuowanie serii samouczek aplikacji interfejsu API programu .NET hello](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="34a31-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="34a31-123">W hello [portalu Azure](https://portal.azure.com/), przejdź toohello **ustawienia** bloku aplikacji interfejsu API hello mają tooprotect, a następnie znajdź hello **funkcje** sekcji, a następnie kliknij przycisk **Uwierzytelniania / autoryzacji**.</span><span class="sxs-lookup"><span data-stu-id="34a31-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Uwierzytelnianie/autoryzację, w portalu Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="34a31-125">W hello **uwierzytelniania / autoryzacji** bloku, kliknij przycisk **na**.</span><span class="sxs-lookup"><span data-stu-id="34a31-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="34a31-126">W hello **tootake akcji w przypadku nieuwierzytelnionego żądania** listy rozwijanej wybierz **Zaloguj się za pomocą usługi Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="34a31-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="34a31-127">W obszarze **dostawców uwierzytelniania**, wybierz pozycję **usługi Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="34a31-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Blok uwierzytelniania/autoryzacji w portalu Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="34a31-129">Skonfiguruj hello **ustawień usługi Azure Active Directory** toocreate bloku Azure nowej aplikacji usługi AD, lub użyj istniejącej aplikacji usługi Azure AD, jeśli masz już konto, które mają toouse.</span><span class="sxs-lookup"><span data-stu-id="34a31-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="34a31-130">Scenariusze wewnętrzny zwykle obejmują wywołanie aplikacji interfejsu API aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="34a31-131">Oddzielne Azure można użyć tylko jednej aplikacji usługi Azure AD lub aplikacji usługi AD dla każdej aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="34a31-132">Aby uzyskać szczegółowe informacje dotyczące tego bloku, zobacz [jak tooconfigure Logowanie usługi Azure Active Directory toouse aplikacji usługi App Service](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="34a31-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="34a31-133">Po zakończeniu korzystania z bloku konfiguracji dostawcy uwierzytelniania hello, kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="34a31-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="34a31-134">W hello **uwierzytelniania / autoryzacji** bloku, kliknij przycisk **zapisać**.</span><span class="sxs-lookup"><span data-stu-id="34a31-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Klikanie pozycji Zapisz.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="34a31-136">Po zakończeniu usługi aplikacji — tylko zezwala na żądania pochodzące z wywołań w dzierżawie usługi Azure AD hello skonfigurowane.</span><span class="sxs-lookup"><span data-stu-id="34a31-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="34a31-137">Brak kodu uwierzytelniania i autoryzacji jest wymagany w aplikacji interfejsu API hello chronione.</span><span class="sxs-lookup"><span data-stu-id="34a31-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="34a31-138">Witaj tokenu elementu nośnego jest przekazywana toohello interfejsu API aplikacji wraz z oświadczeń często używane w nagłówkach HTTP, a może odczytywać dane toovalidate kodu, które żądania są z określonego obiektu wywołującego, takich jak nazwy głównej usługi.</span><span class="sxs-lookup"><span data-stu-id="34a31-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="34a31-139">Ta funkcja uwierzytelniania działa hello tak samo dla wszystkich języków obsługuje usługi aplikacji, w tym .NET, Node.js i Java.</span><span class="sxs-lookup"><span data-stu-id="34a31-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="34a31-140">Jak tooconsume hello chronione aplikacji interfejsu API</span><span class="sxs-lookup"><span data-stu-id="34a31-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="34a31-141">obiekt wywołujący Hello podać tokenu elementu nośnego usługi Azure AD z interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="34a31-142">tooget przy użyciu poświadczeń główna usługi tokenu elementu nośnego, wywołujący hello używa biblioteki uwierzytelniania usługi Active Directory (ADAL dla [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), lub [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="34a31-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="34a31-143">tooget token hello kod, który wywołuje ADAL zapewnia hello tooADAL następujących informacji:</span><span class="sxs-lookup"><span data-stu-id="34a31-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="34a31-144">Nazwa Hello dzierżawy usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="34a31-145">Witaj identyfikator i klienta klucz tajny klienta (klucz aplikacji) skojarzone z obiektem wywołującym hello aplikacji hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="34a31-146">Identyfikator klienta aplikacji usługi Azure AD skojarzonej z hello hello Hello chronione aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="34a31-147">(Jeśli jest używany tylko jednej aplikacji usługi Azure AD, to jest hello tego samego Identyfikatora klienta jako jeden dla obiekt wywołujący hello hello.)</span><span class="sxs-lookup"><span data-stu-id="34a31-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="34a31-148">Te wartości są dostępne na stronach hello Azure AD hello [klasycznego portalu Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="34a31-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="34a31-149">Po hello token zostały nabyte, wywołujący hello obejmuje żądań HTTP w nagłówku autoryzacji hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="34a31-150">Usługa aplikacji weryfikuje hello token i umożliwia hello żądań tooreach hello chronione aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="34a31-151">Jak tooprotect aplikacji hello interfejsu API przed dostępem użytkowników w hello sam dzierżawy</span><span class="sxs-lookup"><span data-stu-id="34a31-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="34a31-152">Tokenów elementu nośnego dla użytkowników w tej samej dzierżawy są uznawane za prawidłowe dla hello hello chronione aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="34a31-153">Jeśli chcesz, aby tooensure, który można wywołać tylko nazwy głównej usługi hello chronionej aplikacji interfejsu API, Dodaj kod w hello chronione hello toovalidate aplikacji interfejsu API po oświadczeń z tokenu hello:</span><span class="sxs-lookup"><span data-stu-id="34a31-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="34a31-154">`appid`powinien być hello identyfikator klienta aplikacji usługi Azure AD hello, który jest skojarzony z obiektem wywołującym hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="34a31-155">`oid`(`objectidentifier`) powinna być identyfikator podmiotu zabezpieczeń usługi hello hello wywołującego.</span><span class="sxs-lookup"><span data-stu-id="34a31-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="34a31-156">Usługa App Service zapewnia również hello `objectidentifier` oświadczeń w nagłówku hello X-MS-CLIENT-podmiot zabezpieczeń-ID.</span><span class="sxs-lookup"><span data-stu-id="34a31-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="34a31-157">Jak tooprotect hello aplikacji interfejsu API z dostęp za pomocą przeglądarki</span><span class="sxs-lookup"><span data-stu-id="34a31-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="34a31-158">Nie zweryfikować oświadczenia w kodzie aplikacji interfejsu API hello chroniony, a Użyj oddzielnej aplikacji usługi Azure AD dla hello chronione aplikacji interfejsu API, upewnij się, że hello, że adres URL odpowiedzi aplikacji usługi Azure AD jest nie tak samo jak hello podstawowy adres URL aplikacji interfejsu API hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="34a31-159">Jeśli hello adres URL odpowiedzi wskazuje bezpośrednio aplikacji interfejsu API toohello chronione, użytkownik w dzierżawie powitalnych tej samej usługi Azure AD można Przeglądaj toohello aplikacji interfejsu API, zaloguj się na i pomyślnie wywołać interfejs API hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="34a31-160"><a id="tutorialstart"></a>Kontynuowanie serii samouczek hello aplikacji interfejsu API programu .NET</span><span class="sxs-lookup"><span data-stu-id="34a31-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="34a31-161">Jeśli wykonujesz hello Node.js lub Java samouczek serii dla aplikacji interfejsu API, Pomiń toohello [następne kroki](#next-steps) sekcji.</span><span class="sxs-lookup"><span data-stu-id="34a31-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="34a31-162">Hello dalszej części tego artykułu nadal serii samouczek aplikacji interfejsu API programu .NET hello i przyjęto założenie, że zostały wykonane hello [samouczek uwierzytelniania użytkownika](app-service-api-dotnet-user-principal-auth.md) i mieć hello przykładowej aplikacji działających na platformie Azure przy użyciu uwierzytelniania użytkownika włączone.</span><span class="sxs-lookup"><span data-stu-id="34a31-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="34a31-163">Konfigurowanie uwierzytelniania w systemie Azure</span><span class="sxs-lookup"><span data-stu-id="34a31-163">Set up authentication in Azure</span></span>
<span data-ttu-id="34a31-164">W tej sekcji można skonfigurować usługę aplikacji, aby tego hello żądań tylko HTTP umożliwia aplikacji interfejsu API warstwy danych hello tooreach są hello te, które prawidłowy Azure AD tokenów elementu nośnego.</span><span class="sxs-lookup"><span data-stu-id="34a31-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="34a31-165">W następującej sekcji hello skonfiguruj toosend aplikacji interfejsu API warstwy środkowej hello aplikacji tooAzure poświadczeń AD, wrócić tokenu elementu nośnego i wysłać aplikacji interfejsu API warstwy danych toohello tokenu elementu nośnego hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="34a31-166">Ten proces przedstawiono na powitania diagramu.</span><span class="sxs-lookup"><span data-stu-id="34a31-166">This process is illustrated in hello diagram.</span></span>

![Diagram uwierzytelniania usługi](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="34a31-168">Jeśli wystąpiły problemy podczas hello samouczek zalecenia, zobacz hello [Rozwiązywanie problemów](#troubleshooting) sekcji na końcu hello hello samouczka.</span><span class="sxs-lookup"><span data-stu-id="34a31-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="34a31-169">W hello [portalu Azure](https://portal.azure.com/), przejdź toohello **ustawienia** bloku aplikacji hello interfejsu API dla aplikacji interfejsu API (warstwy danych) ToDoListDataAPI hello utworzone, a następnie kliknij przycisk **ustawienia**.</span><span class="sxs-lookup"><span data-stu-id="34a31-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="34a31-170">W hello **ustawienia** bloku, Znajdź hello **funkcje** sekcji, a następnie kliknij przycisk **uwierzytelniania / autoryzacji**.</span><span class="sxs-lookup"><span data-stu-id="34a31-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Uwierzytelnianie/autoryzację, w portalu Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="34a31-172">W hello **uwierzytelniania / autoryzacji** bloku, kliknij przycisk **na**.</span><span class="sxs-lookup"><span data-stu-id="34a31-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="34a31-173">W hello **tootake akcji w przypadku nieuwierzytelnionego żądania** listy rozwijanej wybierz **Zaloguj się za pomocą usługi Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="34a31-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="34a31-174">To jest ustawienie hello, powodujący tooensure App Service, tylko uwierzytelnienia aplikacji interfejsu API hello reach żądania.</span><span class="sxs-lookup"><span data-stu-id="34a31-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="34a31-175">Dla żądania, które mają tokenów elementu nośnego prawidłowe, usługi aplikacji przekazuje tokeny hello wzdłuż aplikacji toohello interfejsu API i wypełnia nagłówków HTTP z często używanych oświadczeń toomake informacji kodu tooyour łatwo dostępne.</span><span class="sxs-lookup"><span data-stu-id="34a31-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="34a31-176">W obszarze **dostawców uwierzytelniania**, kliknij przycisk **usługi Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="34a31-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Blok uwierzytelniania/autoryzacji w portalu Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="34a31-178">W hello **ustawień usługi Azure Active Directory** bloku, kliknij przycisk **Express**.</span><span class="sxs-lookup"><span data-stu-id="34a31-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="34a31-179">Z hello **Express** opcji Azure można automatycznie utworzyć aplikację AAD w usługi Azure AD [dzierżawy](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="34a31-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="34a31-180">Nie masz toocreate dzierżawy, ponieważ jeden ma automatycznie co konto platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="34a31-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="34a31-181">W obszarze **tryb zarządzania**, kliknij przycisk **Utwórz nową aplikację usługi AD** Jeśli nie została jeszcze wybrana.</span><span class="sxs-lookup"><span data-stu-id="34a31-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="34a31-182">Hello portal podłącza hello **tworzenie aplikacji** pole wprowadzania wartości domyślnej.</span><span class="sxs-lookup"><span data-stu-id="34a31-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="34a31-183">Domyślnie program hello aplikacji usługi Azure AD o nazwie hello takie same jak aplikacja hello interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="34a31-184">Jeśli wolisz, możesz wprowadzić inną nazwę.</span><span class="sxs-lookup"><span data-stu-id="34a31-184">If you prefer, you can enter a different name.</span></span>
   
    ![Ustawienia usługi Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="34a31-186">**Uwaga**: Alternatywnie można użyć jednej usługi Azure AD aplikacji hello zarówno wywołania aplikacji interfejsu API i hello chronione aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="34a31-187">Jeśli została wybrana opcja to alternatywne rozwiązanie, nie musisz hello **Utwórz nową aplikację usługi AD** opcji w tym miejscu, ponieważ utworzonej wcześniej w samouczku uwierzytelniania użytkownika hello aplikacji usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="34a31-188">W tym samouczku użyjesz rozdzielenie aplikacji usługi Azure AD, dla hello wywołanie aplikacji interfejsu API i hello chronione aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="34a31-189">Zanotuj wartość hello hello **tworzenie aplikacji** pole wprowadzania; będzie wyszukiwania tej aplikacji usługi AAD w hello klasycznego portalu Azure później.</span><span class="sxs-lookup"><span data-stu-id="34a31-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="34a31-190">Kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="34a31-190">Click **OK**.</span></span>
10. <span data-ttu-id="34a31-191">W hello **uwierzytelniania / autoryzacji** bloku, kliknij przycisk **zapisać**.</span><span class="sxs-lookup"><span data-stu-id="34a31-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Klikanie pozycji Zapisz.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="34a31-193">Usługi aplikacji — tworzy aplikację usługi Azure Active Directory z **adres URL logowania** i **adres URL odpowiedzi** automatycznie ustawione toohello adres URL aplikacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="34a31-194">ostatnie wartości Hello umożliwia użytkownikom w sieci toolog dzierżawy usługi AAD w i aplikacji interfejsu API hello dostępu.</span><span class="sxs-lookup"><span data-stu-id="34a31-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="34a31-195">Sprawdź, czy jest chroniony, aplikacja hello interfejsu API</span><span class="sxs-lookup"><span data-stu-id="34a31-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="34a31-196">W przeglądarce Przejdź toohello adres URL aplikacji hello interfejsu API: w hello **aplikacji interfejsu API** bloku w hello portalu Azure, kliknij łącze hello w obszarze **adres URL**.</span><span class="sxs-lookup"><span data-stu-id="34a31-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="34a31-197">Jesteś ekran logowania przekierowanego tooa ponieważ nieuwierzytelnione żądania nie są dozwolone w aplikacji interfejsu API hello tooreach.</span><span class="sxs-lookup"><span data-stu-id="34a31-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="34a31-198">Jeśli przeglądarki Przejdź toohello interfejs użytkownika programu Swagger, przeglądarka może już być zalogowany — w takim przypadku otwórz sesję InPrivate lub Incognito okno i przejdź toohello URL interfejsu użytkownika programu Swagger.</span><span class="sxs-lookup"><span data-stu-id="34a31-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="34a31-199">Zaloguj się przy użyciu poświadczeń użytkownika w dzierżawie usługi AAD.</span><span class="sxs-lookup"><span data-stu-id="34a31-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="34a31-200">Gdy użytkownik jest zalogowany, hello "Pomyślnie utworzono" strona zostanie wyświetlona w przeglądarce hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="34a31-201">Konfigurowanie tooacquire projektu ToDoListAPI hello i Wyślij token usługi Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="34a31-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="34a31-202">W tej sekcji hello następujących zadań:</span><span class="sxs-lookup"><span data-stu-id="34a31-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="34a31-203">Dodaj kod w aplikacji interfejsu API warstwy środkowej hello, który używa usługi Azure AD aplikacji poświadczenia tooacquire token i wysłać go przy użyciu protokołu HTTP żądania aplikacji interfejsu API warstwy danych toohello.</span><span class="sxs-lookup"><span data-stu-id="34a31-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="34a31-204">Pobierz hello poświadczenia, które są potrzebne z usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="34a31-205">Wprowadź poświadczenia hello w usłudze Azure App Service ustawienia środowiska środowiska uruchomieniowego w aplikacji interfejsu API warstwy środkowej hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="34a31-206">Konfigurowanie tooacquire projektu ToDoListAPI hello i Wyślij token usługi Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="34a31-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="34a31-207">Wprowadź następujące zmiany w projekcie ToDoListAPI hello w programie Visual Studio hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="34a31-208">Usuń znaczniki komentarza cały kod hello w hello *ServicePrincipal.cs* pliku.</span><span class="sxs-lookup"><span data-stu-id="34a31-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="34a31-209">To jest kod hello używa biblioteki ADAL dla tokenu elementu nośnego hello Azure AD tooacquire .NET.</span><span class="sxs-lookup"><span data-stu-id="34a31-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="34a31-210">Używa kilku wartości konfiguracji, które zostanie ustawiona w środowisku platformy Azure środowiska uruchomieniowego hello później.</span><span class="sxs-lookup"><span data-stu-id="34a31-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="34a31-211">Oto kod hello:</span><span class="sxs-lookup"><span data-stu-id="34a31-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="34a31-212">**Uwaga:** ten kod wymaga pakietu NuGet programu .NET (Microsoft.IdentityModel.Clients.ActiveDirectory), który jest już zainstalowany w projekcie hello hello biblioteki ADAL.</span><span class="sxs-lookup"><span data-stu-id="34a31-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="34a31-213">Jeśli zostały tworzenia tego projektu od podstaw, trzeba będzie tooinstall tego pakietu.</span><span class="sxs-lookup"><span data-stu-id="34a31-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="34a31-214">Ten pakiet nie jest automatycznie instalowany przez szablon nowego projektu aplikacji interfejsu API hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="34a31-215">W *kontrolerów/ToDoListController*, usuń znaczniki komentarza hello kodu w hello `NewDataAPIClient` metodę, która dodaje hello tokenu tooHTTP żądań w nagłówku autoryzacji hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="34a31-216">Wdrażanie projektu ToDoListAPI hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="34a31-217">(Kliknij prawym przyciskiem myszy projekt hello, a następnie kliknij przycisk **Publikuj > Publikuj**.)</span><span class="sxs-lookup"><span data-stu-id="34a31-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="34a31-218">Visual Studio wdroży projekt hello i otwiera podstawowy adres URL przeglądarki toohello aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="34a31-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="34a31-219">Wyświetli stronę błędu 403, co jest zrozumiałe dla próba toogo tooa interfejsu API sieci Web podstawowego adresu URL w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="34a31-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="34a31-220">Zamknij hello przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="34a31-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="34a31-221">Pobiera wartości konfiguracji usługi Azure AD</span><span class="sxs-lookup"><span data-stu-id="34a31-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="34a31-222">W hello [klasycznego portalu Azure](https://manage.windowsazure.com/), przejdź do zbyt**usługi Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="34a31-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="34a31-223">Na powitania **katalogu** kliknij dzierżawę usługi AAD.</span><span class="sxs-lookup"><span data-stu-id="34a31-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="34a31-224">Kliknij przycisk **aplikacji > aplikacje Moja firma jest właścicielem**, a następnie kliknij znacznik wyboru hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="34a31-225">Liście hello aplikacji kliknij nazwę hello hello, który Azure utworzony po włączeniu uwierzytelniania dla aplikacji interfejsu API (warstwy danych) ToDoListDataAPI hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="34a31-226">Kliknij przycisk hello **Konfiguruj** kartę.</span><span class="sxs-lookup"><span data-stu-id="34a31-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="34a31-227">Kopiuj hello **identyfikator klienta** wartość i zapisz go w innym możesz pobrać go z później.</span><span class="sxs-lookup"><span data-stu-id="34a31-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="34a31-228">W hello klasycznego portalu Azure Przejdź wstecz listy toohello **aplikacji Moja firma jest właścicielem**i kliknij aplikację AAD hello, który został utworzony dla aplikacji interfejsu API ToDoListAPI warstwy środkowej hello (hello utworzonej w poprzedniej samouczek hello, nie Witaj, jeden utworzonego w ramach tego samouczka).</span><span class="sxs-lookup"><span data-stu-id="34a31-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="34a31-229">Kliknij przycisk hello **Konfiguruj** kartę.</span><span class="sxs-lookup"><span data-stu-id="34a31-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="34a31-230">Kopiuj hello **identyfikator klienta** wartość i zapisz go w innym możesz pobrać go z później.</span><span class="sxs-lookup"><span data-stu-id="34a31-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="34a31-231">W obszarze **klucze**, wybierz pozycję **1 rok** z hello **wybierz czas trwania** listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="34a31-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="34a31-232">Kliknij pozycję **Zapisz**.</span><span class="sxs-lookup"><span data-stu-id="34a31-232">Click **Save**.</span></span>
    
     ![Generowanie klucza aplikacji](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="34a31-234">Skopiuj wartość klucza hello i zapisz go w innym, które możesz pobrać go z później.</span><span class="sxs-lookup"><span data-stu-id="34a31-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Skopiuj nowy klucz aplikacji](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="34a31-236">Konfigurowanie ustawień usługi Azure AD w aplikacji interfejsu API warstwy środkowej hello środowiska uruchomieniowego</span><span class="sxs-lookup"><span data-stu-id="34a31-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="34a31-237">Przejdź toohello [portalu Azure](https://portal.azure.com/), a następnie przejdź toohello **aplikacji interfejsu API** bloku aplikacji hello interfejsu API, który jest hostem projektu TodoListAPI (warstwy środkowej) hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="34a31-238">Kliknij kolejno pozycje **Ustawienia > Ustawienia aplikacji**.</span><span class="sxs-lookup"><span data-stu-id="34a31-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="34a31-239">W hello **ustawień aplikacji** Dodaj hello następujące klucze i wartości:</span><span class="sxs-lookup"><span data-stu-id="34a31-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="34a31-240">**Klucz**</span><span class="sxs-lookup"><span data-stu-id="34a31-240">**Key**</span></span> | <span data-ttu-id="34a31-241">IDA: urzędu</span><span class="sxs-lookup"><span data-stu-id="34a31-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="34a31-242">**Wartość**</span><span class="sxs-lookup"><span data-stu-id="34a31-242">**Value**</span></span> |<span data-ttu-id="34a31-243">https://login.microsoftonline.com/ {nazwa dzierżawy usługi Azure AD}</span><span class="sxs-lookup"><span data-stu-id="34a31-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="34a31-244">**Przykład**</span><span class="sxs-lookup"><span data-stu-id="34a31-244">**Example**</span></span> |<span data-ttu-id="34a31-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="34a31-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="34a31-246">**Klucz**</span><span class="sxs-lookup"><span data-stu-id="34a31-246">**Key**</span></span> | <span data-ttu-id="34a31-247">IDA: ClientId</span><span class="sxs-lookup"><span data-stu-id="34a31-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="34a31-248">**Wartość**</span><span class="sxs-lookup"><span data-stu-id="34a31-248">**Value**</span></span> |<span data-ttu-id="34a31-249">Identyfikator klienta hello wywoływania aplikacji (warstwy środkowej - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="34a31-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="34a31-250">**Przykład**</span><span class="sxs-lookup"><span data-stu-id="34a31-250">**Example**</span></span> |<span data-ttu-id="34a31-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="34a31-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="34a31-252">**Klucz**</span><span class="sxs-lookup"><span data-stu-id="34a31-252">**Key**</span></span> | <span data-ttu-id="34a31-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="34a31-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="34a31-254">**Wartość**</span><span class="sxs-lookup"><span data-stu-id="34a31-254">**Value**</span></span> |<span data-ttu-id="34a31-255">Klucz aplikacji hello wywoływania aplikacji (warstwy środkowej - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="34a31-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="34a31-256">**Przykład**</span><span class="sxs-lookup"><span data-stu-id="34a31-256">**Example**</span></span> |<span data-ttu-id="34a31-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="34a31-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="34a31-258">**Klucz**</span><span class="sxs-lookup"><span data-stu-id="34a31-258">**Key**</span></span> | <span data-ttu-id="34a31-259">IDA: zasobów</span><span class="sxs-lookup"><span data-stu-id="34a31-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="34a31-260">**Wartość**</span><span class="sxs-lookup"><span data-stu-id="34a31-260">**Value**</span></span> |<span data-ttu-id="34a31-261">Identyfikator klienta o nazwie aplikacji hello (- projekt ToDoListDataAPI warstwy danych)</span><span class="sxs-lookup"><span data-stu-id="34a31-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="34a31-262">**Przykład**</span><span class="sxs-lookup"><span data-stu-id="34a31-262">**Example**</span></span> |<span data-ttu-id="34a31-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="34a31-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="34a31-264">**Uwaga**: dla `ida:Resource`, upewnij się, że używasz o nazwie aplikacji hello **identyfikator klienta** i nie jego **identyfikator URI aplikacji**.</span><span class="sxs-lookup"><span data-stu-id="34a31-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="34a31-265">`ida:ClientId`i `ida:Resource` są różne wartości w tym samouczku, ponieważ używasz Rozdziel usługi Azure AD applicaations hello warstwy środkowej i warstwy danych.</span><span class="sxs-lookup"><span data-stu-id="34a31-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="34a31-266">Przy użyciu pojedynczej aplikacji usługi Azure AD dla hello wywołanie aplikacji interfejsu API i hello chronione aplikacji interfejsu API, należy użyć hello samą wartość w obu `ida:ClientId` i `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="34a31-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="34a31-267">Hello kodzie użyto ConfigurationManager tooget tych wartości, więc może być przechowywany w pliku Web.config hello projektu lub środowisko uruchomieniowe Azure hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="34a31-268">Po uruchomieniu aplikacji ASP.NET w usłudze Azure App Service ustawienia środowiska automatycznie zastąpić ustawienia z pliku Web.config. Ustawienia środowiska są zwykle [bardziej bezpieczny sposób toostore poufne informacje porównać pliku Web.config tooa](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="34a31-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="34a31-269">Kliknij pozycję **Zapisz**.</span><span class="sxs-lookup"><span data-stu-id="34a31-269">Click **Save**.</span></span>
   
    ![Klikanie pozycji Zapisz.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="34a31-271">Testowanie aplikacji hello</span><span class="sxs-lookup"><span data-stu-id="34a31-271">Test hello application</span></span>
1. <span data-ttu-id="34a31-272">W przeglądarce Przejdź toohello adres URL HTTPS aplikacji sieci web frontonu AngularJS hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="34a31-273">Kliknij przycisk hello **tooDo listy** kartę i zaloguj się przy użyciu poświadczeń użytkownika w dzierżawie usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="34a31-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="34a31-274">Dodaj tooverify elementy zadań do wykonania, która aplikacja hello działa.</span><span class="sxs-lookup"><span data-stu-id="34a31-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![Strona z listą tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="34a31-276">Jeśli aplikacja hello nie działać zgodnie z oczekiwaniami, należy dokładnie sprawdzić wszystkie ustawienia hello, wprowadzony w hello portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="34a31-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="34a31-277">Jeśli są wyświetlane wszystkie ustawienia hello toobe poprawne, zobacz hello [Rozwiązywanie problemów](#troubleshooting) dalszej części tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="34a31-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="34a31-278">Ochrona aplikacji interfejsu API hello z dostęp za pomocą przeglądarki</span><span class="sxs-lookup"><span data-stu-id="34a31-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="34a31-279">W tym samouczku utworzona oddzielna aplikacji usługi Azure AD dla aplikacji hello API ToDoListDataAPI (warstwy danych).</span><span class="sxs-lookup"><span data-stu-id="34a31-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="34a31-280">Jak przedstawiono, gdy usługi aplikacji — tworzy aplikację usługi AAD konfiguruje hello usługi AAD aplikacji w taki sposób, który pozwala na adres URL aplikacji przez użytkownika toogo toohello interfejsu API w przeglądarce i dziennika.</span><span class="sxs-lookup"><span data-stu-id="34a31-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="34a31-281">Oznacza to, istnieje możliwość, że użytkownik końcowy w dzierżawie usługi Azure AD, a nie tylko nazwy głównej usługi, tooaccess hello interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="34a31-282">Jeśli chcesz dostęp za pomocą przeglądarki tooprevent bez pisania żadnego kodu hello chronione aplikacji interfejsu API, można zmienić hello **adres URL odpowiedzi** w hello usługi AAD aplikacji tak, aby różni się od aplikacji hello interfejsu API bazowy adres URL.</span><span class="sxs-lookup"><span data-stu-id="34a31-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="34a31-283">Wyłącz dostęp za pomocą przeglądarki</span><span class="sxs-lookup"><span data-stu-id="34a31-283">Disable browser access</span></span>
1. <span data-ttu-id="34a31-284">W portalu klasycznym hello **Konfiguruj** karcie hello usługi AAD aplikacji, która została utworzona dla hello TodoListService, zmień wartość hello w hello **adres URL odpowiedzi** pola tak, aby prawidłowy adres URL, ale nie hello interfejsu API aplikacji ADRES URL.</span><span class="sxs-lookup"><span data-stu-id="34a31-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="34a31-285">Kliknij pozycję **Zapisz**.</span><span class="sxs-lookup"><span data-stu-id="34a31-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="34a31-286">Sprawdź, czy dostęp za pomocą przeglądarki przestanie działać.</span><span class="sxs-lookup"><span data-stu-id="34a31-286">Verify browser access no longer works</span></span>
<span data-ttu-id="34a31-287">Wcześniej upewnieniu się, że adres URL aplikacji interfejsu API toohello można przejść z przeglądarką logując się przy użyciu poświadczeń użytkownika.</span><span class="sxs-lookup"><span data-stu-id="34a31-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="34a31-288">W tej sekcji możesz sprawdzić, czy nie jest to możliwe.</span><span class="sxs-lookup"><span data-stu-id="34a31-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="34a31-289">W nowym oknie przeglądarki Przejdź toohello adres URL aplikacji interfejsu API hello ponownie.</span><span class="sxs-lookup"><span data-stu-id="34a31-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="34a31-290">Logowanie, gdy monit toodo tak.</span><span class="sxs-lookup"><span data-stu-id="34a31-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="34a31-291">Logowania zakończy się pomyślnie, ale prowadzi tooan strony błędu.</span><span class="sxs-lookup"><span data-stu-id="34a31-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="34a31-292">Skonfigurowano hello usługi AAD aplikacji, aby użytkownicy w dzierżawie usługi AAD hello nie może zalogować się i dostęp do interfejsu API hello w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="34a31-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="34a31-293">Można nadal dostęp do aplikacji interfejsu API hello przy użyciu tokenu głównej usługi, które można sprawdzić, przechodząc adres URL aplikacji sieci web toohello i dodanie więcej elementów do wykonania.</span><span class="sxs-lookup"><span data-stu-id="34a31-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="34a31-294">Ogranicz nazwy głównej usługi określonego tooa dostępu</span><span class="sxs-lookup"><span data-stu-id="34a31-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="34a31-295">Teraz każdego obiektu wywołującego, który można uzyskać token dla użytkownika lub nazwy głównej usługi w dzierżawie usługi Azure AD można wywołać aplikacji hello API TodoListDataAPI (warstwy danych).</span><span class="sxs-lookup"><span data-stu-id="34a31-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="34a31-296">Można toomake się, że tej aplikacji interfejsu API warstwy danych hello akceptuje tylko wywołania z aplikacji interfejsu API (warstwy środkowej) TodoListAPI hello i tylko z określoną usługą podmiot zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="34a31-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="34a31-297">Ograniczenia te można dodać, dodając hello toovalidate kodu `appid` i `objectidentifier` oświadczenia na przychodzące wywołania.</span><span class="sxs-lookup"><span data-stu-id="34a31-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="34a31-298">W tym samouczku, możesz zaznaczyć hello kodu, który sprawdza identyfikator aplikacji i usług identyfikator podmiotu zabezpieczeń bezpośrednio w akcji kontrolera.</span><span class="sxs-lookup"><span data-stu-id="34a31-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="34a31-299">Alternatywne to toouse niestandardowego `Authorize` atrybutu lub toodo tej weryfikacji w sekwencjach uruchamiania (np. oprogramowanie pośredniczące OWIN).</span><span class="sxs-lookup"><span data-stu-id="34a31-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="34a31-300">Na przykład hello ostatnie zobacz [tej aplikacji przykładowej](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="34a31-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="34a31-301">Należy powitania po projekt TodoListDataAPI toohello zmiany.</span><span class="sxs-lookup"><span data-stu-id="34a31-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="34a31-302">Otwórz hello *Controllers/TodoListController.cs* pliku.</span><span class="sxs-lookup"><span data-stu-id="34a31-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="34a31-303">Usuń znaczniki komentarza hello wierszy, które ustawić `trustedCallerClientId` i `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="34a31-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="34a31-304">Usuń znaczniki komentarza hello kodu w hello CheckCallerId metody.</span><span class="sxs-lookup"><span data-stu-id="34a31-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="34a31-305">Ta metoda jest wywoływana na początku każdej metody akcji w kontrolerze hello hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="34a31-306">Należy ponownie wdrożyć tooAzure projekt ToDoListDataAPI hello usługi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="34a31-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="34a31-307">W przeglądarce Przejdź adres URL HTTPS toohello AngularJS fronton aplikacji sieci web, a strona główna powitania kliknij hello **tooDo listy** kartę.</span><span class="sxs-lookup"><span data-stu-id="34a31-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="34a31-308">Aplikacja Hello nie działa, ponieważ wywołania zakończenia toohello ponownie kończą się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="34a31-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="34a31-309">Nowy kod Hello jest sprawdzanie rzeczywisty identyfikator appid i elemencie objectidentifier, ale nie ma jeszcze toocheck poprawnych wartości hello przed ich.</span><span class="sxs-lookup"><span data-stu-id="34a31-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="34a31-310">Przeglądarka Hello konsoli narzędzi dla deweloperów zgłasza, że ten serwer hello zwrócił błąd HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="34a31-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Błąd w Developer Tools konsoli](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="34a31-312">Następujące kroki hello służy do konfigurowania hello oczekiwanych wartości.</span><span class="sxs-lookup"><span data-stu-id="34a31-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="34a31-313">Przy użyciu programu PowerShell usługi Azure AD, uzyskać wartość hello hello usługi głównej hello aplikacji usługi Azure AD, utworzonej dla projektu TodoListWebApp hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="34a31-314">a.</span><span class="sxs-lookup"><span data-stu-id="34a31-314">a.</span></span> <span data-ttu-id="34a31-315">Aby uzyskać instrukcje dotyczące tooinstall programu Azure PowerShell i połączenia tooyour subskrypcji, zobacz [przy użyciu programu Azure PowerShell z usługą Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="34a31-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="34a31-316">b.</span><span class="sxs-lookup"><span data-stu-id="34a31-316">b.</span></span> <span data-ttu-id="34a31-317">tooget listę nazwy główne usług, wykonanie hello `Login-AzureRmAccount` polecenia, a następnie hello `Get-AzureRmADServicePrincipal` polecenia.</span><span class="sxs-lookup"><span data-stu-id="34a31-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="34a31-318">c.</span><span class="sxs-lookup"><span data-stu-id="34a31-318">c.</span></span> <span data-ttu-id="34a31-319">Znajdź hello objectid dla hello nazwy głównej usługi hello TodoListAPI aplikacji i zapisz go w lokalizacji, w której można skopiować z później.</span><span class="sxs-lookup"><span data-stu-id="34a31-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="34a31-320">W hello portalu Azure Przejdź toohello bloku aplikacji interfejsu API dla aplikacji interfejsu API hello wdrożony projekt ToDoListDataAPI hello do.</span><span class="sxs-lookup"><span data-stu-id="34a31-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="34a31-321">Kliknij przycisk **Ustawienia > Ustawienia aplikacji**.</span><span class="sxs-lookup"><span data-stu-id="34a31-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="34a31-322">W hello **ustawień aplikacji** Dodaj hello następujące klucze i wartości:</span><span class="sxs-lookup"><span data-stu-id="34a31-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="34a31-323">**Klucz**</span><span class="sxs-lookup"><span data-stu-id="34a31-323">**Key**</span></span> | <span data-ttu-id="34a31-324">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="34a31-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="34a31-325">**Wartość**</span><span class="sxs-lookup"><span data-stu-id="34a31-325">**Value**</span></span> |<span data-ttu-id="34a31-326">Identyfikator podmiotu zabezpieczeń usługi wywołania aplikacji</span><span class="sxs-lookup"><span data-stu-id="34a31-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="34a31-327">**Przykład**</span><span class="sxs-lookup"><span data-stu-id="34a31-327">**Example**</span></span> |<span data-ttu-id="34a31-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="34a31-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="34a31-329">**Klucz**</span><span class="sxs-lookup"><span data-stu-id="34a31-329">**Key**</span></span> | <span data-ttu-id="34a31-330">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="34a31-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="34a31-331">**Wartość**</span><span class="sxs-lookup"><span data-stu-id="34a31-331">**Value**</span></span> |<span data-ttu-id="34a31-332">Identyfikator klienta aplikacji - skopiowane z aplikacji Azure AD TodoListAPI hello wywołania</span><span class="sxs-lookup"><span data-stu-id="34a31-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="34a31-333">**Przykład**</span><span class="sxs-lookup"><span data-stu-id="34a31-333">**Example**</span></span> |<span data-ttu-id="34a31-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="34a31-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="34a31-335">Kliknij pozycję **Zapisz**.</span><span class="sxs-lookup"><span data-stu-id="34a31-335">Click **Save**.</span></span>
    
     ![Klikanie pozycji Zapisz.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="34a31-337">W przeglądarce adres zwrotny URL aplikacji sieci web toohello, a strona główna powitania kliknij hello **tooDo listy** kartę.</span><span class="sxs-lookup"><span data-stu-id="34a31-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="34a31-338">Ta aplikacja hello czas działa zgodnie z oczekiwaniami, ponieważ hello wywołującego zaufanych aplikacji identyfikator i identyfikator podmiotu zabezpieczeń usługi hello oczekiwanej wartości.</span><span class="sxs-lookup"><span data-stu-id="34a31-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![Strona z listą tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="34a31-340">Kompilowanie projektów powitania od podstaw</span><span class="sxs-lookup"><span data-stu-id="34a31-340">Building hello projects from scratch</span></span>
<span data-ttu-id="34a31-341">Witaj dwa projekty interfejsu API sieci Web zostały utworzone przy użyciu hello **aplikacji interfejsu API Azure** szablonu i zastąpienie hello domyślne wartości kontroler z kontrolerem listy zadań projektu.</span><span class="sxs-lookup"><span data-stu-id="34a31-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="34a31-342">Uzyskania tokeny podmiotu zabezpieczeń usługi Azure AD w projekcie ToDoListAPI hello hello [Active Directory Authentication Library (ADAL) dla platformy .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) zainstalowano pakiet NuGet.</span><span class="sxs-lookup"><span data-stu-id="34a31-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="34a31-343">Aby uzyskać informacje na temat za tworzenie aplikacji jednostronicowej AngularJS z interfejsu API sieci Web wewnętrznej jak ToDoListAngular, zobacz [ręce w laboratorium: tworzenie jednej strony aplikacji JEDNOSTRONICOWEJ z interfejsu API sieci Web platformy ASP.NET i Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="34a31-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="34a31-344">Aby uzyskać informacje na temat tooadd kod uwierzytelniania usługi Azure AD, zobacz [zabezpieczanie AngularJS jednej strony aplikacji za pomocą usługi Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="34a31-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="34a31-345">Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="34a31-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="34a31-346">Upewnij się, że użytkownik nie należy mylić (warstwy środkowej) ToDoListAPI i ToDoListDataAPI (warstwy danych).</span><span class="sxs-lookup"><span data-stu-id="34a31-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="34a31-347">Na przykład, w tym samouczku, możesz dodać uwierzytelniania toohello aplikacji warstwy danych interfejsu API, **, ale klucz aplikacji hello muszą pochodzić z hello aplikacji usługi Azure AD, który został utworzony dla aplikacji interfejsu API warstwy środkowej hello**.</span><span class="sxs-lookup"><span data-stu-id="34a31-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="34a31-348">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="34a31-348">Next steps</span></span>
<span data-ttu-id="34a31-349">To jest ostatni samouczek hello w hello serii aplikacje interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="34a31-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="34a31-350">Aby uzyskać więcej informacji na temat usługi Azure Active Directory zobacz następujące zasoby hello.</span><span class="sxs-lookup"><span data-stu-id="34a31-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="34a31-351">Przewodnik Azure deweloperzy AD</span><span class="sxs-lookup"><span data-stu-id="34a31-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="34a31-352">Scenariusze usługi Azure AD</span><span class="sxs-lookup"><span data-stu-id="34a31-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="34a31-353">Przykłady Azure AD</span><span class="sxs-lookup"><span data-stu-id="34a31-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="34a31-354">Witaj [aplikacji sieci Web-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) przypomina próbki toowhat jest wyświetlany w tym samouczku, ale bez korzystania z usługi aplikacji uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="34a31-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="34a31-355">Aby uzyskać informacje o innych metodach toodeploy Visual Studio projektów tooAPI aplikacji, za pomocą programu Visual Studio lub [automatyzacji wdrażania](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) z [systemu kontroli źródła](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), zobacz [jak toodeploy Usługa aplikacji Azure aplikacji](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="34a31-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

