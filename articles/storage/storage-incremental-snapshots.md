---
title: "aaaUse migawki przyrostowych kopii zapasowych i odzyskiwania niezarządzane dysków maszyny Wirtualnej platformy Azure | Dokumentacja firmy Microsoft"
description: "Tworzenie niestandardowego rozwiązania do tworzenia kopii zapasowych i odzyskiwania dysków maszyny wirtualnej platformy Azure przy użyciu przyrostowej migawki."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 6d3e6d78e953f77a1028ac35dcde1ef046dbc3bb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="19a7b-103">Tworzenie kopii zapasowej Azure niezarządzane dysków maszyny Wirtualnej z migawkami przyrostowe</span><span class="sxs-lookup"><span data-stu-id="19a7b-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="19a7b-104">Omówienie</span><span class="sxs-lookup"><span data-stu-id="19a7b-104">Overview</span></span>
<span data-ttu-id="19a7b-105">Usługa Azure Storage udostępnia możliwość hello migawki tootake obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-105">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="19a7b-106">Migawki przechwytywania stanu obiektu blob hello w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="19a7b-106">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="19a7b-107">W tym artykule firma Microsoft opisano scenariusz jak może przechowywać kopie zapasowe przy użyciu migawek dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="19a7b-108">Po wybraniu toouse nie można użyć tej metody kopia zapasowa Azure i usługi odzyskiwania i chcą toocreate niestandardowych strategii tworzenia kopii zapasowych dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-108">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="19a7b-109">Dyski maszyny wirtualnej platformy Azure są przechowywane jako stronicowe obiekty BLOB w usłudze Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="19a7b-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="19a7b-110">Ponieważ firma Microsoft mówimy więc o strategii tworzenia kopii zapasowych dysków maszyny wirtualnej w tym artykule, firma Microsoft będzie odwołanie toosnapshots w kontekście hello stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="19a7b-111">toolearn więcej informacji na temat migawek, zobacz zbyt[tworzenia migawki obiektu Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="19a7b-111">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="19a7b-112">Co to jest migawkę?</span><span class="sxs-lookup"><span data-stu-id="19a7b-112">What is a snapshot?</span></span>
<span data-ttu-id="19a7b-113">Migawki obiektu blob jest tylko do odczytu wersji obiektu blob przechwyconych w punkcie w czasie.</span><span class="sxs-lookup"><span data-stu-id="19a7b-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="19a7b-114">Po utworzeniu migawki, to można można odczytać, kopiowane, lub usunięte, ale nie został zmodyfikowany.</span><span class="sxs-lookup"><span data-stu-id="19a7b-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="19a7b-115">Migawki zapewniają tooback sposób się obiektu blob znajduje się na chwilę w czasie.</span><span class="sxs-lookup"><span data-stu-id="19a7b-115">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="19a7b-116">Do POZOSTAŁEJ wersji 2015-04-05, trzeba było hello możliwości toocopy pełnej migawki.</span><span class="sxs-lookup"><span data-stu-id="19a7b-116">Until REST version 2015-04-05 you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="19a7b-117">Z hello REST wersji 2015-07-08 lub wyższej, możesz również skopiować przyrostowe migawki.</span><span class="sxs-lookup"><span data-stu-id="19a7b-117">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="19a7b-118">Pełna migawka kopii</span><span class="sxs-lookup"><span data-stu-id="19a7b-118">Full snapshot copy</span></span>
<span data-ttu-id="19a7b-119">Migawki mogą być kopiowane konta magazynu tooanother jako zapasowe tookeep obiektów blob, hello podstawowego obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-119">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="19a7b-120">Można także skopiować migawki przez blob podstawowej, czyli jak przywracanie tooan obiektu blob hello starszej wersji.</span><span class="sxs-lookup"><span data-stu-id="19a7b-120">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="19a7b-121">Gdy migawki zostaną skopiowane z jednego tooanother konta magazynu, zajmie hello sam obszar jako obiektu blob strony podstawowej hello.</span><span class="sxs-lookup"><span data-stu-id="19a7b-121">When a snapshot is copied from one storage account tooanother, it will occupy hello same space as hello base page blob.</span></span> <span data-ttu-id="19a7b-122">W związku z tym Kopiowanie całego migawki z jednego tooanother konta magazynu będzie zajmować dużo czasu i będą korzystać z dużej ilości miejsca w hello docelowe konto magazynu.</span><span class="sxs-lookup"><span data-stu-id="19a7b-122">Therefore, copying whole snapshots from one storage account tooanother will be slow and will also consume lot of space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="19a7b-123">Po skopiowaniu hello podstawowego obiektu blob tooanother docelowego migawki hello hello obiektu blob nie są kopiowane wraz z jej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-123">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="19a7b-124">Podobnie jeśli podstawowego obiektu blob zastąpić kopii, migawki skojarzone z obiektem blob podstawowej hello nie dotyczy i pozostać bez zmian w obszarze nazwy podstawowe obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="19a7b-125">Wykonywanie kopii zapasowych dysków przy użyciu migawek</span><span class="sxs-lookup"><span data-stu-id="19a7b-125">Back up disks using snapshots</span></span>
<span data-ttu-id="19a7b-126">Jako strategii tworzenia kopii zapasowej dla dysków maszyny wirtualnej można migawek hello obiektu blob dysku lub stronę i skopiuj je tooanother konto magazynu przy użyciu narzędzia, takie jak [kopiowania obiektu Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operacji lub [AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="19a7b-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="19a7b-127">Można skopiować obiektu blob strony migawki tooa docelowy o innej nazwie.</span><span class="sxs-lookup"><span data-stu-id="19a7b-127">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="19a7b-128">Obiekt blob Hello wynikowy docelowej strony jest zapisywalny stronicowy obiekt blob i nie migawki.</span><span class="sxs-lookup"><span data-stu-id="19a7b-128">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="19a7b-129">W dalszej części tego artykułu możemy opisano kroki tootake kopie zapasowe przy użyciu migawek dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-129">Later in this article we will describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="19a7b-130">Przywracanie dysków za pomocą migawek</span><span class="sxs-lookup"><span data-stu-id="19a7b-130">Restore disks using snapshots</span></span>
<span data-ttu-id="19a7b-131">Gdy nadejdzie czas toorestore dysku tooa poprzedniej wersji stabilnej przechwycone w jednym z hello migawek kopii zapasowych, możesz skopiować migawki za pośrednictwem obiektu blob strony podstawowej hello.</span><span class="sxs-lookup"><span data-stu-id="19a7b-131">When it is time toorestore your disk tooa previous stable version captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="19a7b-132">Po migawki hello jest awansowana toohello blob strony podstawowej, hello pozostaje migawki, ale jego źródło jest zastępowany kopii, którą można zarówno Odczyt i zapis.</span><span class="sxs-lookup"><span data-stu-id="19a7b-132">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="19a7b-133">W dalszej części tego artykułu możemy opisano kroki toorestore poprzednią wersję dysku z jej migawek.</span><span class="sxs-lookup"><span data-stu-id="19a7b-133">Later in this article we will describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="19a7b-134">Implementowanie pełna migawka kopii</span><span class="sxs-lookup"><span data-stu-id="19a7b-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="19a7b-135">Wykonując poniższe polecenie hello, można zaimplementować pełna migawka kopii</span><span class="sxs-lookup"><span data-stu-id="19a7b-135">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="19a7b-136">Najpierw Utwórz migawkę hello blob podstawowej za pomocą hello [migawki obiektu Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operacji.</span><span class="sxs-lookup"><span data-stu-id="19a7b-136">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="19a7b-137">Następnie kopiowania hello migawki tooa docelowym magazynu konta za pomocą [kopiowania obiektu Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="19a7b-137">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="19a7b-138">Powtórz ten proces toomaintain kopie zapasowe z podstawowego obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-138">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="19a7b-139">Kopiuj przyrostowe migawki</span><span class="sxs-lookup"><span data-stu-id="19a7b-139">Incremental snapshot copy</span></span>
<span data-ttu-id="19a7b-140">Nowa funkcja Hello w [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) interfejs API udostępnia znacznie lepszą tooback sposób zapasowej migawki hello stronicowych obiektów blob lub dysków.</span><span class="sxs-lookup"><span data-stu-id="19a7b-140">hello new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="19a7b-141">Hello interfejsu API zwraca listę hello zmiany między hello podstawowej obiektów blob i hello migawki.</span><span class="sxs-lookup"><span data-stu-id="19a7b-141">hello API returns hello list of changes between hello base blob and hello snapshots.</span></span> <span data-ttu-id="19a7b-142">Zmniejsza to hello ilość miejsca używanego na powitania konto kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-142">This reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="19a7b-143">Hello interfejs API obsługuje stronicowych obiektów blob na magazyn w warstwie Premium, a także magazynu w warstwie standardowa.</span><span class="sxs-lookup"><span data-stu-id="19a7b-143">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="19a7b-144">Przy użyciu tego interfejsu API, można teraz tworzyć szybsze i wydajne rozwiązania kopii zapasowej dla maszyn wirtualnych platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="19a7b-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="19a7b-145">Są to dostępnych hello REST wersji 2015-07-08 i wyższych.</span><span class="sxs-lookup"><span data-stu-id="19a7b-145">This will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="19a7b-146">Przyrostowa kopia migawki umożliwia toocopy z jednego magazynu konta tooanother hello różnicy między,</span><span class="sxs-lookup"><span data-stu-id="19a7b-146">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="19a7b-147">Podstawowy obiektów blob i jego migawki lub</span><span class="sxs-lookup"><span data-stu-id="19a7b-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="19a7b-148">Wszystkie migawki dwóch hello podstawowego obiektu blob</span><span class="sxs-lookup"><span data-stu-id="19a7b-148">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="19a7b-149">Podana hello następujące warunki są spełnione,</span><span class="sxs-lookup"><span data-stu-id="19a7b-149">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="19a7b-150">Obiekt blob Hello utworzono Jan-1-2016 lub nowszy.</span><span class="sxs-lookup"><span data-stu-id="19a7b-150">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="19a7b-151">Hello obiektu blob nie zostało zastąpione [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) lub [kopiowania obiektu Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) między dwiema migawkami.</span><span class="sxs-lookup"><span data-stu-id="19a7b-151">hello blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="19a7b-152">**Uwaga**: Ta funkcja jest dostępna dla Premium i standardowa Azure stronicowe obiekty BLOB.</span><span class="sxs-lookup"><span data-stu-id="19a7b-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="19a7b-153">Jeśli masz niestandardowe strategii tworzenia kopii zapasowej, która korzysta z migawki, kopiowanie migawek hello z jednego tooanother konta magazynu może być bardzo wolno i zużywa dużo miejsca do magazynowania.</span><span class="sxs-lookup"><span data-stu-id="19a7b-153">When you have a custom backup strategy that uses snapshots, copying hello snapshots from one storage account tooanother can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="19a7b-154">Zamiast kopiować konta magazynu kopii zapasowej tooa cały migawki hello, można napisać hello różnica między blob kopii zapasowej strony tooa kolejnych migawek.</span><span class="sxs-lookup"><span data-stu-id="19a7b-154">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="19a7b-155">W ten sposób hello czasu toocopy miejsca toostore kopii zapasowych i znacznie zmniejszyć.</span><span class="sxs-lookup"><span data-stu-id="19a7b-155">This way, hello time toocopy and space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="19a7b-156">Implementowanie kopiowania przyrostowe migawki</span><span class="sxs-lookup"><span data-stu-id="19a7b-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="19a7b-157">Można zaimplementować przyrostowe migawki kopii następujący hello</span><span class="sxs-lookup"><span data-stu-id="19a7b-157">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="19a7b-158">Utwórz migawkę przy użyciu podstawowego obiektu blob hello [migawki obiektu Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="19a7b-158">Take a snapshot of hello base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="19a7b-159">Kopiuj hello migawki toohello docelowej magazynu kopii zapasowej konta przy użyciu [kopiowania obiektu Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="19a7b-159">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="19a7b-160">Są to hello blob kopii zapasowej strony.</span><span class="sxs-lookup"><span data-stu-id="19a7b-160">This will be hello backup page blob.</span></span> <span data-ttu-id="19a7b-161">Utworzenie migawki tej kopii zapasowej stronicowych obiektów blob i przechowywać w konto kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="19a7b-162">Utwórz kolejną migawkę podstawowego obiektu blob hello za pomocą migawki obiektu Blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-162">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="19a7b-163">Pobierz hello różnica między pierwszego i drugiego migawki za pomocą podstawowego obiektu blob [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span><span class="sxs-lookup"><span data-stu-id="19a7b-163">Get hello difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="19a7b-164">Użyj nowego parametru hello **prevsnapshot** toospecify hello wartość DateTime ma różnicy hello tooget z migawki hello.</span><span class="sxs-lookup"><span data-stu-id="19a7b-164">Use hello new parameter **prevsnapshot** toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="19a7b-165">Jeśli ten parametr jest obecny, hello odpowiedzi REST uwzględni tylko stron hello, które zostały zmienione między migawki docelowej i poprzednią migawkę tym wyczyść strony.</span><span class="sxs-lookup"><span data-stu-id="19a7b-165">When this parameter is present, hello REST response will include only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="19a7b-166">Użyj [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) tooapply te zmiany toohello kopii zapasowej stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="19a7b-167">Na koniec migawki obiektu blob kopii zapasowej strony hello i zapisze go na koncie magazynu kopii zapasowej hello.</span><span class="sxs-lookup"><span data-stu-id="19a7b-167">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="19a7b-168">W następnej sekcji hello możemy opisano szczegółowo w sposób umożliwiający obsługę kopii zapasowych dysków przy użyciu przyrostowej migawki kopii</span><span class="sxs-lookup"><span data-stu-id="19a7b-168">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="19a7b-169">Scenariusz</span><span class="sxs-lookup"><span data-stu-id="19a7b-169">Scenario</span></span>
<span data-ttu-id="19a7b-170">W tej sekcji możemy opisano scenariusz, który obejmuje niestandardowych strategii tworzenia kopii zapasowej przy użyciu migawek dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="19a7b-171">Rozważ premium magazynu P30 dysku maszyny Wirtualnej Azure serii DS.</span><span class="sxs-lookup"><span data-stu-id="19a7b-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="19a7b-172">Witaj P30 dysk o nazwie *mypremiumdisk* są przechowywane na koncie magazynu premium o nazwie *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-172">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="19a7b-173">Konto magazynu w warstwie standardowa nazywane *mybackupstdaccount* będzie służyć do przechowywania kopii zapasowej hello *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-173">A standard storage account called *mybackupstdaccount* will be used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="19a7b-174">Chcielibyśmy tookeep migawki z *mypremiumdisk* co 12 godzin.</span><span class="sxs-lookup"><span data-stu-id="19a7b-174">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="19a7b-175">toolearn dotyczące tworzenia konta magazynu i dyski, można znaleźć zbyt[kont magazynu Azure o](storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="19a7b-175">toolearn about creating storage account and disks, refer too[About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="19a7b-176">toolearn o tworzeniu kopii zapasowych maszyn wirtualnych platformy Azure, zobacz zbyt[kopii zapasowych maszyny Wirtualnej Azure Planowanie](../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="19a7b-176">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="19a7b-177">Kopie zapasowe toomaintain kroki dysk przy użyciu przyrostowej migawki</span><span class="sxs-lookup"><span data-stu-id="19a7b-177">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="19a7b-178">Hello opisane poniżej będzie migawek *mypremiumdisk* i obsługa kopii zapasowych hello w *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-178">hello steps described below will take snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="19a7b-179">Witaj kopia zapasowa będzie standardowy stronicowy obiekt blob o nazwie *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-179">hello backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="19a7b-180">Witaj kopii zapasowej stronicowych obiektów blob będzie zawsze odzwierciedla hello sam stan jako ostatnia migawka hello z *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-180">hello backup page blob will always reflect hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="19a7b-181">Najpierw utwórz hello kopii zapasowej stronicowych obiektów blob dla dysku magazynu premium.</span><span class="sxs-lookup"><span data-stu-id="19a7b-181">First, create hello backup page blob for your premium storage disk.</span></span> <span data-ttu-id="19a7b-182">toodo, wykonaj migawki *mypremiumdisk* o nazwie *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-182">toodo this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="19a7b-183">Skopiuj to toomybackupstdaccount migawki jako stronicowy obiekt blob o nazwie *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-183">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="19a7b-184">Utwórz migawkę *mybackupstdpageblob* o nazwie *mybackupstdpageblob_ss1*za pomocą [migawki obiektu Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) i zapisze go w *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="19a7b-185">Podczas hello okna kopii zapasowej, Utwórz kolejną migawkę z *mypremiumdisk*, powiedz *mypremiumdisk_ss2*i zapisz go w *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-185">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="19a7b-186">Pobrać hello przyrostowe zmiany między migawki hello dwa *mypremiumdisk_ss2* i *mypremiumdisk_ss1*za pomocą [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) na  *mypremiumdisk_ss2* z **prevsnapshot** toohello sygnaturę czasową ustawiono parametru *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-186">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="19a7b-187">Zapisać te zmiany przyrostowe toohello kopii zapasowej stronicowych obiektów blob *mybackupstdpageblob* w *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-187">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="19a7b-188">W przypadku usunięto zakresów w hello przyrostowe zmiany, muszą zostać wyczyszczone z obiektu blob kopii zapasowej strony hello.</span><span class="sxs-lookup"><span data-stu-id="19a7b-188">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="19a7b-189">Użyj [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) toowrite zmiany przyrostowe toohello kopii zapasowej strony blob.</span><span class="sxs-lookup"><span data-stu-id="19a7b-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="19a7b-190">Utworzenie migawki obiektu blob kopii zapasowej strony hello *mybackupstdpageblob*o nazwie *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-190">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="19a7b-191">Usunąć poprzednią migawkę hello *mypremiumdisk_ss1* z konta magazynu premium.</span><span class="sxs-lookup"><span data-stu-id="19a7b-191">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="19a7b-192">Powtórz kroki 4 – 6 co okna kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="19a7b-193">W ten sposób można zachować kopie zapasowe *mypremiumdisk* w ramach konta magazynu w warstwie standardowa.</span><span class="sxs-lookup"><span data-stu-id="19a7b-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Tworzenie kopii zapasowej dysku przy użyciu przyrostowej migawki](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="19a7b-195">Kroki toorestore dysku z migawki</span><span class="sxs-lookup"><span data-stu-id="19a7b-195">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="19a7b-196">Witaj opisane poniżej spowoduje przywrócenie dysku premium *mypremiumdisk* tooan wcześniej migawki z konta magazynu kopii zapasowych hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-196">hello steps described below will restore premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="19a7b-197">Zidentyfikuj hello punktu w czasie, którego chcesz toorestore hello premium dysku.</span><span class="sxs-lookup"><span data-stu-id="19a7b-197">Identify hello point in time you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="19a7b-198">Załóżmy, że utworzenie migawki *mybackupstdpageblob_ss2*, który jest przechowywany na koncie magazynu kopii zapasowej hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="19a7b-199">W mybackupstdaccount, podwyższyć poziom migawki hello *mybackupstdpageblob_ss2* jako obiekt blob hello nowej strony podstawowej kopii zapasowej *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-199">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="19a7b-200">Utworzenie migawki tej przywróconej kopii zapasowej stronicowych obiektów blob, nazywany *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="19a7b-201">Kopiuj hello przywrócić stronicowych obiektów blob *mybackupstdpageblobrestored* z *mybackupstdaccount* za*mypremiumaccount* jako nowego dysku premium hello  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="19a7b-201">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="19a7b-202">Utwórz migawkę *mypremiumdiskrestored*o nazwie *mypremiumdiskrestored_ss1* dokonywania przyszłych przyrostowych kopii zapasowych.</span><span class="sxs-lookup"><span data-stu-id="19a7b-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="19a7b-203">Wskaż serii hello DS dysku toohello przywrócić maszyny Wirtualnej *mypremiumdiskrestored* i odłączania hello starego *mypremiumdisk* z hello maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="19a7b-203">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="19a7b-204">Rozpocząć proces tworzenia kopii zapasowej hello opisanego w poprzedniej sekcji hello przywrócić dysku *mypremiumdiskrestored*, przy użyciu hello *mybackupstdpageblobrestored* jako hello blob kopii zapasowej strony.</span><span class="sxs-lookup"><span data-stu-id="19a7b-204">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![Przywracanie z migawki dysku](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="19a7b-206">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="19a7b-206">Next Steps</span></span>
<span data-ttu-id="19a7b-207">Dowiedz się więcej o tworzeniu migawki obiektu blob i planowania infrastruktury kopii zapasowych maszyn wirtualnych przy użyciu poniższych łączy hello.</span><span class="sxs-lookup"><span data-stu-id="19a7b-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using hello links below.</span></span>

* [<span data-ttu-id="19a7b-208">Utworzenie migawki obiektu Blob</span><span class="sxs-lookup"><span data-stu-id="19a7b-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="19a7b-209">Zaplanuj infrastrukturę kopii zapasowej maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="19a7b-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)

