---
title: "Obsługa zapory DB rozwiązania Cosmos & IP Azure kontrola dostępu | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak używać zasad kontroli dostępu dla adresu IP dla strony Obsługa zapory na kontach bazy danych Azure DB rozwiązania Cosmos."
keywords: "Kontrola dostępu do adresu IP, obsługi zapory"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="3723b-104">Obsługa zapory w usłudze Azure DB rozwiązania Cosmos</span><span class="sxs-lookup"><span data-stu-id="3723b-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="3723b-105">Aby zabezpieczyć dane przechowywane na koncie Azure DB rozwiązania Cosmos bazy danych, bazy danych Azure rozwiązania Cosmos udostępnił pomocy technicznej na podstawie klucza tajnego [modelu autoryzacji](https://msdn.microsoft.com/library/azure/dn783368.aspx) , która zawiera kod uwierzytelniania wiadomości Hash-based silne (HMAC).</span><span class="sxs-lookup"><span data-stu-id="3723b-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="3723b-106">Oprócz modelu autoryzacji na podstawie tajnego bazy danych Azure rozwiązania Cosmos obsługuje teraz, zasady kontroli dostępu na podstawie adresu IP dla strony Obsługa zapory dla ruchu przychodzącego zmiennych.</span><span class="sxs-lookup"><span data-stu-id="3723b-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="3723b-107">Ten model jest bardzo podobne do reguł zapory systemu tradycyjne bazy danych i zapewnia dodatkowy poziom zabezpieczeń do bazy danych Azure rozwiązania Cosmos konta bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3723b-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="3723b-108">Z tym modelem można teraz skonfigurować konto bazy danych DB rozwiązania Cosmos Azure można uzyskiwać tylko z zatwierdzonych zbiór maszyny i/lub usług w chmurze.</span><span class="sxs-lookup"><span data-stu-id="3723b-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="3723b-109">Dostęp do zasobów bazy danych Azure rozwiązania Cosmos z tych zestawów zatwierdzonych komputery i usługi wymagają nadal obiekt wywołujący, aby przedstawić token prawidłowego autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="3723b-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="3723b-110">Omówienie kontroli dostępu dla adresu IP</span><span class="sxs-lookup"><span data-stu-id="3723b-110">IP access control overview</span></span>
<span data-ttu-id="3723b-111">Domyślnie konto bazy danych Azure DB rozwiązania Cosmos jest dostępny z publicznej sieci internet, tak długo, jak długo żądanie towarzyszy token prawidłowego autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="3723b-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="3723b-112">Aby skonfigurować kontroli dostępu na podstawie zasad IP, użytkownik musi podać zbiór adresów IP i zakresów adresów IP w postaci CIDR do uwzględnienia jako lista dozwolonych adresów IP klienta, konto bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3723b-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="3723b-113">Po zastosowaniu tej konfiguracji wszystkich żądań wysyłanych z komputerów spoza tej listy dozwolonych jest blokowana przez serwer.</span><span class="sxs-lookup"><span data-stu-id="3723b-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="3723b-114">Na poniższym diagramie opisano połączenia przetwarzania przepływu kontroli dostępu opartej na protokole IP.</span><span class="sxs-lookup"><span data-stu-id="3723b-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagram przedstawiający proces łączenia dla kontroli dostępu na podstawie adresu IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="3723b-116">Połączenia z usługi w chmurze</span><span class="sxs-lookup"><span data-stu-id="3723b-116">Connections from cloud services</span></span>
<span data-ttu-id="3723b-117">Na platformie Azure usługi w chmurze są bardzo typowy sposób do hostowania warstwy środkowej logiki usługi przy użyciu bazy danych Azure rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="3723b-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="3723b-118">Aby włączyć dostęp do bazy danych Azure rozwiązania Cosmos konta bazy danych z usługi w chmurze, publiczny adres IP usługi w chmurze należy dodać do listy dozwolonych adresów IP skojarzonych z Twoim kontem bazy danych Azure DB rozwiązania Cosmos przez [Konfigurowanie dostępu do adresu IP kontrolowanie zasad](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="3723b-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="3723b-119">Gwarantuje to, że wszystkich wystąpień roli usługi w chmurze dostęp do Twojego konta bazy danych Azure DB rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="3723b-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="3723b-120">Możesz pobrać adresy IP dla usług w chmurze w portalu Azure, jak pokazano na poniższym zrzucie ekranu.</span><span class="sxs-lookup"><span data-stu-id="3723b-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Zrzut ekranu przedstawiający publiczny adres IP w usłudze w chmurze wyświetlane w portalu Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="3723b-122">Podczas skalowanie usługi w chmurze, dodając rolę dodatkowe wystąpienia tych nowych wystąpień automatycznie mają dostęp do bazy danych Azure rozwiązania Cosmos konto bazy danych, ponieważ są one częścią tej samej usługi w chmurze.</span><span class="sxs-lookup"><span data-stu-id="3723b-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="3723b-123">Połączenia z maszyn wirtualnych</span><span class="sxs-lookup"><span data-stu-id="3723b-123">Connections from virtual machines</span></span>
<span data-ttu-id="3723b-124">[Maszyny wirtualne](https://azure.microsoft.com/services/virtual-machines/) lub [zestawy skalowania maszyny wirtualnej](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) może również służyć do hostowania warstwy środkowej usług przy użyciu bazy danych Azure rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="3723b-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="3723b-125">Skonfiguruj konto bazy danych DB rozwiązania Cosmos Azure, aby zezwolić na dostęp z maszyn wirtualnych, publicznych adresów IP maszyny wirtualnej i/lub maszyny wirtualnej zestawu skali musi być skonfigurowany jako jeden z dozwolonych adresów IP dla konta bazy danych Azure DB rozwiązania Cosmos przez [Konfigurowanie zasad kontroli dostępu IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="3723b-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="3723b-126">Można pobrać adresy IP dla maszyn wirtualnych w portalu Azure, jak pokazano na poniższym zrzucie ekranu.</span><span class="sxs-lookup"><span data-stu-id="3723b-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Zrzut ekranu przedstawiający publicznego adresu IP dla maszyny wirtualnej, wyświetlane w portalu Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="3723b-128">Po dodaniu wystąpień dodatkowych maszyn wirtualnych do grupy są automatycznie udostępniane dostęp do Twojego konta bazy danych Azure DB rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="3723b-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="3723b-129">Połączenia z Internetu</span><span class="sxs-lookup"><span data-stu-id="3723b-129">Connections from the internet</span></span>
<span data-ttu-id="3723b-130">Gdy uzyskujesz dostęp do bazy danych Azure rozwiązania Cosmos konto bazy danych z komputera w Internecie, adres IP klienta lub zakres adresów IP komputera, należy dodać do listy dozwolonych adresów IP do bazy danych Azure rozwiązania Cosmos konta bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3723b-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="3723b-131"><a id="configure-ip-policy"></a>Konfigurowanie zasad kontroli dostępu IP</span><span class="sxs-lookup"><span data-stu-id="3723b-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="3723b-132">Zasady kontroli dostępu IP można ustawić w portalu Azure lub programistycznie za pomocą [interfejsu wiersza polecenia Azure](cli-samples.md), [programu Azure Powershell](powershell-samples.md), lub [interfejsu API REST](/rest/api/documentdb/) aktualizując `ipRangeFilter`właściwości.</span><span class="sxs-lookup"><span data-stu-id="3723b-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="3723b-133">Zakresy adresów IP musi być przecinkami oddzielone i nie może zawierać spacji.</span><span class="sxs-lookup"><span data-stu-id="3723b-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="3723b-134">Przykład: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="3723b-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="3723b-135">Podczas aktualizowania konta bazy danych za pomocą tych metod, pamiętaj wypełnić wszystkie właściwości, aby zapobiec zresetowanie do domyślnych ustawień.</span><span class="sxs-lookup"><span data-stu-id="3723b-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="3723b-136">Przez włączenie IP zasady kontroli dostępu dla konta bazy danych Azure rozwiązania Cosmos bazy danych, dostęp do konta bazy danych Azure rozwiązania Cosmos bazy danych z komputerów poza skonfigurowanego dozwolone listę zakresów adresów IP są zablokowane.</span><span class="sxs-lookup"><span data-stu-id="3723b-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="3723b-137">Z tym modelem przeglądanie operacji płaszczyzna danych z portalu będzie również zablokowany do zapewnienia integralności kontroli dostępu.</span><span class="sxs-lookup"><span data-stu-id="3723b-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="3723b-138">Aby ułatwić projektowanie, portalu Azure ułatwia Identyfikuj i Dodaj adres IP komputera klienta do listy dozwolonych, dzięki czemu aplikacje działające na tym komputerze można uzyskać dostęp do konta bazy danych Azure rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="3723b-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="3723b-139">Należy pamiętać, wykrycie tutaj adres IP klienta, widziany przez portal.</span><span class="sxs-lookup"><span data-stu-id="3723b-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="3723b-140">Może to być adres IP klienta na komputerze, ale może być również adres IP bramy sieci.</span><span class="sxs-lookup"><span data-stu-id="3723b-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="3723b-141">Pamiętaj usunąć go przed przejściem do środowiska produkcyjnego.</span><span class="sxs-lookup"><span data-stu-id="3723b-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="3723b-142">Aby ustawić zasady kontroli dostępu do adresu IP w portalu Azure, przejdź do bloku konta bazy danych rozwiązania Cosmos platformy Azure, kliknij przycisk **zapory** w menu nawigacji, następnie kliknij przycisk **ON**</span><span class="sxs-lookup"><span data-stu-id="3723b-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Zrzut ekranu pokazujący sposób otworzyć blok zapory w portalu Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="3723b-144">W okienku, określ, czy portalu Azure można uzyskać dostępu do konta i dodać inne adresów i zakresów, jakie odpowiednie, a następnie kliknij przycisk **zapisać**.</span><span class="sxs-lookup"><span data-stu-id="3723b-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="3723b-145">Po włączeniu zasady kontroli dostępu do adresu IP, należy dodać adres IP portalu Azure w celu uzyskania dostępu.</span><span class="sxs-lookup"><span data-stu-id="3723b-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="3723b-146">Portal adresy IP są:</span><span class="sxs-lookup"><span data-stu-id="3723b-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="3723b-147">Region</span><span class="sxs-lookup"><span data-stu-id="3723b-147">Region</span></span>|<span data-ttu-id="3723b-148">Adres IP</span><span class="sxs-lookup"><span data-stu-id="3723b-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="3723b-149">Wszystkie regiony, z wyjątkiem tych określonych poniżej</span><span class="sxs-lookup"><span data-stu-id="3723b-149">All regions except those specified below</span></span>| <span data-ttu-id="3723b-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="3723b-150">104.42.195.92</span></span>|
> |<span data-ttu-id="3723b-151">Niemcy</span><span class="sxs-lookup"><span data-stu-id="3723b-151">Germany</span></span>|<span data-ttu-id="3723b-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="3723b-152">51.4.229.218</span></span>|
> |<span data-ttu-id="3723b-153">Chiny</span><span class="sxs-lookup"><span data-stu-id="3723b-153">China</span></span>|<span data-ttu-id="3723b-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="3723b-154">139.217.8.252</span></span>|
> |<span data-ttu-id="3723b-155">Administracja USA — Arizona</span><span class="sxs-lookup"><span data-stu-id="3723b-155">US Gov Arizona</span></span>|<span data-ttu-id="3723b-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="3723b-156">52.244.48.71</span></span>|
>

![Zrzut ekranu pokazujący sposób konfigurowania ustawień zapory w portalu Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="3723b-158">Rozwiązywanie problemów z zasady kontroli dostępu do adresu IP</span><span class="sxs-lookup"><span data-stu-id="3723b-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="3723b-159">Operacje portalu</span><span class="sxs-lookup"><span data-stu-id="3723b-159">Portal operations</span></span>
<span data-ttu-id="3723b-160">Przez włączenie IP zasady kontroli dostępu dla konta bazy danych Azure rozwiązania Cosmos bazy danych, dostęp do konta bazy danych Azure rozwiązania Cosmos bazy danych z komputerów poza skonfigurowanego dozwolone listę zakresów adresów IP są zablokowane.</span><span class="sxs-lookup"><span data-stu-id="3723b-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="3723b-161">W związku z tym jeśli chcesz włączyć danych portalu płaszczyzny operacje, takie jak przeglądanie kolekcje i kwerendy dokumentów, musisz jawnie zezwolić na korzystanie z dostępu do portalu Azure **zapory** bloku w portalu.</span><span class="sxs-lookup"><span data-stu-id="3723b-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Zrzut ekranu pokazujący sposób, aby umożliwić dostęp do portalu Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="3723b-163">Zestaw SDK & Rest API</span><span class="sxs-lookup"><span data-stu-id="3723b-163">SDK & Rest API</span></span>
<span data-ttu-id="3723b-164">Dla zabezpieczeń ze względu na dostęp za pomocą zestawu SDK lub interfejsu API REST z komputerów nie ma na liście dozwolonych zwróci ogólnego 404 odpowiedzi nie znaleziono z nie dodatkowych szczegółów.</span><span class="sxs-lookup"><span data-stu-id="3723b-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="3723b-165">Sprawdź, czy IP skonfigurowanych dla tego konta bazy danych Azure DB rozwiązania Cosmos listy dozwolonych, aby upewnić się, że konfiguracja prawidłowe zasady zostanie zastosowana do bazy danych Azure rozwiązania Cosmos konta bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3723b-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3723b-166">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="3723b-166">Next steps</span></span>
<span data-ttu-id="3723b-167">Aby uzyskać informacje o sieci Zobacz wskazówki dotyczące wydajności związanych z [porady dotyczące wydajności](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="3723b-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

