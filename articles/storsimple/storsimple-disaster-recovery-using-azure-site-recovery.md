---
title: "Automatyzowanie StorSimple udziału plików odzyskiwania po awarii z usługą Azure Site Recovery | Dokumentacja firmy Microsoft"
description: "W tym artykule opisano kroki i najlepsze rozwiązania dotyczące tworzenia rozwiązanie odzyskiwania po awarii dla udziałów plików hostowane na magazynu Microsoft Azure StorSimple."
services: storsimple
documentationcenter: NA
author: vidarmsft
manager: syadav
editor: 
ms.assetid: 23049a2c-055e-4d0e-b8f5-af2a87ecf53f
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/09/2017
ms.author: vidarmsft
ms.openlocfilehash: b4d575587eec1bcf43c33c7faeb8360ec67b5214
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="automated-disaster-recovery-solution-using-azure-site-recovery-for-file-shares-hosted-on-storsimple"></a><span data-ttu-id="a21bd-103">Zautomatyzowane rozwiązanie odzyskiwania po awarii dla udziałów plików hostowane na StorSimple przy użyciu usługi Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="a21bd-103">Automated Disaster Recovery solution using Azure Site Recovery for file shares hosted on StorSimple</span></span>
## <a name="overview"></a><span data-ttu-id="a21bd-104">Omówienie</span><span class="sxs-lookup"><span data-stu-id="a21bd-104">Overview</span></span>
<span data-ttu-id="a21bd-105">Microsoft Azure StorSimple jest rozwiązania magazynu hybrydowego chmury, którego dotyczy złożoności danych niestrukturalnych zwykle powiązanych ze udziałów plików.</span><span class="sxs-lookup"><span data-stu-id="a21bd-105">Microsoft Azure StorSimple is a hybrid cloud storage solution that addresses the complexities of unstructured data commonly associated with file shares.</span></span> <span data-ttu-id="a21bd-106">StorSimple używa magazynu w chmurze jako rozszerzenia rozwiązania lokalnego, i automatycznie warstwy danych w lokalnej pamięci masowej i magazynu w chmurze.</span><span class="sxs-lookup"><span data-stu-id="a21bd-106">StorSimple uses cloud storage as an extension of the on-premises solution and automatically tiers data across on-premises storage and cloud storage.</span></span> <span data-ttu-id="a21bd-107">Zintegrowana ochrony danych z lokalnego i w chmurze migawek, eliminuje potrzebę stosowania sprawling infrastruktury magazynu.</span><span class="sxs-lookup"><span data-stu-id="a21bd-107">Integrated data protection, with local and cloud snapshots, eliminates the need for a sprawling storage infrastructure.</span></span>

<span data-ttu-id="a21bd-108">[Usługa Azure Site Recovery](../site-recovery/site-recovery-overview.md) to usługa bazujących na platformie Azure, która zapewnia możliwości odzyskiwanie po awarii poprzez organizowanie replikacji, trybu failover i odzyskiwania maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="a21bd-108">[Azure Site Recovery](../site-recovery/site-recovery-overview.md) is an Azure-based service that provides disaster recovery (DR) capabilities by orchestrating replication, failover, and recovery of virtual machines.</span></span> <span data-ttu-id="a21bd-109">Usługa Azure Site Recovery obsługuje wiele technologii replikacji spójnie replikacji, ochronę i bezproblemowo w tryb failover maszyn wirtualnych i aplikacji do publicznego i prywatnego lub hostowanej chmury.</span><span class="sxs-lookup"><span data-stu-id="a21bd-109">Azure Site Recovery supports a number of replication technologies to consistently replicate, protect, and seamlessly fail over virtual machines and applications to private/public or hosted clouds.</span></span>

<span data-ttu-id="a21bd-110">Za pomocą usługi Azure Site Recovery, replikację maszyny wirtualnej i tworzenie migawek chmury StorSimple, można chronić środowisko serwera całego pliku.</span><span class="sxs-lookup"><span data-stu-id="a21bd-110">Using Azure Site Recovery, virtual machine replication, and StorSimple cloud snapshot capabilities, you can protect the complete file server environment.</span></span> <span data-ttu-id="a21bd-111">W przypadku przerw w działaniu można użyć jednego kliknięcia można wyświetlić z udziałów plików w tryb online na platformie Azure w ciągu kilku minut.</span><span class="sxs-lookup"><span data-stu-id="a21bd-111">In the event of a disruption, you can use a single click to bring your file shares online in Azure in just a few minutes.</span></span>

<span data-ttu-id="a21bd-112">Tego dokumentu szczegółowo opisano sposób można utworzyć rozwiązanie odzyskiwania po awarii dla Twojego udziały plików hostowane na magazynie StorSimple i wykonać planowane, nieplanowane i testy trybu failover przy użyciu planu odzyskiwania jednym kliknięciem.</span><span class="sxs-lookup"><span data-stu-id="a21bd-112">This document explains in detail how you can create a disaster recovery solution for your file shares hosted on StorSimple storage, and perform planned, unplanned, and test failovers using a one-click recovery plan.</span></span> <span data-ttu-id="a21bd-113">W zasadzie pokazuje, jak można zmodyfikować planu odzyskiwania w magazynie usługi Azure Site Recovery, aby włączyć tryb failover StorSimple w scenariuszach po awarii.</span><span class="sxs-lookup"><span data-stu-id="a21bd-113">In essence, it shows how you can modify the Recovery Plan in your Azure Site Recovery vault to enable StorSimple failovers during disaster scenarios.</span></span> <span data-ttu-id="a21bd-114">Ponadto opisano obsługiwane konfiguracje i wymagania wstępne.</span><span class="sxs-lookup"><span data-stu-id="a21bd-114">In addition, it describes supported configurations and prerequisites.</span></span> <span data-ttu-id="a21bd-115">Tym dokumencie przyjęto założenie, że czytelnik zna podstawowe informacje dotyczące architektury usługi Azure Site Recovery i StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-115">This document assumes that you are familiar with the basics of Azure Site Recovery and StorSimple architectures.</span></span>

## <a name="supported-azure-site-recovery-deployment-options"></a><span data-ttu-id="a21bd-116">Obsługiwane opcje wdrażania usługi Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="a21bd-116">Supported Azure Site Recovery deployment options</span></span>
<span data-ttu-id="a21bd-117">Klienci mogą wdrażania serwerów plików jako serwerów fizycznych lub maszynach wirtualnych (VM) działające w funkcji Hyper-V lub programu VMware, a następnie utwórz udziałów plików z woluminów używać poza magazynu StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-117">Customers can deploy file servers as physical servers or virtual machines (VMs) running on Hyper-V or VMware, and then create file shares from volumes carved out of StorSimple storage.</span></span> <span data-ttu-id="a21bd-118">Usługa Azure Site Recovery może chronić fizycznych i wirtualnych wdrożeń do dodatkowej lokacji lub na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="a21bd-118">Azure Site Recovery can protect both physical and virtual deployments to either a secondary site or to Azure.</span></span> <span data-ttu-id="a21bd-119">W tym dokumencie opisano szczegóły rozwiązanie odzyskiwania po awarii z platformy Azure jako lokacja odzyskiwania dla serwera plików, maszyna wirtualna hostowana w ramach funkcji Hyper-V i udziałów plików w magazynie StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-119">This document covers details of a DR solution with Azure as the recovery site for a file server VM hosted on Hyper-V and with file shares on StorSimple storage.</span></span> <span data-ttu-id="a21bd-120">Podobnie można stosować inne scenariusze, w których serwer plików maszyny Wirtualnej jest na maszynie Wirtualnej VMware lub komputera fizycznego.</span><span class="sxs-lookup"><span data-stu-id="a21bd-120">Other scenarios in which the file server VM is on a VMware VM or a physical machine can be implemented similarly.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a21bd-121">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="a21bd-121">Prerequisites</span></span>
<span data-ttu-id="a21bd-122">Implementowanie rozwiązania odzyskiwania po awarii jednego kliknięcia, które używa usługi Azure Site Recovery udziały plików hostowane na magazynie StorSimple ma następujące wymagania wstępne:</span><span class="sxs-lookup"><span data-stu-id="a21bd-122">Implementing a one-click disaster recovery solution that uses Azure Site Recovery for file shares hosted on StorSimple storage has the following prerequisites:</span></span>

* <span data-ttu-id="a21bd-123">Lokalnego serwera z systemem Windows Server 2012 R2 pliku, maszyna wirtualna hostowana w funkcji Hyper-V lub programu VMware lub komputera fizycznego</span><span class="sxs-lookup"><span data-stu-id="a21bd-123">On-premises Windows Server 2012 R2 File server VM hosted on Hyper-V or VMware or a physical machine</span></span>
* <span data-ttu-id="a21bd-124">StorSimple urządzenia lokalnie zarejestrowana w usłudze Menedżer Azure StorSimple</span><span class="sxs-lookup"><span data-stu-id="a21bd-124">StorSimple storage device on-premises registered with Azure StorSimple manager</span></span>
* <span data-ttu-id="a21bd-125">Urządzenia StorSimple chmury, utworzone w Menedżerze Azure StorSimple (to może znajdować się w stanie zamykanie)</span><span class="sxs-lookup"><span data-stu-id="a21bd-125">StorSimple Cloud Appliance created in the Azure StorSimple manager (this can be kept in shut down state)</span></span>
* <span data-ttu-id="a21bd-126">Udziały plików hostowane na woluminach skonfigurowane na urządzeniu magazynu StorSimple</span><span class="sxs-lookup"><span data-stu-id="a21bd-126">File shares hosted on the volumes configured on the StorSimple storage device</span></span>
* <span data-ttu-id="a21bd-127">[Magazynu usługi Azure Site Recovery](../site-recovery/site-recovery-vmm-to-vmm.md) utworzone w ramach subskrypcji Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="a21bd-127">[Azure Site Recovery services vault](../site-recovery/site-recovery-vmm-to-vmm.md) created in a Microsoft Azure subscription</span></span>

<span data-ttu-id="a21bd-128">Ponadto Azure w przypadku odzyskiwania lokacji, uruchom [narzędzie oceny gotowości maszyny wirtualnej Azure](http://azure.microsoft.com/downloads/vm-readiness-assessment/) na maszynach wirtualnych, aby upewnić się, że są one zgodne z maszynami wirtualnymi Azure i usługi Azure Site Recovery services.</span><span class="sxs-lookup"><span data-stu-id="a21bd-128">In addition, if Azure is your recovery site, run the [Azure Virtual Machine Readiness Assessment tool](http://azure.microsoft.com/downloads/vm-readiness-assessment/) on VMs to ensure that they are compatible with Azure VMs and Azure Site Recovery services.</span></span>

<span data-ttu-id="a21bd-129">Aby uniknąć problemów (co może spowodować zwiększenie kosztów), upewnij się, że utworzenie Twojego urządzenia chmury StorSimple, konto usługi Automatyzacja i magazynu opóźnienia konta lub kont w tym samym regionie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-129">To avoid latency issues (which might result in higher costs), make sure that you create your StorSimple Cloud Appliance, automation account, and storage account(s) in the same region.</span></span>

## <a name="enable-dr-for-storsimple-file-shares"></a><span data-ttu-id="a21bd-130">Włącz odzyskiwania po awarii dla udziałów plików StorSimple</span><span class="sxs-lookup"><span data-stu-id="a21bd-130">Enable DR for StorSimple file shares</span></span>
<span data-ttu-id="a21bd-131">Każdego składnika środowiska lokalnego musi być chroniony, aby umożliwić dokończenie replikacji i odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-131">Each component of the on-premises environment needs to be protected to enable complete replication and recovery.</span></span> <span data-ttu-id="a21bd-132">W tej sekcji opisano sposób:</span><span class="sxs-lookup"><span data-stu-id="a21bd-132">This section describes how to:</span></span>

* <span data-ttu-id="a21bd-133">Konfigurowanie replikacji usługi Active Directory i DNS (opcjonalny)</span><span class="sxs-lookup"><span data-stu-id="a21bd-133">Set up Active Directory and DNS replication (optional)</span></span>
* <span data-ttu-id="a21bd-134">Użyj usługi Azure Site Recovery, aby włączyć ochronę maszyny Wirtualnej serwera plików</span><span class="sxs-lookup"><span data-stu-id="a21bd-134">Use Azure Site Recovery to enable protection of the file server VM</span></span>
* <span data-ttu-id="a21bd-135">Włączanie ochrony woluminów StorSimple</span><span class="sxs-lookup"><span data-stu-id="a21bd-135">Enable protection of StorSimple volumes</span></span>
* <span data-ttu-id="a21bd-136">Konfigurowanie sieci</span><span class="sxs-lookup"><span data-stu-id="a21bd-136">Configure the network</span></span>

### <a name="set-up-active-directory-and-dns-replication-optional"></a><span data-ttu-id="a21bd-137">Konfigurowanie replikacji usługi Active Directory i DNS (opcjonalny)</span><span class="sxs-lookup"><span data-stu-id="a21bd-137">Set up Active Directory and DNS replication (optional)</span></span>
<span data-ttu-id="a21bd-138">Jeśli chcesz chronić na komputerach z systemem usługi Active Directory i DNS, tak aby były dostępne w lokacji odzyskiwania po awarii, musisz jawnie je chronić (tak, aby serwery plików są dostępne po pracy awaryjnej z uwierzytelnianiem).</span><span class="sxs-lookup"><span data-stu-id="a21bd-138">If you want to protect the machines running Active Directory and DNS so that they are available on the DR site, you need to explicitly protect them (so that the file servers are accessible after fail over with authentication).</span></span> <span data-ttu-id="a21bd-139">Dostępne są dwie opcje zalecane, zależnie od stopnia złożoności klienta w środowisku lokalnym.</span><span class="sxs-lookup"><span data-stu-id="a21bd-139">There are two recommended options based on the complexity of the customer’s on-premises environment.</span></span>

#### <a name="option-1"></a><span data-ttu-id="a21bd-140">Opcja 1</span><span class="sxs-lookup"><span data-stu-id="a21bd-140">Option 1</span></span>
<span data-ttu-id="a21bd-141">Jeśli klient ma małej liczby aplikacji, jednego kontrolera domeny dla całej lokalnej lokacji i awarii w całej lokacji, wówczas zalecamy replikację do dodatkowej maszyny kontrolera domeny przy użyciu replikacji usługi Azure Site Recovery Witryna (dotyczy to zarówno do lokacji i lokacji do platformy Azure).</span><span class="sxs-lookup"><span data-stu-id="a21bd-141">If the customer has a small number of applications, a single domain controller for the entire on-premises site, and will be failing over the entire site, then we recommend using Azure Site Recovery replication to replicate the domain controller machine to a secondary site (this is applicable for both site-to-site and site-to-Azure).</span></span>

#### <a name="option-2"></a><span data-ttu-id="a21bd-142">Opcja 2</span><span class="sxs-lookup"><span data-stu-id="a21bd-142">Option 2</span></span>
<span data-ttu-id="a21bd-143">Jeśli klient ma dużą liczbę aplikacji, działa lasu usługi Active Directory i spowoduje niepowodzenie przez kilka aplikacji w czasie, a następnie zalecamy skonfigurowanie dodatkowego kontrolera domeny w lokacji odzyskiwania po awarii (dodatkowej lokacji lub na platformie Azure).</span><span class="sxs-lookup"><span data-stu-id="a21bd-143">If the customer has a large number of applications, is running an Active Directory forest, and will be failing over a few applications at a time, then we recommend setting up an additional domain controller on the DR site (either a secondary site or in Azure).</span></span>

<span data-ttu-id="a21bd-144">Zapoznaj się z [rozwiązania automatycznego odzyskiwania po awarii dla usługi Active Directory i DNS za pomocą usługi Azure Site Recovery](../site-recovery/site-recovery-active-directory.md) instrukcje podczas udostępniania kontrolera domeny w lokacji odzyskiwania po awarii.</span><span class="sxs-lookup"><span data-stu-id="a21bd-144">Please refer to [Automated DR solution for Active Directory and DNS using Azure Site Recovery](../site-recovery/site-recovery-active-directory.md) for instructions when making a domain controller available on the DR site.</span></span> <span data-ttu-id="a21bd-145">W pozostałej części tego dokumentu będzie przyjęto założenie, że kontroler domeny jest dostępny w witrynie odzyskiwania po awarii.</span><span class="sxs-lookup"><span data-stu-id="a21bd-145">For the remainder of this document, we will assume a domain controller is available on the DR site.</span></span>

### <a name="use-azure-site-recovery-to-enable-protection-of-the-file-server-vm"></a><span data-ttu-id="a21bd-146">Użyj usługi Azure Site Recovery, aby włączyć ochronę maszyny Wirtualnej serwera plików</span><span class="sxs-lookup"><span data-stu-id="a21bd-146">Use Azure Site Recovery to enable protection of the file server VM</span></span>
<span data-ttu-id="a21bd-147">Ten krok wymaga, aby przygotować środowisko serwera lokalnego pliku, Utwórz przygotowanie magazynie usługi Azure Site Recovery i włącz ochronę plików maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-147">This step requires that you prepare the on-premises file server environment, create and prepare an Azure Site Recovery vault, and enable file protection of the VM.</span></span>

#### <a name="to-prepare-the-on-premises-file-server-environment"></a><span data-ttu-id="a21bd-148">Aby przygotować środowisko serwera plików lokalnych</span><span class="sxs-lookup"><span data-stu-id="a21bd-148">To prepare the on-premises file server environment</span></span>
1. <span data-ttu-id="a21bd-149">Ustaw **Kontrola konta użytkownika** do **nigdy nie Powiadamiaj**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-149">Set the **User Account Control** to **Never Notify**.</span></span> <span data-ttu-id="a21bd-150">Jest to wymagane, dzięki czemu skryptów automatyzacji Azure umożliwia łączenie obiektów docelowych iSCSI po błędów przez usługi Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="a21bd-150">This is required so that you can use Azure automation scripts to connect the iSCSI targets after fail over by Azure Site Recovery.</span></span>

   1. <span data-ttu-id="a21bd-151">Naciśnij klawisze Windows + Q i wyszukaj **UAC**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-151">Press the Windows key +Q and search for **UAC**.</span></span>
   2. <span data-ttu-id="a21bd-152">Wybierz **ustawienia kontroli konta użytkownika zmiany**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-152">Select **Change User Account Control settings**.</span></span>
   3. <span data-ttu-id="a21bd-153">Przeciągnij pasek do dołu **nigdy nie Powiadamiaj**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-153">Drag the bar to the bottom towards **Never Notify**.</span></span>
   4. <span data-ttu-id="a21bd-154">Kliknij przycisk **OK** , a następnie wybierz **tak** po wyświetleniu monitu.</span><span class="sxs-lookup"><span data-stu-id="a21bd-154">Click **OK** and then select **Yes** when prompted.</span></span>

      ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image1.png)
2. <span data-ttu-id="a21bd-155">Zainstaluj agenta maszyny Wirtualnej na każdym serwerze plików maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="a21bd-155">Install the VM Agent on each of the file server VMs.</span></span> <span data-ttu-id="a21bd-156">Jest to wymagane, co umożliwia uruchamianie skryptów automatyzacji Azure na nieudane przez maszyny wirtualne.</span><span class="sxs-lookup"><span data-stu-id="a21bd-156">This is required so that you can run Azure automation scripts on the failed over VMs.</span></span>

   1. <span data-ttu-id="a21bd-157">[Pobierz agenta](http://aka.ms/vmagentwin) do `C:\\Users\\<username>\\Downloads`.</span><span class="sxs-lookup"><span data-stu-id="a21bd-157">[Download the agent](http://aka.ms/vmagentwin) to `C:\\Users\\<username>\\Downloads`.</span></span>
   2. <span data-ttu-id="a21bd-158">Otwórz program Windows PowerShell w trybie administratora (Uruchom jako Administrator), a następnie wprowadź następujące polecenie, aby przejść do lokalizacji pobierania:</span><span class="sxs-lookup"><span data-stu-id="a21bd-158">Open Windows PowerShell in Administrator mode (Run as Administrator), and then enter the following command to navigate to the download location:</span></span>

      `cd C:\\Users\\<username>\\Downloads\\WindowsAzureVmAgent.2.6.1198.718.rd\_art\_stable.150415-1739.fre.msi`

      > [!NOTE]
      > <span data-ttu-id="a21bd-159">Nazwa pliku mogą ulec zmianie w zależności od wersji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-159">The file name may change depending on the version.</span></span>
      >
      >
3. <span data-ttu-id="a21bd-160">Kliknij przycisk **Dalej**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-160">Click **Next**.</span></span>
4. <span data-ttu-id="a21bd-161">Zaakceptuj **postanowienia Umowy** , a następnie kliknij przycisk **dalej**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-161">Accept the **Terms of Agreement** and then click **Next**.</span></span>
5. <span data-ttu-id="a21bd-162">Kliknij przycisk **Zakończ**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-162">Click **Finish**.</span></span>
6. <span data-ttu-id="a21bd-163">Tworzenie udziałów plików za pomocą woluminów używać poza magazynu StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-163">Create file shares using volumes carved out of StorSimple storage.</span></span> <span data-ttu-id="a21bd-164">Aby uzyskać więcej informacji, zobacz [usługi Menedżer StorSimple umożliwia zarządzanie woluminami](storsimple-manage-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="a21bd-164">For more information, see [Use the StorSimple Manager service to manage volumes](storsimple-manage-volumes.md).</span></span>

   1. <span data-ttu-id="a21bd-165">Na lokalnych maszyn wirtualnych, naciśnij klawisze Windows + Q, a następnie wyszukaj **iSCSI**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-165">On your on-premises VMs, press the Windows key +Q and search for **iSCSI**.</span></span>
   2. <span data-ttu-id="a21bd-166">Wybierz **inicjatora iSCSI**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-166">Select **iSCSI initiator**.</span></span>
   3. <span data-ttu-id="a21bd-167">Wybierz **konfiguracji** karcie i skopiuj Nazwa inicjatora.</span><span class="sxs-lookup"><span data-stu-id="a21bd-167">Select the **Configuration** tab and copy the initiator name.</span></span>
   4. <span data-ttu-id="a21bd-168">Zaloguj się do witryny [Azure Portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="a21bd-168">Log in to the [Azure portal](https://portal.azure.com/).</span></span>
   5. <span data-ttu-id="a21bd-169">Wybierz **StorSimple** karcie, a następnie wybierz usługę Menedżer StorSimple, który zawiera urządzenia fizycznego.</span><span class="sxs-lookup"><span data-stu-id="a21bd-169">Select the **StorSimple** tab and then select the StorSimple Manager Service that contains the physical device.</span></span>
   6. <span data-ttu-id="a21bd-170">Utwórz wolumin kontenerów, a następnie utwórz woluminy.</span><span class="sxs-lookup"><span data-stu-id="a21bd-170">Create volume container(s) and then create volume(s).</span></span> <span data-ttu-id="a21bd-171">(Te woluminy dotyczą udziałów plików na serwerze plików maszyn wirtualnych).</span><span class="sxs-lookup"><span data-stu-id="a21bd-171">(These volumes are for the file share(s) on the file server VMs).</span></span> <span data-ttu-id="a21bd-172">Skopiuj Nazwa inicjatora i zapewniają odpowiednią nazwę rekordy kontroli dostępu, podczas tworzenia woluminu.</span><span class="sxs-lookup"><span data-stu-id="a21bd-172">Copy the initiator name and give an appropriate name for the Access Control Records when you create the volumes.</span></span>
   7. <span data-ttu-id="a21bd-173">Wybierz **Konfiguruj** kartę i zanotuj adres IP urządzenia, w dół.</span><span class="sxs-lookup"><span data-stu-id="a21bd-173">Select the **Configure** tab and note down the IP address of the device.</span></span>
   8. <span data-ttu-id="a21bd-174">Na lokalnych maszyn wirtualnych, przejdź do **inicjatora iSCSI** ponownie, a następnie wprowadź adres IP w sekcji szybkie połączenie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-174">On your on-premises VMs, go to the **iSCSI initiator** again and enter the IP in the Quick Connect section.</span></span> <span data-ttu-id="a21bd-175">Kliknij przycisk **szybkie połączenie** (urządzenie powinno być teraz połączone).</span><span class="sxs-lookup"><span data-stu-id="a21bd-175">Click **Quick Connect** (the device should now be connected).</span></span>
   9. <span data-ttu-id="a21bd-176">Otwórz Azure portalu i wybierz pozycję **woluminów i urządzeń** kartę.</span><span class="sxs-lookup"><span data-stu-id="a21bd-176">Open the Azure portal and select the **Volumes and Devices** tab.</span></span> <span data-ttu-id="a21bd-177">Kliknij przycisk **automatycznie skonfigurować**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-177">Click **Auto Configure**.</span></span> <span data-ttu-id="a21bd-178">Nowo utworzony wolumin powinny być wyświetlane.</span><span class="sxs-lookup"><span data-stu-id="a21bd-178">The volume that you just created should appear.</span></span>
   10. <span data-ttu-id="a21bd-179">W portalu, wybierz **urządzeń** karcie, a następnie wybierz **utworzyć nowe urządzenie wirtualne.**</span><span class="sxs-lookup"><span data-stu-id="a21bd-179">In the portal, select the **Devices** tab and then select **Create a New Virtual Device.**</span></span> <span data-ttu-id="a21bd-180">(Będzie można używać tego urządzenia wirtualnego, jeśli do pracy awaryjnej).</span><span class="sxs-lookup"><span data-stu-id="a21bd-180">(This virtual device will be used if a failover occurs).</span></span> <span data-ttu-id="a21bd-181">Tym nowym urządzeniu wirtualnym można przechowywać w trybie offline, aby uniknąć dodatkowych kosztów.</span><span class="sxs-lookup"><span data-stu-id="a21bd-181">This new virtual device can be kept in an offline state to avoid extra costs.</span></span> <span data-ttu-id="a21bd-182">Urządzenie wirtualne przełączenia do trybu offline, przejdź do **maszyn wirtualnych** sekcji w portalu i go zamknąć.</span><span class="sxs-lookup"><span data-stu-id="a21bd-182">To take the virtual device offline, go to the **Virtual Machines** section on the Portal and shut it down.</span></span>
   11. <span data-ttu-id="a21bd-183">Wróć do maszyn wirtualnych lokalnie i Otwórz przystawkę Zarządzanie dyskami (naciśnij klawisz systemu Windows + X i wybierz **Zarządzanie dyskami**).</span><span class="sxs-lookup"><span data-stu-id="a21bd-183">Go back to the on-premises VMs and open Disk Management (press the Windows key + X and select **Disk Management**).</span></span>
   12. <span data-ttu-id="a21bd-184">Można zauważyć pewne dodatkowe dysków (w zależności od liczby woluminów, które utworzono).</span><span class="sxs-lookup"><span data-stu-id="a21bd-184">You will notice some extra disks (depending on the number of volumes you have created).</span></span> <span data-ttu-id="a21bd-185">Kliknij prawym przyciskiem myszy pierwszy z nich, zaznacz **Inicjowanie dysku**i wybierz **OK**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-185">Right-click the first one, select **Initialize Disk**, and select **OK**.</span></span> <span data-ttu-id="a21bd-186">Kliknij prawym przyciskiem myszy **Unallocated** zaznacz **nowy wolumin prosty**, a następnie przypisać jej literę dysku i zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="a21bd-186">Right-click the **Unallocated** section, select **New Simple Volume**, assign it a drive letter, and finish the wizard.</span></span>
   13. <span data-ttu-id="a21bd-187">Powtórz krok l dla wszystkich dysków.</span><span class="sxs-lookup"><span data-stu-id="a21bd-187">Repeat step l for all the disks.</span></span> <span data-ttu-id="a21bd-188">Wszystkie dyski będą teraz widoczne na **ten komputer** w Eksploratorze Windows.</span><span class="sxs-lookup"><span data-stu-id="a21bd-188">You can now see all the disks on **This PC** in the Windows Explorer.</span></span>
   14. <span data-ttu-id="a21bd-189">Do tworzenia udziałów plików na tych woluminach za pomocą roli usługi plików i magazynowania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-189">Use the File and Storage Services role to create file shares on these volumes.</span></span>

#### <a name="to-create-and-prepare-an-azure-site-recovery-vault"></a><span data-ttu-id="a21bd-190">Do tworzenia i przygotowywania magazynie usługi Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="a21bd-190">To create and prepare an Azure Site Recovery vault</span></span>
<span data-ttu-id="a21bd-191">Zapoznaj się [dokumentacji usługi Azure Site Recovery](../site-recovery/site-recovery-hyper-v-site-to-azure.md) rozpocząć pracę z usługą Azure Site Recovery przed rozpoczęciem ochrony serwera plików maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-191">Refer to the [Azure Site Recovery documentation](../site-recovery/site-recovery-hyper-v-site-to-azure.md) to get started with Azure Site Recovery before protecting the file server VM.</span></span>

#### <a name="to-enable-protection"></a><span data-ttu-id="a21bd-192">Aby włączyć ochronę</span><span class="sxs-lookup"><span data-stu-id="a21bd-192">To enable protection</span></span>
1. <span data-ttu-id="a21bd-193">Rozłączanie docelowych iSCSI z lokalnych maszyn wirtualnych, które chcesz chronić za pomocą usługi Azure Site Recovery:</span><span class="sxs-lookup"><span data-stu-id="a21bd-193">Disconnect the iSCSI target(s) from the on-premises VMs that you want to protect through Azure Site Recovery:</span></span>

   1. <span data-ttu-id="a21bd-194">Naciśnij klawisze Windows + Q i wyszukaj **iSCSI**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-194">Press Windows key + Q and search for **iSCSI**.</span></span>
   2. <span data-ttu-id="a21bd-195">Wybierz **Konfigurowanie inicjatora iSCSI**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-195">Select **Set up iSCSI initiator**.</span></span>
   3. <span data-ttu-id="a21bd-196">Odłącz urządzenia StorSimple, którą wcześniej połączenia.</span><span class="sxs-lookup"><span data-stu-id="a21bd-196">Disconnect the StorSimple device that you connected previously.</span></span> <span data-ttu-id="a21bd-197">Alternatywnie możesz wyłączyć serwer plików, kilka minut po włączeniu ochrony.</span><span class="sxs-lookup"><span data-stu-id="a21bd-197">Alternatively, you can switch off the file server for a few minutes when enabling protection.</span></span>

   > [!NOTE]
   > <span data-ttu-id="a21bd-198">Spowoduje to udziałów plików jest tymczasowo niedostępna.</span><span class="sxs-lookup"><span data-stu-id="a21bd-198">This will cause the file shares to be temporarily unavailable.</span></span>
   >
   >
2. <span data-ttu-id="a21bd-199">[Włącz ochronę maszyny wirtualnej](../site-recovery/site-recovery-hyper-v-site-to-azure.md) serwera plików maszyny Wirtualnej w portalu usługi Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="a21bd-199">[Enable virtual machine protection](../site-recovery/site-recovery-hyper-v-site-to-azure.md) of the file server VM from the Azure Site Recovery portal.</span></span>
3. <span data-ttu-id="a21bd-200">Po początkowej synchronizacji można ponownie element docelowy.</span><span class="sxs-lookup"><span data-stu-id="a21bd-200">When the initial synchronization begins, you can reconnect the target again.</span></span> <span data-ttu-id="a21bd-201">Przejdź do inicjatora iSCSI, wybierz urządzenie StorSimple, a następnie kliknij przycisk **Connect**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-201">Go to the iSCSI initiator, select the StorSimple device, and click **Connect**.</span></span>
4. <span data-ttu-id="a21bd-202">Po ukończeniu synchronizacji i stan maszyny Wirtualnej jest **chronione**, wybierz maszynę Wirtualną, wybierz **Konfiguruj** , a następnie odpowiednio zaktualizować sieci maszyny wirtualnej (to jest sieć który nieudane przez Wirtualne będą częścią).</span><span class="sxs-lookup"><span data-stu-id="a21bd-202">When the synchronization is complete and the status of the VM is **Protected**, select the VM, select the **Configure** tab, and update the network of the VM accordingly (this is the network that the failed over VM(s) will be a part of).</span></span> <span data-ttu-id="a21bd-203">Sieć nie widać, oznacza, że synchronizacja nadal trwa.</span><span class="sxs-lookup"><span data-stu-id="a21bd-203">If the network doesn’t show up, it means that the sync is still going on.</span></span>

### <a name="enable-protection-of-storsimple-volumes"></a><span data-ttu-id="a21bd-204">Włączanie ochrony woluminów StorSimple</span><span class="sxs-lookup"><span data-stu-id="a21bd-204">Enable protection of StorSimple volumes</span></span>
<span data-ttu-id="a21bd-205">Jeśli nie wybrano **włączyć domyślnego tworzenia kopii zapasowej dla tego woluminu** opcja dla woluminów StorSimple, przejdź do **zasad tworzenia kopii zapasowych** Menedżer StorSimple usługi, a następnie utwórz odpowiednie zasady tworzenia kopii zapasowej wszystkie woluminy.</span><span class="sxs-lookup"><span data-stu-id="a21bd-205">If you have not selected the **Enable a default backup for this volume** option for the StorSimple volumes, go to **Backup Policies** in the StorSimple Manager service, and create a suitable backup policy for all the volumes.</span></span> <span data-ttu-id="a21bd-206">Firma Microsoft zaleca, aby ustawić częstotliwość tworzenia kopii zapasowych na cel punktu odzyskiwania (RPO), który chcesz wyświetlić dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-206">We recommend that you set the frequency of backups to the recovery point objective (RPO) that you would like to see for the application.</span></span>

### <a name="configure-the-network"></a><span data-ttu-id="a21bd-207">Konfigurowanie sieci</span><span class="sxs-lookup"><span data-stu-id="a21bd-207">Configure the network</span></span>
<span data-ttu-id="a21bd-208">Dla serwera plików maszyny Wirtualnej Skonfiguruj ustawienia sieciowe w usłudze Azure Site Recovery, aby wszystkie sieci maszyny Wirtualnej są dołączone do odpowiedniej sieci DR po pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-208">For the file server VM, configure network settings in Azure Site Recovery so that the VM networks are attached to the correct DR network after failover.</span></span>

<span data-ttu-id="a21bd-209">Możesz wybrać maszynę Wirtualną w **elementy replikowane** kartę, aby skonfigurować ustawienia sieciowe, jak pokazano na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-209">You can select the VM in the **Replicated items** tab to configure the network settings, as shown in the following illustration.</span></span>

![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image2.png)

## <a name="create-a-recovery-plan"></a><span data-ttu-id="a21bd-210">Tworzenie planu odzyskiwania</span><span class="sxs-lookup"><span data-stu-id="a21bd-210">Create a recovery plan</span></span>
<span data-ttu-id="a21bd-211">W usłudze ASR do automatyzacji procesu pracy awaryjnej udziałów plików, można utworzyć planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-211">You can create a recovery plan in ASR to automate the failover process of the file shares.</span></span> <span data-ttu-id="a21bd-212">W przypadku zakłóceń przełączeniem udziały plików w ciągu kilku minut za pomocą jednego kliknięcia.</span><span class="sxs-lookup"><span data-stu-id="a21bd-212">If a disruption occurs, you can bring the file shares up in a few minutes with just a single click.</span></span> <span data-ttu-id="a21bd-213">Aby włączyć ten automatyzacji, konieczne będzie konto usługi Automatyzacja Azure.</span><span class="sxs-lookup"><span data-stu-id="a21bd-213">To enable this automation, you will need an Azure automation account.</span></span>

#### <a name="to-create-an-automation-account"></a><span data-ttu-id="a21bd-214">Aby utworzyć konto usługi Automatyzacja</span><span class="sxs-lookup"><span data-stu-id="a21bd-214">To create an Automation account</span></span>
1. <span data-ttu-id="a21bd-215">Przejdź do portalu Azure &gt; **automatyzacji** sekcji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-215">Go to the Azure portal &gt; **Automation** section.</span></span>
2. <span data-ttu-id="a21bd-216">Kliknij przycisk **+ Dodaj** przycisku, otwiera poniżej bloku.</span><span class="sxs-lookup"><span data-stu-id="a21bd-216">Click **+ Add** button, opens below blade.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image11.png)

   * <span data-ttu-id="a21bd-217">Name — wprowadź nowe konto automatyzacji</span><span class="sxs-lookup"><span data-stu-id="a21bd-217">Name - Enter a new automation account</span></span>
   * <span data-ttu-id="a21bd-218">Subskrypcja — Wybierz subskrypcję</span><span class="sxs-lookup"><span data-stu-id="a21bd-218">Subscription - Choose subscription</span></span>
   * <span data-ttu-id="a21bd-219">Resource group - Utwórz nowe/wybierz istniejącą grupę zasobów</span><span class="sxs-lookup"><span data-stu-id="a21bd-219">Resource group - Create new/choose existing resource group</span></span>
   * <span data-ttu-id="a21bd-220">Lokalizacja — wybierz lokalizację, przechowuj go w tym samym/region geograficzny w której utworzono urządzenia chmury StorSimple i konta magazynu.</span><span class="sxs-lookup"><span data-stu-id="a21bd-220">Location - Choose location, keep it in the same geo/region in which the StorSimple Cloud Appliance and Storage Accounts were created.</span></span>
   * <span data-ttu-id="a21bd-221">Utwórz konto Uruchom jako platformy Azure — wybierz **tak** opcji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-221">Create Azure Run As account - Select **Yes** option.</span></span>

3. <span data-ttu-id="a21bd-222">Przejdź do konta automatyzacji, kliknij przycisk **Runbook** &gt; **galerii przeglądania** Aby zaimportować wszystkie wymagane elementy runbook do konta automatyzacji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-222">Go to the Automation account, click **Runbooks** &gt; **Browse Gallery** to import all the required runbooks into the automation account.</span></span>
4. <span data-ttu-id="a21bd-223">Dodaj następujące elementy runbook znajdując **odzyskiwania po awarii** tag w galerii:</span><span class="sxs-lookup"><span data-stu-id="a21bd-223">Add the following runbooks by finding **Disaster Recovery** tag in the gallery:</span></span>

   * <span data-ttu-id="a21bd-224">Wyczyść woluminów StorSimple po Test pracy awaryjnej (TFO)</span><span class="sxs-lookup"><span data-stu-id="a21bd-224">Clean up of StorSimple volumes after Test Failover (TFO)</span></span>
   * <span data-ttu-id="a21bd-225">Kontenery woluminów StorSimple trybu failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-225">Failover StorSimple volume containers</span></span>
   * <span data-ttu-id="a21bd-226">Zainstalować woluminów na urządzeniu StorSimple po pracy awaryjnej</span><span class="sxs-lookup"><span data-stu-id="a21bd-226">Mount volumes on StorSimple device after failover</span></span>
   * <span data-ttu-id="a21bd-227">Odinstaluj niestandardowego rozszerzenia skryptu na maszynie Wirtualnej Azure</span><span class="sxs-lookup"><span data-stu-id="a21bd-227">Uninstall custom script extension in Azure VM</span></span>
   * <span data-ttu-id="a21bd-228">Uruchom urządzenia wirtualnego StorSimple</span><span class="sxs-lookup"><span data-stu-id="a21bd-228">Start StorSimple Virtual Appliance</span></span>

     ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image3.png)

5. <span data-ttu-id="a21bd-229">Publikuj wszystkie skrypty wybierając konto automatyzacji elementu runbook, a następnie kliknij przycisk **Edytuj** &gt; **publikowania** , a następnie **tak** w komunikacie weryfikacyjnym.</span><span class="sxs-lookup"><span data-stu-id="a21bd-229">Publish all the scripts by selecting the runbook in the automation account and click **Edit** &gt; **Publish** and then **Yes** to the verification message.</span></span> <span data-ttu-id="a21bd-230">Po wykonaniu tego kroku **elementów Runbook** karta pojawi się w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="a21bd-230">After this step, the **Runbooks** tab will appear as follows:</span></span>

    ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image4.png)

6. <span data-ttu-id="a21bd-231">Wybierz konto automatyzacji **zasoby** kartę &gt; kliknij **zmienne** &gt; **dodać zmienną** i dodaj następujące zmienne.</span><span class="sxs-lookup"><span data-stu-id="a21bd-231">In the automation account, select the **Assets** tab &gt; click **Variables** &gt; **Add a variable** and add the following variables.</span></span> <span data-ttu-id="a21bd-232">Można zaszyfrować te zasoby.</span><span class="sxs-lookup"><span data-stu-id="a21bd-232">You can choose to encrypt these assets.</span></span> <span data-ttu-id="a21bd-233">Te zmienne są specyficzne dla planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-233">These variables are recovery plan–specific.</span></span> <span data-ttu-id="a21bd-234">Jeśli odzyskiwania (który zostanie utworzony w następnym kroku) nazwa jest TestPlan, a następnie zmiennych powinny być TestPlan StorSimRegKey, TestPlan AzureSubscriptionName i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-234">If your recovery plan (which you will create in the next step) name is TestPlan, then your variables should be TestPlan-StorSimRegKey, TestPlan-AzureSubscriptionName, and so on.</span></span>

   * <span data-ttu-id="a21bd-235">*RecoveryPlanName***- StorSimRegKey**: klucz rejestracji usługi Menedżer StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-235">*RecoveryPlanName***-StorSimRegKey**: The registration key for the StorSimple Manager service.</span></span>
   * <span data-ttu-id="a21bd-236">*RecoveryPlanName***- AzureSubscriptionName**: Nazwa subskrypcji platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="a21bd-236">*RecoveryPlanName***-AzureSubscriptionName**: The name of the Azure subscription.</span></span>
   * <span data-ttu-id="a21bd-237">*RecoveryPlanName***- ResourceName**: Nazwa zasobu StorSimple, który ma urządzenie StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-237">*RecoveryPlanName***-ResourceName**: The name of the StorSimple resource that has the StorSimple device.</span></span>
   * <span data-ttu-id="a21bd-238">*RecoveryPlanName***- DeviceName**: urządzenia, które ma w tryb pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-238">*RecoveryPlanName***-DeviceName**: The device that has to be failed over.</span></span>
   * <span data-ttu-id="a21bd-239">*RecoveryPlanName***- VolumeContainers**: przecinkami ciąg kontenery woluminów znajduje się on na urządzenia, które muszą być nie powiodło się powyżej, na przykład volcon1, volcon2, volcon3.</span><span class="sxs-lookup"><span data-stu-id="a21bd-239">*RecoveryPlanName***-VolumeContainers**: A comma-separated string of volume containers present on the device that need to be failed over; for example, volcon1,volcon2, volcon3.</span></span>
   * <span data-ttu-id="a21bd-240">*RecoveryPlanName***- TargetDeviceName**: urządzenia chmury StorSimple, na którym kontenery są w tryb pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-240">*RecoveryPlanName***-TargetDeviceName**: The StorSimple Cloud Appliance on which the containers are to be failed over.</span></span>
   * <span data-ttu-id="a21bd-241">*RecoveryPlanName***- TargetDeviceDnsName**: Nazwa usługi urządzenia docelowego (znajdują się w **maszyny wirtualnej** sekcji: Nazwa usługi jest taka sama jak nazwa DNS).</span><span class="sxs-lookup"><span data-stu-id="a21bd-241">*RecoveryPlanName***-TargetDeviceDnsName**: The service name of the target device (this can be found in the **Virtual Machine** section: the service name is the same as the DNS name).</span></span>
   * <span data-ttu-id="a21bd-242">*RecoveryPlanName***- StorageAccountName**: Nazwa konta magazynu, w którym będą przechowywane skryptu (mającej do uruchamiania na nieudane przez VM).</span><span class="sxs-lookup"><span data-stu-id="a21bd-242">*RecoveryPlanName***-StorageAccountName**: The storage account name in which the script (which has to run on the failed over VM) will be stored.</span></span> <span data-ttu-id="a21bd-243">Może to być konto magazynu, które ma miejsce do tymczasowego przechowywania skryptu.</span><span class="sxs-lookup"><span data-stu-id="a21bd-243">This can be any storage account that has some space to store the script temporarily.</span></span>
   * <span data-ttu-id="a21bd-244">*RecoveryPlanName***- StorageAccountKey**: klucz dostępu dla konta magazynu powyżej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-244">*RecoveryPlanName***-StorageAccountKey**: The access key for the above storage account.</span></span>
   * <span data-ttu-id="a21bd-245">*RecoveryPlanName***- ScriptContainer**: nazwa kontenera, w którym skrypt będzie przechowywany w chmurze.</span><span class="sxs-lookup"><span data-stu-id="a21bd-245">*RecoveryPlanName***-ScriptContainer**: The name of the container in which the script will be stored in the cloud.</span></span> <span data-ttu-id="a21bd-246">Kontener nie istnieje, zostanie utworzona.</span><span class="sxs-lookup"><span data-stu-id="a21bd-246">If the container doesn’t exist, it will be created.</span></span>
   * <span data-ttu-id="a21bd-247">*RecoveryPlanName***- VMGUIDS**: po ochrony maszyn wirtualnych, usługi Azure Site Recovery przypisuje każdej maszyny Wirtualnej Unikatowy identyfikator, który zawiera szczegóły nieudane za pośrednictwem maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-247">*RecoveryPlanName***-VMGUIDS**: Upon protecting a VM, Azure Site Recovery assigns every VM a unique ID that gives the details of the failed over VM.</span></span> <span data-ttu-id="a21bd-248">Aby uzyskać VMGUID, wybierz **usług odzyskiwania** i kliknij polecenie **chronionego elementu** &gt; **grup ochrony** &gt;  **Maszyny** &gt; **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-248">To obtain the VMGUID, select the **Recovery Services** tab and click **Protected Item** &gt; **Protection Groups** &gt; **Machines** &gt; **Properties**.</span></span> <span data-ttu-id="a21bd-249">Jeśli masz wiele maszyn wirtualnych, Dodaj identyfikatory GUID jako ciąg rozdzielony przecinkami.</span><span class="sxs-lookup"><span data-stu-id="a21bd-249">If you have multiple VMs, then add the GUIDs as a comma-separated string.</span></span>
   * <span data-ttu-id="a21bd-250">*RecoveryPlanName***- AutomationAccountName** — nazwa konta automatyzacji, w którym można dodać elementy runbook i zasoby.</span><span class="sxs-lookup"><span data-stu-id="a21bd-250">*RecoveryPlanName***-AutomationAccountName** – The name of the automation account in which you have added the runbooks and the assets.</span></span>

  <span data-ttu-id="a21bd-251">Na przykład, jeśli nazwa planu odzyskiwania jest fileServerpredayRP a następnie z **poświadczenia** & **zmienne** karty powinna wyglądać następująco po dodaniu wszystkie zasoby.</span><span class="sxs-lookup"><span data-stu-id="a21bd-251">For example, if the name of the recovery plan is fileServerpredayRP, then your **Credentials** & **Variables** tabs should appear as follows after you add all the assets.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image5.png)

7. <span data-ttu-id="a21bd-252">Przejdź do **usług odzyskiwania** sekcji, a następnie wybierz utworzony wcześniej magazyn Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="a21bd-252">Go to the **Recovery Services** section and select the Azure Site Recovery vault that you created earlier.</span></span>
8. <span data-ttu-id="a21bd-253">Wybierz **plany odzyskiwania (lokacji odzyskiwania)** opcję **Zarządzaj** grupy i utworzenie nowego planu odzyskiwania w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="a21bd-253">Select the **Recovery Plans (Site Recovery)** option from **Manage** group and create a new recovery plan as follows:</span></span>

   <span data-ttu-id="a21bd-254">a.</span><span class="sxs-lookup"><span data-stu-id="a21bd-254">a.</span></span>  <span data-ttu-id="a21bd-255">Kliknij przycisk **+ planu odzyskiwania** przycisku, otwiera poniżej bloku.</span><span class="sxs-lookup"><span data-stu-id="a21bd-255">Click **+ Recover plan** button, opens below blade.</span></span>

      ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image6.png)

   <span data-ttu-id="a21bd-256">b.</span><span class="sxs-lookup"><span data-stu-id="a21bd-256">b.</span></span>  <span data-ttu-id="a21bd-257">Wprowadź nazwę planu odzyskiwania, wybierz wartości modelu źródłowego, docelowego i wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="a21bd-257">Enter a recovery plan name, choose Source, Target & Deployment model values.</span></span>

   <span data-ttu-id="a21bd-258">c.</span><span class="sxs-lookup"><span data-stu-id="a21bd-258">c.</span></span>  <span data-ttu-id="a21bd-259">Wybierz maszyny wirtualne z grupy ochrony, które chcesz uwzględnić w planie odzyskiwania, a następnie kliknij przycisk **OK** przycisku.</span><span class="sxs-lookup"><span data-stu-id="a21bd-259">Select the VMs from the protection group that you want to include in the recovery plan and click **OK** button.</span></span>

   <span data-ttu-id="a21bd-260">d.</span><span class="sxs-lookup"><span data-stu-id="a21bd-260">d.</span></span>  <span data-ttu-id="a21bd-261">Wybierz wcześniej utworzony plan odzyskiwania, kliknij przycisk **Dostosuj** przycisk, aby otworzyć widoku dostosowywania planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-261">Select Recovery plan that you created earlier, click **Customize** button to open the Recovery plan customization view.</span></span>

   <span data-ttu-id="a21bd-262">e.</span><span class="sxs-lookup"><span data-stu-id="a21bd-262">e.</span></span>  <span data-ttu-id="a21bd-263">Kliknij prawym przyciskiem myszy **wszystkich grup zamykania** i kliknij przycisk **dodać akcję sprzed**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-263">Right click on **All groups shutdown** and click **Add pre action**.</span></span>

   <span data-ttu-id="a21bd-264">f.</span><span class="sxs-lookup"><span data-stu-id="a21bd-264">f.</span></span>  <span data-ttu-id="a21bd-265">Otwiera Wstaw blok akcji, wprowadź nazwę, wybierz **głównej stronie** opcji w przypadku, gdy opcja uruchamiania, wybierz konto automatyzacji (w którym można dodać elementy runbook), a następnie wybierz **pracy awaryjnej-StorSimple--kontenery woluminów**  elementu runbook.</span><span class="sxs-lookup"><span data-stu-id="a21bd-265">Opens Insert action blade, enter a name, select **Primary side** option in Where to run option, select Automation account (in which you added the runbooks) and then select the **Failover-StorSimple-Volume-Containers** runbook.</span></span>

   <span data-ttu-id="a21bd-266">g.</span><span class="sxs-lookup"><span data-stu-id="a21bd-266">g.</span></span>  <span data-ttu-id="a21bd-267">Kliknij prawym przyciskiem myszy **Grupa 1: Uruchom** i kliknij przycisk **Dodaj chronione elementy** opcji, a następnie wybierz maszyny wirtualne, które mają być chronione w planie odzyskiwania i kliknij przycisk **Ok** przycisku.</span><span class="sxs-lookup"><span data-stu-id="a21bd-267">Right click on **Group 1: Start** and click **Add protected items** option then select the VMs that are to be protected in the recovery plan and Click **Ok** button.</span></span> <span data-ttu-id="a21bd-268">Opcjonalne, jeśli jest ono już zaznaczone maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="a21bd-268">Optional, if it's already selected VMs.</span></span>

   <span data-ttu-id="a21bd-269">h.</span><span class="sxs-lookup"><span data-stu-id="a21bd-269">h.</span></span>  <span data-ttu-id="a21bd-270">Kliknij prawym przyciskiem myszy **Grupa 1: Uruchom** i kliknij przycisk **Post akcji** opcji, a następnie dodaj następujące skrypty:</span><span class="sxs-lookup"><span data-stu-id="a21bd-270">Right click on **Group 1: Start** and click **Post action** option then add all the following scripts:</span></span>

   * <span data-ttu-id="a21bd-271">Element runbook Start-StorSimple--urządzenie wirtualne</span><span class="sxs-lookup"><span data-stu-id="a21bd-271">Start-StorSimple-Virtual-Appliance runbook</span></span>
   * <span data-ttu-id="a21bd-272">Niepowodzenie elementu runbook przez StorSimple--kontenery woluminów</span><span class="sxs-lookup"><span data-stu-id="a21bd-272">Fail over-StorSimple-volume-containers runbook</span></span>
   * <span data-ttu-id="a21bd-273">Element runbook instalacji woluminów po failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-273">Mount-volumes-after-failover runbook</span></span>
   * <span data-ttu-id="a21bd-274">Odinstaluj niestandardowy skryptu — rozszerzenia elementu runbook</span><span class="sxs-lookup"><span data-stu-id="a21bd-274">Uninstall-custom-script-extension runbook</span></span>

   <span data-ttu-id="a21bd-275">i.</span><span class="sxs-lookup"><span data-stu-id="a21bd-275">i.</span></span>  <span data-ttu-id="a21bd-276">Dodaj akcję ręczną po powyżej 4 skrypty w tym samym **Grupa 1: kroki po** sekcji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-276">Add a manual action after the above 4 scripts in the same **Group 1: Post-steps** section.</span></span> <span data-ttu-id="a21bd-277">Ta akcja jest punkt, w którym można sprawdzić, czy wszystko działa poprawnie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-277">This action is the point at which you can verify that everything is working correctly.</span></span> <span data-ttu-id="a21bd-278">Ta akcja musi zostać dodany tylko w ramach testowego trybu failover (tak wybierać tylko **testowy tryb Failover** wyboru).</span><span class="sxs-lookup"><span data-stu-id="a21bd-278">This action needs to be added only as a part of Test failover (so only select the **Test Failover** checkbox).</span></span>

   <span data-ttu-id="a21bd-279">j.</span><span class="sxs-lookup"><span data-stu-id="a21bd-279">j.</span></span>  <span data-ttu-id="a21bd-280">Po akcji ręcznej, Dodaj **oczyszczania** przy użyciu tej samej procedury, który był używany przez inne elementy runbook w skrypcie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-280">After the manual action, add the **Cleanup** script using the same procedure that you used for the other runbooks.</span></span> <span data-ttu-id="a21bd-281">**Zapisz** planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-281">**Save** the recovery plan.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a21bd-282">Podczas uruchamiania test trybu failover, należy sprawdzić wszystko, co w kroku akcji ręcznej, ponieważ woluminów StorSimple, które ma zostać sklonowany na urządzeniu docelowym zostaną usunięte w ramach czyszczenia po wykonaniu akcji ręcznej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-282">When running a test failover, you should verify everything at the manual action step because the StorSimple volumes that had been cloned on the target device will be deleted as a part of the cleanup after the manual action is completed.</span></span>
    >

    ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image7.png)

## <a name="perform-a-test-failover"></a><span data-ttu-id="a21bd-283">Wykonaj test trybu failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-283">Perform a test failover</span></span>
<span data-ttu-id="a21bd-284">Zapoznaj się [rozwiązania Active Directory DR](../site-recovery/site-recovery-active-directory.md) Przewodnik uzupełniający szczególne zagadnienia dotyczące usługi Active Directory podczas testowania trybu failover.</span><span class="sxs-lookup"><span data-stu-id="a21bd-284">Refer to the [Active Directory DR Solution](../site-recovery/site-recovery-active-directory.md) companion guide for considerations specific to Active Directory during the test failover.</span></span> <span data-ttu-id="a21bd-285">Ustawienia lokalnych nie zakłóceń w ogóle, podczas testowania trybu failover.</span><span class="sxs-lookup"><span data-stu-id="a21bd-285">The on-premises setup is not disturbed at all when the test failover occurs.</span></span> <span data-ttu-id="a21bd-286">Woluminów StorSimple, które zostały dołączone do lokalnej maszyny Wirtualnej są klonowane urządzenia StorSimple chmurze na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="a21bd-286">The StorSimple volumes that were attached to the on-premises VM are cloned to the StorSimple Cloud Appliance on Azure.</span></span> <span data-ttu-id="a21bd-287">Maszyny Wirtualnej do celów testowych jest włączane na platformie Azure i sklonowany woluminy są dołączone do maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-287">A VM for test purposes is brought up in Azure and the cloned volumes are attached to the VM.</span></span>

#### <a name="to-perform-the-test-failover"></a><span data-ttu-id="a21bd-288">Aby wykonać test trybu failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-288">To perform the test failover</span></span>
1. <span data-ttu-id="a21bd-289">W portalu Azure wybierz magazyn odzyskiwania lokacji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-289">In the Azure portal, select your site recovery vault.</span></span>
2. <span data-ttu-id="a21bd-290">Kliknij przycisk planu odzyskiwania utworzone dla serwera plików maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-290">Click the recovery plan created for the file server VM.</span></span>
3. <span data-ttu-id="a21bd-291">Kliknij przycisk **testowanie trybu Failover**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-291">Click **Test Failover**.</span></span>
4. <span data-ttu-id="a21bd-292">Wybierz sieć wirtualna platformy Azure, do której maszyny wirtualne Azure zostaną połączone po pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-292">Select the Azure virtual network to which Azure VMs will be connected after failover occurs.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image8.png)
5. <span data-ttu-id="a21bd-293">Kliknij przycisk **OK**, aby rozpocząć tryb failover.</span><span class="sxs-lookup"><span data-stu-id="a21bd-293">Click **OK** to begin the failover.</span></span> <span data-ttu-id="a21bd-294">Możesz śledzić postępy, klikając na maszynie Wirtualnej, aby otworzyć jego właściwości lub na **zadania testowego trybu failover** w nazwie magazynu &gt; **zadania** &gt; **zadania usługi Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-294">You can track progress by clicking on the VM to open its properties, or on the **Test failover job** in vault name &gt; **Jobs** &gt; **Site Recovery jobs**.</span></span>
6. <span data-ttu-id="a21bd-295">Po zakończeniu trybu failover, należy także widoczna replika Azure maszyny są wyświetlane w portalu Azure &gt; **maszyn wirtualnych**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-295">After the failover completes, you should also be able to see the replica Azure machine appear in the Azure portal &gt; **Virtual Machines**.</span></span> <span data-ttu-id="a21bd-296">Można wykonywać z operacji sprawdzania poprawności.</span><span class="sxs-lookup"><span data-stu-id="a21bd-296">You can perform your validations.</span></span>
7. <span data-ttu-id="a21bd-297">Po są wykonywane operacje sprawdzania poprawności, kliknij przycisk **pełne sprawdzanie poprawności**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-297">After the validations are done, click **Validations Complete**.</span></span> <span data-ttu-id="a21bd-298">Zostanie rozpoczęta, woluminy StorSimple i zamykania urządzenia StorSimple w chmurze.</span><span class="sxs-lookup"><span data-stu-id="a21bd-298">This will cleanup the StorSimple Volumes and shutdown the StorSimple Cloud Appliance.</span></span>
8. <span data-ttu-id="a21bd-299">Gdy wszystko będzie gotowe, kliknij przycisk **oczyszczania testowy tryb failover** dla planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-299">Once you're done, click **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="a21bd-300">W notatkach zarejestrować i zapisać wszelkie obserwacje związane z testowania trybu failover.</span><span class="sxs-lookup"><span data-stu-id="a21bd-300">In Notes record and save any observations associated with the test failover.</span></span> <span data-ttu-id="a21bd-301">Spowoduje to usunięcie maszyny wirtualnej, które zostały utworzone podczas testowania trybu failover.</span><span class="sxs-lookup"><span data-stu-id="a21bd-301">This will delete the virtual machine that were created during test failover.</span></span>

## <a name="perform-a-planned-failover"></a><span data-ttu-id="a21bd-302">Realizacja planowanego trybu failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-302">Perform a planned failover</span></span>
   <span data-ttu-id="a21bd-303">Podczas planowanego trybu failover na lokalny serwer plików zamknięcia maszyny Wirtualnej jest bezpiecznie i chmury, w których wykonywana jest migawka kopii zapasowej woluminów na urządzeniu StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-303">During a planned failover, the on-premises file server VM is shut down gracefully and a cloud backup snapshot of the volumes on StorSimple device is taken.</span></span> <span data-ttu-id="a21bd-304">Woluminy StorSimple są Failover urządzeń wirtualnych, replika maszyny Wirtualnej jest włączane na platformie Azure i woluminy są dołączone do maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-304">The StorSimple volumes are failed over to the virtual device, a replica VM is brought up on Azure, and the volumes are attached to the VM.</span></span>

#### <a name="to-perform-a-planned-failover"></a><span data-ttu-id="a21bd-305">Aby wykonać planowanego trybu failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-305">To perform a planned failover</span></span>
1. <span data-ttu-id="a21bd-306">W portalu Azure wybierz **usług odzyskiwania** magazynu &gt; **planów odzyskiwania (lokacji odzyskiwania)** &gt; **recoveryplan_name** utworzone dla Serwer plików maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-306">In the Azure portal, select **Recovery services** vault &gt; **Recovery plans (Site recovery)** &gt; **recoveryplan_name** created for the file server VM.</span></span>
2. <span data-ttu-id="a21bd-307">W bloku planu odzyskiwania, kliknij **więcej** &gt; **planowanego trybu failover**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-307">On the Recovery plan blade, Click **More** &gt;  **Planned failover**.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image9.png)
3. <span data-ttu-id="a21bd-308">Na **potwierdzić planowanego trybu Failover** bloku, wybierz źródłowych i docelowych lokalizacji i Sieć docelowa wybierz i kliknij ikonę znacznika wyboru ✓, aby rozpocząć proces trybu failover.</span><span class="sxs-lookup"><span data-stu-id="a21bd-308">On the **Confirm Planned Failover** blade, choose the source and target locations and select target network and click the check icon ✓ to start the failover process.</span></span>
4. <span data-ttu-id="a21bd-309">Po utworzeniu maszyny wirtualnej repliki, są one w stan oczekiwania na zatwierdzenie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-309">After replica virtual machines are created they're in a commit pending state.</span></span> <span data-ttu-id="a21bd-310">Kliknij przycisk **zatwierdzania** do zatwierdzenia pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-310">Click **Commit** to commit the failover.</span></span>
5. <span data-ttu-id="a21bd-311">Po zakończeniu replikacji maszyn wirtualnych uruchomienia w lokalizacji dodatkowej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-311">After replication is complete, the virtual machines start up at the secondary location.</span></span>

## <a name="perform-a-failover"></a><span data-ttu-id="a21bd-312">Przejściu w tryb failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-312">Perform a failover</span></span>
<span data-ttu-id="a21bd-313">Podczas nieplanowanego trybu failover woluminów StorSimple nie powiodło przez urządzenie wirtualne, replika maszyny Wirtualnej zostanie przeniesiony na platformie Azure i woluminy są dołączone do maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-313">During an unplanned failover, the StorSimple volumes are failed over to the virtual device, a replica VM will be brought up on Azure, and the volumes are attached to the VM.</span></span>

#### <a name="to-perform-a-failover"></a><span data-ttu-id="a21bd-314">Aby włączyć tryb failover</span><span class="sxs-lookup"><span data-stu-id="a21bd-314">To perform a failover</span></span>
1. <span data-ttu-id="a21bd-315">W portalu Azure wybierz **usług odzyskiwania** magazynu &gt; **planów odzyskiwania (lokacji odzyskiwania)** &gt; **recoveryplan_name** utworzone dla Serwer plików maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-315">In the Azure portal, select **Recovery services** vault &gt; **Recovery plans (Site recovery)** &gt; **recoveryplan_name** created for the file server VM.</span></span>
2. <span data-ttu-id="a21bd-316">W bloku planu odzyskiwania, kliknij **więcej** &gt; **pracy awaryjnej**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-316">On the Recovery plan blade, Click **More** &gt;  **Failover**.</span></span>
3. <span data-ttu-id="a21bd-317">Na **potwierdzić trybu Failover** bloku, wybierz źródło i docelowych lokalizacji.</span><span class="sxs-lookup"><span data-stu-id="a21bd-317">On the **Confirm Failover** blade, choose the source and target locations.</span></span>
4. <span data-ttu-id="a21bd-318">Wybierz **wyłączyć maszyny wirtualne i zsynchronizuj najnowsze dane** do określenia, czy usługi Site Recovery należy spróbować zamknąć chronioną maszynę wirtualną i synchronizacji danych, dzięki czemu będzie można przełączyć najnowszej wersji danych.</span><span class="sxs-lookup"><span data-stu-id="a21bd-318">Select **Shut down virtual machines and synchronize the latest data** to specify that Site Recovery should try to shut down the protected virtual machine and synchronize the data so that the latest version of the data will be failed over.</span></span>
5. <span data-ttu-id="a21bd-319">Po pracy awaryjnej maszyny wirtualne są w stan oczekiwania na zatwierdzenie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-319">After the failover, the virtual machines are in a commit pending state.</span></span> <span data-ttu-id="a21bd-320">Kliknij przycisk **zatwierdzania** do zatwierdzenia pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-320">Click **Commit** to commit the failover.</span></span>


## <a name="perform-a-failback"></a><span data-ttu-id="a21bd-321">Wykonaj powrót po awarii</span><span class="sxs-lookup"><span data-stu-id="a21bd-321">Perform a failback</span></span>
<span data-ttu-id="a21bd-322">Podczas powrotu po awarii kontenery woluminów StorSimple są nie powiodło się na powrót do urządzenia fizycznego po wykonywana jest kopia zapasowa.</span><span class="sxs-lookup"><span data-stu-id="a21bd-322">During a failback, StorSimple volume containers are failed over back to the physical device after a backup is taken.</span></span>

#### <a name="to-perform-a-failback"></a><span data-ttu-id="a21bd-323">Aby wykonać powrotu po awarii</span><span class="sxs-lookup"><span data-stu-id="a21bd-323">To perform a failback</span></span>
1. <span data-ttu-id="a21bd-324">W portalu Azure wybierz **usług odzyskiwania** magazynu &gt; **planów odzyskiwania (lokacji odzyskiwania)** &gt; **recoveryplan_name** utworzone dla Serwer plików maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-324">In the Azure portal, select **Recovery services** vault &gt; **Recovery plans (Site Recovery)** &gt; **recoveryplan_name** created for the file server VM.</span></span>
2. <span data-ttu-id="a21bd-325">W bloku planu odzyskiwania, kliknij **więcej** &gt; **planowanego trybu Failover**.</span><span class="sxs-lookup"><span data-stu-id="a21bd-325">On the Recovery plan blade, Click **More** &gt;  **Planned Failover**.</span></span>
3. <span data-ttu-id="a21bd-326">Wybierz lokalizacje źródłowa i docelowa, wybierz odpowiednie synchronizacji danych oraz opcje tworzenia maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-326">Choose the source and target locations, select the appropriate Data synchronization and VM creation options.</span></span>
4. <span data-ttu-id="a21bd-327">Kliknij przycisk **OK** przycisk, aby rozpocząć proces powrotu po awarii.</span><span class="sxs-lookup"><span data-stu-id="a21bd-327">Click **OK** button to start the failback process.</span></span>

   ![](./media/storsimple-disaster-recovery-using-azure-site-recovery/image10.png)

## <a name="best-practices"></a><span data-ttu-id="a21bd-328">Najlepsze rozwiązania</span><span class="sxs-lookup"><span data-stu-id="a21bd-328">Best Practices</span></span>
### <a name="capacity-planning-and-readiness-assessment"></a><span data-ttu-id="a21bd-329">Pojemności oceny planowania i gotowości</span><span class="sxs-lookup"><span data-stu-id="a21bd-329">Capacity planning and readiness assessment</span></span>
#### <a name="hyper-v-site"></a><span data-ttu-id="a21bd-330">Lokacja funkcji Hyper-V</span><span class="sxs-lookup"><span data-stu-id="a21bd-330">Hyper-V site</span></span>
<span data-ttu-id="a21bd-331">Użyj [planisty wydajności użytkownika](http://www.microsoft.com/download/details.aspx?id=39057) do projektowania serwera, magazynu i infrastruktury sieci w środowisku funkcji Hyper-V replica.</span><span class="sxs-lookup"><span data-stu-id="a21bd-331">Use the [User Capacity planner tool](http://www.microsoft.com/download/details.aspx?id=39057) to design the server, storage, and network infrastructure for your Hyper-V replica environment.</span></span>

#### <a name="azure"></a><span data-ttu-id="a21bd-332">Azure</span><span class="sxs-lookup"><span data-stu-id="a21bd-332">Azure</span></span>
<span data-ttu-id="a21bd-333">Można uruchomić [narzędzie oceny gotowości maszyny wirtualnej Azure](http://azure.microsoft.com/downloads/vm-readiness-assessment/) na maszynach wirtualnych, aby upewnić się, że są one zgodne z maszynami wirtualnymi Azure i usług Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="a21bd-333">You can run the [Azure Virtual Machine Readiness Assessment tool](http://azure.microsoft.com/downloads/vm-readiness-assessment/) on VMs to ensure that they are compatible with Azure VMs and Azure Site Recovery Services.</span></span> <span data-ttu-id="a21bd-334">Narzędzie oceny gotowości sprawdza konfiguracji maszyny Wirtualnej, a także ostrzega, konfiguracje są niezgodne z platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="a21bd-334">The Readiness Assessment Tool checks VM configurations and warns when configurations are incompatible with Azure.</span></span> <span data-ttu-id="a21bd-335">Na przykład jego wygeneruje ostrzeżenie, jeśli dysk C: jest większy niż 127 GB.</span><span class="sxs-lookup"><span data-stu-id="a21bd-335">For example, it issues a warning if a C: drive is larger than 127 GB.</span></span>

<span data-ttu-id="a21bd-336">Planowanie wydajności składa się z co najmniej dwie ważne procesów:</span><span class="sxs-lookup"><span data-stu-id="a21bd-336">Capacity planning is made up of at least two important processes:</span></span>

* <span data-ttu-id="a21bd-337">Mapowanie lokalnych maszyn wirtualnych funkcji Hyper-V do rozmiarów maszyn wirtualnych Azure (na przykład A6, A7 A8 i A9).</span><span class="sxs-lookup"><span data-stu-id="a21bd-337">Mapping on-premises Hyper-V VMs to Azure VM sizes (such as A6, A7, A8, and A9).</span></span>
* <span data-ttu-id="a21bd-338">Określanie wymaganego przepustowości połączenia z Internetem.</span><span class="sxs-lookup"><span data-stu-id="a21bd-338">Determining the required Internet bandwidth.</span></span>

## <a name="limitations"></a><span data-ttu-id="a21bd-339">Ograniczenia</span><span class="sxs-lookup"><span data-stu-id="a21bd-339">Limitations</span></span>
* <span data-ttu-id="a21bd-340">Obecnie tylko 1 urządzenia StorSimple można Failover (na jednym urządzeniu chmury StorSimple).</span><span class="sxs-lookup"><span data-stu-id="a21bd-340">Currently, only 1 StorSimple device can be failed over (to a single StorSimple Cloud Appliance).</span></span> <span data-ttu-id="a21bd-341">Scenariusz serwera plików, które obejmuje kilka urządzeń StorSimple nie jest jeszcze obsługiwany.</span><span class="sxs-lookup"><span data-stu-id="a21bd-341">The scenario of a file server that spans several StorSimple devices is not yet supported.</span></span>
* <span data-ttu-id="a21bd-342">Jeśli wystąpi błąd podczas włączania ochrony dla maszyny Wirtualnej, upewnij się, Rozłączono obiektów docelowych iSCSI.</span><span class="sxs-lookup"><span data-stu-id="a21bd-342">If you get an error while enabling protection for a VM, make sure that you have disconnected the iSCSI targets.</span></span>
* <span data-ttu-id="a21bd-343">Wszystkie kontenery woluminów, które zostały zgrupowane razem z powodu zasad tworzenia kopii zapasowych, dzieląc go w kontenery woluminów będzie można przełączyć razem.</span><span class="sxs-lookup"><span data-stu-id="a21bd-343">All the volume containers that have been grouped together because of backup policies spanning across volume containers will be failed over together.</span></span>
* <span data-ttu-id="a21bd-344">Wszystkie woluminy w kontenerach woluminu wybrana zostanie zainicjowana.</span><span class="sxs-lookup"><span data-stu-id="a21bd-344">All the volumes in the volume containers you have chosen will be failed over.</span></span>
* <span data-ttu-id="a21bd-345">Nie można przełączyć woluminów, które dodać do więcej niż 64 TB, ponieważ maksymalną pojemność pojedynczego urządzenia chmury StorSimple wynosi 64 TB.</span><span class="sxs-lookup"><span data-stu-id="a21bd-345">Volumes that add up to more than 64 TB can’t be failed over because the maximum capacity of a single StorSimple Cloud Appliance is 64 TB.</span></span>
* <span data-ttu-id="a21bd-346">Jeśli planowane lub nieplanowane przejście trybu failover nie powiedzie się i maszyn wirtualnych są tworzone na platformie Azure, następnie nie oczyszczania zapasowej maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="a21bd-346">If the planned/unplanned failover fails and the VMs are created in Azure, then do not clean up the VMs.</span></span> <span data-ttu-id="a21bd-347">Zamiast tego powrotu po awarii.</span><span class="sxs-lookup"><span data-stu-id="a21bd-347">Instead, do a failback.</span></span> <span data-ttu-id="a21bd-348">Jeśli usuniesz maszyn wirtualnych następnie lokalnych maszyn wirtualnych nie można włączyć ponownie.</span><span class="sxs-lookup"><span data-stu-id="a21bd-348">If you delete the VMs then the on-premises VMs cannot be turned on again.</span></span>
* <span data-ttu-id="a21bd-349">Po przejściu w tryb failover Jeśli nie są widoczne na woluminach, przejdź do maszyn wirtualnych, otwórz przystawkę Zarządzanie dyskami ponownie przeskanować dyski i dostosować je online.</span><span class="sxs-lookup"><span data-stu-id="a21bd-349">After a failover, if you are not able to see the volumes, go to the VMs, open Disk Management, rescan the disks, and then bring them online.</span></span>
* <span data-ttu-id="a21bd-350">W niektórych przypadkach litery dysku w lokacji odzyskiwania po awarii może różnić się od litery lokalną.</span><span class="sxs-lookup"><span data-stu-id="a21bd-350">In some instances, the drive letters in the DR site might be different than the letters on-premises.</span></span> <span data-ttu-id="a21bd-351">W takim przypadku należy ręcznie rozwiązać ten problem, po zakończeniu pracy awaryjnej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-351">If this occurs, you will need to manually correct the problem after the failover is finished.</span></span>
* <span data-ttu-id="a21bd-352">Powinno zostać wyłączone uwierzytelnianie wieloskładnikowe dla poświadczenia platformy Azure, wprowadzony na koncie automatyzacji jako zasób.</span><span class="sxs-lookup"><span data-stu-id="a21bd-352">Multi-factor authentication should be disabled for the Azure credential that is entered in the automation account as an asset.</span></span> <span data-ttu-id="a21bd-353">Jeśli uwierzytelnianie nie jest wyłączone, skrypty będzie niemożliwe do automatycznego uruchamiania i planu odzyskiwania zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="a21bd-353">If this authentication is not disabled, scripts will not be allowed to run automatically and the recovery plan will fail.</span></span>
* <span data-ttu-id="a21bd-354">Limit czasu zadania trybu failover: StorSimple skryptu zostanie limit czasu, jeśli trybem failover kontenery woluminów trwa dłużej niż limit usługi Azure Site Recovery dla skryptu (obecnie 120 minut).</span><span class="sxs-lookup"><span data-stu-id="a21bd-354">Failover job timeout: The StorSimple script will time out if the failover of volume containers takes more time than the Azure Site Recovery limit per script (currently 120 minutes).</span></span>
* <span data-ttu-id="a21bd-355">Limit czasu zadania tworzenia kopii zapasowej: Jeśli woluminów kopii zapasowej trwa dłużej niż limit usługi Azure Site Recovery dla skryptu (obecnie 120 minut) limitu czasu skryptu StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-355">Backup job timeout: The StorSimple script times out if the backup of volumes takes more time than the Azure Site Recovery limit per script (currently 120 minutes).</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="a21bd-356">Ręcznie uruchom kopię zapasową z portalu Azure, a następnie ponownie uruchom planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-356">Run the backup manually from the Azure portal and then run the recovery plan again.</span></span>

* <span data-ttu-id="a21bd-357">Limit czasu zadania sklonować: Jeśli Klonowanie woluminów zajmuje więcej czasu niż limit usługi Azure Site Recovery dla skryptu (obecnie 120 minut) limitu czasu skryptu StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-357">Clone job timeout: The StorSimple script times out if the cloning of volumes takes more time than the Azure Site Recovery limit per script (currently 120 minutes).</span></span>
* <span data-ttu-id="a21bd-358">Błąd synchronizacji czasu: StorSimple skrypty błędy limit informujący o tym, że kopie zapasowe nie powiodły, mimo że kopii zapasowej zakończy się pomyślnie w portalu.</span><span class="sxs-lookup"><span data-stu-id="a21bd-358">Time synchronization error: The StorSimple scripts errors out saying that the backups were unsuccessful even though the backup is successful in the portal.</span></span> <span data-ttu-id="a21bd-359">Możliwą przyczyną tego może być, że urządzenia StorSimple czasu może być zsynchronizowany z bieżącym czasem w strefie czasowej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-359">A possible cause for this might be that the StorSimple appliance’s time might be out of sync with the current time in the time zone.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="a21bd-360">Synchronizacja czasu urządzenia przy użyciu bieżącego czasu w strefie czasowej.</span><span class="sxs-lookup"><span data-stu-id="a21bd-360">Sync the appliance time with the current time in the time zone.</span></span>

* <span data-ttu-id="a21bd-361">Błąd trybu failover urządzenia: StorSimple skrypt może zakończyć się niepowodzeniem, jeśli występuje urządzenia trybu failover, gdy działa planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-361">Appliance failover error: The StorSimple script might fail if there is an appliance failover when the recovery plan is running.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="a21bd-362">Po zakończeniu pracy awaryjnej urządzenia, uruchom ponownie planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="a21bd-362">Rerun the recovery plan after the appliance failover is complete.</span></span>


## <a name="summary"></a><span data-ttu-id="a21bd-363">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="a21bd-363">Summary</span></span>
<span data-ttu-id="a21bd-364">Za pomocą usługi Azure Site Recovery, można utworzyć plan odzyskiwania ukończenia automatycznego po awarii dla serwera plików maszyny Wirtualnej o udziały plików hostowane na magazynie StorSimple.</span><span class="sxs-lookup"><span data-stu-id="a21bd-364">Using Azure Site Recovery, you can create a complete automated disaster recovery plan for a file server VM having file shares hosted on StorSimple storage.</span></span> <span data-ttu-id="a21bd-365">Możesz zainicjować trybu failover w ciągu kilku sekund z dowolnego miejsca w przypadku przerwy w pracy i get aplikacji do pracy w ciągu kilku minut.</span><span class="sxs-lookup"><span data-stu-id="a21bd-365">You can initiate the failover within seconds from anywhere in the event of a disruption and get the application up and running in a few minutes.</span></span>
