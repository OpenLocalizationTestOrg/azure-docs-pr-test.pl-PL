---
title: "Usługi Active Directory Federation Services na platformie Azure | Microsoft Docs"
description: "W tym dokumencie omówiono procedurę wdrożenia usług AD FS na platformie Azure w celu zapewnienia wysokiej dostępności."
keywords: "wdrażanie usług AD FS na platformie Azure, wdrażanie azure adfs, azure adfs, azure ad fs, wdrażanie adfs, wdrażanie ad fs, adfs w azure, wdrażanie adfs w azure, wdrażanie usług AD FS na platformie azure, adfs azure, wprowadzenie do usług AD FS, Azure, wprowadzenie do usług AD FS na platformie Azure, iaas, ADFS, przenoszenie adfs do azure"
services: active-directory
documentationcenter: 
author: anandyadavmsft
manager: femila
editor: 
ms.assetid: 692a188c-badc-44aa-ba86-71c0e8074510
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 07/17/2017
ms.author: anandy; billmath
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: ddd29a1230286de8999175498ee793f3b3ea24e2
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="deploying-active-directory-federation-services-in-azure"></a><span data-ttu-id="cfd00-104">Wdrażanie usług Active Directory Federation Services na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="cfd00-104">Deploying Active Directory Federation Services in Azure</span></span>
<span data-ttu-id="cfd00-105">Usługi AD FS udostępniają uproszczone, zabezpieczone funkcje federacji tożsamości i logowania jednokrotnego (SSO) w sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-105">AD FS provides simplified, secured identity federation and Web single sign-on (SSO) capabilities.</span></span> <span data-ttu-id="cfd00-106">Federacja z usługą Azure AD lub O365 umożliwia użytkownikom uwierzytelnianie się przy użyciu poświadczeń lokalnych i uzyskiwanie dostępu do wszystkich zasobów w chmurze.</span><span class="sxs-lookup"><span data-stu-id="cfd00-106">Federation with Azure AD or O365 enables users to authenticate using on-premises credentials and access all resources in cloud.</span></span> <span data-ttu-id="cfd00-107">Tym samym ważne staje się zapewnienie infrastruktury usług AD FS o wysokiej dostępności, która gwarantuje dostęp zarówno do zasobów lokalnych, jak i przechowywanych w chmurze.</span><span class="sxs-lookup"><span data-stu-id="cfd00-107">As a result, it becomes important to have a highly available AD FS infrastructure to ensure access to resources both on-premises and in the cloud.</span></span> <span data-ttu-id="cfd00-108">Wdrożenie usług AD FS na platformie Azure może pomóc w osiągnięciu wymaganej wysokiej dostępności w prosty sposób.</span><span class="sxs-lookup"><span data-stu-id="cfd00-108">Deploying AD FS in Azure can help achieve the high availability required with minimal efforts.</span></span>
<span data-ttu-id="cfd00-109">Wdrożenie usług AD FS na platformie Azure niesie ze sobą szereg korzyści, takich jak na przykład:</span><span class="sxs-lookup"><span data-stu-id="cfd00-109">There are several advantages of deploying AD FS in Azure, a few of them are listed below:</span></span>

* <span data-ttu-id="cfd00-110">**Wysoka dostępność** — zaawansowane możliwości zapewniane przez zestawy dostępności Azure gwarantują wysoką dostępność infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="cfd00-110">**High Availability** - With the power of Azure Availability Sets, you ensure a highly available infrastructure.</span></span>
* <span data-ttu-id="cfd00-111">**Łatwe skalowanie** — chcesz zwiększyć wydajność?</span><span class="sxs-lookup"><span data-stu-id="cfd00-111">**Easy to Scale** – Need more performance?</span></span> <span data-ttu-id="cfd00-112">Platforma Azure pozwala łatwo przeprowadzić migrację na bardziej wydajne maszyny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-112">Easily migrate to more powerful machines by just a few clicks in Azure</span></span>
* <span data-ttu-id="cfd00-113">**Nadmiarowość geograficzna między lokalizacjami** — nadmiarowość geograficzna platformy Azure zapewnia wysoką dostępność infrastruktury na całym świecie.</span><span class="sxs-lookup"><span data-stu-id="cfd00-113">**Cross-Geo Redundancy** – With Azure Geo Redundancy you can be assured that your infrastructure is highly available across the globe</span></span>
* <span data-ttu-id="cfd00-114">**Łatwe zarządzanie** — opcje zarządzania w witrynie Azure Portal są bardzo uproszczone, co sprawia, że zarządzanie infrastrukturą jest bardzo łatwe i bezproblemowe.</span><span class="sxs-lookup"><span data-stu-id="cfd00-114">**Easy to Manage** – With highly simplified management options in Azure portal, managing your infrastructure is very easy and hassle-free</span></span> 

## <a name="design-principles"></a><span data-ttu-id="cfd00-115">Zasady projektowania</span><span class="sxs-lookup"><span data-stu-id="cfd00-115">Design principles</span></span>
![Projekt wdrożenia](./media/active-directory-aadconnect-azure-adfs/deployment.png)

<span data-ttu-id="cfd00-117">Na powyższym diagramie przedstawiono zalecaną podstawową topologię umożliwiającą rozpoczęcie wdrażania infrastruktury usług AD FS na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="cfd00-117">The diagram above shows the recommended basic topology to start deploying your AD FS infrastructure in Azure.</span></span> <span data-ttu-id="cfd00-118">Poniżej przedstawiono zasady dotyczące różnych składników tej topologii:</span><span class="sxs-lookup"><span data-stu-id="cfd00-118">The principles behind the various components of the topology are listed below:</span></span>

* <span data-ttu-id="cfd00-119">**Kontrolery domeny (DC) / serwery usług AD FS**: jeśli liczba użytkowników nie przekracza 1000, można po prostu zainstalować rolę usług AD FS na kontrolerach domeny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-119">**DC / ADFS Servers**: If you have fewer than 1,000 users you can simply install AD FS role on your domain controllers.</span></span> <span data-ttu-id="cfd00-120">Jeśli liczba użytkowników przekracza 1000 lub konieczne jest wyeliminowanie wszelkich wpływów na wydajność kontrolerów domeny, usługi AD FS należy wdrożyć na oddzielnych serwerach.</span><span class="sxs-lookup"><span data-stu-id="cfd00-120">If you do not want any performance impact on the domain controllers or if you have more than 1,000 users, then deploy AD FS on separate servers.</span></span>
* <span data-ttu-id="cfd00-121">**Serwer proxy aplikacji sieci Web (WAP)** — konieczne jest wdrożenie serwerów proxy aplikacji sieci Web w celu umożliwienia użytkownikom korzystania z usług AD FS również spoza sieci firmowej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-121">**WAP Server** – it is necessary to deploy Web Application Proxy servers, so that users can reach the AD FS when they are not on the company network also.</span></span>
* <span data-ttu-id="cfd00-122">**Strefa DMZ**: serwery proxy aplikacji sieci Web zostaną umieszczone w strefie DMZ. Komunikacja między strefą DMZ i podsiecią wewnętrzną jest możliwa TYLKO przez port TCP 443.</span><span class="sxs-lookup"><span data-stu-id="cfd00-122">**DMZ**: The Web Application Proxy servers will be placed in the DMZ and ONLY TCP/443 access is allowed between the DMZ and the internal subnet.</span></span>
* <span data-ttu-id="cfd00-123">**Moduły równoważenia obciążenia**: aby zapewnić wysoką dostępność usług AD FS i serwerów proxy aplikacji sieci Web, zaleca się użycie wewnętrznego modułu równoważenia obciążenia dla serwerów usług AD FS oraz usługi Azure Load Balancer dla serwerów proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-123">**Load Balancers**: To ensure high availability of AD FS and Web Application Proxy servers, we recommend using an internal load balancer for AD FS servers and Azure Load Balancer for Web Application Proxy servers.</span></span>
* <span data-ttu-id="cfd00-124">**Zestawy dostępności**: aby zapewnić nadmiarowość wdrożenia usług AD FS, zaleca się umieszczenie co najmniej dwóch maszyn wirtualnych w zestawie dostępności w celu uzyskania podobnych obciążeń.</span><span class="sxs-lookup"><span data-stu-id="cfd00-124">**Availability Sets**: To provide redundancy to your AD FS deployment, it is recommended that you group two or more virtual machines in an Availability Set for similar workloads.</span></span> <span data-ttu-id="cfd00-125">Taka konfiguracja zapewnia dostępność co najmniej jednej maszyny wirtualnej podczas planowanych i nieplanowanych zdarzeń związanych z konserwacją.</span><span class="sxs-lookup"><span data-stu-id="cfd00-125">This configuration ensures that during either a planned or unplanned maintenance event, at least one virtual machine will be available</span></span>
* <span data-ttu-id="cfd00-126">**Konta magazynu**: zaleca się korzystanie z dwóch kont magazynu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-126">**Storage Accounts**: It is recommended to have two storage accounts.</span></span> <span data-ttu-id="cfd00-127">Korzystanie z jednego konta magazynu może prowadzić do utworzenia pojedynczego punktu awarii. Jeśli konto magazynu przestanie funkcjonować (w mało prawdopodobnym scenariuszu), wdrożenie stanie się niedostępne.</span><span class="sxs-lookup"><span data-stu-id="cfd00-127">Having a single storage account can lead to creation of a single point of failure and can cause the deployment to become unavailable in an unlikely scenario where the storage account goes down.</span></span> <span data-ttu-id="cfd00-128">Użycie dwóch kont magazynu pozwala powiązać każde konto z linią awarii.</span><span class="sxs-lookup"><span data-stu-id="cfd00-128">Two storage accounts will help associate one storage account for each fault line.</span></span>
* <span data-ttu-id="cfd00-129">**Separacja sieci**: serwery proxy aplikacji sieci Web powinny zostać wdrożone w oddzielnej sieci DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-129">**Network segregation**:  Web Application Proxy servers should be deployed in a separate DMZ network.</span></span> <span data-ttu-id="cfd00-130">Sieć wirtualną można podzielić na dwie odizolowane podsieci, a następnie wdrożyć w nich serwery proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-130">You can divide one virtual network into two subnets and then deploy the Web Application Proxy server(s) in an isolated subnet.</span></span> <span data-ttu-id="cfd00-131">Dla każdej podsieci można po prostu skonfigurować ustawienia sieciowej grupy zabezpieczeń, zezwalając tylko na wymaganą komunikację między tymi podsieciami.</span><span class="sxs-lookup"><span data-stu-id="cfd00-131">You can simply configure the network security group settings for each subnet and allow only required communication between the two subnets.</span></span> <span data-ttu-id="cfd00-132">Więcej szczegółów podano w poniższych scenariuszach wdrażania.</span><span class="sxs-lookup"><span data-stu-id="cfd00-132">More details are given per deployment scenario below</span></span>

## <a name="steps-to-deploy-ad-fs-in-azure"></a><span data-ttu-id="cfd00-133">Kroki umożliwiające wdrożenie usług AD FS na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="cfd00-133">Steps to deploy AD FS in Azure</span></span>
<span data-ttu-id="cfd00-134">Kroki zawarte w tej sekcji służą jako przewodnik umożliwiający wdrożenie opisanej poniżej infrastruktury usług AD FS na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="cfd00-134">The steps mentioned in this section outline the guide to deploy the below depicted AD FS infrastructure in Azure.</span></span>

### <a name="1-deploying-the-network"></a><span data-ttu-id="cfd00-135">1. Wdrażanie sieci</span><span class="sxs-lookup"><span data-stu-id="cfd00-135">1. Deploying the network</span></span>
<span data-ttu-id="cfd00-136">Zgodnie z powyższymi informacjami można utworzyć dwie podsieci w jednej sieci wirtualnej lub skonfigurować dwie całkowicie odrębne sieci wirtualne.</span><span class="sxs-lookup"><span data-stu-id="cfd00-136">As outlined above, you can either create two subnets in a single virtual network or else create two completely different virtual networks (VNet).</span></span> <span data-ttu-id="cfd00-137">W tym artykule omówiono wariant obejmujący wdrożenie jednej sieci wirtualnej, która zostanie podzielona na dwie podsieci.</span><span class="sxs-lookup"><span data-stu-id="cfd00-137">This article will focus on deploying a single virtual network and divide it into two subnets.</span></span> <span data-ttu-id="cfd00-138">Takie podejście jest prostsze, ponieważ użycie dwóch sieci wirtualnych wymagałoby zastosowania bramy umożliwiającej komunikację.</span><span class="sxs-lookup"><span data-stu-id="cfd00-138">This is currently an easier approach as two separate VNets would require a VNet to VNet gateway for communications.</span></span>

<span data-ttu-id="cfd00-139">**1.1 Tworzenie sieci wirtualnej**</span><span class="sxs-lookup"><span data-stu-id="cfd00-139">**1.1 Create virtual network**</span></span>

![Tworzenie sieci wirtualnej](./media/active-directory-aadconnect-azure-adfs/deploynetwork1.png)

<span data-ttu-id="cfd00-141">W witrynie Azure Portal wybierz sieć wirtualną. W bardzo prosty sposób możesz wdrożyć sieć wirtualną z jedną podsiecią.</span><span class="sxs-lookup"><span data-stu-id="cfd00-141">In the Azure portal, select virtual network and you can deploy the virtual network and one subnet immediately with just one click.</span></span> <span data-ttu-id="cfd00-142">Podsieć wewnętrzna jest również zdefiniowana i gotowa do dodania maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="cfd00-142">INT subnet is also defined and is ready now for VMs to be added.</span></span>
<span data-ttu-id="cfd00-143">Następnym krokiem jest dodanie podsieci DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-143">The next step is to add another subnet to the network, i.e. the DMZ subnet.</span></span> <span data-ttu-id="cfd00-144">Aby utworzyć podsieć DMZ, wystarczy wykonać następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="cfd00-144">To create the DMZ subnet, simply</span></span>

* <span data-ttu-id="cfd00-145">Wybierz nowo utworzoną sieć.</span><span class="sxs-lookup"><span data-stu-id="cfd00-145">Select the newly created network</span></span>
* <span data-ttu-id="cfd00-146">W obszarze właściwości wybierz pozycję Podsieć.</span><span class="sxs-lookup"><span data-stu-id="cfd00-146">In the properties select subnet</span></span>
* <span data-ttu-id="cfd00-147">W panelu podsieci kliknij przycisk dodawania.</span><span class="sxs-lookup"><span data-stu-id="cfd00-147">In the subnet panel click on the add button</span></span>
* <span data-ttu-id="cfd00-148">Podaj nazwę podsieci i informacje dotyczące przestrzeni adresowej w celu utworzenia podsieci.</span><span class="sxs-lookup"><span data-stu-id="cfd00-148">Provide the subnet name and address space information to create the subnet</span></span>

![Podsieć](./media/active-directory-aadconnect-azure-adfs/deploynetwork2.png)

![Podsieć DMZ](./media/active-directory-aadconnect-azure-adfs/deploynetwork3.png)

<span data-ttu-id="cfd00-151">**1.2. Tworzenie sieciowych grup zabezpieczeń**</span><span class="sxs-lookup"><span data-stu-id="cfd00-151">**1.2. Creating the network security groups**</span></span>

<span data-ttu-id="cfd00-152">Sieciowa grupa zabezpieczeń (NSG, Network security group) zawiera listę reguł listy kontroli dostępu (ACL), które blokują lub zezwalają na ruch sieciowy do wystąpień maszyn wirtualnych w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-152">A Network security group (NSG) contains a list of Access Control List (ACL) rules that allow or deny network traffic to your VM instances in a Virtual Network.</span></span> <span data-ttu-id="cfd00-153">Grupy NSG można kojarzyć z podsieciami lub poszczególnymi wystąpieniami maszyn wirtualnych w danej podsieci.</span><span class="sxs-lookup"><span data-stu-id="cfd00-153">NSGs can be associated with either subnets or individual VM instances within that subnet.</span></span> <span data-ttu-id="cfd00-154">Gdy sieciowa grupa zabezpieczeń jest skojarzona z podsiecią, reguły listy ACL dotyczą wszystkich wystąpień maszyn wirtualnych w tej podsieci.</span><span class="sxs-lookup"><span data-stu-id="cfd00-154">When an NSG is associated with a subnet, the ACL rules apply to all the VM instances in that subnet.</span></span>
<span data-ttu-id="cfd00-155">Na potrzeby tego przewodnika zostaną utworzone dwie sieciowe grupy zabezpieczeń: dla sieci wewnętrznej i podsieci DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-155">For the purpose of this guidance, we will create two NSGs: one each for an internal network and a DMZ.</span></span> <span data-ttu-id="cfd00-156">Zostaną one odpowiednio oznaczone: NSG_INT i NSG_DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-156">They will be labeled NSG_INT and NSG_DMZ respectively.</span></span>

![Tworzenie sieciowej grupy zabezpieczeń](./media/active-directory-aadconnect-azure-adfs/creatensg1.png)

<span data-ttu-id="cfd00-158">Utworzona sieciowa grupa zabezpieczeń nie zawiera żadnych reguł ruchu przychodzącego ani reguł ruchu wychodzącego.</span><span class="sxs-lookup"><span data-stu-id="cfd00-158">After the NSG is created, there will be 0 inbound and 0 outbound rules.</span></span> <span data-ttu-id="cfd00-159">Gdy zaczną działać role zainstalowane na poszczególnych serwerach, można przystąpić do konfigurowania reguł ruchu przychodzącego i wychodzącego zgodnie z odpowiednim poziomem zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="cfd00-159">Once the roles on the respective servers are installed and functional, then the inbound and outbound rules can be made according to the desired level of security.</span></span>

![Inicjowanie sieciowej grupy zabezpieczeń](./media/active-directory-aadconnect-azure-adfs/nsgint1.png)

<span data-ttu-id="cfd00-161">Po utworzeniu sieciowych grup zabezpieczeń skojarz grupę NSG_INT z podsiecią INT, a grupę NSG_DMZ z podsiecią DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-161">After the NSGs are created, associate NSG_INT with subnet INT and NSG_DMZ with subnet DMZ.</span></span> <span data-ttu-id="cfd00-162">Poniżej znajduje się przykładowy zrzut ekranu:</span><span class="sxs-lookup"><span data-stu-id="cfd00-162">An example screenshot is given below:</span></span>

![Konfigurowanie sieciowej grupy zabezpieczeń](./media/active-directory-aadconnect-azure-adfs/nsgconfigure1.png)

* <span data-ttu-id="cfd00-164">Kliknij pozycję Podsieci, aby otworzyć panel podsieci</span><span class="sxs-lookup"><span data-stu-id="cfd00-164">Click on Subnets to open the panel for subnets</span></span>
* <span data-ttu-id="cfd00-165">Wybierz podsieć do skojarzenia z sieciową grupą zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="cfd00-165">Select the subnet to associate with the NSG</span></span> 

<span data-ttu-id="cfd00-166">Po wprowadzeniu zmian w konfiguracji panel podsieci powinien wyglądać tak jak poniżej:</span><span class="sxs-lookup"><span data-stu-id="cfd00-166">After configuration, the panel for Subnets should look like below:</span></span>

![Podsieci skojarzone z sieciową grupą zabezpieczeń](./media/active-directory-aadconnect-azure-adfs/nsgconfigure2.png)

<span data-ttu-id="cfd00-168">**1.3. Tworzenie połączenia z infrastrukturą lokalną**</span><span class="sxs-lookup"><span data-stu-id="cfd00-168">**1.3. Create Connection to on-premises**</span></span>

<span data-ttu-id="cfd00-169">Aby wdrożyć kontroler domeny (DC) na platformie Azure, musisz utworzyć połączenie z infrastrukturą lokalną.</span><span class="sxs-lookup"><span data-stu-id="cfd00-169">We will need a connection to on-premises in order to deploy the domain controller (DC) in azure.</span></span> <span data-ttu-id="cfd00-170">Platforma Azure udostępnia różne opcje umożliwiające połączenie infrastruktury lokalnej z infrastrukturą Azure.</span><span class="sxs-lookup"><span data-stu-id="cfd00-170">Azure offers various connectivity options to connect your on-premises infrastructure to your Azure infrastructure.</span></span>

* <span data-ttu-id="cfd00-171">Punkt-lokacja</span><span class="sxs-lookup"><span data-stu-id="cfd00-171">Point-to-site</span></span>
* <span data-ttu-id="cfd00-172">Lokacja-lokacja w sieci wirtualnej</span><span class="sxs-lookup"><span data-stu-id="cfd00-172">Virtual Network Site-to-site</span></span>
* <span data-ttu-id="cfd00-173">ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="cfd00-173">ExpressRoute</span></span>

<span data-ttu-id="cfd00-174">Zaleca się używanie usługi ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="cfd00-174">It is recommended to use ExpressRoute.</span></span> <span data-ttu-id="cfd00-175">Usługa ExpressRoute umożliwia tworzenie prywatnych połączeń między centrami danych Azure i infrastrukturą lokalną lub wspólnym środowiskiem.</span><span class="sxs-lookup"><span data-stu-id="cfd00-175">ExpressRoute lets you create private connections between Azure datacenters and infrastructure that’s on your premises or in a co-location environment.</span></span> <span data-ttu-id="cfd00-176">Połączenia ExpressRoute nie odbywają się za pośrednictwem publicznego Internetu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-176">ExpressRoute connections do not go over the public Internet.</span></span> <span data-ttu-id="cfd00-177">Zapewniają one większą niezawodność i szybkość oraz mniejsze opóźnienia i lepsze zabezpieczenia niż typowe połączenia przez Internet.</span><span class="sxs-lookup"><span data-stu-id="cfd00-177">They offer more reliability, faster speeds, lower latencies and higher security than typical connections over the Internet.</span></span>
<span data-ttu-id="cfd00-178">Mimo że zaleca się korzystać z usługi ExpressRoute, można wybrać dowolny typ połączenia, dopasowany do potrzeb danej organizacji.</span><span class="sxs-lookup"><span data-stu-id="cfd00-178">While it is recommended to use ExpressRoute, you may choose any connection method best suited for your organization.</span></span> <span data-ttu-id="cfd00-179">Aby dowiedzieć się więcej na temat usługi ExpressRoute i różnych opcji łączności udostępnianych przez tę usługę, przeczytaj artykuł [ExpressRoute — opis techniczny](https://aka.ms/Azure/ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="cfd00-179">To learn more about ExpressRoute and the various connectivity options using ExpressRoute, read [ExpressRoute technical overview](https://aka.ms/Azure/ExpressRoute).</span></span>

### <a name="2-create-storage-accounts"></a><span data-ttu-id="cfd00-180">2. Tworzenie kont magazynu</span><span class="sxs-lookup"><span data-stu-id="cfd00-180">2. Create storage accounts</span></span>
<span data-ttu-id="cfd00-181">Aby utrzymać wysoką dostępność i uniknąć zależności od jednego konta magazynu, można utworzyć dwa konta magazynu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-181">In order to maintain high availability and avoid dependence on a single storage account, you can create two storage accounts.</span></span> <span data-ttu-id="cfd00-182">Maszyny znajdujące się w poszczególnych zestawach dostępności podziel na dwie grupy, a następnie przypisz do każdej grupy oddzielne konto magazynu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-182">Divide the machines in each availability set into two groups and then assign each group a separate storage account.</span></span>

![Tworzenie kont magazynu](./media/active-directory-aadconnect-azure-adfs/storageaccount1.png)

### <a name="3-create-availability-sets"></a><span data-ttu-id="cfd00-184">3. Tworzenie zestawów dostępności</span><span class="sxs-lookup"><span data-stu-id="cfd00-184">3. Create availability sets</span></span>
<span data-ttu-id="cfd00-185">Dla każdej roli (kontrolera domeny/serwera usług AD FS i serwera proxy aplikacji sieci Web) musisz utworzyć zestawy dostępności zawierające co najmniej po dwie maszyny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-185">For each role (DC/AD FS and WAP), create availability sets that will contain 2 machines each at the minimum.</span></span> <span data-ttu-id="cfd00-186">Pozwoli to osiągnąć większą dostępność poszczególnych ról.</span><span class="sxs-lookup"><span data-stu-id="cfd00-186">This will help achieve higher availability for each role.</span></span> <span data-ttu-id="cfd00-187">Tworząc zestawy dostępności, musisz uwzględnić parę zasadniczych kwestii:</span><span class="sxs-lookup"><span data-stu-id="cfd00-187">While creating the availability sets, it is essential to decide on the following:</span></span>

* <span data-ttu-id="cfd00-188">**Domeny błędów**: maszyny wirtualne w tej samej domenie błędów współużytkują źródło zasilania i fizyczny przełącznik sieciowy.</span><span class="sxs-lookup"><span data-stu-id="cfd00-188">**Fault Domains**: Virtual machines in the same fault domain share the same power source and physical network switch.</span></span> <span data-ttu-id="cfd00-189">Zaleca się korzystanie co najmniej z 2 domen błędów.</span><span class="sxs-lookup"><span data-stu-id="cfd00-189">A minimum of 2 fault domains are recommended.</span></span> <span data-ttu-id="cfd00-190">Na potrzeby tego wdrożenia możesz pozostawić wartość domyślną równą 3.</span><span class="sxs-lookup"><span data-stu-id="cfd00-190">The default value is 3 and you can leave it as is for the purpose of this deployment</span></span>
* <span data-ttu-id="cfd00-191">**Domeny aktualizacji**: maszyny w tej samej domenie aktualizacji będą ponownie uruchamiane razem podczas aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="cfd00-191">**Update domains**: Machines belonging to the same update domain are restarted together during an update.</span></span> <span data-ttu-id="cfd00-192">Warto skonfigurować co najmniej 2 domeny aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="cfd00-192">You want to have minimum of 2 update domains.</span></span> <span data-ttu-id="cfd00-193">Na potrzeby tego wdrożenia możesz pozostawić wartość domyślną równą 5.</span><span class="sxs-lookup"><span data-stu-id="cfd00-193">The default value is 5 and you can leave it as is for the purpose of this deployment</span></span>

![Zestawy dostępności](./media/active-directory-aadconnect-azure-adfs/availabilityset1.png)

<span data-ttu-id="cfd00-195">Utwórz następujące zestawy dostępności.</span><span class="sxs-lookup"><span data-stu-id="cfd00-195">Create the following availability sets</span></span>

| <span data-ttu-id="cfd00-196">Zestaw dostępności</span><span class="sxs-lookup"><span data-stu-id="cfd00-196">Availability Set</span></span> | <span data-ttu-id="cfd00-197">Rola</span><span class="sxs-lookup"><span data-stu-id="cfd00-197">Role</span></span> | <span data-ttu-id="cfd00-198">Domeny błędów</span><span class="sxs-lookup"><span data-stu-id="cfd00-198">Fault domains</span></span> | <span data-ttu-id="cfd00-199">Domeny aktualizacji</span><span class="sxs-lookup"><span data-stu-id="cfd00-199">Update domains</span></span> |
|:---:|:---:|:---:|:--- |
| <span data-ttu-id="cfd00-200">contosodcset</span><span class="sxs-lookup"><span data-stu-id="cfd00-200">contosodcset</span></span> |<span data-ttu-id="cfd00-201">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="cfd00-201">DC/ADFS</span></span> |<span data-ttu-id="cfd00-202">3</span><span class="sxs-lookup"><span data-stu-id="cfd00-202">3</span></span> |<span data-ttu-id="cfd00-203">5</span><span class="sxs-lookup"><span data-stu-id="cfd00-203">5</span></span> |
| <span data-ttu-id="cfd00-204">contosowapset</span><span class="sxs-lookup"><span data-stu-id="cfd00-204">contosowapset</span></span> |<span data-ttu-id="cfd00-205">WAP</span><span class="sxs-lookup"><span data-stu-id="cfd00-205">WAP</span></span> |<span data-ttu-id="cfd00-206">3</span><span class="sxs-lookup"><span data-stu-id="cfd00-206">3</span></span> |<span data-ttu-id="cfd00-207">5</span><span class="sxs-lookup"><span data-stu-id="cfd00-207">5</span></span> |

### <a name="4-deploy-virtual-machines"></a><span data-ttu-id="cfd00-208">4. Wdrażanie maszyn wirtualnych</span><span class="sxs-lookup"><span data-stu-id="cfd00-208">4. Deploy virtual machines</span></span>
<span data-ttu-id="cfd00-209">Następnym krokiem jest wdrożenie maszyn wirtualnych, które będą hostować różne role w używanej infrastrukturze.</span><span class="sxs-lookup"><span data-stu-id="cfd00-209">The next step is to deploy virtual machines that will host the different roles in your infrastructure.</span></span> <span data-ttu-id="cfd00-210">Zaleca się wdrożenie co najmniej dwóch maszyn w każdym zestawie dostępności.</span><span class="sxs-lookup"><span data-stu-id="cfd00-210">A minimum of two machines are recommended in each availability set.</span></span> <span data-ttu-id="cfd00-211">Na potrzeby podstawowego wdrożenia zostaną utworzone cztery maszyny wirtualne.</span><span class="sxs-lookup"><span data-stu-id="cfd00-211">Create four virtual machines for the basic deployment.</span></span>

| <span data-ttu-id="cfd00-212">Maszyna</span><span class="sxs-lookup"><span data-stu-id="cfd00-212">Machine</span></span> | <span data-ttu-id="cfd00-213">Rola</span><span class="sxs-lookup"><span data-stu-id="cfd00-213">Role</span></span> | <span data-ttu-id="cfd00-214">Podsieć</span><span class="sxs-lookup"><span data-stu-id="cfd00-214">Subnet</span></span> | <span data-ttu-id="cfd00-215">Zestaw dostępności</span><span class="sxs-lookup"><span data-stu-id="cfd00-215">Availability set</span></span> | <span data-ttu-id="cfd00-216">Konto magazynu</span><span class="sxs-lookup"><span data-stu-id="cfd00-216">Storage account</span></span> | <span data-ttu-id="cfd00-217">Adres IP</span><span class="sxs-lookup"><span data-stu-id="cfd00-217">IP Address</span></span> |
|:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="cfd00-218">contosodc1</span><span class="sxs-lookup"><span data-stu-id="cfd00-218">contosodc1</span></span> |<span data-ttu-id="cfd00-219">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="cfd00-219">DC/ADFS</span></span> |<span data-ttu-id="cfd00-220">INT</span><span class="sxs-lookup"><span data-stu-id="cfd00-220">INT</span></span> |<span data-ttu-id="cfd00-221">contosodcset</span><span class="sxs-lookup"><span data-stu-id="cfd00-221">contosodcset</span></span> |<span data-ttu-id="cfd00-222">contososac1</span><span class="sxs-lookup"><span data-stu-id="cfd00-222">contososac1</span></span> |<span data-ttu-id="cfd00-223">Statyczny</span><span class="sxs-lookup"><span data-stu-id="cfd00-223">Static</span></span> |
| <span data-ttu-id="cfd00-224">contosodc2</span><span class="sxs-lookup"><span data-stu-id="cfd00-224">contosodc2</span></span> |<span data-ttu-id="cfd00-225">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="cfd00-225">DC/ADFS</span></span> |<span data-ttu-id="cfd00-226">INT</span><span class="sxs-lookup"><span data-stu-id="cfd00-226">INT</span></span> |<span data-ttu-id="cfd00-227">contosodcset</span><span class="sxs-lookup"><span data-stu-id="cfd00-227">contosodcset</span></span> |<span data-ttu-id="cfd00-228">contososac2</span><span class="sxs-lookup"><span data-stu-id="cfd00-228">contososac2</span></span> |<span data-ttu-id="cfd00-229">Statyczny</span><span class="sxs-lookup"><span data-stu-id="cfd00-229">Static</span></span> |
| <span data-ttu-id="cfd00-230">contosowap1</span><span class="sxs-lookup"><span data-stu-id="cfd00-230">contosowap1</span></span> |<span data-ttu-id="cfd00-231">WAP</span><span class="sxs-lookup"><span data-stu-id="cfd00-231">WAP</span></span> |<span data-ttu-id="cfd00-232">DMZ</span><span class="sxs-lookup"><span data-stu-id="cfd00-232">DMZ</span></span> |<span data-ttu-id="cfd00-233">contosowapset</span><span class="sxs-lookup"><span data-stu-id="cfd00-233">contosowapset</span></span> |<span data-ttu-id="cfd00-234">contososac1</span><span class="sxs-lookup"><span data-stu-id="cfd00-234">contososac1</span></span> |<span data-ttu-id="cfd00-235">Statyczny</span><span class="sxs-lookup"><span data-stu-id="cfd00-235">Static</span></span> |
| <span data-ttu-id="cfd00-236">contosowap2</span><span class="sxs-lookup"><span data-stu-id="cfd00-236">contosowap2</span></span> |<span data-ttu-id="cfd00-237">WAP</span><span class="sxs-lookup"><span data-stu-id="cfd00-237">WAP</span></span> |<span data-ttu-id="cfd00-238">DMZ</span><span class="sxs-lookup"><span data-stu-id="cfd00-238">DMZ</span></span> |<span data-ttu-id="cfd00-239">contosowapset</span><span class="sxs-lookup"><span data-stu-id="cfd00-239">contosowapset</span></span> |<span data-ttu-id="cfd00-240">contososac2</span><span class="sxs-lookup"><span data-stu-id="cfd00-240">contososac2</span></span> |<span data-ttu-id="cfd00-241">Statyczny</span><span class="sxs-lookup"><span data-stu-id="cfd00-241">Static</span></span> |

<span data-ttu-id="cfd00-242">Warto zauważyć, że nie określono sieciowej grupy zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="cfd00-242">As you might have noticed, no NSG has been specified.</span></span> <span data-ttu-id="cfd00-243">Wynika to z możliwości użycia sieciowej grupy zabezpieczeń na poziomie podsieci.</span><span class="sxs-lookup"><span data-stu-id="cfd00-243">This is because azure lets you use NSG at the subnet level.</span></span> <span data-ttu-id="cfd00-244">Ruchem sieciowym maszyny możesz sterować przy użyciu określonej sieciowej grupy zabezpieczeń skojarzonej z podsiecią lub obiektem NIC.</span><span class="sxs-lookup"><span data-stu-id="cfd00-244">Then, you can control machine network traffic by using the individual NSG associated with either the subnet or else the NIC object.</span></span> <span data-ttu-id="cfd00-245">Więcej informacji można znaleźć w artykule [Co to jest grupa zabezpieczeń sieci](https://aka.ms/Azure/NSG)</span><span class="sxs-lookup"><span data-stu-id="cfd00-245">Read more on [What is a Network Security Group (NSG)](https://aka.ms/Azure/NSG).</span></span>
<span data-ttu-id="cfd00-246">Statyczny adres IP jest zalecany w przypadku samodzielnego zarządzania systemem DNS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-246">Static IP address is recommended if you are managing the DNS.</span></span> <span data-ttu-id="cfd00-247">Możesz również używać usługi Azure DNS. W takim przypadku w rekordach DNS dla domeny będziesz odwoływać się do nowych maszyn za pomocą nazw FQDN platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="cfd00-247">You can use Azure DNS and instead in the DNS records for your domain, refer to the new machines by their Azure FQDNs.</span></span>
<span data-ttu-id="cfd00-248">Po ukończeniu wdrażania okienko maszyn wirtualnych powinno wyglądać tak jak poniżej:</span><span class="sxs-lookup"><span data-stu-id="cfd00-248">Your virtual machine pane should look like below after the deployment is completed:</span></span>

![Wdrożone maszyny wirtualne](./media/active-directory-aadconnect-azure-adfs/virtualmachinesdeployed_noadfs.png)

### <a name="5-configuring-the-domain-controller--ad-fs-servers"></a><span data-ttu-id="cfd00-250">5. Konfigurowanie kontrolera domeny / serwerów usług AD FS</span><span class="sxs-lookup"><span data-stu-id="cfd00-250">5. Configuring the domain controller / AD FS servers</span></span>
 <span data-ttu-id="cfd00-251">W celu uwierzytelnienia dowolnego żądania przychodzącego wymagana jest komunikacja między usługami AD FS a kontrolerem domeny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-251">In order to authenticate any incoming request, AD FS will need to contact the domain controller.</span></span> <span data-ttu-id="cfd00-252">Aby uniknąć kosztów związanych z przesyłaniem danych w ramach uwierzytelniania między platformą Azure a lokalnym kontrolerem domeny, zaleca się wdrożenie repliki kontrolera domeny na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="cfd00-252">To save the costly trip from Azure to on-premises DC for authentication, it is recommended to deploy a replica of the domain controller in Azure.</span></span> <span data-ttu-id="cfd00-253">W celu osiągnięcia wysokiej dostępności zalecane jest utworzenie zestawu dostępności obejmującego co najmniej dwa kontrolery domeny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-253">In order to attain high availability, it is recommended to create an availability set of at-least 2 domain controllers.</span></span>

| <span data-ttu-id="cfd00-254">Kontroler domeny</span><span class="sxs-lookup"><span data-stu-id="cfd00-254">Domain controller</span></span> | <span data-ttu-id="cfd00-255">Rola</span><span class="sxs-lookup"><span data-stu-id="cfd00-255">Role</span></span> | <span data-ttu-id="cfd00-256">Konto magazynu</span><span class="sxs-lookup"><span data-stu-id="cfd00-256">Storage account</span></span> |
|:---:|:---:|:---:|
| <span data-ttu-id="cfd00-257">contosodc1</span><span class="sxs-lookup"><span data-stu-id="cfd00-257">contosodc1</span></span> |<span data-ttu-id="cfd00-258">Replika</span><span class="sxs-lookup"><span data-stu-id="cfd00-258">Replica</span></span> |<span data-ttu-id="cfd00-259">contososac1</span><span class="sxs-lookup"><span data-stu-id="cfd00-259">contososac1</span></span> |
| <span data-ttu-id="cfd00-260">contosodc2</span><span class="sxs-lookup"><span data-stu-id="cfd00-260">contosodc2</span></span> |<span data-ttu-id="cfd00-261">Replika</span><span class="sxs-lookup"><span data-stu-id="cfd00-261">Replica</span></span> |<span data-ttu-id="cfd00-262">contososac2</span><span class="sxs-lookup"><span data-stu-id="cfd00-262">contososac2</span></span> |

* <span data-ttu-id="cfd00-263">Podnieś poziom tych dwóch serwerów jako replika kontrolerów domeny w systemie DNS</span><span class="sxs-lookup"><span data-stu-id="cfd00-263">Promote the two servers as replica domain controllers with DNS</span></span>
* <span data-ttu-id="cfd00-264">Skonfiguruj serwery usług AD FS, instalując rolę usług AD FS za pomocą Menedżera serwera.</span><span class="sxs-lookup"><span data-stu-id="cfd00-264">Configure the AD FS servers by installing the AD FS role using the server manager.</span></span>

### <a name="6-deploying-internal-load-balancer-ilb"></a><span data-ttu-id="cfd00-265">6. Wdrażanie wewnętrznego modułu równoważenia obciążenia (ILB)</span><span class="sxs-lookup"><span data-stu-id="cfd00-265">6. Deploying Internal Load Balancer (ILB)</span></span>
<span data-ttu-id="cfd00-266">**6.1. Tworzenie wewnętrznego modułu równoważenia obciążenia**</span><span class="sxs-lookup"><span data-stu-id="cfd00-266">**6.1. Create the ILB**</span></span>

<span data-ttu-id="cfd00-267">Aby wdrożyć wewnętrzny moduł równoważenia obciążenia, wybierz pozycję Moduły równoważenia obciążenia w witrynie Azure Portal i kliknij pozycję (+).</span><span class="sxs-lookup"><span data-stu-id="cfd00-267">To deploy an ILB, select Load Balancers in the Azure portal and click on add (+).</span></span>

> [!NOTE]
> <span data-ttu-id="cfd00-268">Jeśli nie widzisz polecenia **Moduły równoważenia obciążenia** w menu, kliknij pozycję **Przeglądaj** w lewym dolnym rogu portalu i przewijaj listę, aż zobaczysz polecenie **Moduły równoważenia obciążenia**.</span><span class="sxs-lookup"><span data-stu-id="cfd00-268">if you do not see **Load Balancers** in your menu, click **Browse** in the lower left of the portal and scroll until you see **Load Balancers**.</span></span>  <span data-ttu-id="cfd00-269">Następnie kliknij żółtą gwiazdkę, aby dodać to polecenie do menu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-269">Then click the yellow star to add it to your menu.</span></span> <span data-ttu-id="cfd00-270">Wybierz ikonę nowego modułu równoważenia obciążenia, aby otworzyć panel umożliwiający skonfigurowanie tego modułu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-270">Now select the new load balancer icon to open the panel to begin configuration of the load balancer.</span></span>
> 
> 

![Przeglądanie modułu równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/browseloadbalancer.png)

* <span data-ttu-id="cfd00-272">**Nazwa**: wpisz odpowiednią nazwę modułu równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="cfd00-272">**Name**: Give any suitable name to the load balancer</span></span>
* <span data-ttu-id="cfd00-273">**Schemat**: ponieważ ten moduł zostanie umieszczony przed serwerami usług AD FS i jest przeznaczony TYLKO na potrzeby połączeń sieci wewnętrznej, wybierz pozycję „Wewnętrzny”</span><span class="sxs-lookup"><span data-stu-id="cfd00-273">**Scheme**: Since this load balancer will be placed in front of the AD FS servers and is meant for internal network connections ONLY, select “Internal”</span></span>
* <span data-ttu-id="cfd00-274">**Sieć wirtualna**: wybierz sieć wirtualną, w której wdrażasz usługi AD FS</span><span class="sxs-lookup"><span data-stu-id="cfd00-274">**Virtual Network**: Choose the virtual network where you are deploying your AD FS</span></span>
* <span data-ttu-id="cfd00-275">**Podsieć**: wybierz wewnętrzną podsieć</span><span class="sxs-lookup"><span data-stu-id="cfd00-275">**Subnet**: Choose the internal subnet here</span></span>
* <span data-ttu-id="cfd00-276">**Przypisanie adresu IP**: Statyczne</span><span class="sxs-lookup"><span data-stu-id="cfd00-276">**IP Address assignment**: Static</span></span>

![Wewnętrzny moduł równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/ilbdeployment1.png)

<span data-ttu-id="cfd00-278">Po kliknięciu pozycji Utwórz i wdrożeniu wewnętrznego modułu równoważenia obciążenia powinien on pojawić się na liście modułów równoważenia obciążenia:</span><span class="sxs-lookup"><span data-stu-id="cfd00-278">After you click create and the ILB is deployed, you should see it in the list of load balancers:</span></span>

![Moduły równoważenia obciążenia po skonfigurowaniu wewnętrznego modułu równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/ilbdeployment2.png)

<span data-ttu-id="cfd00-280">Następnym krokiem jest skonfigurowanie puli zaplecza i sondy zaplecza.</span><span class="sxs-lookup"><span data-stu-id="cfd00-280">Next step is to configure the backend pool and the backend probe.</span></span>

<span data-ttu-id="cfd00-281">**6.2. Konfigurowanie puli zaplecza wewnętrznego modułu równoważenia obciążenia**</span><span class="sxs-lookup"><span data-stu-id="cfd00-281">**6.2. Configure ILB backend pool**</span></span>

<span data-ttu-id="cfd00-282">Wybierz nowo utworzony wewnętrzny moduł równoważenia obciążenia na panelu Moduły równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-282">Select the newly created ILB in the Load Balancers panel.</span></span> <span data-ttu-id="cfd00-283">Zostanie otwarty panel ustawień.</span><span class="sxs-lookup"><span data-stu-id="cfd00-283">It will open the settings panel.</span></span> 

1. <span data-ttu-id="cfd00-284">Wybierz pule zaplecza na panelu ustawień</span><span class="sxs-lookup"><span data-stu-id="cfd00-284">Select backend pools from the settings panel</span></span>
2. <span data-ttu-id="cfd00-285">Na panelu dodawania puli zaplecza kliknij pozycję Dodaj maszynę wirtualną</span><span class="sxs-lookup"><span data-stu-id="cfd00-285">In the add backend pool panel, click on add virtual machine</span></span>
3. <span data-ttu-id="cfd00-286">Zostanie wyświetlony panel umożliwiający wybranie zestawu dostępności</span><span class="sxs-lookup"><span data-stu-id="cfd00-286">You will be presented with a panel where you can choose availability set</span></span>
4. <span data-ttu-id="cfd00-287">Wybierz zestaw dostępności usług AD FS</span><span class="sxs-lookup"><span data-stu-id="cfd00-287">Choose the AD FS availability set</span></span>

![Konfigurowanie puli zaplecza wewnętrznego modułu równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/ilbdeployment3.png)

<span data-ttu-id="cfd00-289">**6.3. Konfigurowanie sondy**</span><span class="sxs-lookup"><span data-stu-id="cfd00-289">**6.3. Configuring probe**</span></span>

<span data-ttu-id="cfd00-290">W panelu ustawień wewnętrznego modułu równoważenia obciążenia wybierz pozycję Sondy.</span><span class="sxs-lookup"><span data-stu-id="cfd00-290">In the ILB settings panel, select Probes.</span></span>

1. <span data-ttu-id="cfd00-291">Kliknij pozycję Dodaj.</span><span class="sxs-lookup"><span data-stu-id="cfd00-291">Click on add</span></span>
2. <span data-ttu-id="cfd00-292">Podaj szczegóły sondy a.</span><span class="sxs-lookup"><span data-stu-id="cfd00-292">Provide details for probe a.</span></span> <span data-ttu-id="cfd00-293">**Nazwa**: nazwa sondy b.</span><span class="sxs-lookup"><span data-stu-id="cfd00-293">**Name**: Probe name b.</span></span> <span data-ttu-id="cfd00-294">**Protokół**: TCP c.</span><span class="sxs-lookup"><span data-stu-id="cfd00-294">**Protocol**: TCP c.</span></span> <span data-ttu-id="cfd00-295">**Port**: 443 (HTTPS) d.</span><span class="sxs-lookup"><span data-stu-id="cfd00-295">**Port**: 443 (HTTPS) d.</span></span> <span data-ttu-id="cfd00-296">**Interwał**: 5 (wartość domyślna) — odstęp czasu, z jakim wewnętrzny moduł równoważenia obciążenia będzie sondował maszyny w puli zaplecza e.</span><span class="sxs-lookup"><span data-stu-id="cfd00-296">**Interval**: 5 (default value) – this is the interval at which ILB will probe the machines in the backend pool e.</span></span> <span data-ttu-id="cfd00-297">**Limit progu złej kondycji**: 2 (wartość domyślna) — wartość progowa liczby kolejnych niepowodzeń sondowania, po których wewnętrzny moduł równoważenia obciążenia uzna, że maszyna w puli zaplecza nie odpowiada i zaprzestanie wysyłania ruchu do tej maszyny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-297">**Unhealthy threshold limit**: 2 (default val ue) – this is the threshold of consecutive probe failures after which ILB will declare a machine in the backend pool non-responsive and stop sending traffic to it.</span></span>

![Konfigurowanie sondy wewnętrznego modułu równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/ilbdeployment4.png)

<span data-ttu-id="cfd00-299">**6.4. Tworzenie reguł równoważenia obciążenia**</span><span class="sxs-lookup"><span data-stu-id="cfd00-299">**6.4. Create load balancing rules**</span></span>

<span data-ttu-id="cfd00-300">Reguły równoważenia obciążenia pozwalają modułowi skutecznie równoważyć ruch sieciowy.</span><span class="sxs-lookup"><span data-stu-id="cfd00-300">In order to effectively balance the traffic, the ILB should be configured with load balancing rules.</span></span> <span data-ttu-id="cfd00-301">W celu utworzenia reguły równoważenia obciążenia wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="cfd00-301">In order to create a load balancing rule,</span></span> 

1. <span data-ttu-id="cfd00-302">Wybierz pozycję Reguły równoważenia obciążenia na panelu ustawień wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-302">Select Load balancing rule from the settings panel of the ILB</span></span>
2. <span data-ttu-id="cfd00-303">Kliknij pozycję Dodaj na panelu Reguły równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-303">Click on Add in the Load balancing rule panel</span></span>
3. <span data-ttu-id="cfd00-304">Na panelu Dodawanie reguły równoważenia obciążenia wykonaj następujące czynności: a.</span><span class="sxs-lookup"><span data-stu-id="cfd00-304">In the Add load balancing rule panel a.</span></span> <span data-ttu-id="cfd00-305">**Nazwa**: podaj nazwę reguły b.</span><span class="sxs-lookup"><span data-stu-id="cfd00-305">**Name**: Provide a name for the rule b.</span></span> <span data-ttu-id="cfd00-306">**Protokół**: wybierz opcję TCP c.</span><span class="sxs-lookup"><span data-stu-id="cfd00-306">**Protocol**: Select TCP c.</span></span> <span data-ttu-id="cfd00-307">**Port**: 443 d.</span><span class="sxs-lookup"><span data-stu-id="cfd00-307">**Port**: 443 d.</span></span> <span data-ttu-id="cfd00-308">**Port zaplecza**: 443 e.</span><span class="sxs-lookup"><span data-stu-id="cfd00-308">**Backend port**: 443 e.</span></span> <span data-ttu-id="cfd00-309">**Pula zaplecza**: wybierz pulę utworzoną wcześniej dla klastra usług AD FS f.</span><span class="sxs-lookup"><span data-stu-id="cfd00-309">**Backend pool**: Select the pool you created for the AD FS cluster earlier f.</span></span> <span data-ttu-id="cfd00-310">**Sonda**: wybierz sondę utworzoną wcześniej dla serwerów usług AD FS</span><span class="sxs-lookup"><span data-stu-id="cfd00-310">**Probe**: Select the probe created for AD FS servers earlier</span></span>

![Konfigurowanie reguł wewnętrznego modułu równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/ilbdeployment5.png)

<span data-ttu-id="cfd00-312">**6.5. Aktualizowanie systemu DNS o dane wewnętrznego modułu równoważenia obciążenia**</span><span class="sxs-lookup"><span data-stu-id="cfd00-312">**6.5. Update DNS with ILB**</span></span>

<span data-ttu-id="cfd00-313">Przejdź do serwera DNS i utwórz rekord CNAME dla wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-313">Go to your DNS server and create a CNAME for the ILB.</span></span> <span data-ttu-id="cfd00-314">Rekord CNAME jest przeznaczony dla usługi federacyjnej. Adres IP powinien wskazywać adres IP wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-314">The CNAME should be for the federation service with the IP address pointing to the IP address of the ILB.</span></span> <span data-ttu-id="cfd00-315">Na przykład jeśli docelowy adres IP modułu to 10.3.0.8, a zainstalowana usługa federacyjna jest dostępna pod adresem fs.contoso.com, należy utworzyć rekord CNAME dla adresu fs.contoso.com wskazujący na adres 10.3.0.8.</span><span class="sxs-lookup"><span data-stu-id="cfd00-315">For example if the ILB DIP address is 10.3.0.8, and the federation service installed is fs.contoso.com, then create a CNAME for fs.contoso.com pointing to 10.3.0.8.</span></span>
<span data-ttu-id="cfd00-316">Dzięki temu cała komunikacja dla adresu fs.contoso.com będzie odpowiednio kierowana i przekazywana do wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-316">This will ensure that all communication regarding fs.contoso.com end up at the ILB and are appropriately routed.</span></span>

### <a name="7-configuring-the-web-application-proxy-server"></a><span data-ttu-id="cfd00-317">7. Konfigurowanie serwera proxy aplikacji sieci Web</span><span class="sxs-lookup"><span data-stu-id="cfd00-317">7. Configuring the Web Application Proxy server</span></span>
<span data-ttu-id="cfd00-318">**7.1. Konfigurowanie połączenia między serwerami proxy aplikacji sieci Web i serwerami usług AD FS**</span><span class="sxs-lookup"><span data-stu-id="cfd00-318">**7.1. Configuring the Web Application Proxy servers to reach AD FS servers**</span></span>

<span data-ttu-id="cfd00-319">Aby zapewnić komunikację między serwerami proxy aplikacji sieci Web a serwerami usług AD FS znajdującymi się za wewnętrznym modułem równoważenia obciążenia, w katalogu %systemroot%\system32\drivers\etc\hosts utwórz rekord dla wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-319">In order to ensure that Web Application Proxy servers are able to reach the AD FS servers behind the ILB, create a record in the %systemroot%\system32\drivers\etc\hosts for the ILB.</span></span> <span data-ttu-id="cfd00-320">Pamiętaj o tym, że nazwa wyróżniająca (DN) powinna być nazwą usługi federacyjnej, na przykład fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="cfd00-320">Note that the distinguished name (DN) should be the federation service name, for example fs.contoso.com.</span></span> <span data-ttu-id="cfd00-321">Ponadto wpis adresu IP powinien odpowiadać adresowi IP wewnętrznego modułu równoważenia obciążenia (w tym przykładzie: 10.3.0.8).</span><span class="sxs-lookup"><span data-stu-id="cfd00-321">And the IP entry should be that of the ILB’s IP address (10.3.0.8 as in the example).</span></span>

<span data-ttu-id="cfd00-322">**7.2. Instalowanie roli serwera proxy aplikacji sieci Web**</span><span class="sxs-lookup"><span data-stu-id="cfd00-322">**7.2. Installing the Web Application Proxy role**</span></span>

<span data-ttu-id="cfd00-323">Gdy serwery proxy aplikacji sieci Web mają zapewniony dostęp do serwerów usług AD FS znajdujących się za wewnętrznym modułem równoważenia obciążenia, można zainstalować serwery proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-323">After you ensure that Web Application Proxy servers are able to reach the AD FS servers behind ILB, you can next install the Web Application Proxy servers.</span></span> <span data-ttu-id="cfd00-324">Serwery proxy aplikacji sieci Web nie są przyłączane do domeny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-324">Web Application Proxy servers do not be joined to the domain.</span></span> <span data-ttu-id="cfd00-325">Zainstaluj role serwera proxy aplikacji sieci Web na dwóch serwerach proxy aplikacji sieci Web, wybierając rolę dostępu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="cfd00-325">Install the Web Application Proxy roles on the two Web Application Proxy servers by selecting the Remote Access role.</span></span> <span data-ttu-id="cfd00-326">Menedżer serwera poprowadzi Cię przez proces instalacji serwera proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-326">The server manager will guide you to complete the WAP installation.</span></span>
<span data-ttu-id="cfd00-327">Aby uzyskać więcej informacji na temat wdrażania serwera proxy aplikacji sieci Web, zapoznaj się z artykułem [Instalowanie i konfigurowanie usługi Serwer proxy aplikacji sieci Web](https://technet.microsoft.com/library/dn383662.aspx).</span><span class="sxs-lookup"><span data-stu-id="cfd00-327">For more information on how to deploy WAP, read [Install and Configure the Web Application Proxy Server](https://technet.microsoft.com/library/dn383662.aspx).</span></span>

### <a name="8--deploying-the-internet-facing-public-load-balancer"></a><span data-ttu-id="cfd00-328">8.  Wdrażanie modułu równoważenia obciążenia połączonego z Internetem (publicznego)</span><span class="sxs-lookup"><span data-stu-id="cfd00-328">8.  Deploying the Internet Facing (Public) Load Balancer</span></span>
<span data-ttu-id="cfd00-329">**8.1.  Tworzenie modułu równoważenia obciążenia połączonego z Internetem (publicznego)**</span><span class="sxs-lookup"><span data-stu-id="cfd00-329">**8.1.  Create Internet Facing (Public) Load Balancer**</span></span>

<span data-ttu-id="cfd00-330">W witrynie Azure Portal wybierz pozycję Moduły równoważenia obciążenia, a następnie kliknij pozycję Dodaj.</span><span class="sxs-lookup"><span data-stu-id="cfd00-330">In the Azure portal, select Load balancers and then click on Add.</span></span> <span data-ttu-id="cfd00-331">Na panelu Tworzenie modułu równoważenia obciążenia wprowadź następujące informacje.</span><span class="sxs-lookup"><span data-stu-id="cfd00-331">In the Create load balancer panel, enter the following information</span></span>

1. <span data-ttu-id="cfd00-332">**Nazwa**: nazwa modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-332">**Name**: Name for the load balancer</span></span>
2. <span data-ttu-id="cfd00-333">**Schemat**: opcja Publiczny informuje platformę Azure, że ten moduł równoważenia obciążenia musi mieć adres publiczny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-333">**Scheme**: Public – this option tells Azure that this load balancer will need a public address.</span></span>
3. <span data-ttu-id="cfd00-334">**Adres IP**: utwórz nowy adres IP (dynamiczny).</span><span class="sxs-lookup"><span data-stu-id="cfd00-334">**IP Address**: Create a new IP address (dynamic)</span></span>

![Moduł równoważenia obciążenia połączony z Internetem](./media/active-directory-aadconnect-azure-adfs/elbdeployment1.png)

<span data-ttu-id="cfd00-336">Wdrożony moduł pojawi się na liście modułów równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-336">After deployment, the load balancer will appear in the Load balancers list.</span></span>

![Lista modułów równoważenia obciążenia](./media/active-directory-aadconnect-azure-adfs/elbdeployment2.png)

<span data-ttu-id="cfd00-338">**8.2. Przypisywanie etykiety DNS do publicznego adresu IP**</span><span class="sxs-lookup"><span data-stu-id="cfd00-338">**8.2. Assign a DNS label to the public IP**</span></span>

<span data-ttu-id="cfd00-339">Kliknij nowo utworzony moduł w panelu modułów równoważenia obciążenia, aby wyświetlić panel konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="cfd00-339">Click on the newly created load balancer entry in the Load balancers panel to bring up the panel for configuration.</span></span> <span data-ttu-id="cfd00-340">Wykonaj poniższe kroki, aby skonfigurować etykietę DNS dla publicznego adresu IP:</span><span class="sxs-lookup"><span data-stu-id="cfd00-340">Follow below steps to configure the DNS label for the public IP:</span></span>

1. <span data-ttu-id="cfd00-341">Kliknij publiczny adres IP.</span><span class="sxs-lookup"><span data-stu-id="cfd00-341">Click on the public IP address.</span></span> <span data-ttu-id="cfd00-342">Zostanie otwarty panel umożliwiający zmianę ustawień publicznego adresu IP.</span><span class="sxs-lookup"><span data-stu-id="cfd00-342">This will open the panel for the public IP and its settings</span></span>
2. <span data-ttu-id="cfd00-343">Kliknij pozycję Konfiguracja.</span><span class="sxs-lookup"><span data-stu-id="cfd00-343">Click on Configuration</span></span>
3. <span data-ttu-id="cfd00-344">Podaj etykietę DNS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-344">Provide a DNS label.</span></span> <span data-ttu-id="cfd00-345">Ta publiczna etykieta DNS zapewnia dostęp z dowolnego miejsca, na przykład contosofs.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="cfd00-345">This will become the public DNS label that you can access from anywhere, for example contosofs.westus.cloudapp.azure.com.</span></span> <span data-ttu-id="cfd00-346">Na zewnętrznym serwerze DNS usługi federacyjnej (na przykład fs.contoso.com) możesz dodać wpis, który umożliwia rozpoznanie etykiety DNS zewnętrznego modułu równoważenia obciążenia (contosofs.westus.cloudapp.azure.com).</span><span class="sxs-lookup"><span data-stu-id="cfd00-346">You can add an entry in the external DNS for the federation service (like fs.contoso.com) that resolves to the DNS label of the external load balancer (contosofs.westus.cloudapp.azure.com).</span></span>

![Konfigurowanie modułu równoważenia obciążenia połączonego z Internetem](./media/active-directory-aadconnect-azure-adfs/elbdeployment3.png) 

![Konfigurowanie modułu równoważenia obciążenia połączonego z Internetem (DNS)](./media/active-directory-aadconnect-azure-adfs/elbdeployment4.png)

<span data-ttu-id="cfd00-349">**8.3. Konfigurowanie puli zaplecza dla modułu równoważenia obciążenia połączonego z** Internetem (publicznego)</span><span class="sxs-lookup"><span data-stu-id="cfd00-349">**8.3. Configure backend pool for Internet Facing (Public) Load Balancer**</span></span> 

<span data-ttu-id="cfd00-350">Konfigurowanie puli zaplecza dla modułu równoważenia obciążenia połączonego z Internetem (publicznego) jako zestawu dostępności (np. contosowapset) dla serwerów proxy aplikacji sieci Web obejmuje te same czynności co tworzenie wewnętrznego modułu równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="cfd00-350">Follow the same steps as in creating the internal load balancer, to configure the backend pool for Internet Facing (Public) Load Balancer as the availability set for the WAP servers.</span></span> <span data-ttu-id="cfd00-351">.</span><span class="sxs-lookup"><span data-stu-id="cfd00-351">For example, contosowapset.</span></span>

![Konfigurowanie puli zaplecza modułu równoważenia obciążenia połączonego z Internetem](./media/active-directory-aadconnect-azure-adfs/elbdeployment5.png)

<span data-ttu-id="cfd00-353">**8.4. Konfigurowanie sondy**</span><span class="sxs-lookup"><span data-stu-id="cfd00-353">**8.4. Configure probe**</span></span>

<span data-ttu-id="cfd00-354">Konfigurowanie sondy dla puli zaplecza serwerów proxy aplikacji sieci Web obejmuje te same czynności co konfigurowanie wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-354">Follow the same steps as in configuring the internal load balancer  to configure the probe for the backend pool of WAP servers.</span></span>

![Konfigurowanie sondy modułu równoważenia obciążenia połączonego z Internetem](./media/active-directory-aadconnect-azure-adfs/elbdeployment6.png)

<span data-ttu-id="cfd00-356">**8.5. Tworzenie reguł równoważenia obciążenia**</span><span class="sxs-lookup"><span data-stu-id="cfd00-356">**8.5. Create load balancing rule(s)**</span></span>

<span data-ttu-id="cfd00-357">Aby skonfigurować regułę równoważenia obciążenia dla portu TCP 443, wykonaj te same czynności co w przypadku konfigurowania reguły dla wewnętrznego modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="cfd00-357">Follow the same steps as in ILB to configure the load balancing rule for TCP 443.</span></span>

![Konfigurowanie reguł modułu równoważenia obciążenia połączonego z Internetem](./media/active-directory-aadconnect-azure-adfs/elbdeployment7.png)

### <a name="9-securing-the-network"></a><span data-ttu-id="cfd00-359">9. Zabezpieczanie sieci</span><span class="sxs-lookup"><span data-stu-id="cfd00-359">9. Securing the network</span></span>
<span data-ttu-id="cfd00-360">**9.1. Zabezpieczanie wewnętrznej podsieci**</span><span class="sxs-lookup"><span data-stu-id="cfd00-360">**9.1. Securing the internal subnet**</span></span>

<span data-ttu-id="cfd00-361">Wdrożenie poniższych reguł (w przedstawionej kolejności) stanowi podstawę skutecznego zabezpieczenia wewnętrznej podsieci.</span><span class="sxs-lookup"><span data-stu-id="cfd00-361">Overall, you need the following rules to efficiently secure your internal subnet (in the order as listed below)</span></span>

| <span data-ttu-id="cfd00-362">Reguła</span><span class="sxs-lookup"><span data-stu-id="cfd00-362">Rule</span></span> | <span data-ttu-id="cfd00-363">Opis</span><span class="sxs-lookup"><span data-stu-id="cfd00-363">Description</span></span> | <span data-ttu-id="cfd00-364">Ruch</span><span class="sxs-lookup"><span data-stu-id="cfd00-364">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="cfd00-365">AllowHTTPSFromDMZ</span><span class="sxs-lookup"><span data-stu-id="cfd00-365">AllowHTTPSFromDMZ</span></span> |<span data-ttu-id="cfd00-366">Zezwala na połączenia HTTPS nawiązywane z podsieci DMZ</span><span class="sxs-lookup"><span data-stu-id="cfd00-366">Allow the HTTPS communication from DMZ</span></span> |<span data-ttu-id="cfd00-367">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="cfd00-367">Inbound</span></span> |
| <span data-ttu-id="cfd00-368">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="cfd00-368">DenyInternetOutbound</span></span> |<span data-ttu-id="cfd00-369">Zablokowany dostęp do Internetu</span><span class="sxs-lookup"><span data-stu-id="cfd00-369">No access to internet</span></span> |<span data-ttu-id="cfd00-370">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="cfd00-370">Outbound</span></span> |

![Reguły dostępu WEWN. (ruch przychodzący)](./media/active-directory-aadconnect-azure-adfs/nsg_int.png)

<span data-ttu-id="cfd00-372">[komentarz]: <> (![reguły dostępu WEWN. (ruch przychodzący)](./media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [komentarz]: <> (![reguły dostępu WEWN. (ruch wychodzący)](./media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))</span><span class="sxs-lookup"><span data-stu-id="cfd00-372">[comment]: <> (![INT access rules (inbound)](./media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [comment]: <> (![INT access rules (outbound)](./media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))</span></span>

<span data-ttu-id="cfd00-373">**9.2. Zabezpieczanie podsieci DMZ**</span><span class="sxs-lookup"><span data-stu-id="cfd00-373">**9.2. Securing the DMZ subnet**</span></span>

| <span data-ttu-id="cfd00-374">Reguła</span><span class="sxs-lookup"><span data-stu-id="cfd00-374">Rule</span></span> | <span data-ttu-id="cfd00-375">Opis</span><span class="sxs-lookup"><span data-stu-id="cfd00-375">Description</span></span> | <span data-ttu-id="cfd00-376">Ruch</span><span class="sxs-lookup"><span data-stu-id="cfd00-376">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="cfd00-377">AllowHTTPSFromInternet</span><span class="sxs-lookup"><span data-stu-id="cfd00-377">AllowHTTPSFromInternet</span></span> |<span data-ttu-id="cfd00-378">Zezwala na połączenia HTTPS z podsiecią DMZ nawiązywane z Internetu</span><span class="sxs-lookup"><span data-stu-id="cfd00-378">Allow HTTPS from internet to the DMZ</span></span> |<span data-ttu-id="cfd00-379">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="cfd00-379">Inbound</span></span> |
| <span data-ttu-id="cfd00-380">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="cfd00-380">DenyInternetOutbound</span></span> |<span data-ttu-id="cfd00-381">Blokuje wszystkie połączenia oprócz połączeń wychodzących HTTPS z Internetem</span><span class="sxs-lookup"><span data-stu-id="cfd00-381">Anything except HTTPS to internet is blocked</span></span> |<span data-ttu-id="cfd00-382">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="cfd00-382">Outbound</span></span> |

![Reguły dostępu ZEWN. (ruch przychodzący)](./media/active-directory-aadconnect-azure-adfs/nsg_dmz.png)

<span data-ttu-id="cfd00-384">[komentarz]: <> (![reguły dostępu ZEWN. (ruch przychodzący)](./media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [komentarz]: <> (![reguły dostępu ZEWN. (ruch wychodzący)](./media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))</span><span class="sxs-lookup"><span data-stu-id="cfd00-384">[comment]: <> (![EXT access rules (inbound)](./media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [comment]: <> (![EXT access rules (outbound)](./media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))</span></span>

> [!NOTE]
> <span data-ttu-id="cfd00-385">Jeśli jest wymagane uwierzytelnianie certyfikatu klienta użytkownika (uwierzytelnianie usługi ClientTLS przy użyciu certyfikatów użytkownika X509), port TCP 49443 musi być włączony dla połączeń przychodzących z usługami AD FS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-385">If client user certificate authentication (clientTLS authentication using X509 user certificates) is required, then AD FS requires TCP port 49443 be enabled for inbound access.</span></span>
> 
> 

### <a name="10-test-the-ad-fs-sign-in"></a><span data-ttu-id="cfd00-386">10. Testowanie logowania za pomocą usług AD FS</span><span class="sxs-lookup"><span data-stu-id="cfd00-386">10. Test the AD FS sign-in</span></span>
<span data-ttu-id="cfd00-387">Najprostszym sposobem przetestowania działania usług AD FS jest użycie strony IdpInitiatedSignon.aspx.</span><span class="sxs-lookup"><span data-stu-id="cfd00-387">The easiest way is to test AD FS is by using the IdpInitiatedSignon.aspx page.</span></span> <span data-ttu-id="cfd00-388">Przede wszystkim trzeba ją włączyć we właściwościach usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-388">In order to be able to do that, it is required to enable the IdpInitiatedSignOn on the AD FS properties.</span></span> <span data-ttu-id="cfd00-389">Wykonaj poniższe kroki, aby zweryfikować konfigurację usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-389">Follow the steps below to verify your AD FS setup</span></span>

1. <span data-ttu-id="cfd00-390">Aby włączyć tę stronę, uruchom poniższe polecenie cmdlet na serwerze usług AD FS przy użyciu programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cfd00-390">Run the below cmdlet on the AD FS server, using PowerShell, to set it to enabled.</span></span>
   <span data-ttu-id="cfd00-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span><span class="sxs-lookup"><span data-stu-id="cfd00-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span></span> 
2. <span data-ttu-id="cfd00-392">Przy użyciu dowolnej maszyny zewnętrznej otwórz stronę https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span><span class="sxs-lookup"><span data-stu-id="cfd00-392">From any external machine access https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span></span>  
3. <span data-ttu-id="cfd00-393">Powinna pojawić się poniższa strona usług AD FS:</span><span class="sxs-lookup"><span data-stu-id="cfd00-393">You should see the AD FS page like below:</span></span>

![Testowa strona logowania](./media/active-directory-aadconnect-azure-adfs/test1.png)

<span data-ttu-id="cfd00-395">Po pomyślnym zalogowaniu zostanie wyświetlony poniższy komunikat:</span><span class="sxs-lookup"><span data-stu-id="cfd00-395">On successful sign-in, it will provide you with a success message as shown below:</span></span>

![Test zakończony powodzeniem](./media/active-directory-aadconnect-azure-adfs/test2.png)

## <a name="template-for-deploying-ad-fs-in-azure"></a><span data-ttu-id="cfd00-397">Szablon na potrzeby wdrażania usług AD FS na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="cfd00-397">Template for deploying AD FS in Azure</span></span>
<span data-ttu-id="cfd00-398">Szablon wdraża konfigurację 6 maszyn, po 2 dla kontrolerów domeny, usług AD FS i serwerów proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-398">The template deploys a 6 machine setup, 2 each for Domain Controllers, AD FS and WAP.</span></span>

[<span data-ttu-id="cfd00-399">Usługi AD FS w szablonie wdrażania platformy Azure</span><span class="sxs-lookup"><span data-stu-id="cfd00-399">AD FS in Azure Deployment Template</span></span>](https://github.com/paulomarquesc/adfs-6vms-regular-template-based)

<span data-ttu-id="cfd00-400">Podczas wdrażania tego szablonu możesz użyć istniejącej sieci wirtualnej lub utworzyć nową.</span><span class="sxs-lookup"><span data-stu-id="cfd00-400">You can use an existing virtual network or create a new VNET while deploying this template.</span></span> <span data-ttu-id="cfd00-401">Poniżej wymieniono różnorodne parametry umożliwiające dostosowanie wdrożenia wraz z opisem użycia danego parametru w procesie wdrażania.</span><span class="sxs-lookup"><span data-stu-id="cfd00-401">The various parameters available for customizing the deployment are listed below with the description of usage of the parameter in the deployment process.</span></span> 

| <span data-ttu-id="cfd00-402">Parametr</span><span class="sxs-lookup"><span data-stu-id="cfd00-402">Parameter</span></span> | <span data-ttu-id="cfd00-403">Opis</span><span class="sxs-lookup"><span data-stu-id="cfd00-403">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="cfd00-404">Lokalizacja</span><span class="sxs-lookup"><span data-stu-id="cfd00-404">Location</span></span> |<span data-ttu-id="cfd00-405">Region, w którym można wdrożyć zasoby, na przykład Wschodnie stany USA.</span><span class="sxs-lookup"><span data-stu-id="cfd00-405">The region to deploy the resources into, e.g. East US.</span></span> |
| <span data-ttu-id="cfd00-406">StorageAccountType</span><span class="sxs-lookup"><span data-stu-id="cfd00-406">StorageAccountType</span></span> |<span data-ttu-id="cfd00-407">Typ tworzonego konta magazynu.</span><span class="sxs-lookup"><span data-stu-id="cfd00-407">The type of the Storage Account created</span></span> |
| <span data-ttu-id="cfd00-408">VirtualNetworkUsage</span><span class="sxs-lookup"><span data-stu-id="cfd00-408">VirtualNetworkUsage</span></span> |<span data-ttu-id="cfd00-409">Wskazuje, czy zostanie utworzona nowa sieć wirtualna, czy użyta istniejąca.</span><span class="sxs-lookup"><span data-stu-id="cfd00-409">Indicates if a new virtual network will be created or use an existing one</span></span> |
| <span data-ttu-id="cfd00-410">VirtualNetworkName</span><span class="sxs-lookup"><span data-stu-id="cfd00-410">VirtualNetworkName</span></span> |<span data-ttu-id="cfd00-411">Nazwa sieci wirtualnej do utworzenia. Parametr obowiązkowy w przypadku użycia zarówno nowej, jak i istniejącej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-411">The name of the Virtual Network to Create, mandatory on both existing or new virtual network usage</span></span> |
| <span data-ttu-id="cfd00-412">VirtualNetworkResourceGroupName</span><span class="sxs-lookup"><span data-stu-id="cfd00-412">VirtualNetworkResourceGroupName</span></span> |<span data-ttu-id="cfd00-413">Określa nazwę grupy zasobów, w której znajduje się istniejąca sieć wirtualna.</span><span class="sxs-lookup"><span data-stu-id="cfd00-413">Specifies the name of the resource group where the existing virtual network resides.</span></span> <span data-ttu-id="cfd00-414">Jeśli jest używana istniejąca sieć wirtualna, ten parametr jest obowiązkowy, aby wdrożenie mogło znaleźć identyfikator odpowiedniej istniejącej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-414">When using an existing virtual network, this becomes a mandatory parameter so the deployment can find the ID of the existing virtual network</span></span> |
| <span data-ttu-id="cfd00-415">VirtualNetworkAddressRange</span><span class="sxs-lookup"><span data-stu-id="cfd00-415">VirtualNetworkAddressRange</span></span> |<span data-ttu-id="cfd00-416">Zakres adresów nowej sieci wirtualnej. Parametr obowiązkowy w przypadku tworzenia nowej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-416">The address range of the new VNET, mandatory if creating a new virtual network</span></span> |
| <span data-ttu-id="cfd00-417">InternalSubnetName</span><span class="sxs-lookup"><span data-stu-id="cfd00-417">InternalSubnetName</span></span> |<span data-ttu-id="cfd00-418">Nazwa podsieci wewnętrznej. Parametr obowiązkowy dla obydwu opcji użycia sieci wirtualnej (nowa lub istniejąca).</span><span class="sxs-lookup"><span data-stu-id="cfd00-418">The name of the internal subnet, mandatory on both virtual network usage options (new or existing)</span></span> |
| <span data-ttu-id="cfd00-419">InternalSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="cfd00-419">InternalSubnetAddressRange</span></span> |<span data-ttu-id="cfd00-420">Zakres adresów podsieci wewnętrznej, która zawiera kontrolery domeny i serwery usługi AD FS. Parametr obowiązkowy w przypadku tworzenia nowej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-420">The address range of the internal subnet, which contains the Domain Controllers and ADFS servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="cfd00-421">DMZSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="cfd00-421">DMZSubnetAddressRange</span></span> |<span data-ttu-id="cfd00-422">Zakres adresów podsieci DMZ, która zawiera serwery proxy aplikacji systemu Windows. Parametr obowiązkowy w przypadku tworzenia nowej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-422">The address range of the dmz subnet, which contains the Windows application proxy servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="cfd00-423">DMZSubnetName</span><span class="sxs-lookup"><span data-stu-id="cfd00-423">DMZSubnetName</span></span> |<span data-ttu-id="cfd00-424">Nazwa wewnętrznej podsieci. Parametr obowiązkowy dla obydwu opcji użycia sieci wirtualnej (nowa lub istniejąca).</span><span class="sxs-lookup"><span data-stu-id="cfd00-424">The name of the internal subnet, mandatory on both virtual network usage options (new or existing).</span></span> |
| <span data-ttu-id="cfd00-425">ADDC01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-425">ADDC01NICIPAddress</span></span> |<span data-ttu-id="cfd00-426">Wewnętrzny adres IP pierwszego kontrolera domeny. Ten adres IP zostanie statycznie przypisany do kontrolera domeny i musi być prawidłowym adresem IP w obrębie podsieci wewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-426">The internal IP address of the first Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="cfd00-427">ADDC02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-427">ADDC02NICIPAddress</span></span> |<span data-ttu-id="cfd00-428">Wewnętrzny adres IP drugiego kontrolera domeny. Ten adres IP zostanie statycznie przypisany do kontrolera domeny i musi być prawidłowym adresem IP w obrębie podsieci wewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-428">The internal IP address of the second Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="cfd00-429">ADFS01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-429">ADFS01NICIPAddress</span></span> |<span data-ttu-id="cfd00-430">Wewnętrzny adres IP pierwszego serwera usług ADFS. Ten adres IP zostanie statycznie przypisany do serwera usług ADFS i musi być prawidłowym adresem IP w obrębie podsieci wewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-430">The internal IP address of the first ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="cfd00-431">ADFS02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-431">ADFS02NICIPAddress</span></span> |<span data-ttu-id="cfd00-432">Wewnętrzny adres IP drugiego serwera usług ADFS. Ten adres IP zostanie statycznie przypisany do serwera usług ADFS i musi być prawidłowym adresem IP w obrębie podsieci wewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-432">The internal IP address of the second ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="cfd00-433">WAP01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-433">WAP01NICIPAddress</span></span> |<span data-ttu-id="cfd00-434">Wewnętrzny adres IP pierwszego serwera proxy aplikacji sieci Web. Ten adres IP zostanie statycznie przypisany do serwera proxy aplikacji sieci Web i musi być prawidłowym adresem IP w obrębie podsieci DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-434">The internal IP address of the first WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="cfd00-435">WAP02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-435">WAP02NICIPAddress</span></span> |<span data-ttu-id="cfd00-436">Wewnętrzny adres IP drugiego serwera proxy aplikacji sieci Web. Ten adres IP zostanie statycznie przypisany do serwera proxy aplikacji sieci Web i musi być prawidłowym adresem IP w obrębie podsieci DMZ.</span><span class="sxs-lookup"><span data-stu-id="cfd00-436">The internal IP address of the second WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="cfd00-437">ADFSLoadBalancerPrivateIPAddress</span><span class="sxs-lookup"><span data-stu-id="cfd00-437">ADFSLoadBalancerPrivateIPAddress</span></span> |<span data-ttu-id="cfd00-438">Wewnętrzny adres IP modułu równoważenia obciążenia usług ADFS. Ten adres IP zostanie statycznie przypisany do modułu równoważenia obciążenia i musi być prawidłowym adresem IP w obrębie podsieci wewnętrznej.</span><span class="sxs-lookup"><span data-stu-id="cfd00-438">The internal IP address of the ADFS load balancer, this IP address will be statically assigned to the load balancer and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="cfd00-439">ADDCVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="cfd00-439">ADDCVMNamePrefix</span></span> |<span data-ttu-id="cfd00-440">Prefiks nazwy maszyny wirtualnej dla kontrolerów domeny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-440">Virtual Machine name prefix for Domain Controllers</span></span> |
| <span data-ttu-id="cfd00-441">ADFSVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="cfd00-441">ADFSVMNamePrefix</span></span> |<span data-ttu-id="cfd00-442">Prefiks nazwy maszyny wirtualnej dla serwerów usług ADFS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-442">Virtual Machine name prefix for ADFS servers</span></span> |
| <span data-ttu-id="cfd00-443">WAPVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="cfd00-443">WAPVMNamePrefix</span></span> |<span data-ttu-id="cfd00-444">Prefiks nazwy maszyny wirtualnej dla serwerów proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-444">Virtual Machine name prefix for WAP servers</span></span> |
| <span data-ttu-id="cfd00-445">ADDCVMSize</span><span class="sxs-lookup"><span data-stu-id="cfd00-445">ADDCVMSize</span></span> |<span data-ttu-id="cfd00-446">Rozmiar maszyny wirtualnej kontrolerów domeny.</span><span class="sxs-lookup"><span data-stu-id="cfd00-446">The vm size of the Domain Controllers</span></span> |
| <span data-ttu-id="cfd00-447">ADFSVMSize</span><span class="sxs-lookup"><span data-stu-id="cfd00-447">ADFSVMSize</span></span> |<span data-ttu-id="cfd00-448">Rozmiar maszyny wirtualnej serwerów usług ADFS.</span><span class="sxs-lookup"><span data-stu-id="cfd00-448">The vm size of the ADFS servers</span></span> |
| <span data-ttu-id="cfd00-449">WAPVMSize</span><span class="sxs-lookup"><span data-stu-id="cfd00-449">WAPVMSize</span></span> |<span data-ttu-id="cfd00-450">Rozmiar maszyny wirtualnej serwerów proxy aplikacji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="cfd00-450">The vm size of the WAP servers</span></span> |
| <span data-ttu-id="cfd00-451">AdminUserName</span><span class="sxs-lookup"><span data-stu-id="cfd00-451">AdminUserName</span></span> |<span data-ttu-id="cfd00-452">Nazwa administratora lokalnego maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="cfd00-452">The name of the local Administrator of the virtual machines</span></span> |
| <span data-ttu-id="cfd00-453">AdminPassword</span><span class="sxs-lookup"><span data-stu-id="cfd00-453">AdminPassword</span></span> |<span data-ttu-id="cfd00-454">Hasło do konta administratora lokalnego maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="cfd00-454">The password for the local Administrator account of the virtual machines</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="cfd00-455">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="cfd00-455">Additional resources</span></span>
* [<span data-ttu-id="cfd00-456">Zestawy dostępności</span><span class="sxs-lookup"><span data-stu-id="cfd00-456">Availability Sets</span></span>](https://aka.ms/Azure/Availability) 
* [<span data-ttu-id="cfd00-457">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="cfd00-457">Azure Load Balancer</span></span>](https://aka.ms/Azure/ILB)
* <span data-ttu-id="cfd00-458">[Wewnętrzne równoważenie obciążenia](https://aka.ms/Azure/ILB/Internal).</span><span class="sxs-lookup"><span data-stu-id="cfd00-458">[Internal Load Balancer](https://aka.ms/Azure/ILB/Internal)</span></span>
* [<span data-ttu-id="cfd00-459">Moduł równoważenia obciążenia połączony z Internetem</span><span class="sxs-lookup"><span data-stu-id="cfd00-459">Internet Facing Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internet)
* [<span data-ttu-id="cfd00-460">Konta magazynu</span><span class="sxs-lookup"><span data-stu-id="cfd00-460">Storage Accounts</span></span>](https://aka.ms/Azure/Storage)
* [<span data-ttu-id="cfd00-461">Sieci wirtualne platformy Azure</span><span class="sxs-lookup"><span data-stu-id="cfd00-461">Azure Virtual Networks</span></span>](https://aka.ms/Azure/VNet)
* [<span data-ttu-id="cfd00-462">Linki prowadzące do informacji dotyczących usług AD FS i serwera proxy aplikacji sieci Web</span><span class="sxs-lookup"><span data-stu-id="cfd00-462">AD FS and Web Application Proxy Links</span></span>](http://aka.ms/ADFSLinks) 

## <a name="next-steps"></a><span data-ttu-id="cfd00-463">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="cfd00-463">Next steps</span></span>
* [<span data-ttu-id="cfd00-464">Integrowanie tożsamości lokalnych z usługą Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="cfd00-464">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)
* [<span data-ttu-id="cfd00-465">Konfigurowanie usług AD FS i zarządzanie nimi za pomocą programu Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="cfd00-465">Configuring and managing your AD FS using Azure AD Connect</span></span>](active-directory-aadconnectfed-whatis.md)
* [<span data-ttu-id="cfd00-466">Wdrażanie geograficznie rozproszonych usług AD FS o wysokiej dostępności na platformie Azure przy użyciu usługi Azure Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="cfd00-466">High availability cross-geographic AD FS deployment in Azure with Azure Traffic Manager</span></span>](../active-directory-adfs-in-azure-with-azure-traffic-manager.md)

