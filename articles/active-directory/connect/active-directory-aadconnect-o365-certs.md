---
title: "Certyfikat odnowienia dla użytkowników usługi Office 365 i Azure AD | Dokumentacja firmy Microsoft"
description: "W tym artykule opisano użytkowników usługi Office 365, jak rozwiązać problemy z wiadomości e-mail, które powiadamiają o odnawiania certyfikatu."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 7f1a3303eff9c413602e745b702baa659343eba6
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="f5a25-103">Odnawianie certyfikatów Federacji dla usługi Office 365 i Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="f5a25-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="f5a25-104">Omówienie</span><span class="sxs-lookup"><span data-stu-id="f5a25-104">Overview</span></span>
<span data-ttu-id="f5a25-105">Do pomyślnego federacji między Azure Active Directory (Azure AD) i Active Directory Federation Services (AD FS) certyfikaty używane przez usługi AD FS do podpisywania tokenów zabezpieczających do usługi Azure AD powinna odpowiadać co to jest skonfigurowany w usłudze Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f5a25-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), the certificates used by AD FS to sign security tokens to Azure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="f5a25-106">Wszelkie niezgodność może prowadzić do zerwaniem relacji zaufania.</span><span class="sxs-lookup"><span data-stu-id="f5a25-106">Any mismatch can lead to broken trust.</span></span> <span data-ttu-id="f5a25-107">Usługi Azure AD zapewnia, że te informacje są utrzymywane w synchronizacji podczas wdrażania usług AD FS i serwera Proxy aplikacji sieci Web (Aby uzyskać dostęp przez ekstranet).</span><span class="sxs-lookup"><span data-stu-id="f5a25-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="f5a25-108">Ten artykuł zawiera dodatkowe informacje na temat zarządzania token certyfikaty podpisywania i zachowania ich synchronizacji z usługą Azure AD w następujących przypadkach:</span><span class="sxs-lookup"><span data-stu-id="f5a25-108">This article provides you additional information to manage your token signing certificates and keep them in sync with Azure AD, in the following cases:</span></span>

* <span data-ttu-id="f5a25-109">Nie wymaga wdrażania serwera Proxy aplikacji sieci Web, a w związku z tym metadanych federacji nie jest dostępna w ekstranetu.</span><span class="sxs-lookup"><span data-stu-id="f5a25-109">You are not deploying the Web Application Proxy, and therefore the federation metadata is not available in the extranet.</span></span>
* <span data-ttu-id="f5a25-110">Nie używasz domyślnej konfiguracji usług AD FS certyfikaty podpisywania tokenu.</span><span class="sxs-lookup"><span data-stu-id="f5a25-110">You are not using the default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="f5a25-111">Czy przy użyciu dostawcy tożsamości innych firm.</span><span class="sxs-lookup"><span data-stu-id="f5a25-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="f5a25-112">Domyślna konfiguracja usług AD FS dla certyfikatów podpisywania tokenu</span><span class="sxs-lookup"><span data-stu-id="f5a25-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="f5a25-113">Podpisywania tokenu i odszyfrowywania certyfikaty tokenu są zwykle samodzielnie podpisanych certyfikatów i są dobrym przez jeden rok.</span><span class="sxs-lookup"><span data-stu-id="f5a25-113">The token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="f5a25-114">Domyślnie usługi AD FS obejmują proces automatycznego odnawiania o nazwie **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="f5a25-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="f5a25-115">Jeśli korzystasz z usług AD FS 2.0 lub nowszej, usługi Office 365 i Azure AD automatycznie aktualizuje certyfikatu przed jego wygaśnięciem.</span><span class="sxs-lookup"><span data-stu-id="f5a25-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-the-office-365-portal-or-an-email"></a><span data-ttu-id="f5a25-116">Powiadomienie odnawiania z portalu usługi Office 365 lub wiadomości e-mail</span><span class="sxs-lookup"><span data-stu-id="f5a25-116">Renewal notification from the Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="f5a25-117">W przypadku otrzymania wiadomości e-mail lub portalu powiadomienie monitem o odnawianie certyfikatu dla pakietu Office, zobacz [Zarządzanie zmianami w certyfikaty podpisywania tokenu](#managecerts) do sprawdzenia, czy trzeba wykonywać żadnych czynności.</span><span class="sxs-lookup"><span data-stu-id="f5a25-117">If you received an email or a portal notification asking you to renew your certificate for Office, see [Managing changes to token signing certificates](#managecerts) to check if you need to take any action.</span></span> <span data-ttu-id="f5a25-118">Firma Microsoft dokłada świadomość możliwy problem, który może prowadzić do powiadomienia dotyczące odnawiania certyfikatów, które są wysyłane, nawet wtedy, gdy nie jest wymagana żadna akcja.</span><span class="sxs-lookup"><span data-stu-id="f5a25-118">Microsoft is aware of a possible issue that can lead to notifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="f5a25-119">Usługi Azure AD próbuje metadanych Federacji monitorowanie i aktualizowanie certyfikatów podpisywania wskazywany przez te metadane tokenu.</span><span class="sxs-lookup"><span data-stu-id="f5a25-119">Azure AD attempts to monitor the federation metadata, and update the token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="f5a25-120">30 dni przed wygaśnięciem tokenu podpisywania certyfikatów, usługi Azure AD sprawdza, czy nowe certyfikaty są dostępne przez sondowanie metadanych federacji.</span><span class="sxs-lookup"><span data-stu-id="f5a25-120">30 days before the expiration of the token signing certificates, Azure AD checks if new certificates are available by polling the federation metadata.</span></span>

* <span data-ttu-id="f5a25-121">Czy można pomyślnie sondowania metadanych Federacji i pobrać nowe certyfikaty, bez powiadomienia e-mail i ostrzeżenia w portalu usługi Office 365 jest wystawiony dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f5a25-121">If it can successfully poll the federation metadata and retrieve the new certificates, no email notification or warning in the Office 365 portal is issued to the user.</span></span>
* <span data-ttu-id="f5a25-122">Jeśli nie może pobrać nowych certyfikatów podpisywania tokenu, albo ponieważ metadanych federacji nie jest dostępny lub nie włączono automatycznego przerzucania, usługa Azure AD wystawia wiadomość e-mail z powiadomieniem i ostrzeżenie w portalu usługi Office 365.</span><span class="sxs-lookup"><span data-stu-id="f5a25-122">If it cannot retrieve the new token signing certificates, either because the federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in the Office 365 portal.</span></span>

![Powiadomieniu portalu usługi Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="f5a25-124">Jeśli używasz usług AD FS, aby zapewnić ciągłość, sprawdź, czy serwery powinni mieć następujące aktualizacje, dzięki czemu nie występują błędy uwierzytelniania pod kątem znanych problemów.</span><span class="sxs-lookup"><span data-stu-id="f5a25-124">If you are using AD FS, to ensure business continuity, please verify that your servers have the following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="f5a25-125">Zmniejsza to zagrożenie wynikające znanych problemów dotyczących serwera proxy usług AD FS dla tego odnawiania i okresy przyszłych odnawiania:</span><span class="sxs-lookup"><span data-stu-id="f5a25-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="f5a25-126">Server 2012 R2 — [systemu Windows Server zbiorczy maja 2014](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="f5a25-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="f5a25-127">Server 2008 R2 i 2012 — [niepowodzenia uwierzytelniania za pośrednictwem serwera proxy w systemie Windows Server 2012 lub Windows 2008 R2 z dodatkiem SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="f5a25-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="f5a25-128">Sprawdź, czy certyfikaty muszą zostać zaktualizowane<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="f5a25-128">Check if the certificates need to be updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-the-autocertificaterollover-state"></a><span data-ttu-id="f5a25-129">Krok 1: Sprawdź stan AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="f5a25-129">Step 1: Check the AutoCertificateRollover state</span></span>
<span data-ttu-id="f5a25-130">Na serwerze usług AD FS Otwórz program PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f5a25-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="f5a25-131">Sprawdź, czy wartość AutoCertificateRollover jest równa True.</span><span class="sxs-lookup"><span data-stu-id="f5a25-131">Check that the AutoCertificateRollover value is set to True.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="f5a25-133">Jeśli korzystasz z usług AD FS 2.0, najpierw uruchom Microsoft.Adfs.Powershell Dodaj-Pssnapin.</span><span class="sxs-lookup"><span data-stu-id="f5a25-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="f5a25-134">Krok 2: Sprawdź, czy usługi AD FS a usługą Azure AD są zsynchronizowane</span><span class="sxs-lookup"><span data-stu-id="f5a25-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="f5a25-135">Na serwerze usług AD FS Otwórz wiersz programu Azure AD PowerShell i łączenie z usługą Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f5a25-135">On your AD FS server, open the Azure AD PowerShell prompt, and connect to Azure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="f5a25-136">Możesz pobrać program Azure AD PowerShell [tutaj](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="f5a25-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="f5a25-137">Sprawdź certyfikaty, skonfigurowane w usłudze AD FS a usługą Azure AD zaufania właściwości dla określonej domeny.</span><span class="sxs-lookup"><span data-stu-id="f5a25-137">Check the certificates configured in AD FS and Azure AD trust properties for the specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="f5a25-139">Jeśli odcisków palca w obu dane wyjściowe są zgodne, certyfikaty są zsynchronizowane z usługą Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f5a25-139">If the thumbprints in both the outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-to-expire"></a><span data-ttu-id="f5a25-140">Krok 3: Sprawdź, czy certyfikat wygaśnie</span><span class="sxs-lookup"><span data-stu-id="f5a25-140">Step 3: Check if your certificate is about to expire</span></span>
<span data-ttu-id="f5a25-141">W danych wyjściowych Get MsolFederationProperty lub Get-AdfsCertificate Sprawdź datę w obszarze "Nie po."</span><span class="sxs-lookup"><span data-stu-id="f5a25-141">In the output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for the date under "Not After."</span></span> <span data-ttu-id="f5a25-142">Jeśli data jest mniej niż 30 dni nieobecności, należy podjąć działania.</span><span class="sxs-lookup"><span data-stu-id="f5a25-142">If the date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="f5a25-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="f5a25-143">AutoCertificateRollover</span></span> | <span data-ttu-id="f5a25-144">Certyfikaty w synchronizacji z usługą Azure AD</span><span class="sxs-lookup"><span data-stu-id="f5a25-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="f5a25-145">Jest dostępny publicznie element metadanych Federacji</span><span class="sxs-lookup"><span data-stu-id="f5a25-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="f5a25-146">Ważność</span><span class="sxs-lookup"><span data-stu-id="f5a25-146">Validity</span></span> | <span data-ttu-id="f5a25-147">Akcja</span><span class="sxs-lookup"><span data-stu-id="f5a25-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="f5a25-148">Tak</span><span class="sxs-lookup"><span data-stu-id="f5a25-148">Yes</span></span> |<span data-ttu-id="f5a25-149">Tak</span><span class="sxs-lookup"><span data-stu-id="f5a25-149">Yes</span></span> |<span data-ttu-id="f5a25-150">Tak</span><span class="sxs-lookup"><span data-stu-id="f5a25-150">Yes</span></span> |- |<span data-ttu-id="f5a25-151">Nie jest wymagana żadna akcja.</span><span class="sxs-lookup"><span data-stu-id="f5a25-151">No action needed.</span></span> <span data-ttu-id="f5a25-152">Zobacz [podpisywania tokenu odnawiania certyfikatów automatycznie](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="f5a25-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="f5a25-153">Tak</span><span class="sxs-lookup"><span data-stu-id="f5a25-153">Yes</span></span> |<span data-ttu-id="f5a25-154">Nie</span><span class="sxs-lookup"><span data-stu-id="f5a25-154">No</span></span> |- |<span data-ttu-id="f5a25-155">Mniej niż 15 dni</span><span class="sxs-lookup"><span data-stu-id="f5a25-155">Less than 15 days</span></span> |<span data-ttu-id="f5a25-156">Odnów natychmiast.</span><span class="sxs-lookup"><span data-stu-id="f5a25-156">Renew immediately.</span></span> <span data-ttu-id="f5a25-157">Zobacz [podpisywania tokenu odnawiania certyfikatu ręcznie](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="f5a25-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="f5a25-158">Nie</span><span class="sxs-lookup"><span data-stu-id="f5a25-158">No</span></span> |- |- |<span data-ttu-id="f5a25-159">Mniej niż 30 dni</span><span class="sxs-lookup"><span data-stu-id="f5a25-159">Less than 30 days</span></span> |<span data-ttu-id="f5a25-160">Odnów natychmiast.</span><span class="sxs-lookup"><span data-stu-id="f5a25-160">Renew immediately.</span></span> <span data-ttu-id="f5a25-161">Zobacz [podpisywania tokenu odnawiania certyfikatu ręcznie](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="f5a25-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="f5a25-162">\[-] Nie ma znaczenia.</span><span class="sxs-lookup"><span data-stu-id="f5a25-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="f5a25-163">Odnów certyfikat podpisywania automatycznie tokenu (zalecane)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="f5a25-163">Renew the token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="f5a25-164">Nie trzeba wykonywać żadnych czynności ręcznej, jeśli są spełnione oba poniższe:</span><span class="sxs-lookup"><span data-stu-id="f5a25-164">You don't need to perform any manual steps if both of the following are true:</span></span>

* <span data-ttu-id="f5a25-165">Należy wdrożyć serwer Proxy aplikacji sieci Web, które można włączyć dostęp do metadanych federacji z ekstranetu.</span><span class="sxs-lookup"><span data-stu-id="f5a25-165">You have deployed Web Application Proxy, which can enable access to the federation metadata from the extranet.</span></span>
* <span data-ttu-id="f5a25-166">Używania domyślnej konfiguracji usług AD FS (AutoCertificateRollover jest włączona).</span><span class="sxs-lookup"><span data-stu-id="f5a25-166">You are using the AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="f5a25-167">Sprawdź następujące polecenie, aby potwierdzić, że certyfikat mogą być automatycznie aktualizowane.</span><span class="sxs-lookup"><span data-stu-id="f5a25-167">Check the following to confirm that the certificate can be automatically updated.</span></span>

<span data-ttu-id="f5a25-168">**1. Właściwość usług AD FS AutoCertificateRollover musi mieć ustawioną wartość True.**</span><span class="sxs-lookup"><span data-stu-id="f5a25-168">**1. The AD FS property AutoCertificateRollover must be set to True.**</span></span> <span data-ttu-id="f5a25-169">To wskazuje, że usługi AD FS automatycznie generuje nowy token podpisywania i odszyfrowywania tokenów certyfikatów przed stary tych wygaśnie.</span><span class="sxs-lookup"><span data-stu-id="f5a25-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before the old ones expire.</span></span>

<span data-ttu-id="f5a25-170">**2. Metadane federacji usług AD FS jest dostępny publicznie.**</span><span class="sxs-lookup"><span data-stu-id="f5a25-170">**2. The AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="f5a25-171">Sprawdź, czy z metadanych federacji jest dostępny publicznie, przechodząc pod następujący adres URL z komputera w publicznej sieci internet (się z sieci firmowej):</span><span class="sxs-lookup"><span data-stu-id="f5a25-171">Check that your federation metadata is publicly accessible by navigating to the following URL from a computer on the public internet (off of the corporate network):</span></span>

<span data-ttu-id="f5a25-172">/federationmetadata/2007-06/federationmetadata.xml https:// (your_FS_name)</span><span class="sxs-lookup"><span data-stu-id="f5a25-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="f5a25-173">gdzie `(your_FS_name) `jest zastępowany nazwę hosta usługi federacyjnej, organizacja używa, takich jak fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="f5a25-173">where `(your_FS_name) `is replaced with the federation service host name your organization uses, such as fs.contoso.com.</span></span>  <span data-ttu-id="f5a25-174">Jeśli możesz zweryfikować oba te ustawienia pomyślnie, nie trzeba nic robić.</span><span class="sxs-lookup"><span data-stu-id="f5a25-174">If you are able to verify both of these settings successfully, you do not have to do anything else.</span></span>  

<span data-ttu-id="f5a25-175">Przykład: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="f5a25-175">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="f5a25-176">Odnów certyfikat podpisywania ręcznie tokenu<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="f5a25-176">Renew the token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="f5a25-177">Można odnowić certyfikatów podpisywania ręcznie tokenu.</span><span class="sxs-lookup"><span data-stu-id="f5a25-177">You may choose to renew the token signing certificates manually.</span></span> <span data-ttu-id="f5a25-178">Na przykład poniższe scenariusze mogą działać lepiej odnowienia ręczne:</span><span class="sxs-lookup"><span data-stu-id="f5a25-178">For example, the following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="f5a25-179">Certyfikaty podpisywania tokenu to certyfikaty nie podpisem.</span><span class="sxs-lookup"><span data-stu-id="f5a25-179">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="f5a25-180">Najczęstszą przyczyną tego jest, że Twoja organizacja zarządza certyfikatów usługi AD FS zarejestrowane od urzędu certyfikacji w organizacji.</span><span class="sxs-lookup"><span data-stu-id="f5a25-180">The most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="f5a25-181">Zabezpieczenia sieci nie zezwalają na metadanych Federacji, które mają być publicznie dostępne.</span><span class="sxs-lookup"><span data-stu-id="f5a25-181">Network security does not allow the federation metadata to be publicly available.</span></span>

<span data-ttu-id="f5a25-182">W tych scenariuszach za każdym razem, gdy certyfikaty podpisywania tokenu należy również zaktualizować domeną usługi Office 365 za pomocą polecenia programu PowerShell, MsolFederatedDomain aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="f5a25-182">In these scenarios, every time you update the token signing certificates, you must also update your Office 365 domain by using the PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="f5a25-183">Krok 1: Upewnij się, że usługi AD FS ma nowych certyfikatów podpisywania tokenu</span><span class="sxs-lookup"><span data-stu-id="f5a25-183">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="f5a25-184">**Inne niż domyślne konfiguracji**</span><span class="sxs-lookup"><span data-stu-id="f5a25-184">**Non-default configuration**</span></span>

<span data-ttu-id="f5a25-185">Jeśli używasz niedomyślna Konfiguracja usług AD FS (gdzie **AutoCertificateRollover** ustawiono **False**), są prawdopodobnie używa niestandardowych certyfikatów (nie z podpisem własnym).</span><span class="sxs-lookup"><span data-stu-id="f5a25-185">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set to **False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="f5a25-186">Aby uzyskać więcej informacji o sposobie odnawiania certyfikatów podpisywania tokenu usług AD FS, zobacz [wskazówki dotyczące klientów nie korzystających z usług AD FS certyfikaty z podpisem własnym](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="f5a25-186">For more information about how to renew the AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="f5a25-187">**Metadane federacji nie jest publicznie dostępna**</span><span class="sxs-lookup"><span data-stu-id="f5a25-187">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="f5a25-188">Z drugiej strony Jeśli **AutoCertificateRollover** ma ustawioną wartość **True**, ale z metadanych federacji nie jest dostępny publicznie, najpierw upewnij się, że nowe certyfikaty podpisywania tokenu zostały wygenerowane przez usługi AD FS.</span><span class="sxs-lookup"><span data-stu-id="f5a25-188">On the other hand, if **AutoCertificateRollover** is set to **True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="f5a25-189">Upewnij się, że masz nowy token certyfikaty podpisywania, wykonując następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="f5a25-189">Confirm you have new token signing certificates by taking the following steps:</span></span>

1. <span data-ttu-id="f5a25-190">Sprawdź, czy użytkownik jest zalogowany do podstawowego serwera usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f5a25-190">Verify that you are logged on to the primary AD FS server.</span></span>
2. <span data-ttu-id="f5a25-191">Sprawdź bieżący podpisywania certyfikatów w usługach AD FS, otwierając okno poleceń programu PowerShell i uruchom następujące polecenie:</span><span class="sxs-lookup"><span data-stu-id="f5a25-191">Check the current signing certificates in AD FS by opening a PowerShell command window, and running the following command:</span></span>

    <span data-ttu-id="f5a25-192">PS C:\>podpisywania tokenu Get-ADFSCertificate — CertificateType</span><span class="sxs-lookup"><span data-stu-id="f5a25-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="f5a25-193">Jeśli korzystasz z usług AD FS 2.0, należy najpierw uruchomić Microsoft.Adfs.Powershell Dodaj-Pssnapin.</span><span class="sxs-lookup"><span data-stu-id="f5a25-193">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="f5a25-194">Sprawdź dane wyjściowe polecenia na wszystkie certyfikaty na liście.</span><span class="sxs-lookup"><span data-stu-id="f5a25-194">Look at the command output at any certificates listed.</span></span> <span data-ttu-id="f5a25-195">Jeśli usługi AD FS wygenerował nowy certyfikat, powinny pojawić się dwa certyfikaty w danych wyjściowych: jeden do którego **IsPrimary** wartość jest **True** i **nie później niż** przypada w ciągu 5 dni i na które **IsPrimary** jest **False** i **nie później niż** dotyczy roku w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="f5a25-195">If AD FS has generated a new certificate, you should see two certificates in the output: one for which the **IsPrimary** value is **True** and the **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in the future.</span></span>
4. <span data-ttu-id="f5a25-196">Jeśli zostanie wyświetlony tylko jeden certyfikat i **nie później niż** przypada w ciągu 5 dni, należy wygenerować nowy certyfikat.</span><span class="sxs-lookup"><span data-stu-id="f5a25-196">If you only see one certificate, and the **NotAfter** date is within 5 days, you need to generate a new certificate.</span></span>
5. <span data-ttu-id="f5a25-197">Aby wygenerować nowy certyfikat, uruchom następujące polecenie w wierszu polecenia programu PowerShell: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="f5a25-197">To generate a new certificate, execute the following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="f5a25-198">Sprawdź aktualizację, uruchamiając następujące polecenie: PS C:\>podpisywania tokenu Get-ADFSCertificate — CertificateType</span><span class="sxs-lookup"><span data-stu-id="f5a25-198">Verify the update by running the following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="f5a25-199">Powinien być teraz wyświetlany dwa certyfikaty, z których jedna ma **nie później niż** datę w przyszłości około jednego roku i dla których **IsPrimary** wartość jest **False**.</span><span class="sxs-lookup"><span data-stu-id="f5a25-199">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in the future, and for which the **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-the-new-token-signing-certificates-for-the-office-365-trust"></a><span data-ttu-id="f5a25-200">Krok 2: Zaktualizuj nowy token podpisywania certyfikatów dla zaufania usługi Office 365</span><span class="sxs-lookup"><span data-stu-id="f5a25-200">Step 2: Update the new token signing certificates for the Office 365 trust</span></span>
<span data-ttu-id="f5a25-201">Aktualizacja usługi Office 365 przy użyciu nowego tokenu podpisywania certyfikatów do zastosowania w przypadku zaufania, w następujący sposób.</span><span class="sxs-lookup"><span data-stu-id="f5a25-201">Update Office 365 with the new token signing certificates to be used for the trust, as follows.</span></span>

1. <span data-ttu-id="f5a25-202">Otwórz moduł usługi Active Directory platformy Microsoft Azure dla środowiska Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f5a25-202">Open the Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="f5a25-203">Uruchom $cred = Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="f5a25-203">Run $cred=Get-Credential.</span></span> <span data-ttu-id="f5a25-204">Gdy to polecenie cmdlet wyświetla monit o podanie poświadczeń, wpisz poświadczenia konta administratora usługi chmury.</span><span class="sxs-lookup"><span data-stu-id="f5a25-204">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="f5a25-205">Uruchom Connect MsolService — $cred poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="f5a25-205">Run Connect-MsolService –Credential $cred.</span></span> <span data-ttu-id="f5a25-206">To polecenie cmdlet łączy do usługi w chmurze.</span><span class="sxs-lookup"><span data-stu-id="f5a25-206">This cmdlet connects you to the cloud service.</span></span> <span data-ttu-id="f5a25-207">Tworzenie kontekstu, który łączy do usługi w chmurze jest wymagana przed uruchomieniem dowolnych poleceniach cmdlet dodatkowe zainstalowane przez narzędzie.</span><span class="sxs-lookup"><span data-stu-id="f5a25-207">Creating a context that connects you to the cloud service is required before running any of the additional cmdlets installed by the tool.</span></span>
4. <span data-ttu-id="f5a25-208">Jeśli używasz tych poleceń na komputerze, który nie jest serwerem podstawowym usług AD FS, uruchom zestaw MSOLAdfscontext-komputer <AD FS primary server>, gdzie <AD FS primary server> to wewnętrzna nazwa FQDN podstawowego serwera usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f5a25-208">If you are running these commands on a computer that is not the AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is the internal FQDN name of the primary AD FS server.</span></span> <span data-ttu-id="f5a25-209">To polecenie cmdlet tworzy kontekstu, który łączy użytkownika z usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f5a25-209">This cmdlet creates a context that connects you to AD FS.</span></span>
5. <span data-ttu-id="f5a25-210">Uruchom aktualizacji MSOLFederatedDomain — DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="f5a25-210">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="f5a25-211">To polecenie cmdlet zaktualizowanie ustawień z usług AD FS do usługi w chmurze i konfiguruje relację zaufania między nimi.</span><span class="sxs-lookup"><span data-stu-id="f5a25-211">This cmdlet updates the settings from AD FS into the cloud service, and configures the trust relationship between the two.</span></span>

> [!NOTE]
> <span data-ttu-id="f5a25-212">Jeśli zachodzi konieczność obsługi wielu domen najwyższego poziomu, takich jak contoso.com i fabrikam.com, należy użyć **SupportMultipleDomain** przełącznik z dowolnego polecenia cmdlet.</span><span class="sxs-lookup"><span data-stu-id="f5a25-212">If you need to support multiple top-level domains, such as contoso.com and fabrikam.com, you must use the **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="f5a25-213">Aby uzyskać więcej informacji, zobacz [Obsługa wielu domen poziom górnej](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="f5a25-213">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="f5a25-214">Napraw zaufania usługi Azure AD za pomocą usługi Azure AD Connect<a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="f5a25-214">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="f5a25-215">Jeśli farma usług AD FS, a relacja zaufania usługi Azure AD są skonfigurowane za pomocą usługi Azure AD Connect, można użyć usługi Azure AD Connect do wykrywania, jeśli musisz podejmować żadnych działań dla Twojego certyfikaty podpisywania tokenu.</span><span class="sxs-lookup"><span data-stu-id="f5a25-215">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect to detect if you need to take any action for your token signing certificates.</span></span> <span data-ttu-id="f5a25-216">Jeśli chcesz odnowić certyfikaty, można użyć Azure AD Connect, aby to zrobić.</span><span class="sxs-lookup"><span data-stu-id="f5a25-216">If you need to renew the certificates, you can use Azure AD Connect to do so.</span></span>

<span data-ttu-id="f5a25-217">Aby uzyskać więcej informacji, zobacz [naprawiania zaufania](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="f5a25-217">For more information, see [Repairing the trust](active-directory-aadconnect-federation-management.md).</span></span>
