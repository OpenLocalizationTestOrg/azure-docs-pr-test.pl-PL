---
title: "Odnawianie aaaCertificate dla użytkowników usługi Office 365 i Azure AD | Dokumentacja firmy Microsoft"
description: "W tym artykule opisano tooOffice użytkowników 365 jak tooresolve problemy związane z wiadomościami e-mail powiadamiać użytkowników o odnawiania certyfikatu."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b9b309e06949dc5488cd628650be413f366ed347
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="0da37-103">Odnawianie certyfikatów Federacji dla usługi Office 365 i Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="0da37-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="0da37-104">Omówienie</span><span class="sxs-lookup"><span data-stu-id="0da37-104">Overview</span></span>
<span data-ttu-id="0da37-105">Dla pomyślnego federacji między Azure Active Directory (Azure AD) i Active Directory Federation Services (AD FS) hello certyfikatów używanych przez usługi AD FS toosign zabezpieczeń tokeny tooAzure AD powinna odpowiadać co to jest skonfigurowany w usłudze Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0da37-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), hello certificates used by AD FS toosign security tokens tooAzure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="0da37-106">Wszelkie niezgodność może prowadzić toobroken zaufania.</span><span class="sxs-lookup"><span data-stu-id="0da37-106">Any mismatch can lead toobroken trust.</span></span> <span data-ttu-id="0da37-107">Usługi Azure AD zapewnia, że te informacje są utrzymywane w synchronizacji podczas wdrażania usług AD FS i serwera Proxy aplikacji sieci Web (Aby uzyskać dostęp przez ekstranet).</span><span class="sxs-lookup"><span data-stu-id="0da37-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="0da37-108">Ten artykuł zawiera dodatkowe informacje toomanage token certyfikaty podpisywania i przechowywać w synchronizacji z usługą Azure AD w hello w następujących przypadkach:</span><span class="sxs-lookup"><span data-stu-id="0da37-108">This article provides you additional information toomanage your token signing certificates and keep them in sync with Azure AD, in hello following cases:</span></span>

* <span data-ttu-id="0da37-109">Nie wymaga wdrażania powitania serwera Proxy aplikacji sieci Web, a w związku z tym nie jest dostępna w ekstranecie hello hello metadanych federacji.</span><span class="sxs-lookup"><span data-stu-id="0da37-109">You are not deploying hello Web Application Proxy, and therefore hello federation metadata is not available in hello extranet.</span></span>
* <span data-ttu-id="0da37-110">Nie używasz hello domyślnej konfiguracji usług AD FS certyfikaty podpisywania tokenu.</span><span class="sxs-lookup"><span data-stu-id="0da37-110">You are not using hello default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="0da37-111">Czy przy użyciu dostawcy tożsamości innych firm.</span><span class="sxs-lookup"><span data-stu-id="0da37-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="0da37-112">Domyślna konfiguracja usług AD FS dla certyfikatów podpisywania tokenu</span><span class="sxs-lookup"><span data-stu-id="0da37-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="0da37-113">Hello podpisywania tokenu i odszyfrowywania certyfikaty token są zazwyczaj samodzielnie podpisanych certyfikatów i są dobrym przez jeden rok.</span><span class="sxs-lookup"><span data-stu-id="0da37-113">hello token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="0da37-114">Domyślnie usługi AD FS obejmują proces automatycznego odnawiania o nazwie **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="0da37-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="0da37-115">Jeśli korzystasz z usług AD FS 2.0 lub nowszej, usługi Office 365 i Azure AD automatycznie aktualizuje certyfikatu przed jego wygaśnięciem.</span><span class="sxs-lookup"><span data-stu-id="0da37-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-hello-office-365-portal-or-an-email"></a><span data-ttu-id="0da37-116">Powiadomienie odnawiania z portalu usługi Office 365 hello lub wiadomości e-mail</span><span class="sxs-lookup"><span data-stu-id="0da37-116">Renewal notification from hello Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="0da37-117">Jeśli otrzymanej wiadomości e-mail lub portalu powiadomienie monitem toorenew certyfikat dla pakietu Office, zobacz [Zarządzanie zmienia tootoken certyfikaty podpisywania](#managecerts) toocheck, jeśli potrzebujesz tootake żadnych działań.</span><span class="sxs-lookup"><span data-stu-id="0da37-117">If you received an email or a portal notification asking you toorenew your certificate for Office, see [Managing changes tootoken signing certificates](#managecerts) toocheck if you need tootake any action.</span></span> <span data-ttu-id="0da37-118">Firma Microsoft dokłada świadomość możliwy problem, który może prowadzić toonotifications odnowienia certyfikatu są wysyłane, nawet wtedy, gdy nie jest wymagana żadna akcja.</span><span class="sxs-lookup"><span data-stu-id="0da37-118">Microsoft is aware of a possible issue that can lead toonotifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="0da37-119">Usługi Azure AD podejmuje metadanych Federacji hello toomonitor i certyfikatów podpisywania wskazywany przez te metadane token hello aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="0da37-119">Azure AD attempts toomonitor hello federation metadata, and update hello token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="0da37-120">30 dni przed wygaśnięciem hello certyfikaty podpisywania tokenu hello Azure AD sprawdza nowe certyfikaty są dostępne przez sondowanie hello metadanych federacji.</span><span class="sxs-lookup"><span data-stu-id="0da37-120">30 days before hello expiration of hello token signing certificates, Azure AD checks if new certificates are available by polling hello federation metadata.</span></span>

* <span data-ttu-id="0da37-121">Czy można pomyślnie sondowania metadanych Federacji hello i pobrać nowe certyfikaty hello, bez powiadomienia e-mail i ostrzeżenia w portalu usługi Office 365 hello jest wystawiony toohello użytkownika.</span><span class="sxs-lookup"><span data-stu-id="0da37-121">If it can successfully poll hello federation metadata and retrieve hello new certificates, no email notification or warning in hello Office 365 portal is issued toohello user.</span></span>
* <span data-ttu-id="0da37-122">Jeśli nie może pobrać hello nowych certyfikatów podpisywania tokenu, albo ponieważ hello metadanych federacji nie jest dostępny lub nie włączono automatycznego przerzucania, usługa Azure AD wystawia wiadomość e-mail z powiadomieniem i ostrzeżenie w portalu usługi Office 365 hello.</span><span class="sxs-lookup"><span data-stu-id="0da37-122">If it cannot retrieve hello new token signing certificates, either because hello federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in hello Office 365 portal.</span></span>

![Powiadomieniu portalu usługi Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="0da37-124">Jeśli używasz usług AD FS, tooensure ciągłość prowadzenia działalności biznesowej, sprawdź, czy serwery mają powitania po aktualizacji, dzięki czemu nie występują błędy uwierzytelniania pod kątem znanych problemów.</span><span class="sxs-lookup"><span data-stu-id="0da37-124">If you are using AD FS, tooensure business continuity, please verify that your servers have hello following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="0da37-125">Zmniejsza to zagrożenie wynikające znanych problemów dotyczących serwera proxy usług AD FS dla tego odnawiania i okresy przyszłych odnawiania:</span><span class="sxs-lookup"><span data-stu-id="0da37-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="0da37-126">Server 2012 R2 — [systemu Windows Server zbiorczy maja 2014](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="0da37-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="0da37-127">Server 2008 R2 i 2012 — [niepowodzenia uwierzytelniania za pośrednictwem serwera proxy w systemie Windows Server 2012 lub Windows 2008 R2 z dodatkiem SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="0da37-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="0da37-128">Sprawdzaj, czy certyfikaty hello wymagają toobe zaktualizowane<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="0da37-128">Check if hello certificates need toobe updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-hello-autocertificaterollover-state"></a><span data-ttu-id="0da37-129">Krok 1: Sprawdź stan AutoCertificateRollover hello</span><span class="sxs-lookup"><span data-stu-id="0da37-129">Step 1: Check hello AutoCertificateRollover state</span></span>
<span data-ttu-id="0da37-130">Na serwerze usług AD FS Otwórz program PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0da37-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="0da37-131">Sprawdź, czy hello AutoCertificateRollover wartość tooTrue.</span><span class="sxs-lookup"><span data-stu-id="0da37-131">Check that hello AutoCertificateRollover value is set tooTrue.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="0da37-133">Jeśli korzystasz z usług AD FS 2.0, najpierw uruchom Microsoft.Adfs.Powershell Dodaj-Pssnapin.</span><span class="sxs-lookup"><span data-stu-id="0da37-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="0da37-134">Krok 2: Sprawdź, czy usługi AD FS a usługą Azure AD są zsynchronizowane</span><span class="sxs-lookup"><span data-stu-id="0da37-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="0da37-135">Na serwerze usług AD FS Otwórz hello Azure AD PowerShell wiersza, a następnie połącz tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="0da37-135">On your AD FS server, open hello Azure AD PowerShell prompt, and connect tooAzure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="0da37-136">Możesz pobrać program Azure AD PowerShell [tutaj](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="0da37-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="0da37-137">Sprawdź certyfikaty hello skonfigurowane w usłudze AD FS i właściwości zaufania usługi Azure AD dla hello określonej domeny.</span><span class="sxs-lookup"><span data-stu-id="0da37-137">Check hello certificates configured in AD FS and Azure AD trust properties for hello specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="0da37-139">Jeśli odciski palców hello zarówno hello wyniki zgodne, certyfikaty są zsynchronizowane z usługą Azure AD.</span><span class="sxs-lookup"><span data-stu-id="0da37-139">If hello thumbprints in both hello outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-tooexpire"></a><span data-ttu-id="0da37-140">Krok 3: Sprawdź, czy certyfikat o tooexpire</span><span class="sxs-lookup"><span data-stu-id="0da37-140">Step 3: Check if your certificate is about tooexpire</span></span>
<span data-ttu-id="0da37-141">W danych wyjściowych hello Get MsolFederationProperty lub Get-AdfsCertificate Sprawdź datę hello w obszarze "Nie po."</span><span class="sxs-lookup"><span data-stu-id="0da37-141">In hello output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for hello date under "Not After."</span></span> <span data-ttu-id="0da37-142">Jeśli data hello jest mniej niż 30 dni nieobecności, należy podjąć akcję.</span><span class="sxs-lookup"><span data-stu-id="0da37-142">If hello date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="0da37-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="0da37-143">AutoCertificateRollover</span></span> | <span data-ttu-id="0da37-144">Certyfikaty w synchronizacji z usługą Azure AD</span><span class="sxs-lookup"><span data-stu-id="0da37-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="0da37-145">Jest dostępny publicznie element metadanych Federacji</span><span class="sxs-lookup"><span data-stu-id="0da37-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="0da37-146">Ważność</span><span class="sxs-lookup"><span data-stu-id="0da37-146">Validity</span></span> | <span data-ttu-id="0da37-147">Akcja</span><span class="sxs-lookup"><span data-stu-id="0da37-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="0da37-148">Tak</span><span class="sxs-lookup"><span data-stu-id="0da37-148">Yes</span></span> |<span data-ttu-id="0da37-149">Tak</span><span class="sxs-lookup"><span data-stu-id="0da37-149">Yes</span></span> |<span data-ttu-id="0da37-150">Tak</span><span class="sxs-lookup"><span data-stu-id="0da37-150">Yes</span></span> |- |<span data-ttu-id="0da37-151">Nie jest wymagana żadna akcja.</span><span class="sxs-lookup"><span data-stu-id="0da37-151">No action needed.</span></span> <span data-ttu-id="0da37-152">Zobacz [podpisywania tokenu odnawiania certyfikatów automatycznie](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="0da37-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="0da37-153">Tak</span><span class="sxs-lookup"><span data-stu-id="0da37-153">Yes</span></span> |<span data-ttu-id="0da37-154">Nie</span><span class="sxs-lookup"><span data-stu-id="0da37-154">No</span></span> |- |<span data-ttu-id="0da37-155">Mniej niż 15 dni</span><span class="sxs-lookup"><span data-stu-id="0da37-155">Less than 15 days</span></span> |<span data-ttu-id="0da37-156">Odnów natychmiast.</span><span class="sxs-lookup"><span data-stu-id="0da37-156">Renew immediately.</span></span> <span data-ttu-id="0da37-157">Zobacz [podpisywania tokenu odnawiania certyfikatu ręcznie](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="0da37-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="0da37-158">Nie</span><span class="sxs-lookup"><span data-stu-id="0da37-158">No</span></span> |- |- |<span data-ttu-id="0da37-159">Mniej niż 30 dni</span><span class="sxs-lookup"><span data-stu-id="0da37-159">Less than 30 days</span></span> |<span data-ttu-id="0da37-160">Odnów natychmiast.</span><span class="sxs-lookup"><span data-stu-id="0da37-160">Renew immediately.</span></span> <span data-ttu-id="0da37-161">Zobacz [podpisywania tokenu odnawiania certyfikatu ręcznie](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="0da37-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="0da37-162">\[-] Nie ma znaczenia.</span><span class="sxs-lookup"><span data-stu-id="0da37-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="0da37-163">Odnów certyfikat podpisywania automatycznie token hello (zalecane)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="0da37-163">Renew hello token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="0da37-164">Nie trzeba tooperform wszelkie wymagane ręczne wykonanie czynności, jeśli spełnione są następujące hello:</span><span class="sxs-lookup"><span data-stu-id="0da37-164">You don't need tooperform any manual steps if both of hello following are true:</span></span>

* <span data-ttu-id="0da37-165">Serwer Proxy aplikacji sieci Web, która może umożliwić metadanych Federacji toohello dostępu z ekstranetu hello została wdrożona.</span><span class="sxs-lookup"><span data-stu-id="0da37-165">You have deployed Web Application Proxy, which can enable access toohello federation metadata from hello extranet.</span></span>
* <span data-ttu-id="0da37-166">Używasz usług AD FS hello domyślnej konfiguracji (AutoCertificateRollover jest włączona).</span><span class="sxs-lookup"><span data-stu-id="0da37-166">You are using hello AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="0da37-167">Sprawdź, czy powitania po tooconfirm, który hello certyfikatu może być aktualizowana automatycznie.</span><span class="sxs-lookup"><span data-stu-id="0da37-167">Check hello following tooconfirm that hello certificate can be automatically updated.</span></span>

<span data-ttu-id="0da37-168">**1. hello właściwości usługi AD FS AutoCertificateRollover musi być ustawiona tooTrue.**</span><span class="sxs-lookup"><span data-stu-id="0da37-168">**1. hello AD FS property AutoCertificateRollover must be set tooTrue.**</span></span> <span data-ttu-id="0da37-169">Oznacza to, że usługi AD FS automatycznie generuje nowy podpisywania tokenu i certyfikaty odszyfrowywania tokenów, przed hello tych wygaśnie stary.</span><span class="sxs-lookup"><span data-stu-id="0da37-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before hello old ones expire.</span></span>

<span data-ttu-id="0da37-170">**2. metadane Federacji hello usługi AD FS jest dostępny publicznie.**</span><span class="sxs-lookup"><span data-stu-id="0da37-170">**2. hello AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="0da37-171">Sprawdź, czy z metadanych federacji jest dostępny publicznie, przechodząc toohello następującego adresu URL z komputera hello publicznego Internetu (poza siecią firmową hello):</span><span class="sxs-lookup"><span data-stu-id="0da37-171">Check that your federation metadata is publicly accessible by navigating toohello following URL from a computer on hello public internet (off of hello corporate network):</span></span>

<span data-ttu-id="0da37-172">/federationmetadata/2007-06/federationmetadata.xml https:// (your_FS_name)</span><span class="sxs-lookup"><span data-stu-id="0da37-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="0da37-173">gdzie `(your_FS_name) `jest zastępowany hello nazwa usługi federacyjnej hosta używa Twojej organizacji, na przykład fs.contoso.com.  Jeśli to możliwe tooverify z tych ustawień pomyślnie, nie dysponujesz toodo inaczej.</span><span class="sxs-lookup"><span data-stu-id="0da37-173">where `(your_FS_name) `is replaced with hello federation service host name your organization uses, such as fs.contoso.com.  If you are able tooverify both of these settings successfully, you do not have toodo anything else.</span></span>  

<span data-ttu-id="0da37-174">Przykład: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="0da37-174">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="0da37-175">Odnów token hello ręcznie podpisywania certyfikatu<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="0da37-175">Renew hello token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="0da37-176">Możesz wybrać toorenew certyfikaty podpisywania tokenu hello ręcznie.</span><span class="sxs-lookup"><span data-stu-id="0da37-176">You may choose toorenew hello token signing certificates manually.</span></span> <span data-ttu-id="0da37-177">Na przykład hello następujące scenariusze mogą działać lepiej odnowienia ręczne:</span><span class="sxs-lookup"><span data-stu-id="0da37-177">For example, hello following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="0da37-178">Certyfikaty podpisywania tokenu to certyfikaty nie podpisem.</span><span class="sxs-lookup"><span data-stu-id="0da37-178">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="0da37-179">Hello Najczęstszą przyczyną tego błędu jest to, czy Twoja organizacja zarządza certyfikatów usługi AD FS zarejestrowane od urzędu certyfikacji w organizacji.</span><span class="sxs-lookup"><span data-stu-id="0da37-179">hello most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="0da37-180">Zabezpieczenia sieci nie zezwala na toobe metadanych Federacji hello publicznie dostępne.</span><span class="sxs-lookup"><span data-stu-id="0da37-180">Network security does not allow hello federation metadata toobe publicly available.</span></span>

<span data-ttu-id="0da37-181">W tych scenariuszach za każdym razem, gdy token hello podpisywania certyfikatów, należy również zaktualizować domeną usługi Office 365 za pomocą polecenia programu PowerShell hello, MsolFederatedDomain aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="0da37-181">In these scenarios, every time you update hello token signing certificates, you must also update your Office 365 domain by using hello PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="0da37-182">Krok 1: Upewnij się, że usługi AD FS ma nowych certyfikatów podpisywania tokenu</span><span class="sxs-lookup"><span data-stu-id="0da37-182">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="0da37-183">**Inne niż domyślne konfiguracji**</span><span class="sxs-lookup"><span data-stu-id="0da37-183">**Non-default configuration**</span></span>

<span data-ttu-id="0da37-184">Jeśli używasz niedomyślna Konfiguracja usług AD FS (gdzie **AutoCertificateRollover** ustawiono zbyt**False**), są prawdopodobnie używa niestandardowych certyfikatów (nie z podpisem własnym).</span><span class="sxs-lookup"><span data-stu-id="0da37-184">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set too**False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="0da37-185">Aby uzyskać więcej informacji dotyczących sposobu toorenew hello AD FS tokenu podpisywania certyfikatów, zobacz [wskazówki dotyczące klientów nie korzystających z usług AD FS certyfikaty z podpisem własnym](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="0da37-185">For more information about how toorenew hello AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="0da37-186">**Metadane federacji nie jest publicznie dostępna**</span><span class="sxs-lookup"><span data-stu-id="0da37-186">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="0da37-187">Na hello drugiej strony, jeśli **AutoCertificateRollover** ustawiono zbyt**True**, ale z metadanych federacji nie jest dostępny publicznie, najpierw upewnij się, że nowe certyfikaty podpisywania tokenu zostały wygenerowane przez usługi AD FS.</span><span class="sxs-lookup"><span data-stu-id="0da37-187">On hello other hand, if **AutoCertificateRollover** is set too**True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="0da37-188">Upewnij się, że masz nowy token certyfikaty podpisywania przez pobieranie hello następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="0da37-188">Confirm you have new token signing certificates by taking hello following steps:</span></span>

1. <span data-ttu-id="0da37-189">Sprawdź, czy użytkownik jest zalogowany toohello głównej usługi AD FS serwera.</span><span class="sxs-lookup"><span data-stu-id="0da37-189">Verify that you are logged on toohello primary AD FS server.</span></span>
2. <span data-ttu-id="0da37-190">Sprawdź hello bieżącego podpisywania certyfikatów w usługach AD FS, otwierając okno polecenia programu PowerShell i uruchamiając hello następujące polecenie:</span><span class="sxs-lookup"><span data-stu-id="0da37-190">Check hello current signing certificates in AD FS by opening a PowerShell command window, and running hello following command:</span></span>

    <span data-ttu-id="0da37-191">PS C:\>podpisywania tokenu Get-ADFSCertificate — CertificateType</span><span class="sxs-lookup"><span data-stu-id="0da37-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="0da37-192">Jeśli korzystasz z usług AD FS 2.0, należy najpierw uruchomić Microsoft.Adfs.Powershell Dodaj-Pssnapin.</span><span class="sxs-lookup"><span data-stu-id="0da37-192">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="0da37-193">Sprawdź dane wyjściowe polecenia hello na wszystkie certyfikaty na liście.</span><span class="sxs-lookup"><span data-stu-id="0da37-193">Look at hello command output at any certificates listed.</span></span> <span data-ttu-id="0da37-194">Jeśli usługi AD FS wygenerował nowy certyfikat, powinny pojawić się dwa certyfikaty w danych wyjściowych hello: jeden dla których hello **IsPrimary** wartość jest **True** i hello **nie później niż** Data jest w ciągu 5 dni, a drugi, dla którego **IsPrimary** jest **False** i **nie później niż** dotyczy roku w przyszłości hello.</span><span class="sxs-lookup"><span data-stu-id="0da37-194">If AD FS has generated a new certificate, you should see two certificates in hello output: one for which hello **IsPrimary** value is **True** and hello **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in hello future.</span></span>
4. <span data-ttu-id="0da37-195">Jeśli tylko jeden certyfikat w temacie i hello **nie później niż** przypada w ciągu 5 dni, należy toogenerate nowego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="0da37-195">If you only see one certificate, and hello **NotAfter** date is within 5 days, you need toogenerate a new certificate.</span></span>
5. <span data-ttu-id="0da37-196">toogenerate nowego świadectwa, wykonaj następujące polecenie w wierszu polecenia programu PowerShell hello: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="0da37-196">toogenerate a new certificate, execute hello following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="0da37-197">Sprawdź hello aktualizacji, uruchamiając hello ponownie następujące polecenie: PS C:\>podpisywania tokenu Get-ADFSCertificate — CertificateType</span><span class="sxs-lookup"><span data-stu-id="0da37-197">Verify hello update by running hello following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="0da37-198">Powinien być teraz wyświetlany dwa certyfikaty, z których jedna ma **nie później niż** około co roku w przyszłości hello i dla których hello **IsPrimary** wartość jest **False**.</span><span class="sxs-lookup"><span data-stu-id="0da37-198">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in hello future, and for which hello **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-hello-new-token-signing-certificates-for-hello-office-365-trust"></a><span data-ttu-id="0da37-199">Krok 2: Zaktualizuj hello podpisywania certyfikatów dla zaufania usługi Office 365 hello nowy token.</span><span class="sxs-lookup"><span data-stu-id="0da37-199">Step 2: Update hello new token signing certificates for hello Office 365 trust</span></span>
<span data-ttu-id="0da37-200">Aktualizacja usługi Office 365 z hello nowy token podpisywania certyfikatów toobe używane dla zaufania hello w następujący sposób.</span><span class="sxs-lookup"><span data-stu-id="0da37-200">Update Office 365 with hello new token signing certificates toobe used for hello trust, as follows.</span></span>

1. <span data-ttu-id="0da37-201">Otwórz hello Microsoft Azure Active Directory modułu dla środowiska Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0da37-201">Open hello Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="0da37-202">Uruchom $cred = Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="0da37-202">Run $cred=Get-Credential.</span></span> <span data-ttu-id="0da37-203">Gdy to polecenie cmdlet wyświetla monit o podanie poświadczeń, wpisz poświadczenia konta administratora usługi chmury.</span><span class="sxs-lookup"><span data-stu-id="0da37-203">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="0da37-204">Uruchom Connect MsolService — $cred poświadczeń. To polecenie cmdlet łączy toohello usługi w chmurze.</span><span class="sxs-lookup"><span data-stu-id="0da37-204">Run Connect-MsolService –Credential $cred. This cmdlet connects you toohello cloud service.</span></span> <span data-ttu-id="0da37-205">Tworzenie kontekstu, który łączy użytkownika usługi w chmurze toohello jest wymagana przed uruchomieniem wszelkie dodatkowe polecenia cmdlet hello instalowane przez narzędzie hello.</span><span class="sxs-lookup"><span data-stu-id="0da37-205">Creating a context that connects you toohello cloud service is required before running any of hello additional cmdlets installed by hello tool.</span></span>
4. <span data-ttu-id="0da37-206">Jeśli używasz tych poleceń na komputerze, który nie jest hello usług AD FS podstawowy serwer federacyjny, uruchom zestaw MSOLAdfscontext-komputer <AD FS primary server>, gdzie <AD FS primary server> jest hello wewnętrznej nazwy FQDN hello głównej usługi AD FS serwera.</span><span class="sxs-lookup"><span data-stu-id="0da37-206">If you are running these commands on a computer that is not hello AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is hello internal FQDN name of hello primary AD FS server.</span></span> <span data-ttu-id="0da37-207">To polecenie cmdlet tworzy kontekstu, który łączy tooAD FS.</span><span class="sxs-lookup"><span data-stu-id="0da37-207">This cmdlet creates a context that connects you tooAD FS.</span></span>
5. <span data-ttu-id="0da37-208">Uruchom aktualizacji MSOLFederatedDomain — DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="0da37-208">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="0da37-209">To polecenie cmdlet ustawienia hello z usług AD FS do usługi w chmurze hello aktualizacji i konfiguruje hello relacji zaufania między dwoma hello.</span><span class="sxs-lookup"><span data-stu-id="0da37-209">This cmdlet updates hello settings from AD FS into hello cloud service, and configures hello trust relationship between hello two.</span></span>

> [!NOTE]
> <span data-ttu-id="0da37-210">Jeśli potrzebujesz toosupport wiele domen najwyższego poziomu, takich jak contoso.com i fabrikam.com, należy użyć hello **SupportMultipleDomain** przełącznik z dowolnego polecenia cmdlet.</span><span class="sxs-lookup"><span data-stu-id="0da37-210">If you need toosupport multiple top-level domains, such as contoso.com and fabrikam.com, you must use hello **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="0da37-211">Aby uzyskać więcej informacji, zobacz [Obsługa wielu domen poziom górnej](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="0da37-211">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="0da37-212">Napraw zaufania usługi Azure AD za pomocą usługi Azure AD Connect<a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="0da37-212">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="0da37-213">Jeśli farma usług AD FS, a relacja zaufania usługi Azure AD są skonfigurowane za pomocą usługi Azure AD Connect, można użyć toodetect Azure AD Connect, jeśli potrzebujesz tootake dowolną akcję dla Twojego certyfikaty podpisywania tokenu.</span><span class="sxs-lookup"><span data-stu-id="0da37-213">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect toodetect if you need tootake any action for your token signing certificates.</span></span> <span data-ttu-id="0da37-214">Toorenew hello certyfikatów, należy więc można użyć toodo Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="0da37-214">If you need toorenew hello certificates, you can use Azure AD Connect toodo so.</span></span>

<span data-ttu-id="0da37-215">Aby uzyskać więcej informacji, zobacz [naprawiania zaufania hello](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="0da37-215">For more information, see [Repairing hello trust](active-directory-aadconnect-federation-management.md).</span></span>
