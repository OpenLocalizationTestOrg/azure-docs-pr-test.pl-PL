---
title: 'Azure AD Connect: Odzyskanie bazy danych LocalDB 10 GB limit problem jak | Dokumentacja firmy Microsoft'
description: "W tym temacie opisano sposób odzyskiwania usługi Azure AD Connect usługi synchronizacji po napotkaniu LocalDB 10GB ograniczyć problem."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="e39da-103">Azure AD Connect: Jak odzyskać limitu 10 GB LocalDB</span><span class="sxs-lookup"><span data-stu-id="e39da-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="e39da-104">Program Azure AD Connect wymaga bazy danych programu SQL Server do przechowywania danych tożsamości.</span><span class="sxs-lookup"><span data-stu-id="e39da-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="e39da-105">Możesz korzystać z domyślnego programu SQL Server 2012 Express LocalDB zainstalowanego z programem Azure AD Connect lub użyć własnego pełnego programu SQL.</span><span class="sxs-lookup"><span data-stu-id="e39da-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="e39da-106">Program SQL Server Express narzuca limit rozmiaru w wysokości 10 GB.</span><span class="sxs-lookup"><span data-stu-id="e39da-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="e39da-107">Jeśli jest używany program LocalDB i limit zostanie osiągnięty, usługa synchronizacji programu Azure AD Connect nie będzie mogła uruchomić się ani prawidłowo wykonywać synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="e39da-108">Ten artykuł zawiera kroki odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="e39da-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="e39da-109">Objawy</span><span class="sxs-lookup"><span data-stu-id="e39da-109">Symptoms</span></span>
<span data-ttu-id="e39da-110">Istnieją dwa wspólne symptomy:</span><span class="sxs-lookup"><span data-stu-id="e39da-110">There are two common symptoms:</span></span>

* <span data-ttu-id="e39da-111">Azure AD Connect usługi synchronizacji **działa** , ale nie powiedzie się synchronizować z *"zatrzymana-bazy danych dysk pełny"* błędu.</span><span class="sxs-lookup"><span data-stu-id="e39da-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="e39da-112">Azure AD Connect usługi synchronizacji **nie można uruchomić**.</span><span class="sxs-lookup"><span data-stu-id="e39da-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="e39da-113">Podczas próby uruchomienie usługi pojawia się błąd zdarzeń 6323 i komunikat o błędzie *"Serwer napotkał błąd, ponieważ serwer SQL jest mało miejsca na dysku."*</span><span class="sxs-lookup"><span data-stu-id="e39da-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="e39da-114">Procedura odzyskiwania krótkoterminowego</span><span class="sxs-lookup"><span data-stu-id="e39da-114">Short-term recovery steps</span></span>
<span data-ttu-id="e39da-115">Ta sekcja zawiera kroki, aby odzyskać miejsce DB wymagane do usługa Azure AD Connect synchronizacji można wznowić operacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="e39da-116">Kroki obejmują:</span><span class="sxs-lookup"><span data-stu-id="e39da-116">The steps include:</span></span>
1. [<span data-ttu-id="e39da-117">Sprawdź stan usługi synchronizacji</span><span class="sxs-lookup"><span data-stu-id="e39da-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="e39da-118">Zmniejszyć rozmiar bazy danych</span><span class="sxs-lookup"><span data-stu-id="e39da-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="e39da-119">Usuwanie danych w historii</span><span class="sxs-lookup"><span data-stu-id="e39da-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="e39da-120">Skrócić okres przechowywania danych historii wykonywania</span><span class="sxs-lookup"><span data-stu-id="e39da-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="e39da-121">Sprawdź stan usługi synchronizacji</span><span class="sxs-lookup"><span data-stu-id="e39da-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="e39da-122">Po pierwsze należy ustalić, czy usługi synchronizacji jest nadal uruchomiona lub nie:</span><span class="sxs-lookup"><span data-stu-id="e39da-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="e39da-123">Zaloguj się do serwera usługi Azure AD Connect jako administrator.</span><span class="sxs-lookup"><span data-stu-id="e39da-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="e39da-124">Przejdź do **Menedżera sterowania usługami**.</span><span class="sxs-lookup"><span data-stu-id="e39da-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="e39da-125">Sprawdź stan **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="e39da-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="e39da-126">Jeśli została uruchomiona, nie zatrzymać lub uruchomić ponownie usługę.</span><span class="sxs-lookup"><span data-stu-id="e39da-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="e39da-127">Pomiń [zmniejszyć rozmiar bazy danych](#shrink-the-database) krok i przejdź do [Delete Uruchom dane historii](#delete-run-history-data) kroku.</span><span class="sxs-lookup"><span data-stu-id="e39da-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="e39da-128">Jeśli nie jest uruchomiona, spróbuj uruchomić usługę.</span><span class="sxs-lookup"><span data-stu-id="e39da-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="e39da-129">Jeśli usługa zostanie uruchomiony pomyślnie, Pomiń [zmniejszyć rozmiar bazy danych](#shrink-the-database) krok i przejdź do [Delete Uruchom dane historii](#delete-run-history-data) kroku.</span><span class="sxs-lookup"><span data-stu-id="e39da-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="e39da-130">W przeciwnym razie kontynuuj [zmniejszyć rozmiar bazy danych](#shrink-the-database) kroku.</span><span class="sxs-lookup"><span data-stu-id="e39da-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="e39da-131">Zmniejszyć rozmiar bazy danych</span><span class="sxs-lookup"><span data-stu-id="e39da-131">Shrink the database</span></span>
<span data-ttu-id="e39da-132">Za pomocą operacji zmniejszania rozmiaru w celu zwolnienia miejsca bazy danych można uruchomić usługi synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="e39da-133">Zwalnia jego miejsce DB przez usunięcie odstępy w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="e39da-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="e39da-134">Ten krok jest optymalnych, ponieważ nie gwarantuje, że zawsze przeprowadza odzyskiwanie miejsca.</span><span class="sxs-lookup"><span data-stu-id="e39da-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="e39da-135">Aby dowiedzieć się więcej na temat operacji zmniejszania, przeczytaj ten artykuł [baza danych](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="e39da-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e39da-136">Pomiń ten krok, jeśli zostanie wyświetlony do uruchamiania usługi synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="e39da-137">Nie zaleca się zmniejszanie bazy danych SQL, ponieważ może to prowadzić do niskiej wydajności z powodu fragmentacji zwiększona.</span><span class="sxs-lookup"><span data-stu-id="e39da-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="e39da-138">Nazwa bazy danych, utworzonych dla usługi Azure AD Connect jest **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="e39da-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="e39da-139">Aby wykonać operację zmniejszania, należy zalogować się jako administratora systemu lub właściciela bazy danych.</span><span class="sxs-lookup"><span data-stu-id="e39da-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="e39da-140">Podczas instalacji usługi Azure AD Connect następujące konta mają prawa administratora systemu:</span><span class="sxs-lookup"><span data-stu-id="e39da-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="e39da-141">Administratorzy lokalni</span><span class="sxs-lookup"><span data-stu-id="e39da-141">Local Administrators</span></span>
* <span data-ttu-id="e39da-142">Konto użytkownika, którego użyto do uruchomienia instalacji Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="e39da-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="e39da-143">Konto usługi synchronizacji, które jest używane jako kontekst operacyjny usługi Azure AD Connect synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="e39da-144">Lokalne grupy ADSyncAdmins, który został utworzony podczas instalacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="e39da-145">Utwórz kopię zapasową bazy danych przez skopiowanie **ADSync.mdf** i **ADSync_log.ldf** pliki znajdujące się w obszarze `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` do bezpiecznej lokalizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="e39da-146">Rozpocznij nową sesję programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e39da-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="e39da-147">Przejdź do folderu `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="e39da-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="e39da-148">Uruchom **sqlcmd** narzędzia, uruchamiając polecenie `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, przy użyciu poświadczeń administratora systemu lub bazy danych DBO.</span><span class="sxs-lookup"><span data-stu-id="e39da-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="e39da-149">Aby zmniejszyć rozmiar bazy danych, w wierszu polecenia sqlcmd (1 >), wprowadź `DBCC Shrinkdatabase(ADSync,1);`, a następnie `GO` w następnym wierszu.</span><span class="sxs-lookup"><span data-stu-id="e39da-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="e39da-150">Jeśli operacja się powiodła, spróbuj uruchomić ponownie usługi synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="e39da-151">Jeśli można uruchomić usługi synchronizacji, przejdź do [Delete Uruchom dane historii](#delete-run-history-data) kroku.</span><span class="sxs-lookup"><span data-stu-id="e39da-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="e39da-152">Jeśli nie, skontaktuj się z pomocą techniczną.</span><span class="sxs-lookup"><span data-stu-id="e39da-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="e39da-153">Usuwanie danych w historii</span><span class="sxs-lookup"><span data-stu-id="e39da-153">Delete run history data</span></span>
<span data-ttu-id="e39da-154">Domyślnie program Azure AD Connect przechowuje siedem dni, przez które Historia uruchomień danych.</span><span class="sxs-lookup"><span data-stu-id="e39da-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="e39da-155">W tym kroku usunąć dane Historia uruchomień, aby odzyskać miejsce bazy danych, dzięki czemu usługi Azure AD Connect usługi synchronizacji można uruchomić ponownie przeprowadzić synchronizację.</span><span class="sxs-lookup"><span data-stu-id="e39da-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="e39da-156">Uruchom **Menedżera usługi synchronizacji** , przechodząc do rozpoczęcia → usługi synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="e39da-157">Przejdź do **operacji** kartę.</span><span class="sxs-lookup"><span data-stu-id="e39da-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="e39da-158">W obszarze **akcje**, wybierz pozycję **uruchamia wyczyść**...</span><span class="sxs-lookup"><span data-stu-id="e39da-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="e39da-159">Możesz wybrać **wyczyść wszystkie elementy** lub **wyczyść jest uruchamiany przed... <date>**  opcji.</span><span class="sxs-lookup"><span data-stu-id="e39da-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="e39da-160">Zaleca się uruchamiania czyszcząc Uruchom historyczne dane, które są starsze niż dwa dni.</span><span class="sxs-lookup"><span data-stu-id="e39da-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="e39da-161">Jeśli będziesz kontynuować funkcjonowaniem problem rozmiar bazy danych, należy wybrać **wyczyść wszystkie elementy** opcji.</span><span class="sxs-lookup"><span data-stu-id="e39da-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="e39da-162">Skrócić okres przechowywania danych historii wykonywania</span><span class="sxs-lookup"><span data-stu-id="e39da-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="e39da-163">Ten krok jest aby zmniejszyć prawdopodobieństwo powodowania problem limitu 10 GB po wielu cykli synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="e39da-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="e39da-164">Otwórz nową sesję programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e39da-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="e39da-165">Uruchom `Get-ADSyncScheduler` i zwróć właściwość PurgeRunHistoryInterval, która określa bieżącego okresu przechowywania.</span><span class="sxs-lookup"><span data-stu-id="e39da-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="e39da-166">Uruchom `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` można ustawić okresu przechowywania do dwóch dni.</span><span class="sxs-lookup"><span data-stu-id="e39da-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="e39da-167">Dostosuj okres przechowywania, zależnie od potrzeb.</span><span class="sxs-lookup"><span data-stu-id="e39da-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="e39da-168">Długoterminowe rozwiązanie — migracja do pełnego SQL</span><span class="sxs-lookup"><span data-stu-id="e39da-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="e39da-169">Ogólnie rzecz biorąc problem jest wskaźnikiem, że rozmiar 10 GB bazy danych nie jest już wystarczające dla usługi Azure AD Connect do synchronizowania z lokalnej usługi Active Directory do usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e39da-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="e39da-170">Zalecane jest, aby przełączyć się do pełnej wersji programu SQL server.</span><span class="sxs-lookup"><span data-stu-id="e39da-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="e39da-171">Nie można bezpośrednio zastąpić programu LocalDB istniejącego wdrożenia programu Azure AD Connect za pomocą pełnej wersji programu SQL.</span><span class="sxs-lookup"><span data-stu-id="e39da-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="e39da-172">Zamiast tego należy wdrożyć nowy serwer programu Azure AD Connect z pełną wersją programu SQL.</span><span class="sxs-lookup"><span data-stu-id="e39da-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="e39da-173">Zalecana jest migracja typu swing, gdzie nowy serwer programu Azure AD Connect (z bazą danych w programie SQL) jest wdrażany jako serwer przejściowy obok istniejącego serwera programu Azure AD Connect (z programem LocalDB).</span><span class="sxs-lookup"><span data-stu-id="e39da-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="e39da-174">Instrukcje dotyczące konfigurowania zdalnego programu SQL pod kątem programu Azure AD Connect znajdują się w artykule [Niestandardowa instalacja programu Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="e39da-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="e39da-175">Instrukcje dotyczące migracji typu swing w ramach uaktualniania programu Azure AD Connect znajdują się w artykule [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration) (Azure AD Connect: Uaktualnianie z poprzedniej wersji do najnowszej).</span><span class="sxs-lookup"><span data-stu-id="e39da-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e39da-176">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="e39da-176">Next steps</span></span>
<span data-ttu-id="e39da-177">Dowiedz się więcej na temat [integrowania tożsamości lokalnych z usługą Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="e39da-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
