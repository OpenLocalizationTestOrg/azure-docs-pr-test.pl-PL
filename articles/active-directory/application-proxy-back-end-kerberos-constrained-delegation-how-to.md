---
title: "tooconfigure aaaHow toouse aplikacji serwera Proxy aplikacji ograniczone delegowanie protokołu Kerberos | Dokumentacja firmy Microsoft"
description: "Jak tooconfigure ograniczone delegowanie protokołu Kerberos dla aplikacji serwera Proxy aplikacji usługi Azure AD."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="e8903-103">Jak tooconfigure toouse aplikacji serwera Proxy aplikacji ograniczone delegowanie protokołu Kerberos</span><span class="sxs-lookup"><span data-stu-id="e8903-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="e8903-104">Witaj dostępnych metod na osiągnięcie toopublished logowania jednokrotnego, które aplikacje może różnić się nieco od tooapplication aplikacji i jedną z opcji hello, że serwer Proxy aplikacji Azure oferuje prawa fabrycznej hello, jest delegowanie ograniczone protokołu Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="e8903-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="e8903-105">Jest to, gdzie hosta łącznik jest skonfigurowany tooperform ograniczonego protokołu kerberos uwierzytelniania toobackend aplikacji, w imieniu użytkowników.</span><span class="sxs-lookup"><span data-stu-id="e8903-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="e8903-106">rzeczywiste procedura Hello włączania KCD jest stosunkowo prosta i zwykle wymaga nie więcej niż ogólną wiedzą hello różnymi składnikami i przebieg uwierzytelniania, która ułatwia obsługę logowania jednokrotnego.</span><span class="sxs-lookup"><span data-stu-id="e8903-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="e8903-107">Znajdowania dobre źródła informacji toohelp Rozwiązywanie problemów z scenariuszy, w którym KCD logowania jednokrotnego nie działać zgodnie z oczekiwaniami, może być rozrzedzony.</span><span class="sxs-lookup"><span data-stu-id="e8903-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="e8903-108">Tak w tym artykule prób tooprovide pojedynczy punkt odniesienia, które powinny pomóc w Rozwiązywanie problemów i samodzielnie rozwiązać niektóre hello najbardziej typowe problemy, które widzimy.</span><span class="sxs-lookup"><span data-stu-id="e8903-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="e8903-109">Witaj tym samym czasie oferta dodatkowe wskazówki dotyczące diagnozowania hello bardziej złożone i plików implementacji.</span><span class="sxs-lookup"><span data-stu-id="e8903-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="e8903-110">należy pamiętać, że w tym artykule sprawia, że następujące założenia hello:</span><span class="sxs-lookup"><span data-stu-id="e8903-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="e8903-111">Serwera Proxy aplikacji Azure została wdrożona jako na naszych [dokumentacji](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) i aplikacje KCD toonon dostępu działa zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="e8903-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="e8903-112">Witaj aplikacji docelowej opublikowanych zależy od usług IIS i przez firmę Microsoft implementacja protokołu kerberos.</span><span class="sxs-lookup"><span data-stu-id="e8903-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="e8903-113">host serwera i aplikacji Hello znajdują się w jednej domenie usługi Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e8903-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="e8903-114">Szczegółowe informacje dotyczące wielu domen i lasów scenariusze można znaleźć w naszych [oficjalny dokument KCD](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="e8903-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="e8903-115">Witaj podmiotu jest publikowana w Azure dzierżawcy z wstępne uwierzytelnianie jest włączone, a użytkownicy są oczekiwano uwierzytelniania opartego na tooAzure tooauthenticate za pomocą formularzy.</span><span class="sxs-lookup"><span data-stu-id="e8903-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="e8903-116">Scenariusze uwierzytelniania klienta sformatowanego nie są objęte w tym artykule, ale można dodać w pewnym momencie w przyszłości hello.</span><span class="sxs-lookup"><span data-stu-id="e8903-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="e8903-117">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="e8903-117">Prerequisites</span></span>

<span data-ttu-id="e8903-118">Serwer Proxy aplikacji Azure można wdrożyć do niemal każdego rodzaju infrastruktury lub architektury środowiska i hello bez wątpienia się różnić od tooorganization organizacji.</span><span class="sxs-lookup"><span data-stu-id="e8903-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="e8903-119">Jedną z najbardziej typowych przyczyn KCD hello powiązanych problemy nie jest hello, ale zamiast prostego niewłaściwa konfiguracje lub w środowiskach ogólne nadzoru.</span><span class="sxs-lookup"><span data-stu-id="e8903-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="e8903-120">Z tego powodu informacjami jest zawsze toostart przy tym upewnić się, czy zostały spełnione wszystkie wymagania wstępne hello, którego układ określa się w naszym głównym [przy użyciu logowania jednokrotnego KCD z artykułem serwera Proxy aplikacji hello](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) przed rozpoczęciem rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="e8903-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="e8903-121">Szczególnie hello sekcję na temat konfigurowania KCD na 2012 R2, jak to wykorzystuje tooconfiguring zasadniczo różne podejścia KCD w poprzednich wersjach systemu Windows, ale także będąc w trosce o kilka innych kwestii:</span><span class="sxs-lookup"><span data-stu-id="e8903-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="e8903-122">Nie jest nietypowe dla domeny tooopen serwera członkowskiego okno dialogowe bezpiecznego kanału z określonego kontrolera domeny.</span><span class="sxs-lookup"><span data-stu-id="e8903-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="e8903-123">Następnie przenieś okno tooanother w danym momencie, więc hostów łącznika zazwyczaj nie powinno być możliwe toocommunicate toobeing ograniczone z kontrolerów domeny tylko do określonej lokacji lokalnej.</span><span class="sxs-lookup"><span data-stu-id="e8903-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="e8903-124">Podobne toohello powyżej, scenariusze obejmujące różne domeny korzystają z odwołań, które bezpośrednie łącznika tooDCs hosta, które mogą znajdować się poza hello lokalnej sieci obwodowej.</span><span class="sxs-lookup"><span data-stu-id="e8903-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="e8903-125">W tym scenariuszu, który jest równie ważne toomake się, że także umożliwi ruchu lub nowszej tooDCs reprezentujące innych domen, w przeciwnym razie delegowania zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="e8903-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="e8903-126">Jeśli to możliwe, należy unikać wprowadzania żadnych aktywnych urządzeń adresy IP/Identyfikatory między hostami łącznika i kontrolery domeny, jak te są czasami za pośrednictwem niepożądanych i zakłócić ruch RPC core</span><span class="sxs-lookup"><span data-stu-id="e8903-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="e8903-127">Tyle szybko chcielibyśmy tooresolve problemów i ostatecznie może trwać, dlatego w miarę możliwości należy spróbuj i przetestować delegowania w najprostszym scenariuszy hello.</span><span class="sxs-lookup"><span data-stu-id="e8903-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="e8903-128">Witaj więcej zmiennych, które należy wprowadzić, hello więcej może być toocontend z.</span><span class="sxs-lookup"><span data-stu-id="e8903-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="e8903-129">Na przykład ograniczenie testowania pojedynczy łącznik tooa można zapisać cenny czas, a po rozwiązaniu problemów hello można dodać dodatkowe łączników.</span><span class="sxs-lookup"><span data-stu-id="e8903-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="e8903-130">Pewne czynniki środowiska może również być przyczyną tooan problem, więc ponownie Jeśli to możliwe spróbuj i zminimalizować hello architektura tooa bez systemu operacyjnego co najmniej do testowania.</span><span class="sxs-lookup"><span data-stu-id="e8903-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="e8903-131">Na przykład nie są rzadko nieprawidłowej konfiguracji zapory wewnętrznej listy kontroli dostępu, więc jeśli to możliwe mieć cały ruch z łącznika może bezpośrednio za pomocą toohello kontrolerów domeny i wewnętrznej bazy danych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e8903-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="e8903-132">Faktycznie hello bezwzględną najlepsze miejsce tooposition łączników jest możliwie cele tootheir jako może być.</span><span class="sxs-lookup"><span data-stu-id="e8903-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="e8903-133">Wbudowany zapory nas o podczas testowania, po prostu dodaje niepotrzebne złożoność i właśnie przedłużyć czas badania sieci.</span><span class="sxs-lookup"><span data-stu-id="e8903-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="e8903-134">Tak co stanowi KCD problem mimo to?</span><span class="sxs-lookup"><span data-stu-id="e8903-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="e8903-135">Dobrze istnieje kilka klasycznego oznaczenia logowania jednokrotnego KCD się niepowodzeniem i hello pierwszy oznaki problemu zwykle pojawiają się w hello przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="e8903-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Błąd konfiguracji KCD niepoprawne](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Autoryzacja nie powiodła z powodu uprawnień toomissing](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="e8903-138">wszystkie, które posiadają hello objawem tego samego niepowodzeniem tooperform logowania jednokrotnego i w związku z tym odmawia hello aplikacji toohello dostępu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="e8903-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="e8903-139">Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="e8903-139">Troubleshooting</span></span>

<span data-ttu-id="e8903-140">W jaki sposób można następnie Rozwiąż ten problem są zależne od hello problem i obserwowanych objawów.</span><span class="sxs-lookup"><span data-stu-id="e8903-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="e8903-141">Przed każdym przechodzi dalej czy Sugerujemy hello następującego łącza, ponieważ zawierają one przydatne informacje, które użytkownik może nie ma wszedł w:</span><span class="sxs-lookup"><span data-stu-id="e8903-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="e8903-142">Rozwiązywanie problemów z serwera Proxy aplikacji i komunikaty o błędach</span><span class="sxs-lookup"><span data-stu-id="e8903-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="e8903-143">Błędy protokołu Kerberos i objawy</span><span class="sxs-lookup"><span data-stu-id="e8903-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="e8903-144">Praca z logowania jednokrotnego podczas lokalnej i w chmurze tożsamości nie są identyczne</span><span class="sxs-lookup"><span data-stu-id="e8903-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="e8903-145">Jeśli masz to znacznie, a następnie hello głównego ostatecznie występuje problem.</span><span class="sxs-lookup"><span data-stu-id="e8903-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="e8903-146">Należy toodig głębiej, więc start oddzielając przepływu hello w trzech etapach distinct, które można rozwiązywać problemy.</span><span class="sxs-lookup"><span data-stu-id="e8903-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="e8903-147">**Wstępne uwierzytelnienie klienta** -hello użytkownika zewnętrznego uwierzytelniania tooAzure za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="e8903-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="e8903-148">Trwa stanie toopre-uwierzytelniania jest tooAzure dla toofunction KCD logowania jednokrotnego.</span><span class="sxs-lookup"><span data-stu-id="e8903-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="e8903-149">Powinno to przetestowane i skierowana najpierw, jeśli występują problemy.</span><span class="sxs-lookup"><span data-stu-id="e8903-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="e8903-150">Należy pamiętać, że hello etapu uwierzytelniania wstępnego nie ma relacji tooKCD ani hello opublikowana aplikacja.</span><span class="sxs-lookup"><span data-stu-id="e8903-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="e8903-151">Powinien być dość proste toocorrect niezgodności przez związane z poprawnością sprawdzanie hello podmiotu konto istnieje w systemie Azure i nie jest wyłączone/zablokowany.</span><span class="sxs-lookup"><span data-stu-id="e8903-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="e8903-152">odpowiedzi na błąd Hello w przeglądarce hello jest zazwyczaj dość opisowa toounderstand hello przyczyna.</span><span class="sxs-lookup"><span data-stu-id="e8903-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="e8903-153">Jeśli nie masz pewności, można również sprawdzić naszych innych tooverify docs Rozwiązywanie problemów.</span><span class="sxs-lookup"><span data-stu-id="e8903-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="e8903-154">**Delegowanie usługi** — Witaj łącznika serwera Proxy Azure uzyskania biletu usługi kerberos w Centrum dystrybucji KLUCZY (Centrum dystrybucji protokołu Kerberos), w imieniu użytkowników.</span><span class="sxs-lookup"><span data-stu-id="e8903-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="e8903-155">komunikację zewnętrzną Hello między powitania klienta i hello Azure frontonu powinny nie ma wpływu na KCD, inne niż zapewnienia jego działanie.</span><span class="sxs-lookup"><span data-stu-id="e8903-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="e8903-156">Jest to tak hello usługi serwera Proxy Azure można podać prawidłowy identyfikator, którego można używane tooobtain biletu protokołu kerberos.</span><span class="sxs-lookup"><span data-stu-id="e8903-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="e8903-157">Bez tego KCD nie jest możliwe, a nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="e8903-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="e8903-158">Jak wspomniano wcześniej, komunikaty o błędach przeglądarki hello zwykle zawierają niektóre dobrej wskazówek Dlaczego rzeczy kończą się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="e8903-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="e8903-159">Upewnij się, że toonote hello identyfikator działania i sygnatura czasowa w odpowiedzi hello, jak dzięki temu można toocorrelate hello zachowanie tooactual zdarzenia w dzienniku zdarzeń serwera Proxy Azure hello.</span><span class="sxs-lookup"><span data-stu-id="e8903-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Błąd konfiguracji KCD niepoprawne](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="e8903-161">I dziennik zdarzeń widziany hello odpowiednie wpisy hello będzie widoczne jako zdarzenia 13019 lub 12027.</span><span class="sxs-lookup"><span data-stu-id="e8903-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="e8903-162">Możesz znaleźć hello łącznika dzienniki zdarzeń w **Dzienniki aplikacji i usług** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Łącznik**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="e8903-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Zdarzenie 13019 z dziennika zdarzeń serwera Proxy aplikacji](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Zdarzenie 12027 z dziennika zdarzeń serwera Proxy aplikacji](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="e8903-165">Na użytek rekord A w systemie DNS wewnętrznych aplikacji hello adresów, a nie rekordu CName</span><span class="sxs-lookup"><span data-stu-id="e8903-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="e8903-166">Ponownie Potwierdź obsługujących łącznik hello udzielono toohello toodelegate prawa Witaj wyznaczone konto docelowe głównej nazwy usługi, a **Użyj dowolnego protokołu uwierzytelniania** jest zaznaczone.</span><span class="sxs-lookup"><span data-stu-id="e8903-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="e8903-167">Ten temat znajdują się w naszym głównym [artykułu konfiguracji logowania jednokrotnego](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="e8903-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="e8903-168">Sprawdź, czy jest tylko jedno wystąpienie hello SPN istniejących w AD przez wystawienie **setspn - x** z wiersza polecenia na żadnym hoście członek domeny</span><span class="sxs-lookup"><span data-stu-id="e8903-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="e8903-169">Sprawdź toosee, jeśli zasady domeny jest wymuszane toolimit hello [maksymalny rozmiar kerberos wystawionych tokenów](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), ponieważ ten łącznik hello uniemożliwianie uzyskania tokenu, jeśli znaleziono toobe nadmiernego</span><span class="sxs-lookup"><span data-stu-id="e8903-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="e8903-170">Przechwytywanie hello wymiany między hello łącznika hosta i domeny Centrum dystrybucji KLUCZY śledzenia sieci będzie wówczas hello następnego kroku najlepsze w uzyskaniu więcej niski poziom szczegółów na powitania problemy.</span><span class="sxs-lookup"><span data-stu-id="e8903-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="e8903-171">Można je znaleźć w [nowości papieru rozwiązywanie](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="e8903-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="e8903-172">Jeśli biletów wygląda dobrze, powinny pojawić się zdarzenia w dziennikach hello podając uwierzytelniania nie powiodła z powodu aplikacji toohello zwracającej 401.</span><span class="sxs-lookup"><span data-stu-id="e8903-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="e8903-173">Oznacza to przeważnie tej aplikacji docelowej hello odrzucenia biletu, więc kontynuować powitania po kolejnego etapu.</span><span class="sxs-lookup"><span data-stu-id="e8903-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="e8903-174">**Aplikacji docelowej** -konsumenta hello biletu kerberos hello podał hello łącznika</span><span class="sxs-lookup"><span data-stu-id="e8903-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="e8903-175">Ten łącznik hello etap są oczekiwanego toohave przesyłane protokołu kerberos usługa biletu toohello wewnętrznej bazie danych, jako nagłówek w pierwsze żądanie aplikacji hello.</span><span class="sxs-lookup"><span data-stu-id="e8903-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="e8903-176">Przy użyciu aplikacji hello wewnętrzny adres URL zdefiniowany w portalu hello, sprawdzić, czy aplikacja hello jest dostępny bezpośrednio z przeglądarki hello na powitania łącznika hosta.</span><span class="sxs-lookup"><span data-stu-id="e8903-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="e8903-177">Następnie możesz zalogować się pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="e8903-177">Then you can login successfully.</span></span> <span data-ttu-id="e8903-178">Szczegóły w ten sposób można znaleźć na stronie Rozwiązywanie problemów dotyczących łącznika hello.</span><span class="sxs-lookup"><span data-stu-id="e8903-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="e8903-179">Nadal na hoście łącznika hello, potwierdź hello uwierzytelniania między hello przeglądarki, a aplikacja hello używa protokołu kerberos, wykonując jedną z następujących hello:</span><span class="sxs-lookup"><span data-stu-id="e8903-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="e8903-180">Uruchamianie narzędzi dla deweloperów (**F12**) w programie Internet Explorer lub użyj [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) z hello łącznika hosta.</span><span class="sxs-lookup"><span data-stu-id="e8903-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="e8903-181">Przejdź toohello aplikacji przy użyciu wewnętrznego adresu URL hello i inspekcję hello oferowane nagłówki autoryzacji WWW zwracany w odpowiedzi hello z aplikacji hello, występuje tooensure, który albo negocjowania lub kerberos.</span><span class="sxs-lookup"><span data-stu-id="e8903-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="e8903-182">Obiektu blob kolejnych kerberos zwracany w odpowiedzi hello z toohello przeglądarki hello aplikacji zaczynają się zwykle **YII**, więc jest dobrym wskaźnikiem w play protokołu kerberos.</span><span class="sxs-lookup"><span data-stu-id="e8903-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="e8903-183">NTLM na powitania drugiej zawsze rozpoczynają się **TlRMTVNTUAAB**, która odczytuje NTLMSSP podczas zdekodować z formatu Base64.</span><span class="sxs-lookup"><span data-stu-id="e8903-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="e8903-184">Jeśli widzisz **TlRMTVNTUAAB** na początku hello hello obiektów blob, oznacza to, że protokół Kerberos jest **nie** dostępne.</span><span class="sxs-lookup"><span data-stu-id="e8903-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="e8903-185">Jeśli widzisz, prawdopodobnie Kerberos dostępne.</span><span class="sxs-lookup"><span data-stu-id="e8903-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="e8903-186">Uwaga: Jeśli przy użyciu programu Fiddler, ta metoda wymaga czasowo wyłączyć ochrona rozszerzona na konfiguracji aplikacji hello w usługach IIS.</span><span class="sxs-lookup"><span data-stu-id="e8903-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Przeglądarce inspekcji sieci](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="e8903-188">*Rysunek:* ponieważ to nie rozpoczyna się od TIRMTVNTUAAB, jest to przykład, że protokół Kerberos jest dostępne.</span><span class="sxs-lookup"><span data-stu-id="e8903-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="e8903-189">To jest przykład obiektu Blob protokołu Kerberos, który nie zaczyna się od YII.</span><span class="sxs-lookup"><span data-stu-id="e8903-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="e8903-190">Tymczasowo usunąć NTLM, z listy dostawców hello w lokacji i dostępu do aplikacji IIS bezpośrednio z programu Internet Explorer na hoście łącznika.</span><span class="sxs-lookup"><span data-stu-id="e8903-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="e8903-191">NTLM nie jest już na liście dostawców hello użytkownik powinien być aplikacji hello tooaccess możliwe tylko przy użyciu protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="e8903-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="e8903-192">Jeśli to się nie powiedzie, następnie które sugeruje, że występuje problem z konfiguracją aplikacji hello i uwierzytelnianie Kerberos nie działa.</span><span class="sxs-lookup"><span data-stu-id="e8903-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="e8903-193">Jeśli protokołu Kerberos nie jest dostępna, uwierzytelniania aplikacji hello wyboru negocjowania ustawienia w IIS toomake się, że jest wyświetlane najwyżej z NTLM tuż poniżej.</span><span class="sxs-lookup"><span data-stu-id="e8903-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="e8903-194">(Nie Negotiate: kerberos lub Negotiate: protokołu PKU2U).</span><span class="sxs-lookup"><span data-stu-id="e8903-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="e8903-195">Nadal tylko, jeśli protokół Kerberos jest funkcjonalności.</span><span class="sxs-lookup"><span data-stu-id="e8903-195">Only continue if Kerberos is functional.</span></span>

   ![Dostawców uwierzytelniania systemu Windows](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="e8903-197">Z protokołu Kerberos i NTLM w miejscu umożliwia teraz tymczasowo wyłączyć wstępnego uwierzytelniania dla aplikacji hello w portalu hello.</span><span class="sxs-lookup"><span data-stu-id="e8903-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="e8903-198">Zobacz, czy można do niego dostęp z hello Internetem przy użyciu hello zewnętrznego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="e8903-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="e8903-199">Powinny być tooauthenticate zostanie wyświetlony monit o i powinna być toodo może więc z hello tego samego konta hello używany w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="e8903-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="e8903-200">Jeśli nie, to oznacza problem z hello zaplecza aplikacji i nie KCD w ogóle.</span><span class="sxs-lookup"><span data-stu-id="e8903-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="e8903-201">Teraz ponownie włączyć wstępnego uwierzytelniania w portalu hello i uwierzytelniania za pośrednictwem platformy Azure przez podejmowanie próby tooconnect toohello aplikacji za pomocą jego zewnętrznego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="e8903-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="e8903-202">Logowanie Jednokrotne nie powiodło się, należy Zobacz niedozwolonych komunikat w przeglądarce hello, a także zdarzenia 13022 w dzienniku hello:</span><span class="sxs-lookup"><span data-stu-id="e8903-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="e8903-203">*Łącznik serwera Proxy aplikacji usługi Microsoft AAD nie może uwierzytelnić użytkownika hello, ponieważ powitania serwera wewnętrznej bazy danych odpowiada tooKerberos prób uwierzytelnienia z powodu błędu HTTP 401.*</span><span class="sxs-lookup"><span data-stu-id="e8903-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Dostęp zabroniony błąd 401 HTTTP](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="e8903-205">Sprawdź, pula aplikacji hello skonfigurowane tooensure hello usług IIS aplikacji hello toouse skonfigurowany, tego samego konta, które hello SPN zostały skonfigurowane przed w usłudze AD, przechodząc w usługach IIS, jak przedstawiono poniżej</span><span class="sxs-lookup"><span data-stu-id="e8903-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![Okno konfiguracji aplikacji usług IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="e8903-207">Znając tożsamości hello, należy wydać następujące powitania od cmd monitu toomake się, że to konto jest konfigurowana ostatecznie hello SPN w.</span><span class="sxs-lookup"><span data-stu-id="e8903-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="e8903-208">Na przykład **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="e8903-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![Okno polecenia SetSPN](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="e8903-210">Sprawdź, że hello SPN zdefiniowane w odniesieniu do ustawień aplikacji hello w portalu hello jest hello tej samej nazwy SPN skonfigurowanego przed hello docelowe AD konto używane przez pulę aplikacji hello aplikacji</span><span class="sxs-lookup"><span data-stu-id="e8903-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![Konfiguracja SPN w portalu Azure](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="e8903-212">Przejdź do usług IIS i wybierz hello **edytora konfiguracji** opcję dla aplikacji hello, a następnie przejdź zbyt**system.webServer/security/authentication/windowsAuthentication** toomake się tym **UseAppPoolCredentials** ustawiono tootrue</span><span class="sxs-lookup"><span data-stu-id="e8903-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![Opcja credential pul aplikacji konfiguracji usług IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="e8903-214">Podczas jest przydatny do zwiększania wydajności hello operacji protokołu Kerberos, pozostawiając włączono obsługę trybu jądra powoduje także, że bilet hello na powitania żądanej usługi toobe odszyfrować za pomocą konta komputera.</span><span class="sxs-lookup"><span data-stu-id="e8903-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="e8903-215">Jest to również hello systemu lokalnego, więc o tego podziału tootrue zestaw KCD, gdy aplikacja hello jest obsługiwana na wielu serwerach w farmie.</span><span class="sxs-lookup"><span data-stu-id="e8903-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="e8903-216">Jako dodatkową kontrolę, można również toodisable hello **rozszerzone** ochrony zbyt.</span><span class="sxs-lookup"><span data-stu-id="e8903-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="e8903-217">Było napotkano scenariuszy, w którym okazało toobreak KCD po włączeniu w bardzo określonej konfiguracji, gdy aplikacja jest publikowany jako podfolderem folderu hello domyślnej witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="e8903-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="e8903-218">Ten sam jest skonfigurowany do uwierzytelniania anonimowego, pozostawiając całego okna dialogowe hello nieaktywna co sugeruje, że obiekty podrzędne nie będzie dziedziczy wszystkie aktywne ustawienia.</span><span class="sxs-lookup"><span data-stu-id="e8903-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="e8903-219">Jednak gdy możliwości zawsze zalecamy posiadanie to włączone, więc wszelkimi środkami testu, ale nie zapomnij toorestore to tooenabled.</span><span class="sxs-lookup"><span data-stu-id="e8903-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="e8903-220">Te dodatkowe kontrole powinny umieszczono należy na toostart Śledź przy użyciu opublikowanych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e8903-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="e8903-221">Można przejść od razu pokrętła się dodatkowe łączniki, które są również skonfigurowana toodelegate, ale jeśli nie musisz kwestie następnie będzie Sugerujemy odczytu naszych bardziej szczegółowym opisem technicznym [hello kompletny przewodnik po Rozwiązywanie problemów z usługi Azure AD aplikacji Serwer proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="e8903-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="e8903-222">Jeśli nadal tooprogress problemu, pomocy technicznej może być większa niż tooassist wszystkiego i kontynuować w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="e8903-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="e8903-223">Tworzenie biletu pomocy technicznej bezpośrednio z poziomu portalu hello i naszych inżynierów będzie dotrzeć tooyou.</span><span class="sxs-lookup"><span data-stu-id="e8903-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="e8903-224">Inne scenariusze</span><span class="sxs-lookup"><span data-stu-id="e8903-224">Other scenarios</span></span>

-   <span data-ttu-id="e8903-225">Serwera Proxy aplikacji Azure żądania biletu Kerberos przed wysłaniem jej stosowania tooan żądania.</span><span class="sxs-lookup"><span data-stu-id="e8903-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="e8903-226">Niektóre 3 aplikacje firm, takich jak Tableau serwera nie chcesz, aby ta metoda uwierzytelniania, a raczej oczekuje więcej z konwencjonalnej hello miejsce tootake negocjacji.</span><span class="sxs-lookup"><span data-stu-id="e8903-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="e8903-227">pierwsze żądanie Hello jest anonimowy, dzięki czemu toorespond aplikacji hello hello typów uwierzytelniania, które obsługuje za pośrednictwem 401.</span><span class="sxs-lookup"><span data-stu-id="e8903-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="e8903-228">Podwójny przeskok uwierzytelnianie — często używane w scenariuszach, w którym warstwy aplikacji z wewnętrznej bazy danych i front end wymagające uwierzytelniania, takich jak SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="e8903-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e8903-229">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="e8903-229">Next steps</span></span>
[<span data-ttu-id="e8903-230">Skonfiguruj ograniczone delegowanie protokołu kerberos (KCD) do domeny zarządzanej</span><span class="sxs-lookup"><span data-stu-id="e8903-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
