---
title: "toobuild aaaHow aplikacji, które można zarejestrować się w każdy użytkownik usługi Azure AD | Dokumentacja firmy Microsoft"
description: "Krok po kroku instrukcje tworzenia aplikacji, które można zalogować użytkownika z dowolnej dzierżawy usługi Azure Active Directory nazywanego także wielodostępnych aplikacji."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 123ea8125fa3c308ce0f124cc58e85ec28d476d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="how-toosign-in-any-azure-active-directory-ad-user-using-hello-multi-tenant-application-pattern"></a><span data-ttu-id="baa9e-103">Jak toosign w dowolnej usługi Azure Active Directory (AD) użytkownika za pomocą hello wzorzec wielodostępnych aplikacji</span><span class="sxs-lookup"><span data-stu-id="baa9e-103">How toosign in any Azure Active Directory (AD) user using hello multi-tenant application pattern</span></span>
<span data-ttu-id="baa9e-104">Jeśli oferujesz oprogramowania jako toomany aplikacji usługi organizacji, można skonfigurować Twojej aplikacji tooaccept logowania z dowolnej dzierżawy usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-104">If you offer a Software as a Service application toomany organizations, you can configure your application tooaccept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="baa9e-105">W usłudze Azure AD jest to, co dzierżawy wielu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="baa9e-106">Użytkownicy w dowolnej dzierżawy usługi Azure AD będą mogli toosign w aplikacji tooyour po zgodę toouse konto za pomocą aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-106">Users in any Azure AD tenant will be able toosign in tooyour application after consenting toouse their account with your application.</span></span>  

<span data-ttu-id="baa9e-107">Jeśli masz istniejącej aplikacji, która ma swój własny system konta lub inne rodzaje logowania od innych dostawców w chmurze obsługuje dodawanie usługi Azure AD logowania z dowolnej dzierżawy jest proste.</span><span class="sxs-lookup"><span data-stu-id="baa9e-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="baa9e-108">Tylko rejestrowanie aplikacji, Dodaj kod logowania za pomocą protokołu OAuth2, OpenID Connect lub SAML i umieść przycisk "Logowania w with Microsoft" w swojej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="baa9e-109">Kliknij przycisk powitania po toolearn przycisk więcej na temat znakowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-109">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="baa9e-110">[! [Zaloguj przycisk] [AAD-logowania]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="baa9e-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="baa9e-111">W tym artykule przyjęto założenie, że znasz już tworzenia aplikacji pojedynczej dzierżawy dla usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="baa9e-112">Jeśli nie masz, head, Utwórz kopię zapasową toohello [strony głównej przewodnik dewelopera] [ AAD-Dev-Guide] i wypróbować jeden z naszych Szybki Start!</span><span class="sxs-lookup"><span data-stu-id="baa9e-112">If you’re not, head back up toohello [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="baa9e-113">Istnieją cztery tooconvert prostych czynności w aplikacji do usługi Azure AD wielodostępnych aplikacji:</span><span class="sxs-lookup"><span data-stu-id="baa9e-113">There are four simple steps tooconvert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="baa9e-114">Aktualizowanie aplikacji rejestracji toobe wielu dzierżawy</span><span class="sxs-lookup"><span data-stu-id="baa9e-114">Update your application registration toobe multi-tenant</span></span>
2. <span data-ttu-id="baa9e-115">Zaktualizuj/Common toohello kodu toosend żądania punktu końcowego</span><span class="sxs-lookup"><span data-stu-id="baa9e-115">Update your code toosend requests toohello /common endpoint</span></span> 
3. <span data-ttu-id="baa9e-116">Aktualizacja Twojego toohandle kodu wielu wartości wystawcy</span><span class="sxs-lookup"><span data-stu-id="baa9e-116">Update your code toohandle multiple issuer values</span></span>
4. <span data-ttu-id="baa9e-117">Zrozumienie zgody użytkownika i administratora i zmienić odpowiedni kod</span><span class="sxs-lookup"><span data-stu-id="baa9e-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="baa9e-118">Przyjrzyjmy się każdego kroku szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="baa9e-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="baa9e-119">Można także przejść bezpośrednio za[tej listy próbek wielodostępne][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="baa9e-119">You can also jump straight too[this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-toobe-multi-tenant"></a><span data-ttu-id="baa9e-120">Aktualizacja rejestracji toobe wieloma dzierżawcami</span><span class="sxs-lookup"><span data-stu-id="baa9e-120">Update registration toobe multi-tenant</span></span>
<span data-ttu-id="baa9e-121">Domyślnie rejestracji aplikacji/interfejsu API sieci web w usłudze Azure AD są pojedynczej dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="baa9e-122">Umożliwia rejestrację wielodostępne znajdując hello "wielu dzierżawcza" Przełącz się na stronie właściwości hello Twojej rejestracji aplikacji w hello [portalu Azure] [ AZURE-portal] i ustawienie jej zbyt "Yes".</span><span class="sxs-lookup"><span data-stu-id="baa9e-122">You can make your registration multi-tenant by finding hello “Multi-Tenanted” switch on hello properties page of your application registration in hello [Azure portal][AZURE-portal] and setting it too“Yes”.</span></span>

<span data-ttu-id="baa9e-123">Należy również zauważyć, zanim aplikacji może się wieloma dzierżawcami usługi Azure AD wymaga hello z toobe aplikacji hello globalnie unikatowy identyfikator URI aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-123">Also note, before an application can be made multi-tenant, Azure AD requires hello App ID URI of hello application toobe globally unique.</span></span> <span data-ttu-id="baa9e-124">Identyfikator URI aplikacji Hello jest jeden z sposobów hello, który aplikacja zostanie zidentyfikowana w wiadomości protokołu.</span><span class="sxs-lookup"><span data-stu-id="baa9e-124">hello App ID URI is one of hello ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="baa9e-125">Dla aplikacji pojedynczej dzierżawy jest wystarczająca dla toobe identyfikator URI aplikacji hello jest unikatowa w ramach tej dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-125">For a single tenant application, it is sufficient for hello App ID URI toobe unique within that tenant.</span></span>  <span data-ttu-id="baa9e-126">Aplikacji wielodostępnych musi być globalnie unikatowe dzięki usłudze Azure AD można znaleźć aplikacji hello we wszystkich dzierżawców.</span><span class="sxs-lookup"><span data-stu-id="baa9e-126">For a multi-tenant application, it must be globally unique so Azure AD can find hello application across all tenants.</span></span>  <span data-ttu-id="baa9e-127">Globalne unikatowość jest wymuszana przez wymaganie toohave identyfikator URI aplikacji hello nazwę hosta pasującą zweryfikowanej domeny hello dzierżawy usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-127">Global uniqueness is enforced by requiring hello App ID URI toohave a host name that matches a verified domain of hello Azure AD tenant.</span></span>  <span data-ttu-id="baa9e-128">Na przykład, jeśli hello nazwę dzierżawy został contoso.onmicrosoft.com, a następnie prawidłowy identyfikator URI aplikacji będzie `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="baa9e-128">For example, if hello name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="baa9e-129">Gdyby dzierżawy zweryfikowanej domeny `contoso.com`, również będą prawidłowy identyfikator URI aplikacji, a następnie `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="baa9e-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="baa9e-130">Ustawienie aplikacji jako wielodostępnej zakończy się niepowodzeniem, jeśli identyfikator URI aplikacji hello nie będzie zgodna z tego wzorca.</span><span class="sxs-lookup"><span data-stu-id="baa9e-130">Setting an application as multi-tenant will fail if hello App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="baa9e-131">Aplikacja Native client są wielodostępne domyślnie.</span><span class="sxs-lookup"><span data-stu-id="baa9e-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="baa9e-132">Nie trzeba tootake toomake żadnych akcji klienta natywnego dzierżawy usługi rejestracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-132">You don’t need tootake any action toomake a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-toosend-requests-toocommon"></a><span data-ttu-id="baa9e-133">Aktualizacja Twojego kodu toosend żądań zbyt/wspólne</span><span class="sxs-lookup"><span data-stu-id="baa9e-133">Update your code toosend requests too/common</span></span>
<span data-ttu-id="baa9e-134">W aplikacji pojedynczej dzierżawy żądań logowania są wysyłane dzierżawy toohello logowania punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="baa9e-134">In a single tenant application, sign-in requests are sent toohello tenant’s sign-in endpoint.</span></span> <span data-ttu-id="baa9e-135">Na przykład dla contoso.onmicrosoft.com będzie hello punktu końcowego:</span><span class="sxs-lookup"><span data-stu-id="baa9e-135">For example, for contoso.onmicrosoft.com hello endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="baa9e-136">Wysyłane żądania punktu końcowego dzierżawcy tooa może podpisywać użytkowników (lub gości), w tym tooapplications dzierżawy w tej dzierżawie.</span><span class="sxs-lookup"><span data-stu-id="baa9e-136">Requests sent tooa tenant’s endpoint can sign in users (or guests) in that tenant tooapplications in that tenant.</span></span>  <span data-ttu-id="baa9e-137">Przy użyciu aplikacji wielodostępnych aplikacji hello nie może ustalić góry użytkownika hello dzierżawy jest, więc nie można wysłać żądania punktu końcowego tooa dzierżawcy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-137">With a multi-tenant application, hello application doesn’t know up front what tenant hello user is from, so you can’t send requests tooa tenant’s endpoint.</span></span>  <span data-ttu-id="baa9e-138">Zamiast tego żądania wysyłane tooan punktu końcowego, który multiplexes między dzierżaw wszystkie usługi Azure AD:</span><span class="sxs-lookup"><span data-stu-id="baa9e-138">Instead, requests are sent tooan endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="baa9e-139">Jeśli usługi Azure AD odbiera żądanie na powitania/wspólnego punktu końcowego, jego zalogowaniu użytkownika hello i konsekwencją odnajduje użytkownika hello dzierżawy, który jest z.</span><span class="sxs-lookup"><span data-stu-id="baa9e-139">When Azure AD receives a request on hello /common endpoint, it signs hello user in and as a consequence discovers which tenant hello user is from.</span></span>  <span data-ttu-id="baa9e-140">Hello/wspólnego punktu końcowego działa z wszystkimi hello protokoły obsługiwane przez usługę Azure AD: OpenID Connect, OAuth 2.0 SAML 2.0 i WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="baa9e-140">hello /common endpoint works with all of hello authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="baa9e-141">następnie aplikacja toohello logowania odpowiedzi Hello zawiera token reprezentujący hello użytkownika.</span><span class="sxs-lookup"><span data-stu-id="baa9e-141">hello sign-in response toohello application then contains a token representing hello user.</span></span>  <span data-ttu-id="baa9e-142">wartości wystawcy Hello w tokenie hello informuje aplikacji użytkownika hello dzierżawy jest z.</span><span class="sxs-lookup"><span data-stu-id="baa9e-142">hello issuer value in hello token tells an application what tenant hello user is from.</span></span>  <span data-ttu-id="baa9e-143">Gdy zwraca odpowiedź z hello/wspólnego punktu końcowego, wartości wystawcy hello w tokenie hello będzie odpowiadać toohello użytkownika dzierżawcy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-143">When a response returns from hello /common endpoint, hello issuer value in hello token will correspond toohello user’s tenant.</span></span>  <span data-ttu-id="baa9e-144">Jest ważne toonote hello/wspólnego punktu końcowego nie jest dzierżawcy i nie jest wystawcę, jest po prostu multiplekser.</span><span class="sxs-lookup"><span data-stu-id="baa9e-144">It’s important toonote hello /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="baa9e-145">Używając/Common hello logikę w aplikacji tokenów toovalidate musi tootake toobe zaktualizować to pod uwagę.</span><span class="sxs-lookup"><span data-stu-id="baa9e-145">When using /common, hello logic in your application toovalidate tokens needs toobe updated tootake this into account.</span></span> 

<span data-ttu-id="baa9e-146">Jak wspomniano wcześniej, wielodostępnych aplikacji powinny również zapewnić spójne środowisko logowania dla użytkowników, następujące hello znakowania wytyczne aplikacji usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following hello Azure AD application branding guidelines.</span></span> <span data-ttu-id="baa9e-147">Kliknij przycisk powitania po toolearn przycisk więcej na temat znakowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-147">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="baa9e-148">[! [Zaloguj przycisk] [AAD-logowania]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="baa9e-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="baa9e-149">Spójrzmy na użycie hello/Common hello punktu końcowego i implementacji kodu bardziej szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="baa9e-149">Let’s take a look at hello use of hello /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-toohandle-multiple-issuer-values"></a><span data-ttu-id="baa9e-150">Aktualizacja Twojego toohandle kodu wielu wartości wystawcy</span><span class="sxs-lookup"><span data-stu-id="baa9e-150">Update your code toohandle multiple issuer values</span></span>
<span data-ttu-id="baa9e-151">Aplikacje sieci Web i interfejsów API sieci web odbierają i sprawdzania poprawności tokenów z usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="baa9e-152">Aplikacje klienckie natywnego żądania i odbierać tokeny od usługi Azure AD, jak tak toosend ich tooAPIs, w którym są weryfikowane.</span><span class="sxs-lookup"><span data-stu-id="baa9e-152">While native client applications request and receive tokens from Azure AD, they do so toosend them tooAPIs, where they are validated.</span></span>  <span data-ttu-id="baa9e-153">Natywnych aplikacji nie sprawdzania poprawności tokenów i należy je traktować jako przezroczystości.</span><span class="sxs-lookup"><span data-stu-id="baa9e-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="baa9e-154">Zobaczmy, w jaki sposób aplikacja weryfikuje tokeny odbiera z usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="baa9e-155">Stosowanie pojedynczej dzierżawy potrwa zwykle wartość punktu końcowego, takie jak:</span><span class="sxs-lookup"><span data-stu-id="baa9e-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="baa9e-156">i przy jego użyciu tooconstruct adres URL metadanych (w tym przypadku OpenID Connect), takich jak:</span><span class="sxs-lookup"><span data-stu-id="baa9e-156">and use it tooconstruct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="baa9e-157">toodownload dwa najistotniejsze informacje, które są używane toovalidate tokenów: hello dzierżawy podpisywania kluczy i wartości wystawcy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-157">toodownload two critical pieces of information that are used toovalidate tokens:  hello tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="baa9e-158">Każdej dzierżawy usługi Azure AD ma wartość unikatowy wystawcy hello formularza:</span><span class="sxs-lookup"><span data-stu-id="baa9e-158">Each Azure AD tenant has a unique issuer value of hello form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="baa9e-159">gdzie wartości identyfikatora GUID hello jest hello rename wersja identyfikator dzierżawcy hello hello dzierżawcy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-159">where hello GUID value is hello rename-safe version of hello tenant ID of hello tenant.</span></span>  <span data-ttu-id="baa9e-160">Po kliknięciu hello poprzedzających link metadanych dla `contoso.onmicrosoft.com`, ta wartość wystawcy dokumentu hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-160">If you click on hello preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in hello document.</span></span>

<span data-ttu-id="baa9e-161">Gdy aplikacji pojedynczej dzierżawy weryfikuje token, sprawdza hello podpisu tokenu hello przed hello kluczy z dokumentu metadanych hello podpisywania.</span><span class="sxs-lookup"><span data-stu-id="baa9e-161">When a single tenant application validates a token, it checks hello signature of hello token against hello signing keys from hello metadata document.</span></span> <span data-ttu-id="baa9e-162">Dzięki temu toomake się, że wartości wystawcy hello w hello tokenu dopasowań hello jedną znalezionego w hello dokument metadanych.</span><span class="sxs-lookup"><span data-stu-id="baa9e-162">This allows it toomake sure hello issuer value in hello token matches hello one that was found in hello metadata document.</span></span>

<span data-ttu-id="baa9e-163">Od hello/wspólnego punktu końcowego nie odpowiada żadnemu tooa dzierżawy, a nie wystawcy należy zbadać wartości wystawcy hello w metadanych hello / wspólnej składa się z szablonem adresu URL zamiast rzeczywista wartość:</span><span class="sxs-lookup"><span data-stu-id="baa9e-163">Since hello /common endpoint doesn’t correspond tooa tenant and isn’t an issuer, when you examine hello issuer value in hello metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="baa9e-164">W związku z tym aplikacji wielodostępnych nie można sprawdzić poprawności tokenów porównując tylko wartości wystawcy hello w metadanych hello z hello `issuer` wartość hello tokenu.</span><span class="sxs-lookup"><span data-stu-id="baa9e-164">Therefore, a multi-tenant application can’t validate tokens just by matching hello issuer value in hello metadata with hello `issuer` value in hello token.</span></span>  <span data-ttu-id="baa9e-165">Aplikacji wielodostępnych musi toodecide logiki wartości wystawcy, które są prawidłowe i mają nie, oparte na powitania dzierżawy część Witaj wystawca wartość Identyfikatora.</span><span class="sxs-lookup"><span data-stu-id="baa9e-165">A multi-tenant application needs logic toodecide which issuer values are valid and which are not, based on hello tenant ID portion of hello issuer value.</span></span>  

<span data-ttu-id="baa9e-166">Na przykład jeśli aplikacja wielodostępne zezwala tylko logowania z określonym dzierżawców, którzy utworzyli konto usługi, następnie powinien sprawdzić wartości wystawcy hello lub hello `tid` wartości w hello tokenu toomake się tym dzierżawy znajduje się w ich lista oświadczenia Subskrybenci.</span><span class="sxs-lookup"><span data-stu-id="baa9e-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either hello issuer value or hello `tid` claim value in hello token toomake sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="baa9e-167">Aplikacji wielodostępnych tylko dotyczy osób, nie decyzje żadnych dostępu oparte na dzierżaw następnie zignorowanie wartości wystawcy hello całkowicie.</span><span class="sxs-lookup"><span data-stu-id="baa9e-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore hello issuer value altogether.</span></span>

<span data-ttu-id="baa9e-168">W hello wielodostępne próbek w hello [powiązane zawartości](#related-content) sekcja na końcu tego artykułu, sprawdzania poprawności wystawcy hello jest wyłączone tooenable żadnych toosign dzierżawy usługi Azure AD w.</span><span class="sxs-lookup"><span data-stu-id="baa9e-168">In hello multi-tenant samples in hello [Related Content](#related-content) section at hello end of this article, issuer validation is disabled tooenable any Azure AD tenant toosign in.</span></span>

<span data-ttu-id="baa9e-169">Teraz Przyjrzyjmy się hello czynności użytkownika dla użytkowników, którzy są podpisywania w aplikacjach toomulti dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-169">Now let’s look at hello user experience for users that are signing in toomulti-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="baa9e-170">Opis użytkowników i zgody administratora</span><span class="sxs-lookup"><span data-stu-id="baa9e-170">Understanding user and admin consent</span></span>
<span data-ttu-id="baa9e-171">Dla toosign użytkownika w tooan aplikacji w usłudze Azure AD aplikacja hello musi być reprezentowana w dzierżawie powitalnych użytkownika.</span><span class="sxs-lookup"><span data-stu-id="baa9e-171">For a user toosign in tooan application in Azure AD, hello application must be represented in hello user’s tenant.</span></span>  <span data-ttu-id="baa9e-172">Dzięki temu organizacji hello toodo rzeczy, jak zastosować unikatowych zasad podczas ich dzierżawy logowania toohello aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-172">This allows hello organization toodo things like apply unique policies when users from their tenant sign in toohello application.</span></span>  <span data-ttu-id="baa9e-173">W przypadku aplikacji pojedynczej dzierżawy tej rejestracji jest proste; ma ona hello jedną, która jest wywoływana podczas rejestrowania aplikacji hello w hello [portalu Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="baa9e-173">For a single tenant application, this registration is simple; it’s hello one that happens when you register hello application in hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="baa9e-174">Dla aplikacji wielodostępnych hello rejestracji początkowej dla aplikacji hello przebywa w hello dzierżawy usługi Azure AD używane przez dewelopera hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-174">For a multi-tenant application, hello initial registration for hello application lives in hello Azure AD tenant used by hello developer.</span></span>  <span data-ttu-id="baa9e-175">Po zalogowaniu użytkownika z innej dzierżawy w aplikacji toohello powitania po raz pierwszy, usługi Azure AD prosi o aplikacja hello żąda uprawnienia toohello tooconsent.</span><span class="sxs-lookup"><span data-stu-id="baa9e-175">When a user from a different tenant signs in toohello application for hello first time, Azure AD asks them tooconsent toohello permissions requested by hello application.</span></span>  <span data-ttu-id="baa9e-176">Jeśli ich zgody, a następnie wywołać reprezentację aplikacji hello *nazwy głównej usługi* jest tworzony w hello użytkownika dzierżawcy i można kontynuować logowania.</span><span class="sxs-lookup"><span data-stu-id="baa9e-176">If they consent, then a representation of hello application called a *service principal* is created in hello user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="baa9e-177">W katalogu hello, który rejestruje aplikacji toohello zgody użytkownika hello tworzona jest również delegowania.</span><span class="sxs-lookup"><span data-stu-id="baa9e-177">A delegation is also created in hello directory that records hello user’s consent toohello application.</span></span> <span data-ttu-id="baa9e-178">Zobacz [obiekty aplikacji i nazwy głównej usługi] [ AAD-App-SP-Objects] szczegółowe informacje na temat aplikacji hello aplikacji i ServicePrincipal obiektów i ich relacji tooeach innych.</span><span class="sxs-lookup"><span data-stu-id="baa9e-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on hello application's Application and ServicePrincipal objects, and how they relate tooeach other.</span></span>

![Zgody toosingle warstwy aplikacji][Consent-Single-Tier] 

<span data-ttu-id="baa9e-180">To środowisko zgody zależy aplikacja hello żąda uprawnienia hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-180">This consent experience is affected by hello permissions requested by hello application.</span></span>  <span data-ttu-id="baa9e-181">Usługi Azure AD obsługuje dwa rodzaje uprawnienia tylko do aplikacji i delegowani:</span><span class="sxs-lookup"><span data-stu-id="baa9e-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="baa9e-182">Delegowane uprawnienia przyznaje aplikacji hello możliwości tooact jak zalogowanego użytkownika dla podzbioru hello rzeczy hello użytkownika.</span><span class="sxs-lookup"><span data-stu-id="baa9e-182">A delegated permission grants an application hello ability tooact as a signed in user for a subset of hello things hello user can do.</span></span>  <span data-ttu-id="baa9e-183">Na przykład można przyznać aplikacji hello delegowane uprawnienia tooread hello podpisany w kalendarzu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="baa9e-183">For example, you can grant an application hello delegated permission tooread hello signed in user’s calendar.</span></span>
* <span data-ttu-id="baa9e-184">Uprawnienia tylko do aplikacji otrzymuje bezpośrednio toohello tożsamość aplikacji hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-184">An app-only permission is granted directly toohello identity of hello application.</span></span>  <span data-ttu-id="baa9e-185">Na przykład można przyznać aplikacji hello uprawnienia tylko do aplikacji tooread hello listy użytkowników w dzierżawie, niezależnie od tego, który jest zalogowany toohello aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-185">For example, you can grant an application hello app-only permission tooread hello list of users in a tenant, regardless of who is signed in toohello application.</span></span>

<span data-ttu-id="baa9e-186">Niektóre uprawnienia można przyzwolenie tooby zwykłego użytkownika, a inne wymagają zgody administratora dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-186">Some permissions can be consented tooby a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="baa9e-187">Zgody administratora</span><span class="sxs-lookup"><span data-stu-id="baa9e-187">Admin consent</span></span>
<span data-ttu-id="baa9e-188">Uprawnienia tylko do aplikacji zawsze Wymagaj zgody administratora dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="baa9e-189">Jeśli użytkownik próbuje toosign w aplikacji toohello aplikacji żąda uprawnienia tylko do aplikacji, zostanie wyświetlony komunikat o błędzie informujący, że użytkownik hello nie jest w stanie tooconsent.</span><span class="sxs-lookup"><span data-stu-id="baa9e-189">If your application requests an app-only permission and a user tries toosign in toohello application, an error message will be displayed saying hello user isn’t able tooconsent.</span></span>

<span data-ttu-id="baa9e-190">Niektóre delegowane uprawnienia również wymagać zgody administratora dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="baa9e-191">Na przykład hello możliwości toowrite wstecz tooAzure AD jako zalogowany użytkownik hello wymaga zgody administratora dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-191">For example, hello ability toowrite back tooAzure AD as hello signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="baa9e-192">Podobnie jak uprawnienia tylko do aplikacji Jeśli zwykłego użytkownika spróbuje toosign w aplikacji tooan, który żąda uprawnień delegowanych, które wymaga zgody administratora aplikacji spowoduje wystąpienie błędu.</span><span class="sxs-lookup"><span data-stu-id="baa9e-192">Like app-only permissions, if an ordinary user tries toosign in tooan application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="baa9e-193">Określa, czy uprawnienia wymaga zgody administratora jest określany przez dewelopera hello, która wydała hello zasobów i można znaleźć w dokumentacji hello hello zasobu.</span><span class="sxs-lookup"><span data-stu-id="baa9e-193">Whether or not a permission requires admin consent is determined by hello developer that published hello resource, and can be found in hello documentation for hello resource.</span></span>  <span data-ttu-id="baa9e-194">Łączy tootopics opisujące dostępne uprawnienia hello hello interfejsu API usługi Azure AD Graph i interfejsu API Graph usługi Microsoft są w hello [powiązane zawartości](#related-content) sekcji tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="baa9e-194">Links tootopics describing hello available permissions for hello Azure AD Graph API and Microsoft Graph API are in hello [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="baa9e-195">Jeśli aplikacja używa uprawnienia, które wymagają zgody administratora, należy toohave gestu, takich jak przycisk lub łącza, gdzie Witaj, Administratorze mogą inicjować hello akcji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-195">If your application uses permissions that require admin consent, you need toohave a gesture such as a button or link where hello admin can initiate hello action.</span></span>  <span data-ttu-id="baa9e-196">Żądanie hello aplikacji wysyła ta akcja jest zwykle żądania autoryzacji OAuth2/OpenID Connect, lecz zawiera również hello `prompt=admin_consent` parametr ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="baa9e-196">hello request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes hello `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="baa9e-197">Po zgodził Witaj, Administratorze i nazwy głównej usługi hello jest tworzony w dzierżawie powitania klienta, kolejne żądania logowania nie ma potrzeby hello `prompt=admin_consent` parametru.</span><span class="sxs-lookup"><span data-stu-id="baa9e-197">Once hello admin has consented and hello service principal is created in hello customer’s tenant, subsequent sign-in requests do not need hello `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="baa9e-198">Ponieważ hello administrator decyzję hello zażądał uprawnienia są dopuszczalne, nie innych użytkowników w dzierżawie powitalnych pojawi się monit o zgodę od tej pory.</span><span class="sxs-lookup"><span data-stu-id="baa9e-198">Since hello administrator has decided hello requested permissions are acceptable, no other users in hello tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="baa9e-199">Witaj `prompt=admin_consent` parametru można również przez aplikacje, które zażądać uprawnień, które nie wymagają zgody administratora.</span><span class="sxs-lookup"><span data-stu-id="baa9e-199">hello `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="baa9e-200">Odbywa się po aplikacji hello wymaga obsługi gdzie Witaj, Administratorze dzierżawy "zarejestrowaniu" co w czasie, a nie inne użytkownicy otrzymają monit o zgodę od tego momentu na.</span><span class="sxs-lookup"><span data-stu-id="baa9e-200">This is done when hello applicaton requires an experience where hello tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="baa9e-201">Jeśli aplikacja wymaga zgody administratora, a administrator zaloguje się do jednak hello `prompt=admin_consent` parametru nie są wysyłane, Witaj, Administratorze pomyślnie zgody aplikacji toohello **tylko dla swojego konta użytkownika**.</span><span class="sxs-lookup"><span data-stu-id="baa9e-201">If an application requires admin consent, and an admin signs in but hello `prompt=admin_consent` parameter is not sent, hello admin will successfully consent toohello application **only for their user account**.</span></span>  <span data-ttu-id="baa9e-202">Regularne użytkownicy nie będą nadal mogli toosign w i zgody toohello aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-202">Regular users will still not be able toosign in and consent toohello application.</span></span>  <span data-ttu-id="baa9e-203">Jest to przydatne, jeśli ma być toogive hello dzierżawy administratora hello możliwości tooexplore aplikację przed umożliwieniem dostępu do innych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="baa9e-203">This is useful if you want toogive hello tenant administrator hello ability tooexplore your application before allowing other users access.</span></span>

<span data-ttu-id="baa9e-204">Administrator dzierżawy można wyłączyć możliwość hello tooapplications tooconsent normalnych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="baa9e-204">A tenant administrator can disable hello ability for regular users tooconsent tooapplications.</span></span>  <span data-ttu-id="baa9e-205">Ta funkcja jest wyłączona, zgody administratora jest zawsze wymagane do konfigurowania w dzierżawie powitalnych toobe aplikacji hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-205">If this capability is disabled, admin consent is always required for hello application toobe set up in hello tenant.</span></span>  <span data-ttu-id="baa9e-206">Chcąc tootest aplikacji przy użyciu zwykłego użytkownika zgody wyłączone, można znaleźć hello przełącznik konfiguracji w dzierżawie powitalnych usługi Azure AD sekcji konfiguracji hello [portalu Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="baa9e-206">If you want tootest your application with regular user consent disabled, you can find hello configuration switch in hello Azure AD tenant configuration section of hello [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="baa9e-207">Niektóre aplikacje mają środowisko, w którym normalnych użytkowników są początkowo stanie tooconsent i nowszych aplikacji hello może obejmować hello administratora oraz zażądać uprawnień, które wymagają zgody administratora.</span><span class="sxs-lookup"><span data-stu-id="baa9e-207">Some applications want an experience where regular users are able tooconsent initially, and later hello application can involve hello administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="baa9e-208">Brak nie toodo sposób to rejestracji pojedynczej aplikacji w usłudze Azure AD dzisiaj.</span><span class="sxs-lookup"><span data-stu-id="baa9e-208">There is no way toodo this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="baa9e-209">punkt końcowy v2 Hello nadchodzących usługi Azure AD umożliwi aplikacji toorequest uprawnienia w czasie wykonywania, zamiast w czasie rejestracji spowoduje włączenie tego scenariusza.</span><span class="sxs-lookup"><span data-stu-id="baa9e-209">hello upcoming Azure AD v2 endpoint will allow applications toorequest permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="baa9e-210">Aby uzyskać więcej informacji, zobacz hello [przewodnik dewelopera usługi Azure AD App Model v2][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="baa9e-210">For more information, see hello [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="baa9e-211">Aplikacje wielowarstwowe i zgody</span><span class="sxs-lookup"><span data-stu-id="baa9e-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="baa9e-212">Aplikacja może mieć wielu warstw, każdy reprezentowany przez jego własnej rejestracji w usłudze Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="baa9e-213">Na przykład natywnych aplikacji, która wywołuje interfejs API sieci web lub aplikacji sieci web która wywołuje interfejs API sieci web.</span><span class="sxs-lookup"><span data-stu-id="baa9e-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="baa9e-214">W obu przypadkach powitania klienta (aplikacji sieci web lub aplikacji natywnej) żąda uprawnienia toocall hello zasobów (interfejs API sieci web).</span><span class="sxs-lookup"><span data-stu-id="baa9e-214">In both of these cases, hello client (native app or web app) requests permissions toocall hello resource (web API).</span></span>  <span data-ttu-id="baa9e-215">Dla powitania klienta toobe pomyślnie zgodę na klienta dzierżawy, wszystkie toowhich zasobów wymaga uprawnień musi już istnieć w dzierżawie powitania klienta.</span><span class="sxs-lookup"><span data-stu-id="baa9e-215">For hello client toobe successfully consented into a customer’s tenant, all resources toowhich it requests permissions must already exist in hello customer’s tenant.</span></span>  <span data-ttu-id="baa9e-216">Jeśli ten warunek nie jest spełniony, usługi Azure AD będzie zwracać najpierw należy dodać błędu hello zasobów.</span><span class="sxs-lookup"><span data-stu-id="baa9e-216">If this condition isn’t met, Azure AD will return an error that hello resource must be added first.</span></span>

<span data-ttu-id="baa9e-217">**Konfiguracja wielu warstw w pojedynczej dzierżawy**</span><span class="sxs-lookup"><span data-stu-id="baa9e-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="baa9e-218">Może to być problem, jeśli aplikacja logicznej składa się z dwóch lub więcej rejestracji aplikacji, na przykład oddzielnych klienta i zasobów.</span><span class="sxs-lookup"><span data-stu-id="baa9e-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="baa9e-219">Jak można uzyskać zasobu hello na powitania klienta dzierżawy pierwszy?</span><span class="sxs-lookup"><span data-stu-id="baa9e-219">How do you get hello resource into hello customer tenant first?</span></span>  <span data-ttu-id="baa9e-220">Usługi Azure AD obejmuje przypadek przez włączenie klienta i toobe zasobów zgodę w jednym kroku.</span><span class="sxs-lookup"><span data-stu-id="baa9e-220">Azure AD covers this case by enabling client and resource toobe consented in a single step.</span></span> <span data-ttu-id="baa9e-221">Witaj, użytkownik widzi łączną sumę hello hello uprawnień wymaganych przez powitania klienta i zasobów na stronie zgoda hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-221">hello user sees hello sum total of hello permissions requested by both hello client and resource on hello consent page.</span></span>  <span data-ttu-id="baa9e-222">tooenable to zachowanie rejestracji aplikacji hello zasobów musi zawierać identyfikator aplikacji hello klienta jako `knownClientApplications` w manifeście aplikacji.</span><span class="sxs-lookup"><span data-stu-id="baa9e-222">tooenable this behavior, hello resource’s application registration must include hello client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="baa9e-223">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="baa9e-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="baa9e-224">Ta właściwość może zostać zaktualizowana przy użyciu zasobów hello [manifest aplikacji][AAD-App-Manifest].</span><span class="sxs-lookup"><span data-stu-id="baa9e-224">This property can be updated via hello resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="baa9e-225">To jest przedstawiona w klientami wielowarstwowych wywołanie interfejsu API sieci web przykładowej hello [powiązane zawartości](#related-content) sekcji na końcu hello w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="baa9e-225">This is demonstrated in a multi-tier native client calling web API sample in hello [Related Content](#related-content) section at hello end of this article.</span></span> <span data-ttu-id="baa9e-226">Witaj następujący diagram zawiera omówienie zgody dla aplikacji wielowarstwowych zarejestrowane w pojedynczej dzierżawy:</span><span class="sxs-lookup"><span data-stu-id="baa9e-226">hello following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Wyrazić zgodę, aplikacja kliencka znane toomulti warstwy][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="baa9e-228">**Konfiguracja wielu warstw w wielu dzierżawców**</span><span class="sxs-lookup"><span data-stu-id="baa9e-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="baa9e-229">Podobne przypadku się stanie w przypadku różnych warstw hello aplikacji są rejestrowane w różnym dzierżawcom.</span><span class="sxs-lookup"><span data-stu-id="baa9e-229">A similar case happens if hello different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="baa9e-230">Na przykład rozważmy hello tworzenia aplikacji klientami, która wywołuje hello interfejsu API Office 365 Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="baa9e-230">For example, consider hello case of building a native client application that calls hello Office 365 Exchange Online API.</span></span>  <span data-ttu-id="baa9e-231">natywny hello toodevelop aplikacji i nowszy toorun natywnych aplikacji hello w dzierżawie klienta, nazwy głównej usługi Exchange Online hello musi być obecny.</span><span class="sxs-lookup"><span data-stu-id="baa9e-231">toodevelop hello native application, and later for hello native application toorun in a customer’s tenant, hello Exchange Online service principal must be present.</span></span>  <span data-ttu-id="baa9e-232">W takim przypadku hello deweloperów i klient musi zakupić usługi Exchange Online dla toobe główna usługi hello utworzone w swoich dzierżaw.</span><span class="sxs-lookup"><span data-stu-id="baa9e-232">In this case, hello developer and customer must purchase Exchange Online for hello service principal toobe created in their tenants.</span></span>  

<span data-ttu-id="baa9e-233">W przypadku hello interfejs API utworzony przez organizację innych niż Microsoft Projektant hello hello interfejsu API musi tooprovide sposób ich stosowania hello tooconsent klientów do ich klientom dzierżaw.</span><span class="sxs-lookup"><span data-stu-id="baa9e-233">In hello case of an API built by an organization other than Microsoft, hello developer of hello API needs tooprovide a way for their customers tooconsent hello application into their customers' tenants.</span></span> <span data-ttu-id="baa9e-234">Witaj zalecane projektu jest dla hello 3 strona developer toobuild hello interfejsu API w taki sposób, że można działa również jako tooimplement klienta sieci web rejestracji:</span><span class="sxs-lookup"><span data-stu-id="baa9e-234">hello recommended design is for hello 3rd party developer toobuild hello API such that it can also function as a web client tooimplement sign-up :</span></span>

1. <span data-ttu-id="baa9e-235">Wykonaj hello wcześniejszych sekcjach hello tooensure interfejsu API zaimplementowano wymagania dotyczące rejestracji/kod wielodostępnych aplikacji hello</span><span class="sxs-lookup"><span data-stu-id="baa9e-235">Follow hello earlier sections tooensure hello API implements hello multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="baa9e-236">Ponadto role/zakresy hello tooexposing interfejsu API, upewnij się, hello rejestracji zawiera hello "Zaloguj się i odczytuj profil użytkownika" uprawnienia usługi Azure AD (domyślnie dostępne)</span><span class="sxs-lookup"><span data-stu-id="baa9e-236">In addition tooexposing hello API's scopes/roles, ensure hello registration includes hello "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="baa9e-237">Implementuje stronę logowania — w/tworzenia konta w powitania klienta sieci web, po hello [zgody administratora](#admin-consent) wskazówki wymienione powyżej</span><span class="sxs-lookup"><span data-stu-id="baa9e-237">Implement a sign-in/sign-up page in hello web client, following hello [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="baa9e-238">Po hello użytkownik zgadza toohello aplikacji, hello service principal role i zgody delegowania łącza są tworzone w swojej dzierżawy, a natywnych aplikacji hello może uzyskać tokenów dla hello interfejsu API</span><span class="sxs-lookup"><span data-stu-id="baa9e-238">Once hello user consents toohello application, hello service principal and consent delegation links are created in their tenant, and hello native application can get tokens for hello API</span></span>

<span data-ttu-id="baa9e-239">powitania po diagram zawiera omówienie zgody dla aplikacji wielowarstwowych zarejestrowane w różnych dzierżawców:</span><span class="sxs-lookup"><span data-stu-id="baa9e-239">hello following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Zgody warstwy toomulti wieloosobowa aplikacji][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="baa9e-241">Cofnięcie zgody</span><span class="sxs-lookup"><span data-stu-id="baa9e-241">Revoking Consent</span></span>
<span data-ttu-id="baa9e-242">Użytkownicy i Administratorzy można odwołać zgody tooyour aplikacji w dowolnym momencie:</span><span class="sxs-lookup"><span data-stu-id="baa9e-242">Users and administrators can revoke consent tooyour application at any time:</span></span>

* <span data-ttu-id="baa9e-243">Użytkownicy odwołać dostępu tooindividual aplikacji, usuwając je z ich [aplikacji panelu dostępu] [ AAD-Access-Panel] listy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-243">Users revoke access tooindividual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="baa9e-244">Administratorzy odwołać dostępu tooapplications, usuwając je z usługi Azure AD przy użyciu sekcji zarządzania hello Azure AD hello [portalu Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="baa9e-244">Administrators revoke access tooapplications by removing them from Azure AD using hello Azure AD management section of hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="baa9e-245">Jeśli administrator wyrazi na to zgody tooan aplikacji dla wszystkich użytkowników w dzierżawie, użytkownicy nie mogą indywidualnie odwołać dostęp.</span><span class="sxs-lookup"><span data-stu-id="baa9e-245">If an administrator consents tooan application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="baa9e-246">Tylko hello administrator można odwołać dostęp i tylko dla całej aplikacji hello.</span><span class="sxs-lookup"><span data-stu-id="baa9e-246">Only hello administrator can revoke access, and only for hello whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="baa9e-247">Obsługa protokołu i zgodę</span><span class="sxs-lookup"><span data-stu-id="baa9e-247">Consent and Protocol Support</span></span>
<span data-ttu-id="baa9e-248">Zgoda jest obsługiwana w usłudze Azure AD za pomocą protokołu OpenID Connect, hello OAuth, WS-Federation oraz SAML protokołów.</span><span class="sxs-lookup"><span data-stu-id="baa9e-248">Consent is supported in Azure AD via hello OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="baa9e-249">Witaj protokołów języka SAML i WS-Federation nie obsługują hello `prompt=admin_consent` parametru, więc zgody administratora tylko jest to możliwe za pośrednictwem protokołu OAuth i OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="baa9e-249">hello SAML and WS-Federation protocols do not support hello `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="baa9e-250">Aplikacje wielodostępne i buforowanie tokeny dostępu</span><span class="sxs-lookup"><span data-stu-id="baa9e-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="baa9e-251">Aplikacje wielodostępne można również uzyskać toocall tokenów dostępu do interfejsów API, które są chronione przez usługę Azure AD.</span><span class="sxs-lookup"><span data-stu-id="baa9e-251">Multi-tenant applications can also get access tokens toocall APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="baa9e-252">Typowym błędem podczas korzystania z aplikacją wielodostępne hello Active Directory Authentication Library (ADAL) jest żądaniem tooinitially token dla użytkownika za pomocą/Common, otrzymują odpowiedź, a następnie żądania tokenu kolejnych dla tego samego użytkownika również przy użyciu/Common.</span><span class="sxs-lookup"><span data-stu-id="baa9e-252">A common error when using hello Active Directory Authentication Library (ADAL) with a multi-tenant application, is tooinitially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="baa9e-253">Ponieważ hello odpowiedzi z usługi Azure AD pochodzi od dzierżawcy, nie/wspólne, ADAL buforuje hello token jako pochodzącej z hello dzierżawy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-253">Since hello response from Azure AD comes from a tenant, not /common, ADAL caches hello token as being from hello tenant.</span></span> <span data-ttu-id="baa9e-254">Hello kolejne wywołania tooget zbyt/wspólnego, jest token dostępu dla wpisu pamięci podręcznej hello hello użytkownika Chybienia i hello użytkownika zostanie wyświetlony monit o toosign w ponownie.</span><span class="sxs-lookup"><span data-stu-id="baa9e-254">hello subsequent call too/common tooget an access token for hello user misses hello cache entry, and hello user is prompted toosign in again.</span></span>  <span data-ttu-id="baa9e-255">tooavoid Brak pamięci podręcznej hello, upewnij się, że wezwań do już zalogowanego użytkownika są wykonywane punktu końcowego toohello dzierżawcy.</span><span class="sxs-lookup"><span data-stu-id="baa9e-255">tooavoid missing hello cache, make sure subsequent calls for an already signed in user are made toohello tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="baa9e-256">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="baa9e-256">Next steps</span></span>
<span data-ttu-id="baa9e-257">W tym artykule należy przedstawiono sposób toobuild aplikacji, która może zalogować użytkownika z dowolnej dzierżawy usługi Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="baa9e-257">In this article, you learned how toobuild an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="baa9e-258">Po włączeniu rejestracji jednokrotnej między aplikacji i usługi Azure Active Directory, należy zaktualizować Twojej aplikacji tooaccess interfejsach API udostępnianych przez zasoby firmy Microsoft, takich jak usługi Office 365.</span><span class="sxs-lookup"><span data-stu-id="baa9e-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application tooaccess APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="baa9e-259">Dlatego możesz zaoferować spersonalizowane środowisko w aplikacji, na przykład przedstawiający informacje kontekstowe toohello użytkowników, takich jak ich obraz profilu lub ich dalej terminu kalendarza.</span><span class="sxs-lookup"><span data-stu-id="baa9e-259">So you can offer a personalized experience in your application, for example showing contextual information toohello users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="baa9e-260">toolearn więcej informacji na temat tworzenia interfejsu API wywołuje tooAzure usługi Active Directory i usługi Office 365, takich jak program Exchange, SharePoint, OneDrive, OneNote, planowania, Excel i więcej, odwiedź stronę: [interfejsu API programu Microsoft Graph][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="baa9e-260">toolearn more about making API calls tooAzure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="baa9e-261">Zawartość pokrewna</span><span class="sxs-lookup"><span data-stu-id="baa9e-261">Related content</span></span>
* <span data-ttu-id="baa9e-262">[Przykłady aplikacji z wieloma dzierżawcami][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="baa9e-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="baa9e-263">[Znakowania wytyczne dotyczące aplikacji][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="baa9e-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="baa9e-264">[Przewodnik dewelopera usługi Azure AD][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="baa9e-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="baa9e-265">[Obiekty aplikacji i nazwy głównej usługi][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="baa9e-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="baa9e-266">[Integrowanie aplikacji z usługą Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="baa9e-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="baa9e-267">[Omówienie hello zgody Framework][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="baa9e-267">[Overview of hello Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="baa9e-268">[Zakresy uprawnień Microsoft Graph API][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="baa9e-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="baa9e-269">[Zakresy uprawnień usługi Azure AD Graph API][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="baa9e-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="baa9e-270">Użyj powitania po opinii tooprovide sekcji komentarzy i pomóc nam dostosować i kształtu zawartość.</span><span class="sxs-lookup"><span data-stu-id="baa9e-270">Please use hello following comments section tooprovide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














