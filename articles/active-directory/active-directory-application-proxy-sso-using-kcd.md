---
title: "Logowanie jednokrotne przy użyciu serwera Proxy aplikacji | Dokumentacja firmy Microsoft"
description: "Uwzględniono również sposób zapewnienia logowania jednokrotnego przy użyciu serwera Proxy aplikacji usługi Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 149af1f68e574f78127a9c2de8a0e79ed8774d29
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-to-your-apps-with-application-proxy"></a><span data-ttu-id="31506-103">Ograniczone delegowanie protokołu Kerberos dla rejestracji jednokrotnej do aplikacji przy użyciu serwera Proxy aplikacji</span><span class="sxs-lookup"><span data-stu-id="31506-103">Kerberos Constrained Delegation for single sign-on to your apps with Application Proxy</span></span>

<span data-ttu-id="31506-104">Zapewnia rejestrację jednokrotną dla lokalnych aplikacji opublikowanych przy użyciu serwera Proxy aplikacji, które są zabezpieczone przy użyciu zintegrowanego uwierzytelniania systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="31506-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="31506-105">Te aplikacje wymagają biletu protokołu Kerberos dla dostępu.</span><span class="sxs-lookup"><span data-stu-id="31506-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="31506-106">Serwer Proxy aplikacji używa delegowanie ograniczone protokołu Kerberos (KCD) do obsługi tych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-106">Application Proxy uses Kerberos Constrained Delegation (KCD) to support these applications.</span></span> 

<span data-ttu-id="31506-107">Można włączyć logowanie jednokrotne do aplikacji przy użyciu zintegrowanego uwierzytelniania systemu Windows (IWA) przez nadanie uprawnień łączniki serwera Proxy aplikacji w usłudze Active Directory umożliwiające personifikowanie użytkowników.</span><span class="sxs-lookup"><span data-stu-id="31506-107">You can enable single sign-on to your applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory to impersonate users.</span></span> <span data-ttu-id="31506-108">Łączniki Użyj tego uprawnienia do wysyłania i odbierania tokenów w ich imieniu.</span><span class="sxs-lookup"><span data-stu-id="31506-108">The connectors use this permission to send and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="31506-109">Jak rejestracji jednokrotnej z KCD działa</span><span class="sxs-lookup"><span data-stu-id="31506-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="31506-110">Ten diagram opisano przepływ, gdy użytkownik próbuje uzyskać dostępu do aplikacji lokalnych, która używa funkcji IWA.</span><span class="sxs-lookup"><span data-stu-id="31506-110">This diagram explains the flow when a user attempts to access an on-prem application that uses IWA.</span></span>

![Diagram przepływu uwierzytelniania firmy Microsoft AAD](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="31506-112">Użytkownik musi wprowadzić adres URL, aby uzyskać dostęp do aplikacji lokalnych przy użyciu serwera Proxy aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-112">The user enters the URL to access the on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="31506-113">Serwer Proxy aplikacji przekierowuje żądanie do usługi uwierzytelniania usługi Azure AD do preauthenticate.</span><span class="sxs-lookup"><span data-stu-id="31506-113">Application Proxy redirects the request to Azure AD authentication services to preauthenticate.</span></span> <span data-ttu-id="31506-114">W tym momencie usługi Azure AD stosuje odpowiednie uwierzytelnianie, a zasady autoryzacji, takie jak uwierzytelnianie wieloskładnikowe.</span><span class="sxs-lookup"><span data-stu-id="31506-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="31506-115">Jeśli użytkownik jest weryfikowane, usługi Azure AD tworzy token i wysyła go do użytkownika.</span><span class="sxs-lookup"><span data-stu-id="31506-115">If the user is validated, Azure AD creates a token and sends it to the user.</span></span>
3. <span data-ttu-id="31506-116">Użytkownik przekazuje token do serwera Proxy aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-116">The user passes the token to Application Proxy.</span></span>
4. <span data-ttu-id="31506-117">Serwer Proxy aplikacji sprawdza poprawność tokenu i pobiera główną nazwę użytkownika (UPN) z niego, a następnie wysyła żądanie, głównej nazwy użytkownika i nazwy usługi (SPN) z łącznikiem za pośrednictwem uwierzytelnionego dually bezpiecznego kanału.</span><span class="sxs-lookup"><span data-stu-id="31506-117">Application Proxy validates the token and retrieves the User Principal Name (UPN) from it, and then sends the request, the UPN, and the Service Principal Name (SPN) to the Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="31506-118">Łącznik przeprowadza negocjowanie delegowanie ograniczone protokołu Kerberos (KCD) z lokalnej usługi AD, personifikacji użytkownika w celu pobrania tokenu protokołu Kerberos do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-118">The Connector performs Kerberos Constrained Delegation (KCD) negotiation with the on-prem AD, impersonating the user to get a Kerberos token to the application.</span></span>
6. <span data-ttu-id="31506-119">Usługi Active Directory wysyła ten token protokołu Kerberos do łącznika aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-119">Active Directory sends the Kerberos token for the application to the Connector.</span></span>
7. <span data-ttu-id="31506-120">Łącznik wysyła oryginalne żądanie do serwera aplikacji, za pomocą tokenu protokołu Kerberos, otrzymanego z usługi Active Directory.</span><span class="sxs-lookup"><span data-stu-id="31506-120">The Connector sends the original request to the application server, using the Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="31506-121">Aplikacja wysyła odpowiedź do łącznik, który jest następnie zwracany do serwera Proxy aplikacji usługi i w końcu dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="31506-121">The application sends the response to the Connector, which is then returned to the Application Proxy service and finally to the user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="31506-122">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="31506-122">Prerequisites</span></span>
<span data-ttu-id="31506-123">Przed rozpoczęciem pracy z logowanie jednokrotne dla aplikacji IWA, upewnij się, że środowisko jest gotowe z poniższych ustawień i konfiguracji:</span><span class="sxs-lookup"><span data-stu-id="31506-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with the following settings and configurations:</span></span>

* <span data-ttu-id="31506-124">Aplikacji, takich jak aplikacje sieci Web programu SharePoint są ustawiane do korzystania ze zintegrowanego uwierzytelniania systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="31506-124">Your apps, like SharePoint Web apps, are set to use Integrated Windows Authentication.</span></span> <span data-ttu-id="31506-125">Aby uzyskać więcej informacji, zobacz [włączyć obsługę uwierzytelniania Kerberos](https://technet.microsoft.com/library/dd759186.aspx), lub dla programu SharePoint, zobacz [planowanie uwierzytelniania Kerberos w programie SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span><span class="sxs-lookup"><span data-stu-id="31506-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="31506-126">Wszystkie Twoje aplikacje mają [główne nazwy usług](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span><span class="sxs-lookup"><span data-stu-id="31506-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="31506-127">Serwer z uruchomioną łącznika i serwera, na którym uruchomiono aplikację są przyłączone do domeny, jest częścią tej samej domenie lub domenach ufających.</span><span class="sxs-lookup"><span data-stu-id="31506-127">The server running the Connector and the server running the app are domain joined and part of the same domain or trusting domains.</span></span> <span data-ttu-id="31506-128">Aby uzyskać więcej informacji dotyczących przyłączania do domeny, zobacz [przyłączyć komputer do domeny](https://technet.microsoft.com/library/dd807102.aspx).</span><span class="sxs-lookup"><span data-stu-id="31506-128">For more information on domain join, see [Join a Computer to a Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="31506-129">Serwera z uruchomionym programem łącznika ma dostęp do odczytu atrybutu TokenGroupsGlobalAndUniversal dla użytkowników.</span><span class="sxs-lookup"><span data-stu-id="31506-129">The server running the Connector has access to read the TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="31506-130">To ustawienie domyślne może negatywnie przez ograniczenie funkcjonalności środowiska zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="31506-130">This default setting might have been impacted by security hardening the environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="31506-131">Konfigurowanie usługi Active Directory</span><span class="sxs-lookup"><span data-stu-id="31506-131">Configure Active Directory</span></span>
<span data-ttu-id="31506-132">Konfiguracja usługi Active Directory różni się w zależności od tego, czy z łącznika serwera Proxy aplikacji i serwera aplikacji znajdują się w tej samej domenie lub nie.</span><span class="sxs-lookup"><span data-stu-id="31506-132">The Active Directory configuration varies, depending on whether your Application Proxy connector and the application server are in the same domain or not.</span></span>

#### <a name="connector-and-application-server-in-the-same-domain"></a><span data-ttu-id="31506-133">Łącznik i serwera aplikacji w tej samej domenie</span><span class="sxs-lookup"><span data-stu-id="31506-133">Connector and application server in the same domain</span></span>
1. <span data-ttu-id="31506-134">W usłudze Active Directory, przejdź do **narzędzia** > **użytkownicy i komputery**.</span><span class="sxs-lookup"><span data-stu-id="31506-134">In Active Directory, go to **Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="31506-135">Wybierz serwer z uruchomioną łącznika.</span><span class="sxs-lookup"><span data-stu-id="31506-135">Select the server running the connector.</span></span>
3. <span data-ttu-id="31506-136">Kliknij prawym przyciskiem myszy i wybierz **właściwości** > **delegowania**.</span><span class="sxs-lookup"><span data-stu-id="31506-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="31506-137">Wybierz **Ufaj temu komputerowi w delegowaniu tylko do określonych usług**.</span><span class="sxs-lookup"><span data-stu-id="31506-137">Select **Trust this computer for delegation to specified services only**.</span></span> 
5. <span data-ttu-id="31506-138">W obszarze **usług, do których to konto może okazywać delegowane poświadczenia** dodać wartość tożsamością SPN serwera aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-138">Under **Services to which this account can present delegated credentials** add the value for the SPN identity of the application server.</span></span> <span data-ttu-id="31506-139">Dzięki temu łącznika serwera Proxy aplikacji personifikować użytkowników w usłudze AD dla aplikacji zdefiniowanej na liście.</span><span class="sxs-lookup"><span data-stu-id="31506-139">This enables the Application Proxy Connector to impersonate users in AD against the applications defined in the list.</span></span>

   ![Zrzut ekranu okna właściwości SVR łącznika](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="31506-141">Łącznik i serwera aplikacji w różnych domenach</span><span class="sxs-lookup"><span data-stu-id="31506-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="31506-142">Aby uzyskać listę wymagań wstępnych dotyczących pracy z KCD między domenami, zobacz [ograniczone delegowanie protokołu Kerberos między domenami](https://technet.microsoft.com/library/hh831477.aspx).</span><span class="sxs-lookup"><span data-stu-id="31506-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="31506-143">Użyj `principalsallowedtodelegateto` właściwości na serwerze łącznika, aby włączyć serwer Proxy aplikacji delegować do serwera łącznika.</span><span class="sxs-lookup"><span data-stu-id="31506-143">Use the `principalsallowedtodelegateto` property on the Connector server to enable the Application Proxy to delegate for the Connector server.</span></span> <span data-ttu-id="31506-144">Serwer aplikacji `sharepointserviceaccount` , a serwer delegujące `connectormachineaccount`.</span><span class="sxs-lookup"><span data-stu-id="31506-144">The application server is `sharepointserviceaccount` and the delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="31506-145">W systemie Windows 2012 R2 Użyj tego kodu na przykład:</span><span class="sxs-lookup"><span data-stu-id="31506-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="31506-146">Sharepointserviceaccount może być SPS konta komputera lub konta usługi, na którym uruchomiono SPS puli aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-146">Sharepointserviceaccount can be the SPS machine account or a service account under which the SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="31506-147">Konfigurowanie rejestracji jednokrotnej</span><span class="sxs-lookup"><span data-stu-id="31506-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="31506-148">Publikowanie aplikacji zgodnie z instrukcjami opisanego w [publikowania aplikacji za pomocą serwera Proxy aplikacji](application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="31506-148">Publish your application according to the instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="31506-149">Upewnij się wybrać **usługi Azure Active Directory** jako **metoda uwierzytelniania wstępnego**.</span><span class="sxs-lookup"><span data-stu-id="31506-149">Make sure to select **Azure Active Directory** as the **Preauthentication Method**.</span></span>
2. <span data-ttu-id="31506-150">Gdy aplikacji zostanie wyświetlony na liście aplikacji przedsiębiorstwa, zaznacz go i kliknij **logowanie jednokrotne**.</span><span class="sxs-lookup"><span data-stu-id="31506-150">After your application appears in the list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="31506-151">Ustaw tryb znak pojedynczego **zintegrowane uwierzytelnianie systemu Windows**.</span><span class="sxs-lookup"><span data-stu-id="31506-151">Set the single sign-on mode to **Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="31506-152">Wprowadź **wewnętrznych aplikacji głównej nazwy usługi** serwera aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-152">Enter the **Internal Application SPN** of the application server.</span></span> <span data-ttu-id="31506-153">W tym przykładzie nazwa SPN dla opublikowanych aplikacji jest http/www.contoso.com. Tę nazwę SPN musi znajdować się na liście usług, do których łącznik może okazywać delegowane poświadczenia.</span><span class="sxs-lookup"><span data-stu-id="31506-153">In this example, the SPN for our published application is http/www.contoso.com. This SPN needs to be in the list of services to which the connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="31506-154">Wybierz **delegowane tożsamości logowania** dla łącznika do użycia w imieniu użytkowników.</span><span class="sxs-lookup"><span data-stu-id="31506-154">Choose the **Delegated Login Identity** for the connector to use on behalf of your users.</span></span> <span data-ttu-id="31506-155">Aby uzyskać więcej informacji, zobacz [Praca z różnych lokalnymi i tożsamościami w chmurze](#Working-with-different-on-premises-and-cloud-identities)</span><span class="sxs-lookup"><span data-stu-id="31506-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![Konfiguracja zaawansowanych aplikacji](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="31506-157">Logowanie Jednokrotne dla aplikacji z systemem innym niż Windows</span><span class="sxs-lookup"><span data-stu-id="31506-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="31506-158">Przepływ delegowania protokołu Kerberos w serwera Proxy aplikacji usługi Azure AD rozpoczyna się, gdy usługa Azure AD uwierzytelnia użytkowników w chmurze.</span><span class="sxs-lookup"><span data-stu-id="31506-158">The Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates the user in the cloud.</span></span> <span data-ttu-id="31506-159">Gdy żądanie dociera do lokalnej, łącznika serwera Proxy aplikacji usługi Azure AD wystawia biletu protokołu Kerberos w imieniu użytkownika przez interakcji z lokalnej usługi Active Directory.</span><span class="sxs-lookup"><span data-stu-id="31506-159">Once the request arrives on-premises, the Azure AD Application Proxy connector issues a Kerberos ticket on behalf of the user by interacting with the local Active Directory.</span></span> <span data-ttu-id="31506-160">Ten proces jest określany jako protokołu Kerberos ograniczonego delegowania (KCD).</span><span class="sxs-lookup"><span data-stu-id="31506-160">This process is referred to as Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="31506-161">W następnej fazy żądanie jest wysyłane do aplikacji zaplecza z tego biletu protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="31506-161">In the next phase, a request is sent to the backend application with this Kerberos ticket.</span></span> <span data-ttu-id="31506-162">Istnieje kilka protokołów, które definiują sposób wysyłania takich żądań.</span><span class="sxs-lookup"><span data-stu-id="31506-162">There are several protocols that define how to send such requests.</span></span> <span data-ttu-id="31506-163">Większość serwerów z systemem innym niż Windows oczekiwać Negotiate/SPNego, która jest teraz obsługiwana na serwera Proxy aplikacji usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="31506-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="31506-164">Aby uzyskać więcej informacji o protokole Kerberos, zobacz [wszystkich chcesz wiedzieć o protokołu Kerberos ograniczonego delegowania (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span><span class="sxs-lookup"><span data-stu-id="31506-164">For more information about Kerberos, see [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="31506-165">Aplikacje systemu Windows bez zwykle użytkownika nazwy użytkowników lub nazwy konta SAM zamiast domeny adresów e-mail.</span><span class="sxs-lookup"><span data-stu-id="31506-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="31506-166">Jeśli taka sytuacja ma zastosowanie do aplikacji, należy skonfigurować pole tożsamości logowania delegowanego nawiązywania połączenia z Twoich tożsamości aplikacji tożsamości w chmurze.</span><span class="sxs-lookup"><span data-stu-id="31506-166">If that situation applies to your applications, you need to configure the delegated login identity field to connect your cloud identities to your application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="31506-167">Praca z różnych lokalnymi i tożsamościami w chmurze</span><span class="sxs-lookup"><span data-stu-id="31506-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="31506-168">Serwer Proxy aplikacji założenia, że użytkownicy dokładnie taką samą tożsamość w chmurze i lokalnie.</span><span class="sxs-lookup"><span data-stu-id="31506-168">Application Proxy assumes that users have exactly the same identity in the cloud and on-premises.</span></span> <span data-ttu-id="31506-169">Jeśli nie jest wielkość liter, można nadal służy KCD dla logowania jednokrotnego.</span><span class="sxs-lookup"><span data-stu-id="31506-169">If that's not the case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="31506-170">Skonfiguruj **delegowane tożsamości logowania** dla każdej aplikacji można określić tożsamości, która będzie używana podczas rejestracji jednokrotnej.</span><span class="sxs-lookup"><span data-stu-id="31506-170">Configure a **Delegated login identity** for each application to specify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="31506-171">Ta funkcja umożliwia wiele organizacji, które mają różne lokalnymi i tożsamości w chmurze ma rejestracji Jednokrotnej z chmury do lokalnych aplikacji bez konieczności przez użytkowników wprowadzić różne nazwy użytkowników i hasła.</span><span class="sxs-lookup"><span data-stu-id="31506-171">This capability allows many organizations that have different on-premises and cloud identities to have SSO from the cloud to on-premises apps without requiring the users to enter different usernames and passwords.</span></span> <span data-ttu-id="31506-172">Dotyczy to również organizacjom który:</span><span class="sxs-lookup"><span data-stu-id="31506-172">This includes organizations that:</span></span>

* <span data-ttu-id="31506-173">Wewnętrznie mają kilka domen (joe@us.contoso.com, joe@eu.contoso.com) i jednej domeny w chmurze (joe@contoso.com).</span><span class="sxs-lookup"><span data-stu-id="31506-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in the cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="31506-174">Wewnętrznie mają nazwy domeny bez obsługi routingu (joe@contoso.usa) i prawnych w chmurze.</span><span class="sxs-lookup"><span data-stu-id="31506-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in the cloud.</span></span>
* <span data-ttu-id="31506-175">Nie używaj nazw domen wewnętrznie (Jan)</span><span class="sxs-lookup"><span data-stu-id="31506-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="31506-176">Użyj innych aliasów lokalnych i w chmurze.</span><span class="sxs-lookup"><span data-stu-id="31506-176">Use different aliases on-prem and in the cloud.</span></span> <span data-ttu-id="31506-177">Na przykład joe-johns@contoso.com vs.joej@contoso.com</span><span class="sxs-lookup"><span data-stu-id="31506-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="31506-178">Dzięki serwerowi Proxy aplikacji można wybrać tożsamość używaną do uzyskania biletu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="31506-178">With Application Proxy, you can select which identity to use to obtain the Kerberos ticket.</span></span> <span data-ttu-id="31506-179">To ustawienie jest na aplikację.</span><span class="sxs-lookup"><span data-stu-id="31506-179">This setting is per application.</span></span> <span data-ttu-id="31506-180">Niektóre z tych opcji nadają się do systemów, które nie akceptują format adresu e-mail, inne są zaprojektowane dla alternatywnej nazwy logowania.</span><span class="sxs-lookup"><span data-stu-id="31506-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![Zrzut ekranu parametr tożsamości delegowanego logowania](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="31506-182">Jeśli używana jest tożsamość delegowanego logowania, wartość nie muszą być unikatowe dla wszystkich domen i lasów w Twojej organizacji.</span><span class="sxs-lookup"><span data-stu-id="31506-182">If delegated login identity is used, the value might not be unique across all the domains or forests in your organization.</span></span> <span data-ttu-id="31506-183">Aby uniknąć tego problemu, należy publikowania aplikacji, te dwa razy przy użyciu dwóch różnych grup łącznika.</span><span class="sxs-lookup"><span data-stu-id="31506-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="31506-184">Ponieważ każda aplikacja ma odbiorców inny użytkownik, możesz dołączyć jego łączniki do innej domeny.</span><span class="sxs-lookup"><span data-stu-id="31506-184">Since each application has a different user audience, you can join its Connectors to a different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="31506-185">Konfigurowanie logowania jednokrotnego dla różnych tożsamości</span><span class="sxs-lookup"><span data-stu-id="31506-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="31506-186">Konfigurowanie ustawień usługi Azure AD Connect tożsamość główna jest adres e-mail (poczta).</span><span class="sxs-lookup"><span data-stu-id="31506-186">Configure Azure AD Connect settings so the main identity is the email address (mail).</span></span> <span data-ttu-id="31506-187">Odbywa się w ramach procesu Dostosuj zmieniając **główna nazwa użytkownika** w ustawieniach synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="31506-187">This is done as part of the customize process, by changing the **User Principal Name** field in the sync settings.</span></span> <span data-ttu-id="31506-188">Te ustawienia określają, jak użytkownicy logują się do usługi Office 365, urządzeń Windows10 i inne aplikacje, które używają usługi Azure AD jako magazynu ich tożsamości.</span><span class="sxs-lookup"><span data-stu-id="31506-188">These settings also determine how users log in to Office365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="31506-189">![Identyfikowanie użytkowników zrzut ekranu — Lista rozwijana główna nazwa użytkownika](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="31506-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="31506-190">W ustawieniach konfiguracji aplikacji dla aplikacji, które chcesz zmodyfikować, wybierz **delegowane tożsamości logowania** do użycia:</span><span class="sxs-lookup"><span data-stu-id="31506-190">In the Application Configuration settings for the application you would like to modify, select the **Delegated Login Identity** to be used:</span></span>

   * <span data-ttu-id="31506-191">Nazwa główna użytkownika (na przykład joe@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="31506-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="31506-192">Alternatywna nazwa główna użytkownika (na przykład joed@contoso.local)</span><span class="sxs-lookup"><span data-stu-id="31506-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="31506-193">Nazwa użytkownika, część główna nazwa użytkownika (na przykład Jan)</span><span class="sxs-lookup"><span data-stu-id="31506-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="31506-194">Część nazwy użytkownika alternatywna nazwa główna użytkownika (na przykład joed)</span><span class="sxs-lookup"><span data-stu-id="31506-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="31506-195">Nazwa konta SAM lokalnymi (zależy od konfiguracji kontrolera domeny)</span><span class="sxs-lookup"><span data-stu-id="31506-195">On-premises SAM account name (depends on the domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="31506-196">Rozwiązywanie problemów z logowania jednokrotnego dla różnych tożsamości</span><span class="sxs-lookup"><span data-stu-id="31506-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="31506-197">Jeśli występuje błąd w procesie logowania jednokrotnego, wydaje się w dzienniku zdarzeń maszyny łącznika zgodnie z objaśnieniem w [Rozwiązywanie problemów](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="31506-197">If there is an error in the SSO process, it appears in the connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="31506-198">Jednak w niektórych przypadkach, żądanie jest pomyślnie wysłane do aplikacji zaplecza podczas odpowiada tej aplikacji w różnych odpowiedzi HTTP.</span><span class="sxs-lookup"><span data-stu-id="31506-198">But, in some cases, the request is successfully sent to the backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="31506-199">Rozwiązywanie problemów z tych przypadkach należy zacząć od badanie numer zdarzenia 24029 na maszynie łącznika w dzienniku zdarzeń w sesji serwera Proxy aplikacji.</span><span class="sxs-lookup"><span data-stu-id="31506-199">Troubleshooting these cases should start by examining event number 24029 on the connector machine in the Application Proxy session event log.</span></span> <span data-ttu-id="31506-200">Tożsamość użytkownika, którego użyto do delegowania pojawia się w polu "użytkownika" w ramach szczegółów zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="31506-200">The user identity that was used for delegation appears in the “user” field within the event details.</span></span> <span data-ttu-id="31506-201">Aby włączyć dziennik sesji, wybierz **wyświetlanie analityczne i debugowania dzienniki** w menu Widok podglądu zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="31506-201">To turn on session log, select **Show analytic and debug logs** in the event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="31506-202">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="31506-202">Next steps</span></span>

* [<span data-ttu-id="31506-203">Jak skonfigurować serwer Proxy aplikacji aplikacji na używanie ograniczone delegowanie protokołu Kerberos</span><span class="sxs-lookup"><span data-stu-id="31506-203">How to configure an Application Proxy application to use Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="31506-204">Rozwiązywanie problemów, które masz problem z serwerem Proxy aplikacji</span><span class="sxs-lookup"><span data-stu-id="31506-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="31506-205">Aby zapoznać się z najnowszymi informacjami i aktualizacjami, zobacz [blog dotyczący serwera proxy aplikacji](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="31506-205">For the latest news and updates, check out the [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>

