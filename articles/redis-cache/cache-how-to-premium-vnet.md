---
title: "Konfigurowanie sieci wirtualnej dla usługi pamięć podręczna Azure Redis Premium | Dokumentacja firmy Microsoft"
description: "Informacje o sposobie tworzenia i zarządzania nimi obsługi sieci wirtualnej dla swoich wystąpień pamięci podręcznej Redis Azure warstwy Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: 59d46990e02c0719d2b4df01e216a97fd649c509
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="3663c-103">Jak skonfigurować obsługę sieci wirtualnych dla podręczna Redis Azure Premium</span><span class="sxs-lookup"><span data-stu-id="3663c-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="3663c-104">Pamięć podręczna Redis Azure ma inną pamięci podręcznej oferty, które zapewniają elastyczność w wyborze rozmiar pamięci podręcznej i funkcji, łącznie z funkcji warstwy Premium, takich jak klastrowanie, trwałości i obsługi sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="3663c-105">Sieci wirtualnej jest ona prywatną siecią w chmurze.</span><span class="sxs-lookup"><span data-stu-id="3663c-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="3663c-106">Po skonfigurowaniu wystąpienia pamięci podręcznej Redis Azure z sieci wirtualnej nie jest publicznie adresowana i jest możliwy tylko z maszyn wirtualnych i aplikacji w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="3663c-107">W tym artykule opisano sposób konfigurowania obsługi sieci wirtualnej dla wystąpienia pamięci podręcznej Redis Azure premium.</span><span class="sxs-lookup"><span data-stu-id="3663c-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="3663c-108">Pamięć podręczna Redis Azure obsługuje zarówno classic i sieci wirtualnych Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="3663c-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="3663c-109">Aby uzyskać informacji o innych funkcjach pamięci podręcznej premium, zobacz [wprowadzenie do warstwy Premium pamięci podręcznej Redis Azure](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="3663c-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="3663c-110">Dlaczego sieci wirtualnej?</span><span class="sxs-lookup"><span data-stu-id="3663c-110">Why VNet?</span></span>
<span data-ttu-id="3663c-111">[Sieć wirtualna platformy Azure (VNet)](https://azure.microsoft.com/services/virtual-network/) wdrożenie zapewnia większe bezpieczeństwo i izolację dla pamięci podręcznej Redis Azure, jak również podsieci, zasad kontroli dostępu i inne funkcje, aby jeszcze bardziej ograniczyć dostęp.</span><span class="sxs-lookup"><span data-stu-id="3663c-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="3663c-112">Obsługa sieci wirtualnej</span><span class="sxs-lookup"><span data-stu-id="3663c-112">Virtual network support</span></span>
<span data-ttu-id="3663c-113">Obsługa usługi Virtual Network (VNet) jest skonfigurowany na **nowa pamięć podręczna Redis** bloku podczas tworzenia pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="3663c-114">Po wybraniu warstwie cenowej premium można skonfigurować integracji Redis sieci wirtualnej, wybierając sieć wirtualną, która znajduje się w tej samej subskrypcji i lokalizacji co pamięć podręczną.</span><span class="sxs-lookup"><span data-stu-id="3663c-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="3663c-115">Aby korzystać z nowej sieci wirtualnej, utwórz go najpierw wykonując kroki opisane w [utworzyć sieć wirtualną przy użyciu portalu Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) lub [utworzyć sieć wirtualną (klasyczne) przy użyciu portalu Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) , a następnie wróć do **nowa pamięć podręczna Redis** bloku, aby utworzyć i skonfigurować pamięć podręczną premium.</span><span class="sxs-lookup"><span data-stu-id="3663c-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="3663c-116">Kliknij, aby skonfigurować sieć wirtualną dla nowej pamięci podręcznej **sieci wirtualnej** na **nowa pamięć podręczna Redis** bloku, a następnie wybierz odpowiednią sieć wirtualną z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="3663c-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Sieć wirtualna][redis-cache-vnet]

<span data-ttu-id="3663c-118">Wybierz żądaną podsieci z **podsieci** listy rozwijanej liście, a następnie określ żądaną **statyczny adres IP**.</span><span class="sxs-lookup"><span data-stu-id="3663c-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="3663c-119">Jeśli używasz klasycznej sieci wirtualnej **statyczny adres IP** pole jest opcjonalne, a jeśli nie zostanie określona, wybierany jest jeden z wybranej podsieci.</span><span class="sxs-lookup"><span data-stu-id="3663c-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3663c-120">Podczas wdrażania pamięć podręczna Redis Azure Resource Manager sieci wirtualnej, pamięci podręcznej musi być w dedykowanym podsieć, która nie zawiera żadnych innych zasobów, z wyjątkiem wystąpienia pamięci podręcznej Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="3663c-121">Aby wdrożyć pamięć podręczna Redis Azure Resource Manager sieci wirtualnej do podsieci podejmowana jest próba zawiera inne zasoby, wdrożenie zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="3663c-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Sieć wirtualna][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="3663c-123">Azure rezerwuje niektórych adresów IP w każdej podsieci, a nie można użyć tych adresów.</span><span class="sxs-lookup"><span data-stu-id="3663c-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="3663c-124">Imię i nazwisko adresów IP podsieci są zastrzeżone dla protokołu zgodność, wraz z trzech więcej adresów używanych na potrzeby usług Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="3663c-125">Aby uzyskać więcej informacji, zobacz [istnieją wszystkie ograniczenia dotyczące używania adresów IP w ramach tych podsieci?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="3663c-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="3663c-126">Oprócz adresy IP używane przez infrastrukturę sieci Wirtualnej Azure Redis każdego wystąpienia w podsieci adresów IP używa dwóch na niezależnych i jeden dodatkowy adres IP usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="3663c-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="3663c-127">Pamięć podręczna nieklastrowanych została uznana za jeden identyfikator niezależnego fragmentu.</span><span class="sxs-lookup"><span data-stu-id="3663c-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="3663c-128">Po utworzeniu pamięci podręcznej konfiguracji sieci wirtualnej można wyświetlić, klikając **sieci wirtualnej** z **zasobów menu**.</span><span class="sxs-lookup"><span data-stu-id="3663c-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Sieć wirtualna][redis-cache-vnet-info]

<span data-ttu-id="3663c-130">Aby połączyć się wystąpienia pamięci podręcznej Azure Redis, korzystając z sieci wirtualnej, określ nazwę hosta w pamięci podręcznej w parametrach połączenia, jak pokazano w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="3663c-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="3663c-131">Sieć wirtualna pamięci podręcznej Azure Redis — często zadawane pytania</span><span class="sxs-lookup"><span data-stu-id="3663c-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="3663c-132">Poniższa lista zawiera odpowiedzi na często zadawane pytania dotyczące skalowania pamięć podręczna Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="3663c-133">Co to są niektórych typowych problemów błędnej konfiguracji sieci wirtualnych i pamięci podręcznej Redis Azure?</span><span class="sxs-lookup"><span data-stu-id="3663c-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="3663c-134">Jak sprawdzić, czy Moje pamięci podręcznej działa w sieci Wirtualnej?</span><span class="sxs-lookup"><span data-stu-id="3663c-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="3663c-135">Sieci wirtualne można używać z standard lub podstawowa pamięci podręcznej?</span><span class="sxs-lookup"><span data-stu-id="3663c-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="3663c-136">Dlaczego Tworzenie pamięci podręcznej Redis powiedzie w niektórych podsieci, a innych nie?</span><span class="sxs-lookup"><span data-stu-id="3663c-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="3663c-137">Jakie są wymagania dotyczące miejsca na adres podsieci?</span><span class="sxs-lookup"><span data-stu-id="3663c-137">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="3663c-138">Wszystkie funkcje pamięci podręcznej działają odnośnie do hostowania pamięci podręcznej w sieci Wirtualnej?</span><span class="sxs-lookup"><span data-stu-id="3663c-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="3663c-139">Co to są niektórych typowych problemów błędnej konfiguracji sieci wirtualnych i pamięci podręcznej Redis Azure?</span><span class="sxs-lookup"><span data-stu-id="3663c-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="3663c-140">Gdy pamięć podręczna Redis Azure znajduje się w sieci wirtualnej, są używane porty w poniższych tabelach.</span><span class="sxs-lookup"><span data-stu-id="3663c-140">When Azure Redis Cache is hosted in a VNet, the ports in the following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="3663c-141">Porty w poniższych tabelach są zablokowane, pamięć podręczna może nie działać prawidłowo.</span><span class="sxs-lookup"><span data-stu-id="3663c-141">If the ports in the following tables are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="3663c-142">Co najmniej jeden z tych portów zablokowane jest najbardziej typowe problemy błędnej konfiguracji przy użyciu pamięci podręcznej Redis Azure w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-142">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="3663c-143">Wymagania dotyczące portów wychodzących</span><span class="sxs-lookup"><span data-stu-id="3663c-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="3663c-144">Wymagania dotyczące portów dla ruchu przychodzącego</span><span class="sxs-lookup"><span data-stu-id="3663c-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="3663c-145">Wymagania dotyczące portów wychodzących</span><span class="sxs-lookup"><span data-stu-id="3663c-145">Outbound port requirements</span></span>

<span data-ttu-id="3663c-146">Istnieje siedem wymagań dotyczących portu wychodzącego.</span><span class="sxs-lookup"><span data-stu-id="3663c-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="3663c-147">Jeśli żądany, wszystkie wychodzące połączenia z Internetem mogą być wprowadzane za pośrednictwem klienta lokalnego inspekcji urządzenia.</span><span class="sxs-lookup"><span data-stu-id="3663c-147">If desired, all outbound connections to the internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="3663c-148">Trzy porty kierować ruchem do punkty końcowe systemu Azure obsługi usługi Azure Storage i Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="3663c-148">Three of the ports route traffic to Azure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="3663c-149">Pozostałe zakresy portów i komunikacji podsieci wewnętrznej pamięci podręcznej Redis.</span><span class="sxs-lookup"><span data-stu-id="3663c-149">The remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="3663c-150">Brak reguł NSG podsieci są niezbędne do komunikacji podsieci wewnętrznej pamięci podręcznej Redis.</span><span class="sxs-lookup"><span data-stu-id="3663c-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="3663c-151">Porty</span><span class="sxs-lookup"><span data-stu-id="3663c-151">Port(s)</span></span> | <span data-ttu-id="3663c-152">Kierunek</span><span class="sxs-lookup"><span data-stu-id="3663c-152">Direction</span></span> | <span data-ttu-id="3663c-153">Protokół transportu</span><span class="sxs-lookup"><span data-stu-id="3663c-153">Transport Protocol</span></span> | <span data-ttu-id="3663c-154">Przeznaczenie</span><span class="sxs-lookup"><span data-stu-id="3663c-154">Purpose</span></span> | <span data-ttu-id="3663c-155">Lokalny adres IP</span><span class="sxs-lookup"><span data-stu-id="3663c-155">Local IP</span></span> | <span data-ttu-id="3663c-156">Zdalny adres IP</span><span class="sxs-lookup"><span data-stu-id="3663c-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="3663c-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="3663c-157">80, 443</span></span> |<span data-ttu-id="3663c-158">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-158">Outbound</span></span> |<span data-ttu-id="3663c-159">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-159">TCP</span></span> |<span data-ttu-id="3663c-160">Redis zależności na platformie Azure magazynu/infrastruktury kluczy publicznych (Internet)</span><span class="sxs-lookup"><span data-stu-id="3663c-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="3663c-161">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="3663c-162">53</span><span class="sxs-lookup"><span data-stu-id="3663c-162">53</span></span> |<span data-ttu-id="3663c-163">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-163">Outbound</span></span> |<span data-ttu-id="3663c-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="3663c-164">TCP/UDP</span></span> |<span data-ttu-id="3663c-165">Redis zależności w systemie DNS (Internet/VNet)</span><span class="sxs-lookup"><span data-stu-id="3663c-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="3663c-166">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="3663c-167">8443</span><span class="sxs-lookup"><span data-stu-id="3663c-167">8443</span></span> |<span data-ttu-id="3663c-168">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-168">Outbound</span></span> |<span data-ttu-id="3663c-169">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-169">TCP</span></span> |<span data-ttu-id="3663c-170">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-170">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-171">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-171">(Redis subnet)</span></span> | <span data-ttu-id="3663c-172">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-172">(Redis subnet)</span></span> |
| <span data-ttu-id="3663c-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="3663c-173">10221-10231</span></span> |<span data-ttu-id="3663c-174">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-174">Outbound</span></span> |<span data-ttu-id="3663c-175">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-175">TCP</span></span> |<span data-ttu-id="3663c-176">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-176">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-177">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-177">(Redis subnet)</span></span> | <span data-ttu-id="3663c-178">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-178">(Redis subnet)</span></span> |
| <span data-ttu-id="3663c-179">20226</span><span class="sxs-lookup"><span data-stu-id="3663c-179">20226</span></span> |<span data-ttu-id="3663c-180">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-180">Outbound</span></span> |<span data-ttu-id="3663c-181">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-181">TCP</span></span> |<span data-ttu-id="3663c-182">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-182">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-183">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-183">(Redis subnet)</span></span> |<span data-ttu-id="3663c-184">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-184">(Redis subnet)</span></span> |
| <span data-ttu-id="3663c-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="3663c-185">13000-13999</span></span> |<span data-ttu-id="3663c-186">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-186">Outbound</span></span> |<span data-ttu-id="3663c-187">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-187">TCP</span></span> |<span data-ttu-id="3663c-188">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-188">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-189">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-189">(Redis subnet)</span></span> |<span data-ttu-id="3663c-190">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-190">(Redis subnet)</span></span> |
| <span data-ttu-id="3663c-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="3663c-191">15000-15999</span></span> |<span data-ttu-id="3663c-192">Wychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-192">Outbound</span></span> |<span data-ttu-id="3663c-193">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-193">TCP</span></span> |<span data-ttu-id="3663c-194">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-194">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-195">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-195">(Redis subnet)</span></span> |<span data-ttu-id="3663c-196">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="3663c-197">Wymagania dotyczące portów dla ruchu przychodzącego</span><span class="sxs-lookup"><span data-stu-id="3663c-197">Inbound port requirements</span></span>

<span data-ttu-id="3663c-198">Ma osiem wymagań zakresu portów przychodzących.</span><span class="sxs-lookup"><span data-stu-id="3663c-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="3663c-199">Żądania przychodzące w tych zakresów są ruch przychodzący z innych usług hostowanych w tej samej sieci Wirtualnej lub wewnętrzny komunikacja podsieci Redis.</span><span class="sxs-lookup"><span data-stu-id="3663c-199">Inbound requests in these ranges are either inbound from other services hosted in the same VNET or internal to the Redis subnet communications.</span></span>

| <span data-ttu-id="3663c-200">Porty</span><span class="sxs-lookup"><span data-stu-id="3663c-200">Port(s)</span></span> | <span data-ttu-id="3663c-201">Kierunek</span><span class="sxs-lookup"><span data-stu-id="3663c-201">Direction</span></span> | <span data-ttu-id="3663c-202">Protokół transportu</span><span class="sxs-lookup"><span data-stu-id="3663c-202">Transport Protocol</span></span> | <span data-ttu-id="3663c-203">Przeznaczenie</span><span class="sxs-lookup"><span data-stu-id="3663c-203">Purpose</span></span> | <span data-ttu-id="3663c-204">Lokalny adres IP</span><span class="sxs-lookup"><span data-stu-id="3663c-204">Local IP</span></span> | <span data-ttu-id="3663c-205">Zdalny adres IP</span><span class="sxs-lookup"><span data-stu-id="3663c-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="3663c-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="3663c-206">6379, 6380</span></span> |<span data-ttu-id="3663c-207">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-207">Inbound</span></span> |<span data-ttu-id="3663c-208">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-208">TCP</span></span> |<span data-ttu-id="3663c-209">Komunikacja klienta do serwera Redis, równoważenia obciążenia Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-209">Client communication to Redis, Azure load balancing</span></span> | <span data-ttu-id="3663c-210">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-210">(Redis subnet)</span></span> |<span data-ttu-id="3663c-211">Sieć wirtualna Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="3663c-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="3663c-212">8443</span><span class="sxs-lookup"><span data-stu-id="3663c-212">8443</span></span> |<span data-ttu-id="3663c-213">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-213">Inbound</span></span> |<span data-ttu-id="3663c-214">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-214">TCP</span></span> |<span data-ttu-id="3663c-215">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-215">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-216">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-216">(Redis subnet)</span></span> |<span data-ttu-id="3663c-217">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-217">(Redis subnet)</span></span> |
| <span data-ttu-id="3663c-218">8500</span><span class="sxs-lookup"><span data-stu-id="3663c-218">8500</span></span> |<span data-ttu-id="3663c-219">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-219">Inbound</span></span> |<span data-ttu-id="3663c-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="3663c-220">TCP/UDP</span></span> |<span data-ttu-id="3663c-221">Równoważenia obciążenia Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-221">Azure load balancing</span></span> | <span data-ttu-id="3663c-222">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-222">(Redis subnet)</span></span> |<span data-ttu-id="3663c-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="3663c-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="3663c-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="3663c-224">10221-10231</span></span> |<span data-ttu-id="3663c-225">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-225">Inbound</span></span> |<span data-ttu-id="3663c-226">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-226">TCP</span></span> |<span data-ttu-id="3663c-227">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-227">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-228">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-228">(Redis subnet)</span></span> |<span data-ttu-id="3663c-229">(Redis podsieć), usługi równoważenia obciążenia Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="3663c-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="3663c-230">13000-13999</span></span> |<span data-ttu-id="3663c-231">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-231">Inbound</span></span> |<span data-ttu-id="3663c-232">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-232">TCP</span></span> |<span data-ttu-id="3663c-233">Komunikacja z klientem Redis klastrów równoważenia obciążenia Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-233">Client communication to Redis Clusters, Azure load balancing</span></span> | <span data-ttu-id="3663c-234">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-234">(Redis subnet)</span></span> |<span data-ttu-id="3663c-235">Sieć wirtualna Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="3663c-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="3663c-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="3663c-236">15000-15999</span></span> |<span data-ttu-id="3663c-237">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-237">Inbound</span></span> |<span data-ttu-id="3663c-238">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-238">TCP</span></span> |<span data-ttu-id="3663c-239">Komunikacji z klientem Redis klastrów równoważenia obciążenia Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-239">Client communication to Redis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="3663c-240">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-240">(Redis subnet)</span></span> |<span data-ttu-id="3663c-241">Sieć wirtualna Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="3663c-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="3663c-242">16001</span><span class="sxs-lookup"><span data-stu-id="3663c-242">16001</span></span> |<span data-ttu-id="3663c-243">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-243">Inbound</span></span> |<span data-ttu-id="3663c-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="3663c-244">TCP/UDP</span></span> |<span data-ttu-id="3663c-245">Równoważenia obciążenia Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-245">Azure load balancing</span></span> | <span data-ttu-id="3663c-246">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-246">(Redis subnet)</span></span> |<span data-ttu-id="3663c-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="3663c-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="3663c-248">20226</span><span class="sxs-lookup"><span data-stu-id="3663c-248">20226</span></span> |<span data-ttu-id="3663c-249">Przychodzący</span><span class="sxs-lookup"><span data-stu-id="3663c-249">Inbound</span></span> |<span data-ttu-id="3663c-250">TCP</span><span class="sxs-lookup"><span data-stu-id="3663c-250">TCP</span></span> |<span data-ttu-id="3663c-251">Wewnętrzny komunikację z usługą Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-251">Internal communications for Redis</span></span> | <span data-ttu-id="3663c-252">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-252">(Redis subnet)</span></span> |<span data-ttu-id="3663c-253">(Redis podsieci)</span><span class="sxs-lookup"><span data-stu-id="3663c-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="3663c-254">Dodatkowe wymagania dotyczące łączności sieci sieci Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="3663c-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="3663c-255">Istnieją wymagania dotyczące łączności sieciowej pamięci podręcznej Redis Azure nie może być początkowo spełnieniu w sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="3663c-256">Pamięć podręczna Redis Azure wymaga następujących elementów działał poprawnie, gdy jest używany w ramach sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-256">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="3663c-257">Połączenie sieciowe ruchu wychodzącego punktów końcowych usługi Azure Storage na całym świecie.</span><span class="sxs-lookup"><span data-stu-id="3663c-257">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="3663c-258">Obejmuje to punkty końcowe znajduje się w tym samym regionie co wystąpienia pamięci podręcznej Redis Azure, a także punkty końcowe usługi storage znajduje się w **innych** regiony platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-258">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="3663c-259">Punkty końcowe usługi Azure Storage rozwiązania w obszarze następujące domeny DNS: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, i *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="3663c-259">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="3663c-260">Połączenie sieciowe ruchu wychodzącego *ocsp.msocsp.com*, *mscrl.microsoft.com*, i *crl.microsoft.com*. To połączenie jest potrzebne do obsługi funkcji protokołu SSL.</span><span class="sxs-lookup"><span data-stu-id="3663c-260">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="3663c-261">Konfiguracja DNS dla sieci wirtualnej musi umożliwiać rozpoznawania wszystkich punktów końcowych i domen wspomnianego z wcześniejszych punktów.</span><span class="sxs-lookup"><span data-stu-id="3663c-261">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="3663c-262">W celu zapewnienia prawidłowy infrastruktura DNS jest skonfigurowany i dla sieci wirtualnej można spełnić te wymagania systemu DNS.</span><span class="sxs-lookup"><span data-stu-id="3663c-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="3663c-263">Połączenie sieciowe ruchu wychodzącego do następujących monitorowania Azure punktów końcowych, które rozwiązanie w obszarze następujące domeny DNS: shoebox2 black.shoebox2.metrics.nsatc.net, prod2.prod2.metrics.nsatc.net Północna, azglobal black.azglobal.metrics.nsatc.net, shoebox2 red.shoebox2.metrics.nsatc.net prod2.prod2.metrics.nsatc.net Wschodnia, azglobal red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="3663c-263">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="3663c-264">Jak sprawdzić, czy Moje pamięci podręcznej działa w sieci Wirtualnej?</span><span class="sxs-lookup"><span data-stu-id="3663c-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="3663c-265">Podczas nawiązywania połączenia z wystąpieniem usługi pamięć podręczna Redis Azure, który znajduje się w sieci Wirtualnej, klienci pamięci podręcznej musi być w tej samej sieci Wirtualnej, w tym testowanie aplikacji ani badanie narzędzia diagnostyczne.</span><span class="sxs-lookup"><span data-stu-id="3663c-265">When connecting to an Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in the same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="3663c-266">Gdy wymagania dotyczące portów są skonfigurowane zgodnie z opisem w poprzedniej sekcji, można sprawdzić, czy pamięć podręczna działa, wykonując następujące czynności.</span><span class="sxs-lookup"><span data-stu-id="3663c-266">Once the port requirements are configured as described in the previous section, you can verify that your cache is working by performing the following steps.</span></span>

- <span data-ttu-id="3663c-267">[Ponowny rozruch](cache-administration.md#reboot) wszystkich węzłów pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-267">[Reboot](cache-administration.md#reboot) all of the cache nodes.</span></span> <span data-ttu-id="3663c-268">Jeśli wszystkie zależności wymagane pamięci podręcznej nie można nawiązać połączenia (zgodnie z opisem w [ruchu przychodzącego wymagania dotyczące portów](cache-how-to-premium-vnet.md#inbound-port-requirements) i [wymagania dotyczące portów wychodzących](cache-how-to-premium-vnet.md#outbound-port-requirements)), pamięć podręczna nie będzie można pomyślnie uruchomić ponownie.</span><span class="sxs-lookup"><span data-stu-id="3663c-268">If all of the required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), the cache won't be able to restart successfully.</span></span>
- <span data-ttu-id="3663c-269">Po węzłami pamięci podręcznej ponownym uruchomieniu (określone przez stan pamięci podręcznej w portalu Azure), można wykonać następujące testy:</span><span class="sxs-lookup"><span data-stu-id="3663c-269">Once the cache nodes have restarted (as reported by the cache status in the Azure portal), you can perform the following tests:</span></span>
  - <span data-ttu-id="3663c-270">polecenie ping punktem końcowym (przy użyciu portu 6380) z komputera, który znajduje się w tej samej sieci Wirtualnej jako pamięci podręcznej, za pomocą [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="3663c-270">ping the cache endpoint (using port 6380) from a machine that is within the same VNET as the cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="3663c-271">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="3663c-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="3663c-272">Jeśli `tcping` narzędzie informuje, że port jest otwarty, pamięć podręczna jest dostępny dla połączeń z klientami w sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-272">If the `tcping` tool reports that the port is open, the cache is available for connection from clients in the VNET.</span></span>

  - <span data-ttu-id="3663c-273">Innym sposobem testu jest utworzenie klienta pamięci podręcznej testu (które może być prostą aplikację konsoli przy użyciu programie StackExchange.Redis) który łączy do pamięci podręcznej i dodaje oraz pobiera niektóre elementy z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-273">Another way to test is to create a test cache client (which could be a simple console application using StackExchange.Redis) that connects to the cache and adds and retrieves some items from the cache.</span></span> <span data-ttu-id="3663c-274">Zainstaluj klienta przykładowe na maszynę Wirtualną, która znajduje się w tej samej sieci Wirtualnej jako pamięci podręcznej i uruchom go do weryfikowania łączności do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-274">Install the sample client application onto a VM that is in the same VNET as the cache and run it to verify connectivity to the cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="3663c-275">Sieci wirtualne można używać z standard lub podstawowa pamięci podręcznej?</span><span class="sxs-lookup"><span data-stu-id="3663c-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="3663c-276">Sieci wirtualne można używać tylko z pamięci podręcznych premium.</span><span class="sxs-lookup"><span data-stu-id="3663c-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="3663c-277">Dlaczego Tworzenie pamięci podręcznej Redis powiedzie w niektórych podsieci, a innych nie?</span><span class="sxs-lookup"><span data-stu-id="3663c-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="3663c-278">Jeśli wdrażasz pamięć podręczna Redis Azure Resource Manager sieci wirtualnej pamięci podręcznej musi być w dedykowanym podsieci, która zawiera inny typ zasobu.</span><span class="sxs-lookup"><span data-stu-id="3663c-278">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="3663c-279">Jeśli próby wdrożenia pamięć podręczna Redis Azure do podsieci sieci wirtualnej Menedżera zasobów zawiera inne zasoby, wdrożenie zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="3663c-279">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="3663c-280">Przed utworzeniem nowej pamięci podręcznej Redis, należy usunąć istniejące zasoby w tej podsieci.</span><span class="sxs-lookup"><span data-stu-id="3663c-280">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="3663c-281">Można wdrożyć wiele typów zasobów klasycznych sieci wirtualnej, tak długo, jak długo ma za mało dostępnych adresów IP.</span><span class="sxs-lookup"><span data-stu-id="3663c-281">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="3663c-282">Jakie są wymagania dotyczące miejsca na adres podsieci?</span><span class="sxs-lookup"><span data-stu-id="3663c-282">What are the subnet address space requirements?</span></span>
<span data-ttu-id="3663c-283">Azure rezerwuje niektórych adresów IP w każdej podsieci, a nie można użyć tych adresów.</span><span class="sxs-lookup"><span data-stu-id="3663c-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="3663c-284">Imię i nazwisko adresów IP podsieci są zastrzeżone dla protokołu zgodność, wraz z trzech więcej adresów używanych na potrzeby usług Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-284">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="3663c-285">Aby uzyskać więcej informacji, zobacz [istnieją wszystkie ograniczenia dotyczące używania adresów IP w ramach tych podsieci?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="3663c-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="3663c-286">Oprócz adresy IP używane przez infrastrukturę sieci Wirtualnej Azure Redis każdego wystąpienia w podsieci adresów IP używa dwóch na niezależnych i jeden dodatkowy adres IP usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="3663c-286">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="3663c-287">Pamięć podręczna nieklastrowanych została uznana za jeden identyfikator niezależnego fragmentu.</span><span class="sxs-lookup"><span data-stu-id="3663c-287">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="3663c-288">Wszystkie funkcje pamięci podręcznej działają odnośnie do hostowania pamięci podręcznej w sieci Wirtualnej?</span><span class="sxs-lookup"><span data-stu-id="3663c-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="3663c-289">Jeśli pamięć podręczna jest częścią sieci Wirtualnej, tylko klienci w sieci Wirtualnej można uzyskać dostępu do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-289">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="3663c-290">W związku z tym następujące funkcje zarządzania pamięci podręcznej nie działają w tej chwili.</span><span class="sxs-lookup"><span data-stu-id="3663c-290">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="3663c-291">Redis konsoli — konsoli Redis jest uruchamiana w przeglądarce lokalnego znajduje się poza siecią Wirtualną, nie może nawiązać połączenia z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-291">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="3663c-292">Użyj usługi ExpressRoute z pamięcią podręczną Azure Redis</span><span class="sxs-lookup"><span data-stu-id="3663c-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="3663c-293">Klienci mogą się łączyć [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) obwód do infrastruktury sieci wirtualnej, a więc rozszerzenia sieci lokalnej na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="3663c-294">Domyślnie nowo utworzony obwodu usługi expressroute nie tunelowanie wymuszone (anons trasę domyślną wartość 0.0.0.0/0) w sieci Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="3663c-295">W związku z tym wychodzące połączenie internetowe jest dozwolona bezpośrednio z siecią Wirtualną i aplikacje klienckie mogą nawiązać połączenia z innymi punkty końcowe systemu Azure, łącznie z pamięcią podręczną Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-295">As a result, outbound Internet connectivity is allowed directly from the VNET and client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="3663c-296">Jednak typowych konfiguracji klienta jest użycie wymuszonego tunelowania (anonsowanie trasy domyślnej) który wymusza wychodzący ruch internetowy, zamiast niego przepływ lokalnymi.</span><span class="sxs-lookup"><span data-stu-id="3663c-296">However a common customer configuration is to use forced tunneling (advertise a default route) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="3663c-297">Ten przepływ ruchu przerywa połączenie z pamięcią podręczną Redis Azure w przypadku ruchu wychodzącego, a następnie zablokowany lokalnymi w taki sposób, że wystąpienie pamięci podręcznej Redis Azure nie jest w stanie nawiązać połączenia z jego zależności.</span><span class="sxs-lookup"><span data-stu-id="3663c-297">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="3663c-298">Rozwiązanie jest określenie jednego (lub więcej) trasy zdefiniowane przez użytkownika (Udr) na podsieci, która zawiera pamięci podręcznej Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-298">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="3663c-299">PRZEZ definiuje tras specyficzne dla podsieci, które będą honorowane zamiast trasy domyślnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-299">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="3663c-300">Jeśli to możliwe zaleca się następującej konfiguracji:</span><span class="sxs-lookup"><span data-stu-id="3663c-300">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="3663c-301">Konfiguracji usługi ExpressRoute anonsuje 0.0.0.0/0 i domyślnie życie tuneli wszystkich ruch wychodzący lokalnymi.</span><span class="sxs-lookup"><span data-stu-id="3663c-301">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="3663c-302">PRZEZ stosowana do podsieci, zawierający pamięci podręcznej Redis Azure definiuje 0.0.0.0/0 trasa pracy dla ruchu protokołu TCP/IP do publicznego Internetu; na przykład przez ustawienie Typ następnego przeskoku "Internet".</span><span class="sxs-lookup"><span data-stu-id="3663c-302">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="3663c-303">Łączna te kroki powoduje, że poziomie podsieci przez ma pierwszeństwo przed ExpressRoute, wymuszone tunelowanie, w związku z tym zapewnienie wychodzący dostęp do Internetu z pamięci podręcznej Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-303">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="3663c-304">Łączenie do wystąpienia pamięci podręcznej Redis Azure z aplikacji lokalnych przy użyciu usługi ExpressRoute nie jest typowy sposób scenariusza z powodów wydajności (Aby uzyskać najlepszą wydajność pamięci podręcznej Redis Azure klienci powinni mieć w tym samym regionie co pamięć podręczna Redis Azure).</span><span class="sxs-lookup"><span data-stu-id="3663c-304">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="3663c-305">Trasy zdefiniowane w przez **musi** jest wystarczająco konkretny, aby mają pierwszeństwo względem dowolnego trasy anonsowane przez konfiguracji usługi ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3663c-305">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="3663c-306">Poniższy przykład używa 0.0.0.0/0 szeroki zakres adresów i jako taki może potencjalnie być przypadkowo przesłonięta przez anonsów tras za pomocą bardziej szczegółowych zakresów adresów.</span><span class="sxs-lookup"><span data-stu-id="3663c-306">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="3663c-307">Pamięć podręczna Redis Azure nie jest obsługiwany w konfiguracji usługi ExpressRoute który **niepoprawnie cross anonsować tras z publicznej komunikacji równorzędnej ścieżki do ścieżki prywatnej komunikacji równorzędnej**.</span><span class="sxs-lookup"><span data-stu-id="3663c-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="3663c-308">Konfiguracji usługi ExpressRoute, które mają publicznej komunikacji równorzędnej skonfigurowane, otrzymywać anonsów tras od firmy Microsoft dla dużych zestawów zakresów adresów IP firmy Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="3663c-309">Jeśli te zakresy adresów są niepoprawnie cross anonsowany w ścieżce prywatnej komunikacji równorzędnej, wynik są wszystkie pakiety wychodzącego z podsieci wystąpienia pamięci podręcznej Redis Azure niepoprawnie force-tunneled do infrastruktury sieci lokalnej klienta.</span><span class="sxs-lookup"><span data-stu-id="3663c-309">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="3663c-310">Ten przepływ sieci dzieli pamięci podręcznej Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="3663c-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="3663c-311">Rozwiązanie tego problemu jest zatrzymanie tras między reklam z publicznej komunikacji równorzędnej ścieżki do ścieżki prywatnej komunikacji równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="3663c-311">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="3663c-312">Informacje na trasach zdefiniowanych przez użytkownika jest dostępna w tym [omówienie](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="3663c-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="3663c-313">Aby uzyskać więcej informacji na temat połączenia ExpressRoute, zobacz [opis techniczny ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="3663c-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="3663c-314">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="3663c-314">Next steps</span></span>
<span data-ttu-id="3663c-315">Dowiedz się, jak korzystać z funkcji premium więcej w pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="3663c-315">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="3663c-316">Wprowadzenie do warstwy Premium pamięci podręcznej Redis Azure</span><span class="sxs-lookup"><span data-stu-id="3663c-316">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

