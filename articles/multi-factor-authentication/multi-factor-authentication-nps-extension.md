---
title: "Użyj istniejącego serwera NPS, aby zapewnić możliwości usługi Azure MFA | Dokumentacja firmy Microsoft"
description: "Serwer zasad sieciowych rozszerzenie Azure Multi-Factor Authentication jest prostym rozwiązaniem, umożliwiające dodanie funkcji vericiation dwuetapowej oparte na chmurze do istniejącej infrastruktury uwierzytelniania."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/14/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: H1Hack27Feb2017; it-pro
ms.openlocfilehash: fa125292ee85bd9b5329cffeff7f076d3002cbf3
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/29/2017
---
# <a name="integrate-your-existing-nps-infrastructure-with-azure-multi-factor-authentication"></a><span data-ttu-id="897c4-103">Integracja istniejącej infrastrukturze serwera NPS z usługi Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="897c4-103">Integrate your existing NPS infrastructure with Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="897c4-104">Rozszerzenia serwera zasad sieciowych (NPS) dla usługi Azure MFA dodaje możliwości usługi MFA oparte na chmurze do uwierzytelniania przy użyciu istniejących serwerów infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="897c4-104">The Network Policy Server (NPS) extension for Azure MFA adds cloud-based MFA capabilities to your authentication infrastructure using your existing servers.</span></span> <span data-ttu-id="897c4-105">Z rozszerzeniem serwera zasad Sieciowych można dodać połączenie telefoniczne, wiadomość tekstowa lub weryfikacji aplikacji telefonicznej z istniejących przepływ uwierzytelniania bez konieczności instalowania, konfigurowania i konserwacji nowe serwery.</span><span class="sxs-lookup"><span data-stu-id="897c4-105">With the NPS extension, you can add phone call, text message, or phone app verification to your existing authentication flow without having to install, configure, and maintain new servers.</span></span> 

<span data-ttu-id="897c4-106">To rozszerzenie został utworzony dla organizacji, które chcesz chronić połączenia sieci VPN bez wdrażania serwera usługi Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-106">This extension was created for organizations that want to protect VPN connections without deploying the Azure MFA Server.</span></span> <span data-ttu-id="897c4-107">Rozszerzenia serwera NPS działa jako karty sieciowej między usługi RADIUS i oparte na chmurze usługi Azure MFA, aby zapewnić drugi składnik uwierzytelniania federacyjnego lub zsynchronizowanych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="897c4-107">The NPS extension acts as an adapter between RADIUS and cloud-based Azure MFA to provide a second factor of authentication for federated or synced users.</span></span>

<span data-ttu-id="897c4-108">W przypadku używania rozszerzenia serwera zasad Sieciowych dla usługi Azure MFA, przepływ uwierzytelniania obejmuje następujące składniki:</span><span class="sxs-lookup"><span data-stu-id="897c4-108">When using the NPS extension for Azure MFA, the authentication flow includes the following components:</span></span> 

1. <span data-ttu-id="897c4-109">**Serwer NAS lub sieć VPN** odbiera żądania od klientów sieci VPN i konwertuje je na żądań RADIUS do serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-109">**NAS/VPN Server** receives requests from VPN clients and converts them into RADIUS requests to NPS servers.</span></span> 
2. <span data-ttu-id="897c4-110">**Serwer NPS** łączy do usługi Active Directory w celu przeprowadzenia podstawowego uwierzytelniania dla żądań RADIUS, a na sukces, przekazuje żądanie do wszystkich zainstalowanych rozszerzeń.</span><span class="sxs-lookup"><span data-stu-id="897c4-110">**NPS Server** connects to Active Directory to perform the primary authentication for the RADIUS requests and, upon success, passes the request to any installed extensions.</span></span>  
3. <span data-ttu-id="897c4-111">**Rozszerzenia serwera NPS** wyzwala żądania do usługi Azure MFA dodatkowego uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="897c4-111">**NPS Extension** triggers a request to Azure MFA for the secondary authentication.</span></span> <span data-ttu-id="897c4-112">Po rozszerzenia odbiera odpowiedź, a jeśli żądanie uwierzytelniania MFA zakończy się powodzeniem, kończy żądanie uwierzytelniania podając tokeny zabezpieczające, które obejmują oświadczenia MFA na serwerze NPS, wystawiony przez usługę STS Azure.</span><span class="sxs-lookup"><span data-stu-id="897c4-112">Once the extension receives the response, and if the MFA challenge succeeds, it completes the authentication request by providing the NPS server with security tokens that include an MFA claim, issued by Azure STS.</span></span>  
4. <span data-ttu-id="897c4-113">**Usługa Azure MFA** komunikuje się z usługą Azure Active Directory można pobrać szczegółów użytkownika i wykonuje dodatkowego uwierzytelniania przy użyciu metody weryfikacji skonfigurowane dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="897c4-113">**Azure MFA** communicates with Azure Active Directory to retrieve the user’s details and performs the secondary authentication using a verification method configured to the user.</span></span>

<span data-ttu-id="897c4-114">Na poniższym diagramie przedstawiono ten proces żądania uwierzytelniania wysokiego poziomu:</span><span class="sxs-lookup"><span data-stu-id="897c4-114">The following diagram illustrates this high-level authentication request flow:</span></span> 

![Diagram przepływu uwierzytelniania](./media/multi-factor-authentication-nps-extension/auth-flow.png)

## <a name="plan-your-deployment"></a><span data-ttu-id="897c4-116">Planowanie wdrożenia</span><span class="sxs-lookup"><span data-stu-id="897c4-116">Plan your deployment</span></span>

<span data-ttu-id="897c4-117">Rozszerzenia serwera zasad Sieciowych automatycznie obsługuje nadmiarowość, więc nie trzeba specjalnej konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="897c4-117">The NPS extension automatically handles redundancy, so you don't need a special configuration.</span></span>

<span data-ttu-id="897c4-118">Można utworzyć dowolną liczbę serwerów NPS z włączoną usługą Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-118">You can create as many Azure MFA-enabled NPS servers as you need.</span></span> <span data-ttu-id="897c4-119">W przypadku instalowania wielu serwerów, należy użyć certyfikatu klienta różnicy dla każdego z nich.</span><span class="sxs-lookup"><span data-stu-id="897c4-119">If you do install multiple servers, you should use a difference client certificate for each one of them.</span></span> <span data-ttu-id="897c4-120">Tworzenie certyfikatu dla każdego serwera oznacza indywidualnie zaktualizować każdego certyfikatu, a nie martw się o przestoju na wszystkich serwerach.</span><span class="sxs-lookup"><span data-stu-id="897c4-120">Creating a cert for each server means that you can update each cert individually, and not worry about downtime across all your servers.</span></span>

<span data-ttu-id="897c4-121">Serwery sieci VPN trasy żądania uwierzytelniania, dlatego należy zwrócić uwagę na nowe serwery NPS z włączoną usługą Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-121">VPN servers route authentication requests, so they need to be aware of the new Azure MFA-enabled NPS servers.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="897c4-122">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="897c4-122">Prerequisites</span></span>

<span data-ttu-id="897c4-123">Rozszerzenia serwera NPS jest przeznaczona do pracy z istniejącej infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="897c4-123">The NPS extension is meant to work with your existing infrastructure.</span></span> <span data-ttu-id="897c4-124">Upewnij się, że zostały spełnione następujące wymagania wstępne, przed rozpoczęciem.</span><span class="sxs-lookup"><span data-stu-id="897c4-124">Make sure you have the following prerequisites before you begin.</span></span>

### <a name="licenses"></a><span data-ttu-id="897c4-125">Licencje</span><span class="sxs-lookup"><span data-stu-id="897c4-125">Licenses</span></span>

<span data-ttu-id="897c4-126">Rozszerzenia serwera zasad Sieciowych dla usługi Azure MFA jest dostępny dla klientów z [licencji dla usługi Azure Multi-Factor Authentication](multi-factor-authentication.md) (dołączony do usługi Azure AD Premium, EMS lub subskrypcji usługi MFA).</span><span class="sxs-lookup"><span data-stu-id="897c4-126">The NPS Extension for Azure MFA is available to customers with [licenses for Azure Multi-Factor Authentication](multi-factor-authentication.md) (included with Azure AD Premium, EMS, or an MFA subscription).</span></span>

### <a name="software"></a><span data-ttu-id="897c4-127">Oprogramowanie</span><span class="sxs-lookup"><span data-stu-id="897c4-127">Software</span></span>

<span data-ttu-id="897c4-128">Windows Server 2008 R2 z dodatkiem SP1 lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="897c4-128">Windows Server 2008 R2 SP1 or above.</span></span>

### <a name="libraries"></a><span data-ttu-id="897c4-129">Biblioteki</span><span class="sxs-lookup"><span data-stu-id="897c4-129">Libraries</span></span>

<span data-ttu-id="897c4-130">Te biblioteki są automatycznie instalowane z rozszerzeniem.</span><span class="sxs-lookup"><span data-stu-id="897c4-130">These libraries are installed automatically with the extension.</span></span>
-   [<span data-ttu-id="897c4-131">Pakiety redystrybucyjne języka Visual C++ dla programu Visual Studio 2013 (X64)</span><span class="sxs-lookup"><span data-stu-id="897c4-131">Visual C++ Redistributable Packages for Visual Studio 2013 (X64)</span></span>](https://www.microsoft.com/download/details.aspx?id=40784)
-   [<span data-ttu-id="897c4-132">Microsoft Azure Active Directory modułu dla Windows PowerShell w wersji 1.1.166.0</span><span class="sxs-lookup"><span data-stu-id="897c4-132">Microsoft Azure Active Directory Module for Windows PowerShell version 1.1.166.0</span></span>](https://connect.microsoft.com/site1164/Downloads/DownloadDetails.aspx?DownloadID=59185)

### <a name="azure-active-directory"></a><span data-ttu-id="897c4-133">Usługa Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="897c4-133">Azure Active Directory</span></span>

<span data-ttu-id="897c4-134">Wszyscy przy użyciu rozszerzenia zasad Sieciowych musi być synchronizowane z usługi Azure Active Directory za pomocą usługi Azure AD Connect, a musi być zarejestrowana w usłudze MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-134">Everyone using the NPS extension must be synced to Azure Active Directory using Azure AD Connect, and must be registered for MFA.</span></span>

<span data-ttu-id="897c4-135">Po zainstalowaniu rozszerzenia należy poświadczenia identyfikator i administratora katalogu dla dzierżawy usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="897c4-135">When you install the extension, you need the directory ID and admin credentials for your Azure AD tenant.</span></span> <span data-ttu-id="897c4-136">Można znaleźć Identyfikatora katalogu w [portalu Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="897c4-136">You can find your directory ID in the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="897c4-137">Zaloguj się jako administrator, wybierz opcję **usługi Azure Active Directory** ikony po lewej stronie, następnie wybierz **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="897c4-137">Sign in as an administrator, select the **Azure Active Directory** icon on the left, then select **Properties**.</span></span> <span data-ttu-id="897c4-138">Skopiuj identyfikator GUID w **identyfikator katalogu** i zapisz go.</span><span class="sxs-lookup"><span data-stu-id="897c4-138">Copy the GUID in the **Directory ID** box and save it.</span></span> <span data-ttu-id="897c4-139">Należy użyć tego identyfikatora GUID jako Identyfikatora dzierżawy, po zainstalowaniu rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-139">You use this GUID as the tenant ID when you install the NPS extension.</span></span>

![Znajdź swój identyfikator katalogu we właściwościach usługi Azure Active Directory](./media/multi-factor-authentication-nps-extension/find-directory-id.png)

## <a name="prepare-your-environment"></a><span data-ttu-id="897c4-141">Przygotowywanie środowiska</span><span class="sxs-lookup"><span data-stu-id="897c4-141">Prepare your environment</span></span>

<span data-ttu-id="897c4-142">Przed zainstalowaniem rozszerzenia serwera zasad Sieciowych, które chcesz przygotować możesz środowiska do obsługi ruchu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="897c4-142">Before you install the NPS extension, you want to prepare you environment to handle the authentication traffic.</span></span>

### <a name="enable-the-nps-role-on-a-domain-joined-server"></a><span data-ttu-id="897c4-143">Włączanie roli serwera NPS na serwerze przyłączonym do domeny</span><span class="sxs-lookup"><span data-stu-id="897c4-143">Enable the NPS role on a domain-joined server</span></span>

<span data-ttu-id="897c4-144">Serwer zasad Sieciowych łączy do usługi Azure Active Directory i uwierzytelnia żądania usługi MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-144">The NPS server connects to Azure Active Directory and authenticates the MFA requests.</span></span> <span data-ttu-id="897c4-145">Należy wybrać serwer dla tej roli.</span><span class="sxs-lookup"><span data-stu-id="897c4-145">Choose one server for this role.</span></span> <span data-ttu-id="897c4-146">Firma Microsoft zaleca, wybierając serwer, który nie obsłuży żądania od innych usług, ponieważ rozszerzenia serwera NPS zgłasza błędów dla żądań, które nie są usługi RADIUS.</span><span class="sxs-lookup"><span data-stu-id="897c4-146">We recommend choosing a server that doesn't handle requests from other services, because the NPS extension throws errors for any requests that aren't RADIUS.</span></span>

1. <span data-ttu-id="897c4-147">Na serwerze otwórz **Kreatora dodawania ról i funkcji** w menu Menedżera serwera — Szybki Start.</span><span class="sxs-lookup"><span data-stu-id="897c4-147">On your server, open the **Add Roles and Features Wizard** from the Server Manager Quickstart menu.</span></span>
2. <span data-ttu-id="897c4-148">Wybierz **Instalacja roli lub funkcji** dla danego typu instalacji.</span><span class="sxs-lookup"><span data-stu-id="897c4-148">Choose **Role-based or feature-based installation** for your installation type.</span></span>
3. <span data-ttu-id="897c4-149">Wybierz **usług zasad sieciowych i dostępu** roli serwera.</span><span class="sxs-lookup"><span data-stu-id="897c4-149">Select the **Network Policy and Access Services** server role.</span></span> <span data-ttu-id="897c4-150">Okno wyskakujące może informujące o wymaganych funkcji, aby uruchomić tę rolę.</span><span class="sxs-lookup"><span data-stu-id="897c4-150">A window may pop up to inform you of required features to run this role.</span></span>
4. <span data-ttu-id="897c4-151">Kontynuuj pracę z kreatorem, aż do strony potwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="897c4-151">Continue through the wizard until the Confirmation page.</span></span> <span data-ttu-id="897c4-152">Wybierz **zainstalować**.</span><span class="sxs-lookup"><span data-stu-id="897c4-152">Select **Install**.</span></span>

<span data-ttu-id="897c4-153">Teraz, gdy masz serwer wyznaczony serwera zasad sieciowych, należy także skonfigurować ten serwer do obsługi przychodzących żądań RADIUS z rozwiązania sieci VPN.</span><span class="sxs-lookup"><span data-stu-id="897c4-153">Now that you have a server designated for NPS, you should also configure this server to handle incoming RADIUS requests from the VPN solution.</span></span>

### <a name="configure-your-vpn-solution-to-communicate-with-the-nps-server"></a><span data-ttu-id="897c4-154">Skonfiguruj rozwiązanie sieci VPN do komunikacji z serwerem zasad Sieciowych</span><span class="sxs-lookup"><span data-stu-id="897c4-154">Configure your VPN solution to communicate with the NPS server</span></span>

<span data-ttu-id="897c4-155">W zależności od tego, które rozwiązanie sieci VPN, należy użyć różnią się kroki, aby skonfigurować zasady uwierzytelniania usługi RADIUS.</span><span class="sxs-lookup"><span data-stu-id="897c4-155">Depending on which VPN solution you use, the steps to configure your RADIUS authentication policy vary.</span></span> <span data-ttu-id="897c4-156">Konfigurowanie tej zasady, aby wskazywały serwer usługi RADIUS serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-156">Configure this policy to point to your RADIUS NPS server.</span></span>

### <a name="sync-domain-users-to-the-cloud"></a><span data-ttu-id="897c4-157">Użytkownicy domeny synchronizacji w chmurze</span><span class="sxs-lookup"><span data-stu-id="897c4-157">Sync domain users to the cloud</span></span>

<span data-ttu-id="897c4-158">Ten krok może już zostać ukończone na swojej dzierżawy, ale warto dokładnie sprawdzić, czy usługa Azure AD Connect został zsynchronizowany baz danych.</span><span class="sxs-lookup"><span data-stu-id="897c4-158">This step may already be complete on your tenant, but it's good to double-check that Azure AD Connect has synchronized your databases recently.</span></span>

1. <span data-ttu-id="897c4-159">Zaloguj się do witryny [Azure Portal](https://portal.azure.com) jako administrator.</span><span class="sxs-lookup"><span data-stu-id="897c4-159">Sign in to the [Azure portal](https://portal.azure.com) as an administrator.</span></span>
2. <span data-ttu-id="897c4-160">Wybierz **usługi Azure Active Directory** > **programu Azure AD Connect**</span><span class="sxs-lookup"><span data-stu-id="897c4-160">Select **Azure Active Directory** > **Azure AD Connect**</span></span>
3. <span data-ttu-id="897c4-161">Sprawdź, czy stan synchronizacji **włączone** i który ostatniej synchronizacji był mniejszy niż godzinę temu.</span><span class="sxs-lookup"><span data-stu-id="897c4-161">Verify that your sync status is **Enabled** and that your last sync was less than an hour ago.</span></span>

<span data-ttu-id="897c4-162">Jeśli chcesz rozpocząć poza nowe round synchronizacji, nam zgodnie z instrukcjami w [synchronizacja programu Azure AD Connect: harmonogram](../active-directory/connect/active-directory-aadconnectsync-feature-scheduler.md#start-the-scheduler).</span><span class="sxs-lookup"><span data-stu-id="897c4-162">If you need to kick off a new round of synchronization, us the instructions in [Azure AD Connect sync: Scheduler](../active-directory/connect/active-directory-aadconnectsync-feature-scheduler.md#start-the-scheduler).</span></span>

### <a name="determine-which-authentication-methods-your-users-can-use"></a><span data-ttu-id="897c4-163">Określić, które użytkownicy mogą używać metody uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="897c4-163">Determine which authentication methods your users can use</span></span>

<span data-ttu-id="897c4-164">Istnieją dwa czynniki wpływające na które metody uwierzytelniania są dostępne z wdrażaniem rozszerzenia serwera NPS:</span><span class="sxs-lookup"><span data-stu-id="897c4-164">There are two factors that affect which authentication methods are available with an NPS extension deployment:</span></span>

1. <span data-ttu-id="897c4-165">Algorytm szyfrowania hasła używane między klientem RADIUS (sieć VPN, serwer Netscaler lub innych) i serwerach NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-165">The password encryption algorithm used between the RADIUS client (VPN, Netscaler server, or other) and the NPS servers.</span></span>
   - <span data-ttu-id="897c4-166">**PAP** obsługuje wszystkie metody uwierzytelniania usługi Azure MFA w chmurze: połączenie telefoniczne, wiadomość tekstowa jednokierunkowe powiadomienie aplikacji mobilnej i kod weryfikacyjny z aplikacji mobilnej.</span><span class="sxs-lookup"><span data-stu-id="897c4-166">**PAP** supports all the authentication methods of Azure MFA in the cloud: phone call, one-way text message, mobile app notification, and mobile app verification code.</span></span>
   - <span data-ttu-id="897c4-167">**CHAPV2** i **EAP** obsługi połączeń telefonicznych i powiadomienia aplikacji mobilnej.</span><span class="sxs-lookup"><span data-stu-id="897c4-167">**CHAPV2** and **EAP** support phone call and mobile app notification.</span></span>
2. <span data-ttu-id="897c4-168">Metody wejściowe który aplikacja kliencka (VPN, serwer Netscaler lub innych) może obsłużyć.</span><span class="sxs-lookup"><span data-stu-id="897c4-168">The input methods that the client application (VPN, Netscaler server, or other) can handle.</span></span> <span data-ttu-id="897c4-169">Na przykład klient sieci VPN mają niektóre oznacza Zezwalaj użytkownikowi na wpisz kod weryfikacyjny z aplikacji mobilnej lub tekst?</span><span class="sxs-lookup"><span data-stu-id="897c4-169">For example, does the VPN client have some means to allow the user to type in a verification code from a text or mobile app?</span></span>

<span data-ttu-id="897c4-170">Podczas wdrażania rozszerzenia serwera NPS, użyj te czynniki do oceny, które metody są dostępne dla użytkowników.</span><span class="sxs-lookup"><span data-stu-id="897c4-170">When you deploy the NPS extension, use these factors to evaluate which methods are available for your users.</span></span> <span data-ttu-id="897c4-171">Jeśli klienta RADIUS obsługą protokołu PAP, ale klient UX nie ma pól wejściowych dla kod weryfikacyjny, następnie połączeń telefonicznych i powiadomienia aplikacji mobilnej są dwie opcje są obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="897c4-171">If your RADIUS client supports PAP, but the client UX doesn't have input fields for a verification code, then phone call and mobile app notification are the two supported options.</span></span>

<span data-ttu-id="897c4-172">Możesz [wyłączyć metody uwierzytelniania nieobsługiwany](multi-factor-authentication-whats-next.md#selectable-verification-methods) na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="897c4-172">You can [disable unsupported authentication methods](multi-factor-authentication-whats-next.md#selectable-verification-methods) in Azure.</span></span>

### <a name="enable-users-for-mfa"></a><span data-ttu-id="897c4-173">Włącz użytkowników dla usługi MFA</span><span class="sxs-lookup"><span data-stu-id="897c4-173">Enable users for MFA</span></span>

<span data-ttu-id="897c4-174">Przed wdrożeniem pełne rozszerzenia serwera zasad Sieciowych, należy włączyć uwierzytelnianie wieloskładnikowe dla użytkowników, którzy mają do przeprowadzenia weryfikacji dwuetapowej.</span><span class="sxs-lookup"><span data-stu-id="897c4-174">Before you deploy the full NPS extension, you need to enable MFA for the users that you want to perform two-step verification.</span></span> <span data-ttu-id="897c4-175">Więcej natychmiast po jej wdrożeniu, należy przetestować rozszerzenia, musisz mieć konto co najmniej jeden test, pełni zarejestrowany w usłudze Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="897c4-175">More immediately, to test the extension as you deploy it, you need at least one test account that is fully registered for Multi-Factor Authentication.</span></span>

<span data-ttu-id="897c4-176">Uzyskanie testowe konto uruchomiona, wykonaj następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="897c4-176">Use these steps to get a test account started:</span></span>
1. <span data-ttu-id="897c4-177">Zaloguj się do [https://aka.ms/mfasetup](https://aka.ms/mfasetup) przy użyciu konta testowego.</span><span class="sxs-lookup"><span data-stu-id="897c4-177">Sign in to [https://aka.ms/mfasetup](https://aka.ms/mfasetup) with a test account.</span></span> 
2. <span data-ttu-id="897c4-178">Postępuj zgodnie z monitami, aby skonfigurować metodę weryfikacji.</span><span class="sxs-lookup"><span data-stu-id="897c4-178">Follow the prompts to set up a verification method.</span></span>
3. <span data-ttu-id="897c4-179">Utwórz zasady dostępu warunkowego lub [zmiany stanu użytkownika](multi-factor-authentication-get-started-user-states.md) do wymagania weryfikacji dwuetapowej dla konta testowego.</span><span class="sxs-lookup"><span data-stu-id="897c4-179">Either create a conditional access policy or [change the user state](multi-factor-authentication-get-started-user-states.md) to require two-step verification for the test account.</span></span> 

<span data-ttu-id="897c4-180">Użytkownicy muszą wykonaj następujące kroki, aby zarejestrować przed uwierzytelniają z rozszerzeniem serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-180">Your users also need to follow these steps to enroll before they can authenticate with the NPS extension.</span></span>

## <a name="install-the-nps-extension"></a><span data-ttu-id="897c4-181">Zainstaluj rozszerzenie serwera NPS</span><span class="sxs-lookup"><span data-stu-id="897c4-181">Install the NPS extension</span></span>

> [!IMPORTANT]
> <span data-ttu-id="897c4-182">Zainstaluj rozszerzenie serwera NPS na innym serwerze niż punkt dostępu do sieci VPN.</span><span class="sxs-lookup"><span data-stu-id="897c4-182">Install the NPS extension on a different server than the VPN access point.</span></span>

### <a name="download-and-install-the-nps-extension-for-azure-mfa"></a><span data-ttu-id="897c4-183">Pobierz i zainstaluj rozszerzenie serwera zasad Sieciowych dla usługi Azure MFA</span><span class="sxs-lookup"><span data-stu-id="897c4-183">Download and install the NPS extension for Azure MFA</span></span>

1.  <span data-ttu-id="897c4-184">[Pobierz rozszerzenie serwera NPS](https://aka.ms/npsmfa) z Centrum pobierania Microsoft.</span><span class="sxs-lookup"><span data-stu-id="897c4-184">[Download the NPS Extension](https://aka.ms/npsmfa) from the Microsoft Download Center.</span></span>
2.  <span data-ttu-id="897c4-185">Skopiuj plik binarny do serwera zasad sieciowych, które chcesz skonfigurować.</span><span class="sxs-lookup"><span data-stu-id="897c4-185">Copy the binary to the Network Policy Server you want to configure.</span></span>
3.  <span data-ttu-id="897c4-186">Uruchom *setup.exe* i postępuj zgodnie z instrukcjami instalacji.</span><span class="sxs-lookup"><span data-stu-id="897c4-186">Run *setup.exe* and follow the installation instructions.</span></span> <span data-ttu-id="897c4-187">Jeśli wystąpią błędy, dokładnie dwie biblioteki, w sekcji wymagań wstępnych zostały pomyślnie zainstalowane.</span><span class="sxs-lookup"><span data-stu-id="897c4-187">If you encounter errors, double-check that the two libraries from the prerequisite section were successfully installed.</span></span>

### <a name="run-the-powershell-script"></a><span data-ttu-id="897c4-188">Uruchom skrypt programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="897c4-188">Run the PowerShell script</span></span>

<span data-ttu-id="897c4-189">Instalator tworzy skrypt programu PowerShell w tej lokalizacji: `C:\Program Files\Microsoft\AzureMfa\Config` (gdzie C:\ to dysk instalacji).</span><span class="sxs-lookup"><span data-stu-id="897c4-189">The installer creates a PowerShell script in this location: `C:\Program Files\Microsoft\AzureMfa\Config` (where C:\ is your installation drive).</span></span> <span data-ttu-id="897c4-190">Ten skrypt programu PowerShell są wykonywane następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="897c4-190">This PowerShell script performs the following actions:</span></span>

-   <span data-ttu-id="897c4-191">Tworzenie certyfikatu z podpisem własnym.</span><span class="sxs-lookup"><span data-stu-id="897c4-191">Create a self-signed certificate.</span></span>
-   <span data-ttu-id="897c4-192">Kojarzenie klucza publicznego certyfikatu z usługą główną w usłudze Azure AD.</span><span class="sxs-lookup"><span data-stu-id="897c4-192">Associate the public key of the certificate to the service principal on Azure AD.</span></span>
-   <span data-ttu-id="897c4-193">Przechowywanie certyfikat w magazynie certyfikatów komputera lokalnego.</span><span class="sxs-lookup"><span data-stu-id="897c4-193">Store the cert in the local machine cert store.</span></span>
-   <span data-ttu-id="897c4-194">Udziel dostępu do klucza prywatnego certyfikatu użytkownika sieci.</span><span class="sxs-lookup"><span data-stu-id="897c4-194">Grant access to the certificate’s private key to Network User.</span></span>
-   <span data-ttu-id="897c4-195">Uruchom ponownie serwer NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-195">Restart the NPS.</span></span>

<span data-ttu-id="897c4-196">Jeśli nie chcesz używać certyfikatów (zamiast certyfikatami z podpisem własnym generowanych skrypt programu PowerShell), uruchom skrypt programu PowerShell, aby zakończyć instalację.</span><span class="sxs-lookup"><span data-stu-id="897c4-196">Unless you want to use your own certificates (instead of the self-signed certificates that the PowerShell script generates), run the PowerShell Script to complete the installation.</span></span> <span data-ttu-id="897c4-197">Po zainstalowaniu rozszerzenia na wielu serwerach, każdy z nich ma własny certyfikat.</span><span class="sxs-lookup"><span data-stu-id="897c4-197">If you install the extension on multiple servers, each one should have its own certificate.</span></span>

1. <span data-ttu-id="897c4-198">Uruchom program Windows PowerShell jako administrator.</span><span class="sxs-lookup"><span data-stu-id="897c4-198">Run Windows PowerShell as an administrator.</span></span>
2. <span data-ttu-id="897c4-199">Zmień katalog.</span><span class="sxs-lookup"><span data-stu-id="897c4-199">Change directories.</span></span>

   `cd "C:\Program Files\Microsoft\AzureMfa\Config"`

3. <span data-ttu-id="897c4-200">Uruchom skrypt programu PowerShell utworzone przez Instalatora.</span><span class="sxs-lookup"><span data-stu-id="897c4-200">Run the PowerShell script created by the installer.</span></span>

   `.\AzureMfaNpsExtnConfigSetup.ps1`

4. <span data-ttu-id="897c4-201">PowerShell monit o podanie identyfikatora dzierżawcy</span><span class="sxs-lookup"><span data-stu-id="897c4-201">PowerShell prompts for your tenant ID.</span></span> <span data-ttu-id="897c4-202">Użyj Identyfikatora GUID katalogu, który został skopiowany z portalu Azure w sekcji wymagania wstępne.</span><span class="sxs-lookup"><span data-stu-id="897c4-202">Use the Directory ID GUID that you copied from the Azure portal in the prerequisites section.</span></span>
5. <span data-ttu-id="897c4-203">Zaloguj się do usługi Azure AD jako administrator.</span><span class="sxs-lookup"><span data-stu-id="897c4-203">Sign in to Azure AD as an administrator.</span></span>
6. <span data-ttu-id="897c4-204">PowerShell wyświetla komunikat z potwierdzeniem po zakończeniu działania skryptu.</span><span class="sxs-lookup"><span data-stu-id="897c4-204">PowerShell shows a success message when the script is finished.</span></span>  

<span data-ttu-id="897c4-205">Powtórz te czynności na wszystkie dodatkowe serwery NPS, które chcesz skonfigurować Równoważenie obciążenia sieciowego.</span><span class="sxs-lookup"><span data-stu-id="897c4-205">Repeat these steps on any additional NPS servers that you want to set up for load balancing.</span></span>

>[!NOTE]
><span data-ttu-id="897c4-206">Jeśli używasz własne certyfikaty zamiast generowania certyfikatów przy użyciu skryptu programu PowerShell, upewnij się, że są wyrównane do konwencji nazewnictwa serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-206">If you use your own certificates instead of generating certificates with the PowerShell script, make sure that they align to the NPS naming convention.</span></span> <span data-ttu-id="897c4-207">Nazwa podmiotu musi być **CN =\<TenantID\>, OU = Microsoft NPS rozszerzenia**.</span><span class="sxs-lookup"><span data-stu-id="897c4-207">The subject name must be **CN=\<TenantID\>,OU=Microsoft NPS Extension**.</span></span> 

## <a name="configure-your-nps-extension"></a><span data-ttu-id="897c4-208">Skonfiguruj rozszerzenie serwera NPS</span><span class="sxs-lookup"><span data-stu-id="897c4-208">Configure your NPS extension</span></span>

<span data-ttu-id="897c4-209">Ta sekcja obejmuje zagadnienia dotyczące projektowania oraz sugestie dotyczące pomyślnego wdrożenia rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-209">This section includes design considerations and suggestions for successful NPS extension deployments.</span></span>

### <a name="configuration-limitations"></a><span data-ttu-id="897c4-210">Ograniczenia konfiguracji</span><span class="sxs-lookup"><span data-stu-id="897c4-210">Configuration limitations</span></span>

- <span data-ttu-id="897c4-211">Rozszerzenia serwera zasad Sieciowych dla usługi Azure MFA nie zawiera narzędzia do migracji użytkowników i ustawienia z serwera usługi MFA w chmurze.</span><span class="sxs-lookup"><span data-stu-id="897c4-211">The NPS extension for Azure MFA does not include tools to migrate users and settings from MFA Server to the cloud.</span></span> <span data-ttu-id="897c4-212">Z tego powodu zaleca się nowych wdrożeń zamiast istniejącego wdrożenia przy użyciu rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="897c4-212">For this reason, we suggest using the extension for new deployments, rather than existing deployment.</span></span> <span data-ttu-id="897c4-213">Jeśli używasz rozszerzenia na istniejące wdrożenie, użytkownicy mają do wykonania w górę dowód ponownie, aby wypełnić ich szczegóły usługi MFA w chmurze.</span><span class="sxs-lookup"><span data-stu-id="897c4-213">If you use the extension on an existing deployment, your users have to perform proof-up again to populate their MFA details in the cloud.</span></span>  
- <span data-ttu-id="897c4-214">Rozszerzenia serwera zasad Sieciowych używa nazwy UPN z lokalnej usługi Active directory do identyfikacji użytkownika na usługę Azure MFA do wykonywania dodatkowej uwierzytelniania Rozszerzenie można skonfigurować do używania innego identyfikatora alternatywnego Identyfikatora logowania lub pole niestandardowe usługi Active Directory niż głównej nazwy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="897c4-214">The NPS extension uses the UPN from the on-premises Active directory to identify the user on Azure MFA for performing the Secondary Auth. The extension can be configured to use a different identifier like alternate login ID or custom Active Directory field other than UPN.</span></span> <span data-ttu-id="897c4-215">Zobacz [zaawansowane opcje konfiguracji dla rozszerzenia serwera NPS uwierzytelnianie wieloskładnikowe](multi-factor-authentication-advanced-vpn-configurations.md) Aby uzyskać więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="897c4-215">See [Advanced configuration options for the NPS extension for Multi-Factor Authentication](multi-factor-authentication-advanced-vpn-configurations.md) for more information.</span></span>
- <span data-ttu-id="897c4-216">Nie wszystkie protokoły szyfrowania obsługuje wszystkie metody weryfikacji.</span><span class="sxs-lookup"><span data-stu-id="897c4-216">Not all encryption protocols support all verification methods.</span></span>
   - <span data-ttu-id="897c4-217">**PAP** obsługuje połączenie telefoniczne, wiadomość tekstowa jednokierunkowe powiadomienie aplikacji mobilnej i kod weryfikacyjny z aplikacji mobilnej</span><span class="sxs-lookup"><span data-stu-id="897c4-217">**PAP** supports phone call, one-way text message, mobile app notification, and mobile app verification code</span></span>
   - <span data-ttu-id="897c4-218">**CHAPV2** i **EAP** obsługi połączeń telefonicznych i powiadomienia aplikacji mobilnej</span><span class="sxs-lookup"><span data-stu-id="897c4-218">**CHAPV2** and **EAP** support phone call and mobile app notification</span></span>

### <a name="control-radius-clients-that-require-mfa"></a><span data-ttu-id="897c4-219">Formant klientów usługi RADIUS, które wymagają usługi MFA</span><span class="sxs-lookup"><span data-stu-id="897c4-219">Control RADIUS clients that require MFA</span></span>

<span data-ttu-id="897c4-220">Po włączeniu usługi MFA dla klienta RADIUS przy użyciu rozszerzenia zasad Sieciowych wszystkie uwierzytelnienia dla tego klienta są wymagane do przeprowadzenia uwierzytelniania Wieloskładnikowego.</span><span class="sxs-lookup"><span data-stu-id="897c4-220">Once you enable MFA for a RADIUS client using the NPS Extension, all authentications for this client are required to perform MFA.</span></span> <span data-ttu-id="897c4-221">Jeśli chcesz włączyć usługę MFA dla niektórych klientów usługi RADIUS, a innych nie można skonfigurować dwa serwery NPS i zainstaluj rozszerzenie na tylko jeden z nich.</span><span class="sxs-lookup"><span data-stu-id="897c4-221">If you want to enable MFA for some RADIUS clients but not others, you can configure two NPS servers and install the extension on only one of them.</span></span> <span data-ttu-id="897c4-222">Konfigurowanie klientów usługi RADIUS, które chcesz wymagać uwierzytelniania Wieloskładnikowego w celu wysyłania żądań do serwera zasad Sieciowych skonfigurowano rozszerzenie i innych klientów RADIUS do serwera NPS nie jest skonfigurowany z rozszerzeniem.</span><span class="sxs-lookup"><span data-stu-id="897c4-222">Configure RADIUS clients that you want to require MFA to send requests to the NPS server configured with the extension, and other RADIUS clients to the NPS server not configured with the extension.</span></span>

### <a name="prepare-for-users-that-arent-enrolled-for-mfa"></a><span data-ttu-id="897c4-223">Przygotowanie do użytkowników, którzy nie są rejestrowane w usłudze MFA</span><span class="sxs-lookup"><span data-stu-id="897c4-223">Prepare for users that aren't enrolled for MFA</span></span>

<span data-ttu-id="897c4-224">Jeśli masz użytkowników, którzy nie są rejestrowane w usłudze MFA, można określić, co się dzieje podczas próby uwierzytelnienia.</span><span class="sxs-lookup"><span data-stu-id="897c4-224">If you have users that aren't enrolled for MFA, you can determine what happens when they try to authenticate.</span></span> <span data-ttu-id="897c4-225">Użyj ustawienia rejestru *REQUIRE_USER_MATCH* w ścieżce rejestru *HKLM\Software\Microsoft\AzureMFA* do sterowania zachowaniem funkcji.</span><span class="sxs-lookup"><span data-stu-id="897c4-225">Use the registry setting *REQUIRE_USER_MATCH* in the registry path *HKLM\Software\Microsoft\AzureMFA* to control the feature behavior.</span></span> <span data-ttu-id="897c4-226">To ustawienie nie ma opcji konfiguracji pojedynczego:</span><span class="sxs-lookup"><span data-stu-id="897c4-226">This setting has a single configuration option:</span></span>

| <span data-ttu-id="897c4-227">Klucz</span><span class="sxs-lookup"><span data-stu-id="897c4-227">Key</span></span> | <span data-ttu-id="897c4-228">Wartość</span><span class="sxs-lookup"><span data-stu-id="897c4-228">Value</span></span> | <span data-ttu-id="897c4-229">Domyślne</span><span class="sxs-lookup"><span data-stu-id="897c4-229">Default</span></span> |
| --- | ----- | ------- |
| <span data-ttu-id="897c4-230">REQUIRE_USER_MATCH</span><span class="sxs-lookup"><span data-stu-id="897c4-230">REQUIRE_USER_MATCH</span></span> | <span data-ttu-id="897c4-231">PRAWDA/FAŁSZ</span><span class="sxs-lookup"><span data-stu-id="897c4-231">TRUE/FALSE</span></span> | <span data-ttu-id="897c4-232">Nieustawione (równoważne TRUE)</span><span class="sxs-lookup"><span data-stu-id="897c4-232">Not set (equivalent to TRUE)</span></span> |

<span data-ttu-id="897c4-233">Celem tego ustawienia jest ustalenie, co należy zrobić, gdy użytkownik nie jest zarejestrowane w usłudze MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-233">The purpose of this setting is to determine what to do when a user is not enrolled for MFA.</span></span> <span data-ttu-id="897c4-234">Po klucz nie istnieje, nie jest ustawiony lub jest ustawiony na wartość TRUE, a użytkownik nie jest zarejestrowany, a następnie rozszerzenia nie powiodło się żądanie uwierzytelniania MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-234">When the key does not exist, is not set, or is set to TRUE, and the user is not enrolled, then the extension fails the MFA challenge.</span></span> <span data-ttu-id="897c4-235">Gdy jest ustawiona na wartość FALSE, a użytkownik nie jest zarejestrowany, uwierzytelnianie będzie kontynuowane bez wykonywania MFA.</span><span class="sxs-lookup"><span data-stu-id="897c4-235">When the key is set to FALSE and the user is not enrolled, authentication proceeds without performing MFA.</span></span>

<span data-ttu-id="897c4-236">Możesz utworzyć ten klucz i ustawiona na FALSE, gdy użytkownicy są dołączania, a może nie wszystkie zarejestrowane na potrzeby usługi Azure MFA jeszcze.</span><span class="sxs-lookup"><span data-stu-id="897c4-236">You can choose to create this key and set it to FALSE while your users are onboarding, and may not all be enrolled for Azure MFA yet.</span></span> <span data-ttu-id="897c4-237">Jednak ponieważ ustawienie klucza pozwala na użytkowników, którzy nie są rejestrowane w usłudze MFA do logowania, należy usunąć ten klucz przed przejściem do środowiska produkcyjnego.</span><span class="sxs-lookup"><span data-stu-id="897c4-237">However, since setting the key permits users that aren't enrolled for MFA to sign in, you should remove this key before going to production.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="897c4-238">Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="897c4-238">Troubleshooting</span></span>

### <a name="how-do-i-verify-that-the-client-cert-is-installed-as-expected"></a><span data-ttu-id="897c4-239">Jak sprawdzić, czy certyfikat klienta jest zainstalowany, zgodnie z oczekiwaniami?</span><span class="sxs-lookup"><span data-stu-id="897c4-239">How do I verify that the client cert is installed as expected?</span></span>

<span data-ttu-id="897c4-240">Wyszukaj certyfikat z podpisem własnym utworzonych przez Instalatora w magazynie certyfikatów i sprawdź, czy klucz prywatny ma uprawnienia przyznane użytkownikowi **usługi SIECIOWEJ**.</span><span class="sxs-lookup"><span data-stu-id="897c4-240">Look for the self-signed certificate created by the installer in the cert store, and check that the private key has permissions granted to user **NETWORK SERVICE**.</span></span> <span data-ttu-id="897c4-241">Certyfikat ma nazwę podmiotu **CN \<tenantid\>, OU = Microsoft rozszerzenia serwera NPS**</span><span class="sxs-lookup"><span data-stu-id="897c4-241">The cert has a subject name of **CN \<tenantid\>, OU = Microsoft NPS Extension**</span></span>

-------------------------------------------------------------

### <a name="how-can-i-verify-that-my-client-cert-is-associated-to-my-tenant-in-azure-active-directory"></a><span data-ttu-id="897c4-242">Jak sprawdzić, czy Moje certyfikatu klienta jest skojarzona z mojej dzierżawy w usłudze Azure Active Directory?</span><span class="sxs-lookup"><span data-stu-id="897c4-242">How can I verify that my client cert is associated to my tenant in Azure Active Directory?</span></span>

<span data-ttu-id="897c4-243">Otwórz wiersz polecenia programu PowerShell i uruchom następujące polecenia:</span><span class="sxs-lookup"><span data-stu-id="897c4-243">Open PowerShell command prompt and run the following commands:</span></span>

```
import-module MSOnline
Connect-MsolService
Get-MsolServicePrincipalCredential -AppPrincipalId "981f26a1-7f43-403b-a875-f8b09b8cd720" -ReturnKeyValues 1 
```

<span data-ttu-id="897c4-244">Te polecenia Drukuj wszystkie certyfikaty skojarzenie dzierżawcy z wystąpienia rozszerzenia serwera NPS w sesji programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="897c4-244">These commands print all the certificates associating your tenant with your instance of the NPS extension in your PowerShell session.</span></span> <span data-ttu-id="897c4-245">Wyszukaj certyfikat przez wyeksportowanie Twojego certyfikatu klienta w formacie "X.509(.cer) algorytmem Base-64" bez klucza prywatnego i porównania go z listy z programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="897c4-245">Look for your certificate by exporting your client cert as a "Base-64 encoded X.509(.cer)" file without the private key, and compare it with the list from PowerShell.</span></span>

<span data-ttu-id="897c4-246">Nieprawidłowa-z i prawidłowe-dopóki sygnatury czasowe, które są w formie czytelny dla człowieka, może służyć do odfiltrowywania misfits oczywiste, jeśli polecenie zwraca więcej niż jeden certyfikat.</span><span class="sxs-lookup"><span data-stu-id="897c4-246">Valid-From and Valid-Until timestamps, which are in human-readable form, can be used to filter out obvious misfits if the command returns more than one cert.</span></span>

-------------------------------------------------------------

### <a name="why-are-my-requests-failing-with-adal-token-error"></a><span data-ttu-id="897c4-247">Dlaczego moje żądania kończą się niepowodzeniem z błędem tokenu ADAL?</span><span class="sxs-lookup"><span data-stu-id="897c4-247">Why are my requests failing with ADAL token error?</span></span>

<span data-ttu-id="897c4-248">Ten błąd może wynikać z kilku powodów.</span><span class="sxs-lookup"><span data-stu-id="897c4-248">This error could be due to one of several reasons.</span></span> <span data-ttu-id="897c4-249">Do rozwiązywania problemów, wykonaj następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="897c4-249">Use these steps to help troubleshoot:</span></span>

1. <span data-ttu-id="897c4-250">Uruchom ponownie serwer NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-250">Restart your NPS server.</span></span>
2. <span data-ttu-id="897c4-251">Sprawdź, czy ten certyfikat klienta jest zainstalowany, zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="897c4-251">Verify that that client cert is installed as expected.</span></span>
3. <span data-ttu-id="897c4-252">Sprawdź, czy certyfikat jest skojarzony z dzierżawą w usłudze Azure AD.</span><span class="sxs-lookup"><span data-stu-id="897c4-252">Verify that the certificate is associated with your tenant on Azure AD.</span></span>
4. <span data-ttu-id="897c4-253">Sprawdź, czy ten https://login.microsoftonline.com/ jest dostępny z serwera z uruchomionym programem rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="897c4-253">Verify that https://login.microsoftonline.com/ is accessible from the server running the extension.</span></span>

-------------------------------------------------------------

### <a name="why-does-authentication-fail-with-an-error-in-http-logs-stating-that-the-user-is-not-found"></a><span data-ttu-id="897c4-254">Dlaczego uwierzytelniania nie ze względu na błąd w dziennikach HTTP z informacją, że użytkownik nie zostanie znaleziony?</span><span class="sxs-lookup"><span data-stu-id="897c4-254">Why does authentication fail with an error in HTTP logs stating that the user is not found?</span></span>

<span data-ttu-id="897c4-255">Sprawdź, czy AD Connect jest uruchomiona i czy użytkownik musi być obecny w usłudze Active Directory systemu Windows i usługi Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="897c4-255">Verify that AD Connect is running, and that the user is present in both Windows Active Directory and Azure Active Directory.</span></span>

------------------------------------------------------------

### <a name="why-do-i-see-http-connect-errors-in-logs-with-all-my-authentications-failing"></a><span data-ttu-id="897c4-256">Dlaczego widzę HTTP błędy w dziennikach Uzyskuj dostęp do mojej uwierzytelnienia się niepowodzeniem?</span><span class="sxs-lookup"><span data-stu-id="897c4-256">Why do I see HTTP connect errors in logs with all my authentications failing?</span></span>

<span data-ttu-id="897c4-257">Upewnij się, że adres https://adnotifications.windowsazure.com jest dostępny z serwera udostępniającego rozszerzenie serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="897c4-257">Verify that https://adnotifications.windowsazure.com is reachable from the server running the NPS extension.</span></span>


## <a name="next-steps"></a><span data-ttu-id="897c4-258">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="897c4-258">Next steps</span></span>

- <span data-ttu-id="897c4-259">Konfigurowanie alternatywnych identyfikatorów logowania lub konfigurowania listy wyjątek dla adresów IP, która nie należy przeprowadzać weryfikację dwuetapową w [zaawansowane opcje konfiguracji dla rozszerzenia serwera NPS uwierzytelnianie wieloskładnikowe](nps-extension-advanced-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="897c4-259">Configure alternate IDs for login, or set up an exception list for IPs that shouldn't perform two-step verification in [Advanced configuration options for the NPS extension for Multi-Factor Authentication](nps-extension-advanced-configuration.md)</span></span>

- <span data-ttu-id="897c4-260">[Resolve error messages from the NPS extension for Azure Multi-Factor Authentication](multi-factor-authentication-nps-errors.md) (Rozstrzyganie komunikatów o błędach z rozszerzenia serwera NPS dotyczących usługi Azure Multi-Factor Authentication)</span><span class="sxs-lookup"><span data-stu-id="897c4-260">[Resolve error messages from the NPS extension for Azure Multi-Factor Authentication](multi-factor-authentication-nps-errors.md)</span></span>
