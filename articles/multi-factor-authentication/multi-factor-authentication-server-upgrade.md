---
title: "Uaktualnianie programu Azure serwera usługi MFA | Dokumentacja firmy Microsoft"
description: "Kroki i wskazówki dotyczące uaktualnienia do nowszej wersji serwera usługi Azure Multi-Factor Authentication."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="f31f6-103">Uaktualnij do najnowszej Azure aplikacji serwer Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="f31f6-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="f31f6-104">Ten artykuł przeprowadzi Cię przez proces uaktualniania serwera usługi Azure Multi-Factor Authentication (MFA) w wersji 6.0 lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="f31f6-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="f31f6-105">Jeśli musisz uaktualnić stara wersja PhoneFactor Agent, zapoznaj się [uaktualnienia PhoneFactor Agent do serwera usługi Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="f31f6-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="f31f6-106">Jeśli uaktualniasz z 6.x lub w starszej do v7.x lub nowszej, wszystkie składniki zmienić z .NET 2.0 na .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="f31f6-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="f31f6-107">Wszystkie składniki wymagają programu Microsoft Visual C++ 2015 Redistributable Update 1 lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="f31f6-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="f31f6-108">Instalator serwera usługi MFA instaluje x86 i x64 wersje tych składników, jeśli nie są już zainstalowane.</span><span class="sxs-lookup"><span data-stu-id="f31f6-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="f31f6-109">Jeśli Portal użytkowników i Mobile App Web Service uruchomione na różnych serwerach, należy zainstalować te pakiety przed rozpoczęciem uaktualniania tych składników.</span><span class="sxs-lookup"><span data-stu-id="f31f6-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="f31f6-110">Możesz wyszukać najnowszą aktualizację programu Microsoft Visual C++ 2015 Redistributable na [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="f31f6-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="f31f6-111">Zainstaluj najnowszą wersję serwera usługi Azure MFA</span><span class="sxs-lookup"><span data-stu-id="f31f6-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="f31f6-112">Postępuj zgodnie z instrukcjami w [pobierania serwera usługi Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) można pobrać najnowszą wersję serwera usługi Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="f31f6-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="f31f6-113">Wykonaj kopię zapasową pliku danych serwera usługi MFA w C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (przy założeniu, domyślna lokalizacja instalacji) na serwerze głównym usługi MFA.</span><span class="sxs-lookup"><span data-stu-id="f31f6-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="f31f6-114">Po uruchomieniu wielu serwerów w celu zapewnienia wysokiej dostępności, zmień klienckie systemy, które uwierzytelnienie na serwerze usługi MFA, aby zatrzymać one wysyłać ruch do serwerów, które są uaktualnianie.</span><span class="sxs-lookup"><span data-stu-id="f31f6-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="f31f6-115">Użycie modułu równoważenia obciążenia, usuwany jest serwer usługi MFA z usługi równoważenia obciążenia wykonaj uaktualnienia, a następnie dodaj serwer do farmy.</span><span class="sxs-lookup"><span data-stu-id="f31f6-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="f31f6-116">Uruchom nowe Instalatora na każdym serwerze usługi MFA.</span><span class="sxs-lookup"><span data-stu-id="f31f6-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="f31f6-117">Serwery podrzędne należy najpierw uaktualnić, ponieważ będzie mogła ją odczytać starego pliku danych replikowana przez główny.</span><span class="sxs-lookup"><span data-stu-id="f31f6-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="f31f6-118">Nie trzeba przed uruchomieniem Instalatora należy odinstalować bieżącego serwera usługi MFA.</span><span class="sxs-lookup"><span data-stu-id="f31f6-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="f31f6-119">Instalator wykonuje uaktualnienie w miejscu.</span><span class="sxs-lookup"><span data-stu-id="f31f6-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="f31f6-120">Ścieżka instalacji jest pobierana z rejestru z poprzedniej instalacji, więc instaluje go w tym samym miejscu (na przykład C:\Program Files\Multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="f31f6-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="f31f6-121">Jeśli zostanie wyświetlony monit, aby zainstalować pakiet aktualizacji programu Microsoft Visual C++ 2015 Redistributable, należy zaakceptować monit.</span><span class="sxs-lookup"><span data-stu-id="f31f6-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="f31f6-122">X86 i x64 wersje pakietu są zainstalowane.</span><span class="sxs-lookup"><span data-stu-id="f31f6-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="f31f6-123">Jeśli korzystasz z zestawem SDK usług sieci Web, zostanie wyświetlony monit zainstalować nowy zestaw SDK usług sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f31f6-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="f31f6-124">Po zainstalowaniu nowego zestawu SDK usług sieci Web upewnij się, czy nazwa katalogu wirtualnego odpowiada zainstalowane wcześniej katalogu wirtualnego (na przykład MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="f31f6-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="f31f6-125">Powtórz kroki na wszystkich serwerach podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="f31f6-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="f31f6-126">Podwyższ poziom jednego podwładnych jako nowy wzorzec, a następnie uaktualnić starego serwera głównego.</span><span class="sxs-lookup"><span data-stu-id="f31f6-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="f31f6-127">Uaktualnianie portalu użytkowników</span><span class="sxs-lookup"><span data-stu-id="f31f6-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="f31f6-128">Wykonaj kopię zapasową pliku web.config, który znajduje się w katalogu wirtualnego w wybranej lokalizacji instalacji portalu użytkowników (na przykład C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="f31f6-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="f31f6-129">Jeśli zmiany zostały wprowadzone w motyw domyślny, należy wykonać kopię zapasową do folderu App_Themes\Default.</span><span class="sxs-lookup"><span data-stu-id="f31f6-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="f31f6-130">Warto utworzyć kopię domyślny folder i utworzyć nową kompozycję niż Aby zmienić motyw domyślny.</span><span class="sxs-lookup"><span data-stu-id="f31f6-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="f31f6-131">Jeśli Portal użytkownika jest uruchomiony na tym samym serwerze co inne składniki serwera usługi MFA, pojawi się monit instalacji serwera usługi MFA do zaktualizowania aplikacji Portal użytkowników.</span><span class="sxs-lookup"><span data-stu-id="f31f6-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="f31f6-132">Zaakceptować monit i zainstaluj aktualizację portalu użytkowników.</span><span class="sxs-lookup"><span data-stu-id="f31f6-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="f31f6-133">Sprawdź, czy nazwa katalogu wirtualnego zgodna zainstalowane wcześniej katalogu wirtualnego (na przykład MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="f31f6-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="f31f6-134">Jeśli Portal użytkownika jest na osobnym serwerze, skopiuj plik MultiFactorAuthenticationUserPortalSetup64.msi z lokalizacji instalacji jednego z serwerów usługi MFA i umieścić go na serwerze sieci web portalu użytkowników.</span><span class="sxs-lookup"><span data-stu-id="f31f6-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="f31f6-135">Uruchom Instalatora.</span><span class="sxs-lookup"><span data-stu-id="f31f6-135">Run the installer.</span></span> 

  <span data-ttu-id="f31f6-136">Jeśli wystąpi błąd określania, "Microsoft Visual C++ 2015 Redistributable Update 1 lub nowszy jest wymagany," Pobierz i zainstaluj najnowszy pakiet aktualizacji z [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="f31f6-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="f31f6-137">Zainstalowanie wersji x86 i x64.</span><span class="sxs-lookup"><span data-stu-id="f31f6-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="f31f6-138">Po zainstalowaniu zaktualizowanej oprogramowania portalu użytkowników, porównaj kopii zapasowej pliku web.config, wprowadzone w kroku 1 nowy plik web.config.</span><span class="sxs-lookup"><span data-stu-id="f31f6-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="f31f6-139">Jeśli nie istnieją żadne nowe atrybuty w nowego pliku web.config, skopiuj kopii zapasowej pliku web.config w katalogu wirtualnego, aby zastąpić nową.</span><span class="sxs-lookup"><span data-stu-id="f31f6-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="f31f6-140">Innym rozwiązaniem jest kopiowania/wklejania wartości appSettings i adres URL zestawu SDK usługi sieci Web z pliku kopii zapasowej do nowego pliku web.config.</span><span class="sxs-lookup"><span data-stu-id="f31f6-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="f31f6-141">Jeśli Portal użytkowników na wielu serwerach, powtórz instalacji na wszystkich z nich.</span><span class="sxs-lookup"><span data-stu-id="f31f6-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="f31f6-142">Uaktualnianie usługi sieci Web aplikacji mobilnej</span><span class="sxs-lookup"><span data-stu-id="f31f6-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="f31f6-143">Wykonaj kopię zapasową pliku web.config, który znajduje się w katalogu wirtualnego w lokalizacji instalacji usługi Mobile App Web Service (na przykład C:\inetpub\wwwroot\app lub C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="f31f6-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="f31f6-144">Skopiuj plik MultiFactorAuthenticationMobileAppWebServiceSetup64.msi z lokalizacji instalacji serwerów MFA i umieść je na serwerze sieci web rejestracji aplikacji mobilnej.</span><span class="sxs-lookup"><span data-stu-id="f31f6-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="f31f6-145">Uruchom Instalatora.</span><span class="sxs-lookup"><span data-stu-id="f31f6-145">Run the installer.</span></span> 

  <span data-ttu-id="f31f6-146">Jeśli wystąpi błąd informujący, że program Microsoft Visual C++ 2015 Redistributable Update 1 lub nowszy jest wymagany, Pobierz i zainstaluj najnowszy pakiet aktualizacji z [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="f31f6-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="f31f6-147">Zainstalowanie wersji x86 i x64.</span><span class="sxs-lookup"><span data-stu-id="f31f6-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="f31f6-148">Po zainstalowaniu zaktualizowanej oprogramowania Mobile App Web Service, porównaj plik web.config, która została skopiowana w kroku 1 nowy plik web.config.</span><span class="sxs-lookup"><span data-stu-id="f31f6-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="f31f6-149">Jeśli nie istnieją żadne nowe atrybuty w nowego pliku web.config, możesz skopiować zapisanego pliku web.config wrócić do katalogu wirtualnego i zastąpić nowym.</span><span class="sxs-lookup"><span data-stu-id="f31f6-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="f31f6-150">Innym rozwiązaniem jest kopiowania/wklejania wartości appSettings i adres URL zestawu SDK usługi sieci Web z pliku kopii zapasowej do nowego pliku web.config.</span><span class="sxs-lookup"><span data-stu-id="f31f6-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="f31f6-151">Jeśli masz usługi Mobile App Web Service na wielu serwerach, powtórz instalacji na wszystkich z nich.</span><span class="sxs-lookup"><span data-stu-id="f31f6-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="f31f6-152">Uaktualnienie karty AD FS</span><span class="sxs-lookup"><span data-stu-id="f31f6-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="f31f6-153">Jeśli uwierzytelnianie wieloskładnikowe jest uruchomiony na różnych serwerach niż usługi AD FS</span><span class="sxs-lookup"><span data-stu-id="f31f6-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="f31f6-154">Te instrukcje stosowane tylko wtedy, jeśli serwer Multi-Factor Authentication należy uruchomić niezależnie od serwerów usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f31f6-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="f31f6-155">Jeśli obie usługi są uruchomione na tym samym serwerze, Pomiń tę sekcję i przejdź do procedury instalacji.</span><span class="sxs-lookup"><span data-stu-id="f31f6-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="f31f6-156">Zapisz kopię pliku MultiFactorAuthenticationAdfsAdapter.config, który został zarejestrowany w usługach AD FS lub wyeksportować konfigurację za pomocą następującego polecenia programu PowerShell: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span><span class="sxs-lookup"><span data-stu-id="f31f6-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="f31f6-157">Nazwa karty jest "element WindowsAzureMultiFactorAuthentication" lub "AzureMfaServerAuthentication" w zależności od wcześniej zainstalowanej wersji.</span><span class="sxs-lookup"><span data-stu-id="f31f6-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="f31f6-158">Skopiuj następujące pliki z lokalizacji instalacji serwera usługi MFA do serwerów usług AD FS:</span><span class="sxs-lookup"><span data-stu-id="f31f6-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="f31f6-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="f31f6-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="f31f6-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="f31f6-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="f31f6-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="f31f6-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="f31f6-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="f31f6-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="f31f6-163">Edytowanie skryptu Register-MultiFactorAuthenticationAdfsAdapter.ps1 przez dodanie `-ConfigurationFilePath [path]` na końcu `Register-AdfsAuthenticationProvider` polecenia.</span><span class="sxs-lookup"><span data-stu-id="f31f6-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="f31f6-164">Zastąp *[ścieżka]* z pełną ścieżką do MultiFactorAuthenticationAdfsAdapter.config pliku lub pliku konfiguracji wyeksportowane w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="f31f6-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="f31f6-165">Sprawdź atrybuty w MultiFactorAuthenticationAdfsAdapter.config nowy, aby zobaczyć, jeśli spełniają starego pliku konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="f31f6-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="f31f6-166">Jeśli wszystkie atrybuty zostały dodane lub usunięte w nowej wersji, skopiuj wartości atrybutów ze starego pliku konfiguracji na nową lub zmodyfikować starego pliku konfiguracji w celu dopasowania.</span><span class="sxs-lookup"><span data-stu-id="f31f6-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="f31f6-167">Zainstaluj nowe karty usług AD FS</span><span class="sxs-lookup"><span data-stu-id="f31f6-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="f31f6-168">Użytkownicy nie będą wymagane do przeprowadzenia weryfikacji dwuetapowej etapach 3-8 w tej sekcji.</span><span class="sxs-lookup"><span data-stu-id="f31f6-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="f31f6-169">Jeśli masz skonfigurowane w wielu klastrach usług AD FS, Usuń, uaktualniania i przywracanie poszczególnych klastrów w farmie serwerów, niezależnie od innych klastrów, aby uniknąć przestoju.</span><span class="sxs-lookup"><span data-stu-id="f31f6-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="f31f6-170">Usuń niektóre serwery usług AD FS w farmie.</span><span class="sxs-lookup"><span data-stu-id="f31f6-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="f31f6-171">Zaktualizuj te serwery, gdy nadal są uruchomione inne.</span><span class="sxs-lookup"><span data-stu-id="f31f6-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="f31f6-172">Zainstaluj nowy adapter AD FS na każdym serwerze usunięte z farmy usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f31f6-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="f31f6-173">Jeśli serwer usługi MFA jest zainstalowany na każdym serwerze usług AD FS, możesz je zaktualizować przez administratora serwera usługi MFA UX.</span><span class="sxs-lookup"><span data-stu-id="f31f6-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="f31f6-174">W przeciwnym razie należy zaktualizować, uruchamiając MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="f31f6-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="f31f6-175">Jeśli wystąpi błąd określania, "Microsoft Visual C++ 2015 Redistributable Update 1 lub nowszy jest wymagany," Pobierz i zainstaluj najnowszy pakiet aktualizacji z [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="f31f6-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="f31f6-176">Zainstalowanie wersji x86 i x64.</span><span class="sxs-lookup"><span data-stu-id="f31f6-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="f31f6-177">Przejdź do **usług AD FS** > **zasady uwierzytelniania** > **Edytuj globalne uwierzytelnianie wieloskładnikowe zasady**.</span><span class="sxs-lookup"><span data-stu-id="f31f6-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="f31f6-178">Usuń zaznaczenie pola wyboru **element WindowsAzureMultiFactorAuthentication** lub **AzureMFAServerAuthentication** (w zależności od bieżącej wersji zainstalowanej).</span><span class="sxs-lookup"><span data-stu-id="f31f6-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="f31f6-179">Po wykonaniu tego kroku weryfikację dwuetapową, za pomocą serwera usługi MFA jest niedostępna w tym klastrze usług AD FS dopiero po wykonaniu kroku 8.</span><span class="sxs-lookup"><span data-stu-id="f31f6-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="f31f6-180">Wyrejestruj starszej wersji produktu adapter AD FS, uruchamiając skrypt programu PowerShell Unregister-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="f31f6-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="f31f6-181">Upewnij się, że *— nazwa* parametr ("Element WindowsAzureMultiFactorAuthentication" lub "AzureMFAServerAuthentication") jest zgodna z nazwą, który był wyświetlany w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="f31f6-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="f31f6-182">Dotyczy to wszystkich serwerów w tym samym klastrze usług AD FS, ponieważ istnieje konfiguracja centralnych.</span><span class="sxs-lookup"><span data-stu-id="f31f6-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="f31f6-183">Zarejestruj nowy adapter AD FS, uruchamiając skrypt programu PowerShell Register-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="f31f6-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="f31f6-184">Dotyczy to wszystkich serwerów w tym samym klastrze usług AD FS, ponieważ istnieje konfiguracja centralnych.</span><span class="sxs-lookup"><span data-stu-id="f31f6-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="f31f6-185">Uruchom ponownie usługę AD FS na każdym serwerze usunięte z farmy usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f31f6-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="f31f6-186">Dodaj zaktualizowanych serwerów do farmy usług AD FS i usuń pozostałe serwery z farmy.</span><span class="sxs-lookup"><span data-stu-id="f31f6-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="f31f6-187">Przejdź do **usług AD FS** > **zasady uwierzytelniania** > **Edytuj globalne uwierzytelnianie wieloskładnikowe zasady**.</span><span class="sxs-lookup"><span data-stu-id="f31f6-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="f31f6-188">Sprawdź **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="f31f6-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="f31f6-189">Powtórz krok 2, aby zaktualizować serwery teraz usunięte z farmy usług AD FS i uruchom ponownie usługę AD FS na tych serwerach.</span><span class="sxs-lookup"><span data-stu-id="f31f6-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="f31f6-190">Dodaj tych serwerów do farmy usług AD FS.</span><span class="sxs-lookup"><span data-stu-id="f31f6-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f31f6-191">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="f31f6-191">Next steps</span></span>

- <span data-ttu-id="f31f6-192">Pobierz przykłady [zaawansowanych scenariuszy z usługi Azure Multi-Factor Authentication i sieci VPN innych firm](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="f31f6-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="f31f6-193">Synchronizowanie serwera usługi MFA z usługi Active Directory systemu Windows Server</span><span class="sxs-lookup"><span data-stu-id="f31f6-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="f31f6-194">[Skonfiguruj uwierzytelnianie systemu Windows](multi-factor-authentication-get-started-server-windows.md) dla aplikacji</span><span class="sxs-lookup"><span data-stu-id="f31f6-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
