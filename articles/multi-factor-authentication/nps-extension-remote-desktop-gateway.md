---
title: "Zdalne integracji bramy usług pulpitu z rozszerzeniem Azure MFA NPS | Dokumentacja firmy Microsoft"
description: "W tym artykule omówiono integrowanie infrastruktury bramy usług pulpitu zdalnego z usługą Azure MFA platformy Microsoft Azure przy użyciu rozszerzenia serwera zasad sieciowych (NPS)."
services: active-directory
keywords: "Usługa Azure MFA, integracja bramy usług pulpitu zdalnego, Azure Active Directory, serwer zasad sieciowych rozszerzenia"
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: kgremban
ms.reviewer: jsnow
ms.custom: it-pro
ms.openlocfilehash: 6ff9a341b31e5005949dcc0ecb2591060269846e
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
#  <a name="integrate-your-remote-desktop-gateway-infrastructure-using-the-network-policy-server-nps-extension-and-azure-ad"></a><span data-ttu-id="005c0-104">Integrowanie infrastruktury bramy usług pulpitu zdalnego przy użyciu rozszerzenia serwera zasad sieciowych (NPS) i Azure AD</span><span class="sxs-lookup"><span data-stu-id="005c0-104">Integrate your Remote Desktop Gateway infrastructure using the Network Policy Server (NPS) extension and Azure AD</span></span>

<span data-ttu-id="005c0-105">Ten artykuł zawiera szczegółowe informacje dla integrowanie infrastruktury bramy usług pulpitu zdalnego z usługi Azure Multi-Factor Authentication (MFA) przy użyciu rozszerzenia serwera zasad sieciowych (NPS) platformy Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="005c0-105">This article provides details for integrating your Remote Desktop Gateway infrastructure with Azure Multi-Factor Authentication (MFA) using the Network Policy Server (NPS) extension for Microsoft Azure.</span></span> 

<span data-ttu-id="005c0-106">Rozszerzenie usługi zasad sieciowych (NPS) dla usługi Azure umożliwia klientom ochrony uwierzytelniania klienta usługi usługi użytkowników zdalnego uwierzytelniania (RADIUS), za pomocą usługi Azure na chmurze [Multi-Factor Authentication (MFA)](multi-factor-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="005c0-106">The Network Policy Service (NPS) extension for Azure allows customers to safeguard Remote Authentication Dial-In User Service (RADIUS) client authentication using Azure’s cloud-based [Multi-Factor Authentication (MFA)](multi-factor-authentication.md).</span></span> <span data-ttu-id="005c0-107">To rozwiązanie zapewnia weryfikację dwuetapową dodawania drugiej warstwy zabezpieczeń używanej do logowania użytkowników i transakcji.</span><span class="sxs-lookup"><span data-stu-id="005c0-107">This solution provides two-step verification for adding a second layer of security to user sign-ins and transactions.</span></span>

<span data-ttu-id="005c0-108">Ten artykuł zawiera instrukcje krok po kroku do integracji z usługą Azure MFA infrastruktury serwera NPS przy użyciu rozszerzenia zasad Sieciowych na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="005c0-108">This article provides step-by-step instructions for integrating the NPS infrastructure with Azure MFA using the NPS extension for Azure.</span></span> <span data-ttu-id="005c0-109">Dzięki temu weryfikacji dla użytkownicy próbują zalogować się do bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-109">This enables secure verification for users attempting to log on to a Remote Desktop Gateway.</span></span> 

<span data-ttu-id="005c0-110">Zasad sieciowych i dostępu do usługi (NPS) umożliwia organizacjom wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="005c0-110">The Network Policy and Access Services (NPS) gives organizations the ability to do the following:</span></span>
* <span data-ttu-id="005c0-111">Zdefiniuj centralnej lokalizacji, zarządzania i kontroli żądania sieci, określając, kto może się połączyć, kiedy połączeń dnia są dozwolone, czas trwania połączenia i poziom zabezpieczeń klientów musi być używana do łączenia i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="005c0-111">Define central locations for the management and control of network requests by specifying who can connect, what times of day connections are allowed, the duration of connections, and the level of security that clients must use to connect, and so on.</span></span> <span data-ttu-id="005c0-112">Zamiast określenia tych zasad na każdym serwerze sieci VPN lub bramy usług pulpitu zdalnego (RD), te zasady można określić jeden raz w centralnej lokalizacji.</span><span class="sxs-lookup"><span data-stu-id="005c0-112">Rather than specifying these policies on each VPN or Remote Desktop (RD) Gateway server, these policies can be specified once in a central location.</span></span> <span data-ttu-id="005c0-113">Protokół RADIUS zapewnia scentralizowane uwierzytelnianie, autoryzację i Ewidencjonowanie.</span><span class="sxs-lookup"><span data-stu-id="005c0-113">The RADIUS protocol provides the centralized Authentication, Authorization, and Accounting (AAA).</span></span> 
* <span data-ttu-id="005c0-114">Ustanów i wymuszanie zasad dotyczących kondycji klienta ochrony dostępu do sieci (NAP), które określają, czy urządzenia są przyznawane nieograniczonego lub ograniczonego dostępu do zasobów sieciowych.</span><span class="sxs-lookup"><span data-stu-id="005c0-114">Establish and enforce Network Access Protection (NAP) client health policies that determine whether devices are granted unrestricted or restricted access to network resources.</span></span>
* <span data-ttu-id="005c0-115">Umożliwiają wymuszające uwierzytelnianie i autoryzację na dostęp metodą 802. 1 punkty dostępu bezprzewodowego z obsługą i przełączników Ethernet.</span><span class="sxs-lookup"><span data-stu-id="005c0-115">Provide a means to enforce authentication and authorization for access to 802.1x-capable wireless access points and Ethernet switches.</span></span>    

<span data-ttu-id="005c0-116">Zazwyczaj organizacji, Użyj serwera zasad Sieciowych (RADIUS), aby uprościć i scentralizowane zarządzanie siecią VPN zasad.</span><span class="sxs-lookup"><span data-stu-id="005c0-116">Typically, organizations use NPS (RADIUS) to simplify and centralize the management of VPN polices.</span></span> <span data-ttu-id="005c0-117">Jednak w wielu organizacjach także używać serwera NPS do uproszczenia i scentralizowane zarządzanie zasady autoryzacji połączeń usług pulpitu usług pulpitu zdalnego (RD CAP).</span><span class="sxs-lookup"><span data-stu-id="005c0-117">However, many organizations also use NPS to simplify and centralize the management of RD Desktop Connection Authorization Policies (RD CAPs).</span></span> 

<span data-ttu-id="005c0-118">Organizacje można również zintegrować serwera NPS z usługą Azure MFA do zwiększenia poziomu bezpieczeństwa i zapewnienia wysokiego poziomu zgodności.</span><span class="sxs-lookup"><span data-stu-id="005c0-118">Organizations can also integrate NPS with Azure MFA to enhance security and provide a high level of compliance.</span></span> <span data-ttu-id="005c0-119">Pomaga to zapewnić, że użytkownicy ustanowić weryfikacji dwuetapowej do logowania się do bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-119">This helps ensure that users establish two-step verification to log on to the Remote Desktop Gateway.</span></span> <span data-ttu-id="005c0-120">Aby użytkownicy mogli uzyskać dostęp użytkownik musi podać ich kombinacja nazwy użytkownika i hasła z informacjami, które użytkownik ma w ich kontroli.</span><span class="sxs-lookup"><span data-stu-id="005c0-120">For users to be granted access, they must provide their username/password combination with information that the user has in their control.</span></span> <span data-ttu-id="005c0-121">Te informacje musi być zaufany i nie jest łatwo zduplikowany, takie jak numer telefonu komórkowego, numer telefonu stacjonarnego aplikacji na urządzeniu przenośnym i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="005c0-121">This information must be trusted and not easily duplicated, such as a cell phone number, landline number, application on a mobile device, and so on.</span></span>

<span data-ttu-id="005c0-122">Wcześniej dostępności rozszerzenia serwera zasad Sieciowych na platformie Azure, klientów, którzy chcieliby implementuje weryfikację dwuetapową dla zintegrowanego środowiska serwera zasad Sieciowych i usługi Azure MFA było konfigurowania i konserwacji osobny serwer usługi MFA w środowisku lokalnym, zgodnie z opisem w [bramy usług pulpitu zdalnego i Azure przy użyciu usługi RADIUS serwera Multi-Factor Authentication](multi-factor-authentication-get-started-server-rdg.md).</span><span class="sxs-lookup"><span data-stu-id="005c0-122">Prior to the availability of the NPS extension for Azure, customers who wished to implement two-step verification for integrated NPS and Azure MFA environments had to configure and maintain a separate MFA Server in the on-premises environment as documented in [Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS](multi-factor-authentication-get-started-server-rdg.md).</span></span>

<span data-ttu-id="005c0-123">Dostępność rozszerzenia serwera zasad Sieciowych na platformie Azure pozwala organizacjom wyboru do wdrożenia rozwiązania MFA lokalne lub rozwiązanie MFA oparte na chmurze do bezpiecznego uwierzytelniania klienta RADIUS.</span><span class="sxs-lookup"><span data-stu-id="005c0-123">The availability of the NPS extension for Azure now gives organizations the choice to deploy either an on-premises based MFA solution or a cloud-based MFA solution to secure RADIUS client authentication.</span></span>

## <a name="authentication-flow"></a><span data-ttu-id="005c0-124">Przepływ uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="005c0-124">Authentication Flow</span></span>

<span data-ttu-id="005c0-125">Aby użytkownicy mogli uzyskać dostęp do zasobów sieciowych za pośrednictwem bramy usług pulpitu zdalnego muszą spełniać warunki określone w jednej usług pulpitu zdalnego zasady autoryzacji połączeń (RD CAP) i jeden usług pulpitu zdalnego zasady autoryzacji zasobów (RD RAP).</span><span class="sxs-lookup"><span data-stu-id="005c0-125">For users to be granted access to network resources through a Remote Desktop Gateway, they must meet the conditions specified in one RD Connection Authorization Policy (RD CAP) and one RD Resource Authorization Policy (RD RAP).</span></span> <span data-ttu-id="005c0-126">Zasady RD CAP Określ, kto jest autoryzowany do nawiązania połączenia bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-126">RD CAPs specify who is authorized to connect to RD Gateways.</span></span> <span data-ttu-id="005c0-127">Zasady RD RAP Określ zasobów sieciowych, takich jak usługa Pulpit zdalny lub aplikacji zdalnych, które użytkownik będzie mógł nawiązywać połączenie za pośrednictwem bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-127">RD RAPs specify the network resources, such as remote desktops or remote apps, that the user is allowed to connect to through the RD Gateway.</span></span> 

<span data-ttu-id="005c0-128">Bramy usług pulpitu zdalnego można skonfigurować do używania magazynu centralne zasady dla RD CAP.</span><span class="sxs-lookup"><span data-stu-id="005c0-128">An RD Gateway can be configured to use a central policy store for RD CAPs.</span></span> <span data-ttu-id="005c0-129">Zasady RD RAP nie można użyć centralnych zasad, jak są przetwarzane w bramie usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-129">RD RAPs cannot use a central policy, as they are processed on the RD Gateway.</span></span> <span data-ttu-id="005c0-130">Przykład brama usług pulpitu zdalnego skonfigurowane do używania magazynu centralne zasady dla RD CAP jest klienta RADIUS do innego serwera NPS, który służy do przechowywania centralne zasady.</span><span class="sxs-lookup"><span data-stu-id="005c0-130">An example of an RD Gateway configured to use a central policy store for RD CAPs is a RADIUS client to another NPS server that serves as the central policy store.</span></span>

<span data-ttu-id="005c0-131">Gdy rozszerzenia serwera zasad Sieciowych na platformie Azure są zintegrowane z serwera zasad Sieciowych i bramy usług pulpitu zdalnego, przepływ pomyślne uwierzytelnienie jest następujący:</span><span class="sxs-lookup"><span data-stu-id="005c0-131">When the NPS extension for Azure is integrated with the NPS and Remote Desktop Gateway, the successful authentication flow is as follows:</span></span>

1. <span data-ttu-id="005c0-132">Serwer bramy usług pulpitu zdalnego otrzymuje żądanie uwierzytelnienia od użytkownika pulpitu zdalnego nawiązywania połączenia z zasobem, takich jak sesji pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-132">The Remote Desktop Gateway server receives an authentication request from a remote desktop user to connect to a resource, such as a Remote Desktop session.</span></span> <span data-ttu-id="005c0-133">Działając jako klient usługi RADIUS, serwera bramy usług pulpitu zdalnego konwertuje żądanie na komunikat żądania dostępu usługi RADIUS i wysyła wiadomość do serwera RADIUS (NPS), w którym zainstalowano rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-133">Acting as a RADIUS client, the Remote Desktop Gateway server converts the request to a RADIUS Access-Request message and sends the message to the RADIUS (NPS) server where the NPS extension is installed.</span></span> 
2. <span data-ttu-id="005c0-134">Kombinacja nazwy użytkownika i hasła została zweryfikowana w usłudze Active Directory, a użytkownik jest uwierzytelniony.</span><span class="sxs-lookup"><span data-stu-id="005c0-134">The username and password combination is verified in Active Directory and the user is authenticated.</span></span>
3. <span data-ttu-id="005c0-135">Jeśli są spełnione wszystkie warunki określone w żądanie połączenia serwera zasad Sieciowych i zasad sieciowych (na przykład pory dnia lub grupy ograniczeniami członkostwa), żądania uwierzytelniania dodatkowego z usługą Azure MFA wyzwala rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-135">If all the conditions as specified in the NPS Connection Request and the Network Policies are met (for example, time of day or group membership restrictions), the NPS extension triggers a request for secondary authentication with Azure MFA.</span></span> 
4. <span data-ttu-id="005c0-136">Usługa Azure MFA komunikuje się z usługą Azure AD, pobiera szczegóły użytkownika, a następnie wykonuje dodatkowego uwierzytelniania przy użyciu metody skonfigurowany przez użytkownika (wiadomości tekstowej, aplikacji mobilnych itd.).</span><span class="sxs-lookup"><span data-stu-id="005c0-136">Azure MFA communicates with Azure AD, retrieves the user’s details, and performs the secondary authentication using the method configured by the user (text message, mobile app, and so on).</span></span> 
5. <span data-ttu-id="005c0-137">Na powodzenie żądanie uwierzytelniania MFA uwierzytelnianie wieloskładnikowe Azure komunikuje się wynik, który ma rozszerzenie serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-137">Upon success of the MFA challenge, Azure MFA communicates the result to the NPS extension.</span></span>
6. <span data-ttu-id="005c0-138">Serwer NPS, w którym zainstalowano rozszerzenia wysyła komunikat udzielenia dostępu usługi RADIUS dla zasady RD CAP do serwera bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-138">The NPS server where the extension is installed sends a RADIUS Access-Accept message for the RD CAP policy to the Remote Desktop Gateway server.</span></span>
7. <span data-ttu-id="005c0-139">Użytkownik uzyskuje dostęp do zasobu żądanej sieci za pośrednictwem bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-139">The user is granted access to the requested network resource through the RD Gateway.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="005c0-140">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="005c0-140">Prerequisites</span></span>
<span data-ttu-id="005c0-141">Ta sekcja zawiera szczegóły dotyczące wymagań wstępnych konieczne przed Integrowanie usługi Azure MFA z bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-141">This section details the prerequisites necessary before integrating Azure MFA with the Remote Desktop Gateway.</span></span> <span data-ttu-id="005c0-142">Przed rozpoczęciem, musi mieć następujące wymagania wstępne w miejscu.</span><span class="sxs-lookup"><span data-stu-id="005c0-142">Before you begin, you must have the following prerequisites in place.</span></span>  

* <span data-ttu-id="005c0-143">Infrastruktura usług pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="005c0-143">Remote Desktop Services (RDS) infrastructure</span></span>
* <span data-ttu-id="005c0-144">Licencja usługi Azure MFA</span><span class="sxs-lookup"><span data-stu-id="005c0-144">Azure MFA License</span></span>
* <span data-ttu-id="005c0-145">Oprogramowanie Windows Server</span><span class="sxs-lookup"><span data-stu-id="005c0-145">Windows Server software</span></span>
* <span data-ttu-id="005c0-146">Rola zasad sieciowych i dostępu do usługi (NPS)</span><span class="sxs-lookup"><span data-stu-id="005c0-146">Network Policy and Access Services (NPS) role</span></span>
* <span data-ttu-id="005c0-147">Zsynchronizowane usługi Azure AD z lokalnej usługi AD</span><span class="sxs-lookup"><span data-stu-id="005c0-147">Azure AD synched with on-premises AD</span></span> 
* <span data-ttu-id="005c0-148">Identyfikator GUID usługi Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="005c0-148">Azure Active Directory GUID ID</span></span>

### <a name="remote-desktop-services-rds-infrastructure"></a><span data-ttu-id="005c0-149">Infrastruktura usług pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="005c0-149">Remote Desktop Services (RDS) infrastructure</span></span>
<span data-ttu-id="005c0-150">W miejscu musi mieć działający infrastruktury usług pulpitu zdalnego (RDS).</span><span class="sxs-lookup"><span data-stu-id="005c0-150">You must have a working Remote Desktop Services (RDS) infrastructure in place.</span></span> <span data-ttu-id="005c0-151">Jeśli nie chcesz, a następnie tej infrastruktury może szybko utworzyć na platformie Azure przy użyciu następującego szablonu szybki start: [wdrażania Utwórz kolekcję sesji pulpitu zdalnego](https://github.com/Azure/azure-quickstart-templates/tree/ad20c78b36d8e1246f96bb0e7a8741db481f957f/rds-deployment).</span><span class="sxs-lookup"><span data-stu-id="005c0-151">If you do not, then you can quickly create this infrastructure in Azure using the following quick start template: [Create Remote Desktop Session Collection deployment](https://github.com/Azure/azure-quickstart-templates/tree/ad20c78b36d8e1246f96bb0e7a8741db481f957f/rds-deployment).</span></span> 

<span data-ttu-id="005c0-152">Jeśli chcesz ręcznie utworzyć lokalnej infrastruktury usług pulpitu zdalnego dla celów testowych, wykonaj kroki, aby wdrożyć jeden.</span><span class="sxs-lookup"><span data-stu-id="005c0-152">If you wish to manually create an on-premises RDS infrastructure quickly for testing purposes, follow the steps to deploy one.</span></span> 
<span data-ttu-id="005c0-153">**Dowiedz się więcej**: [wdrożenia usług pulpitu zdalnego z szybki start Azure](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/rds-in-azure) i [RDS podstawowe wdrożenie infrastruktury](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/rds-deploy-infrastructure).</span><span class="sxs-lookup"><span data-stu-id="005c0-153">**Learn more**: [Deploy RDS with Azure quick start](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/rds-in-azure) and [Basic RDS infrastructure deployment](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/rds-deploy-infrastructure).</span></span> 

### <a name="licenses"></a><span data-ttu-id="005c0-154">Licencje</span><span class="sxs-lookup"><span data-stu-id="005c0-154">Licenses</span></span>
<span data-ttu-id="005c0-155">Wymagana jest licencja dla usługi Azure MFA, który jest dostępny za pośrednictwem usługi Azure AD Premium, Enterprise Mobility plus Security (EMS) lub subskrypcji usługi MFA.</span><span class="sxs-lookup"><span data-stu-id="005c0-155">Required is a license for Azure MFA, which is available through an Azure AD Premium, Enterprise Mobility plus Security (EMS), or an MFA subscription.</span></span> <span data-ttu-id="005c0-156">Aby uzyskać więcej informacji, zobacz [sposobu uzyskania usługi Azure Multi-Factor Authentication](multi-factor-authentication-versions-plans.md).</span><span class="sxs-lookup"><span data-stu-id="005c0-156">For more information, see [How to get Azure Multi-Factor Authentication](multi-factor-authentication-versions-plans.md).</span></span> <span data-ttu-id="005c0-157">Do celów testowych, możesz użyć subskrypcji wersji próbnej.</span><span class="sxs-lookup"><span data-stu-id="005c0-157">For testing purposes, you can use a trial subscription.</span></span>

### <a name="software"></a><span data-ttu-id="005c0-158">Oprogramowanie</span><span class="sxs-lookup"><span data-stu-id="005c0-158">Software</span></span>
<span data-ttu-id="005c0-159">Rozszerzenie serwera NPS wymaga systemu Windows Server 2008 R2 z dodatkiem SP1 lub nowszy z zainstalowaną usługą roli serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-159">The NPS extension requires Windows Server 2008 R2 SP1 or above with the NPS role service installed.</span></span> <span data-ttu-id="005c0-160">Wszystkie kroki opisane w tej sekcji zostały wykonane przy użyciu systemu Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="005c0-160">All the steps in this section were performed using Windows Server 2016.</span></span>

### <a name="network-policy-and-access-services-nps-role"></a><span data-ttu-id="005c0-161">Rola zasad sieciowych i dostępu do usługi (NPS)</span><span class="sxs-lookup"><span data-stu-id="005c0-161">Network Policy and Access Services (NPS) role</span></span>
<span data-ttu-id="005c0-162">Usługi roli serwera NPS zawiera serwer usługi RADIUS i klienta, funkcje, a także zasady dostępu do sieci usługi kondycji.</span><span class="sxs-lookup"><span data-stu-id="005c0-162">The NPS role service provides the RADIUS server and client functionality as well as Network Access Policy health service.</span></span> <span data-ttu-id="005c0-163">Musi być zainstalowana rola to na co najmniej dwa komputery w infrastrukturze: bramy usług pulpitu zdalnego i drugi serwer członkowski lub kontroler domeny.</span><span class="sxs-lookup"><span data-stu-id="005c0-163">This role must be installed on at least two computers in your infrastructure: The Remote Desktop Gateway and another member server or domain controller.</span></span> <span data-ttu-id="005c0-164">Domyślnie roli jest już obecny na komputerze, który został skonfigurowany jako brama usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-164">By default, the role is already present on the computer configured as the Remote Desktop Gateway.</span></span>  <span data-ttu-id="005c0-165">Można również zainstalować rolę serwera zasad Sieciowych na co najmniej na innym komputerze, takich jak kontroler domeny lub serwer członkowski.</span><span class="sxs-lookup"><span data-stu-id="005c0-165">You must also install the NPS role on at least on another computer, such as a domain controller or member server.</span></span>

<span data-ttu-id="005c0-166">Aby uzyskać informacje na temat instalowania roli serwera NPS usługi systemu Windows Server 2012 lub starszy, zobacz [zainstalować serwer zasad dotyczących kondycji ochrony dostępu do sieci](https://technet.microsoft.com/library/dd296890.aspx).</span><span class="sxs-lookup"><span data-stu-id="005c0-166">For information on installing the NPS role service Windows Server 2012 or older, see [Install a NAP Health Policy Server](https://technet.microsoft.com/library/dd296890.aspx).</span></span> <span data-ttu-id="005c0-167">Opis najlepszych rozwiązań dla serwera NPS, w tym zalecenie, aby zainstalować serwer zasad Sieciowych na kontrolerze domeny, zobacz [najlepsze rozwiązania dotyczące serwera NPS](https://technet.microsoft.com/library/cc771746).</span><span class="sxs-lookup"><span data-stu-id="005c0-167">For a description of best practices for NPS, including the recommendation to install NPS on a domain controller, see [Best Practices for NPS](https://technet.microsoft.com/library/cc771746).</span></span>

### <a name="azure-active-directory-synched-with-on-premises-active-directory"></a><span data-ttu-id="005c0-168">Usługa Azure Active Directory zsynchronizowane z lokalną usługą Active Directory</span><span class="sxs-lookup"><span data-stu-id="005c0-168">Azure Active Directory synched with on-premises Active Directory</span></span> 
<span data-ttu-id="005c0-169">Aby użyć rozszerzenia serwera NPS, lokalnych użytkowników musi być zsynchronizowane z usługą Azure AD i włączone dla usługi MFA.</span><span class="sxs-lookup"><span data-stu-id="005c0-169">To use the NPS extension, on-premises users must be synced with Azure AD and enabled for MFA.</span></span> <span data-ttu-id="005c0-170">W tej sekcji założono, że użytkowników lokalnych są zsynchronizowane z usługą Azure AD za pomocą AD Connect.</span><span class="sxs-lookup"><span data-stu-id="005c0-170">This section assumes that on-premises users are synched with Azure AD using AD Connect.</span></span> <span data-ttu-id="005c0-171">Aby uzyskać informacje dotyczące usługi Azure AD connect, zobacz [integrację katalogów lokalnych z usługą Azure Active Directory](../active-directory/connect/active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="005c0-171">For information on Azure AD connect, see [Integrate your on-premises directories with Azure Active Directory](../active-directory/connect/active-directory-aadconnect.md).</span></span> 

### <a name="azure-active-directory-guid-id"></a><span data-ttu-id="005c0-172">Identyfikator GUID usługi Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="005c0-172">Azure Active Directory GUID ID</span></span>
<span data-ttu-id="005c0-173">Aby zainstalować serwer NPS, musisz znać identyfikator GUID usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="005c0-173">To install NPS, you need to know the GUID of the Azure AD.</span></span> <span data-ttu-id="005c0-174">Instrukcje dotyczące znajdowania identyfikator GUID usługi Azure AD znajdują się poniżej.</span><span class="sxs-lookup"><span data-stu-id="005c0-174">Instructions for finding the GUID of the Azure AD are provided below.</span></span>

## <a name="configure-multi-factor-authentication"></a><span data-ttu-id="005c0-175">Skonfiguruj usługę Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="005c0-175">Configure Multi-Factor Authentication</span></span> 
<span data-ttu-id="005c0-176">Ta sekcja zawiera instrukcje dotyczące integrowania usługi Azure MFA z bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-176">This section provides instructions for integrating Azure MFA with the Remote Desktop Gateway.</span></span> <span data-ttu-id="005c0-177">Jako administrator należy skonfigurować usługę Azure MFA, zanim użytkownicy będą mogli samodzielnie zarejestrować ich wieloskładnikowego urządzenia lub aplikacji.</span><span class="sxs-lookup"><span data-stu-id="005c0-177">As an administrator, you must configure the Azure MFA service before users can self-register their multi-factor devices or applications.</span></span>

<span data-ttu-id="005c0-178">Postępuj zgodnie z instrukcjami [wprowadzenie do korzystania z usługi Azure Multi-Factor Authentication w chmurze](multi-factor-authentication-get-started-cloud.md) włączyć uwierzytelnianie wieloskładnikowe dla użytkowników usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="005c0-178">Follow the steps in [Getting started with Azure Multi-Factor Authentication in the cloud](multi-factor-authentication-get-started-cloud.md) to enable MFA for your Azure AD users.</span></span> 

### <a name="configure-accounts-for-two-step-verification"></a><span data-ttu-id="005c0-179">Konfigurowanie konta na potrzeby weryfikacji dwuetapowej</span><span class="sxs-lookup"><span data-stu-id="005c0-179">Configure accounts for two-step verification</span></span>
<span data-ttu-id="005c0-180">Po włączeniu konta dla usługi MFA, nie możesz zarejestrować się w zasobów objętych MFA zasad do momentu zaufanego urządzenia na potrzeby drugiego etapu uwierzytelniania pomyślnie zostały skonfigurowane zostały uwierzytelnione przy użyciu weryfikacji dwuetapowej.</span><span class="sxs-lookup"><span data-stu-id="005c0-180">Once an account has been enabled for MFA, you cannot sign in to resources governed by the MFA policy until you have successfully configured a trusted device to use for the second authentication factor have authenticated using two-step verification.</span></span>

<span data-ttu-id="005c0-181">Postępuj zgodnie z instrukcjami [co oznacza Azure Multi-Factor Authentication dla mnie?](./end-user/multi-factor-authentication-end-user.md) do zrozumienia i poprawnie skonfigurować urządzenia dla usługi MFA z kontem użytkownika.</span><span class="sxs-lookup"><span data-stu-id="005c0-181">Follow the steps in [What does Azure Multi-Factor Authentication mean for me?](./end-user/multi-factor-authentication-end-user.md) to understand and properly configure your devices for MFA with your user account.</span></span>

## <a name="install-and-configure-nps-extension"></a><span data-ttu-id="005c0-182">Instalowanie i Konfigurowanie rozszerzeń serwera NPS</span><span class="sxs-lookup"><span data-stu-id="005c0-182">Install and configure NPS extension</span></span>
<span data-ttu-id="005c0-183">Ta sekcja zawiera instrukcje dotyczące konfigurowania infrastruktury usług pulpitu zdalnego do użycia usługi Azure MFA na potrzeby uwierzytelniania klienta z bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-183">This section provides instructions for configuring RDS infrastructure to use Azure MFA for client authentication with the Remote Desktop Gateway.</span></span>

### <a name="acquire-azure-active-directory-guid-id"></a><span data-ttu-id="005c0-184">Uzyskać identyfikator GUID usługi Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="005c0-184">Acquire Azure Active Directory GUID ID</span></span>

<span data-ttu-id="005c0-185">W ramach konfiguracji rozszerzenia serwera NPS musisz podać poświadczenia administratora i identyfikator usługi Azure AD dla dzierżawy usługi Azure AD.</span><span class="sxs-lookup"><span data-stu-id="005c0-185">As part of the configuration of the NPS extension, you need to supply admin credentials and the Azure AD ID for your Azure AD tenant.</span></span> <span data-ttu-id="005c0-186">Poniższe kroki pokazują jak uzyskać identyfikator dzierżawcy.</span><span class="sxs-lookup"><span data-stu-id="005c0-186">The following steps show you how to get the tenant ID.</span></span>

1. <span data-ttu-id="005c0-187">Zaloguj się do [portalu Azure](https://portal.azure.com) jako administrator globalny dzierżawy platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="005c0-187">Sign in to the [Azure portal](https://portal.azure.com) as the global administrator of the Azure tenant.</span></span>
2. <span data-ttu-id="005c0-188">W lewym obszarze nawigacji, wybierz **usługi Azure Active Directory** ikony.</span><span class="sxs-lookup"><span data-stu-id="005c0-188">In the left navigation, select the **Azure Active Directory** icon.</span></span>
3. <span data-ttu-id="005c0-189">Wybierz **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="005c0-189">Select **Properties**.</span></span>
4. <span data-ttu-id="005c0-190">W bloku właściwości, obok identyfikator katalogu kliknij **kopiowania** ikony, jak pokazano poniżej, aby skopiować identyfikator do Schowka.</span><span class="sxs-lookup"><span data-stu-id="005c0-190">In the Properties blade, beside the Directory ID, click the **Copy** icon, as shown below, to copy the ID to clipboard.</span></span>

 ![Właściwości](./media/nps-extension-remote-desktop-gateway/image1.png)

### <a name="install-the-nps-extension"></a><span data-ttu-id="005c0-192">Zainstaluj rozszerzenie serwera NPS</span><span class="sxs-lookup"><span data-stu-id="005c0-192">Install the NPS extension</span></span>
<span data-ttu-id="005c0-193">Zainstaluj rozszerzenie serwera NPS na serwerze, który ma zainstalowaną rolę zasad sieciowych i dostępu do usługi (NPS).</span><span class="sxs-lookup"><span data-stu-id="005c0-193">Install the NPS extension on a server that has the Network Policy and Access Services (NPS) role installed.</span></span> <span data-ttu-id="005c0-194">Funkcja ta działa jako serwer RADIUS dla projektu.</span><span class="sxs-lookup"><span data-stu-id="005c0-194">This functions as the RADIUS server for your design.</span></span> 

>[!Important]
> <span data-ttu-id="005c0-195">Upewnij się, że nie należy instalować rozszerzenia serwera NPS na serwerze bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-195">Be sure you do not install the NPS extension on your Remote Desktop Gateway server.</span></span>
> 

1. <span data-ttu-id="005c0-196">Pobierz [rozszerzenia serwera NPS](https://aka.ms/npsmfa).</span><span class="sxs-lookup"><span data-stu-id="005c0-196">Download the [NPS extension](https://aka.ms/npsmfa).</span></span> 
2. <span data-ttu-id="005c0-197">Kopiowanie pliku wykonywalnego Instalatora (NpsExtnForAzureMfaInstaller.exe) na serwerze zasad Sieciowych.</span><span class="sxs-lookup"><span data-stu-id="005c0-197">Copy the setup executable file (NpsExtnForAzureMfaInstaller.exe) to the NPS server.</span></span>
3. <span data-ttu-id="005c0-198">Na serwerze NPS, kliknij dwukrotnie **NpsExtnForAzureMfaInstaller.exe**.</span><span class="sxs-lookup"><span data-stu-id="005c0-198">On the NPS server, double-click **NpsExtnForAzureMfaInstaller.exe**.</span></span> <span data-ttu-id="005c0-199">Jeśli zostanie wyświetlony monit, kliknij przycisk **Uruchom**.</span><span class="sxs-lookup"><span data-stu-id="005c0-199">If prompted, click **Run**.</span></span>
4. <span data-ttu-id="005c0-200">W rozszerzeniu zasad Sieciowych dla usługi Azure MFA — okno dialogowe, przejrzyj postanowienia licencyjne dotyczące oprogramowania, sprawdź **zgadzam się z warunkami licencji**i kliknij przycisk **zainstalować**.</span><span class="sxs-lookup"><span data-stu-id="005c0-200">In the NPS Extension for Azure MFA dialog box, review the software license terms, check **I agree to the license terms and conditions**, and click **Install**.</span></span>
 
  ![Instalator usługi Azure MFA](./media/nps-extension-remote-desktop-gateway/image2.png)

5. <span data-ttu-id="005c0-202">W rozszerzeniu zasad Sieciowych dla usługi Azure MFA — okno dialogowe kliknij przycisk Zamknij.</span><span class="sxs-lookup"><span data-stu-id="005c0-202">In the NPS Extension for Azure MFA dialog box, click Close.</span></span> 

  ![Rozszerzenia serwera zasad Sieciowych na potrzeby usługi Azure MFA](./media/nps-extension-remote-desktop-gateway/image3.png)

### <a name="configure-certificates-for-use-with-the-nps-extension-using-a-powershell-script"></a><span data-ttu-id="005c0-204">Konfigurowanie certyfikatów do użytku z rozszerzeniem serwera NPS przy użyciu skryptu programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="005c0-204">Configure certificates for use with the NPS extension using a PowerShell script</span></span>
<span data-ttu-id="005c0-205">Następnie należy skonfigurować certyfikatów do użytku przez rozszerzenie serwera NPS do zapewnienia bezpiecznej komunikacji i gwarancji.</span><span class="sxs-lookup"><span data-stu-id="005c0-205">Next, you need to configure certificates for use by the NPS extension to ensure secure communications and assurance.</span></span> <span data-ttu-id="005c0-206">Składniki serwera NPS obejmują skrypt programu Windows PowerShell, który konfiguruje certyfikatu z podpisem własnym do użytku z serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-206">The NPS components include a Windows PowerShell script that configures a self-signed certificate for use with NPS.</span></span> 

<span data-ttu-id="005c0-207">Skrypt wykonuje następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="005c0-207">The script performs the following actions:</span></span>

* <span data-ttu-id="005c0-208">Tworzy certyfikat z podpisem własnym</span><span class="sxs-lookup"><span data-stu-id="005c0-208">Creates a self-signed certificate</span></span>
* <span data-ttu-id="005c0-209">Kojarzy klucz publiczny certyfikatu do usługi podmiotu zabezpieczeń w usłudze Azure AD</span><span class="sxs-lookup"><span data-stu-id="005c0-209">Associates public key of certificate to service principal on Azure AD</span></span>
* <span data-ttu-id="005c0-210">Zapisuje certyfikat w magazynie komputera lokalnego</span><span class="sxs-lookup"><span data-stu-id="005c0-210">Stores the cert in the local machine store</span></span>
* <span data-ttu-id="005c0-211">Zapewnia dostęp do klucza prywatnego certyfikatu użytkownika sieci</span><span class="sxs-lookup"><span data-stu-id="005c0-211">Grants access to the certificate’s private key to the network user</span></span>
* <span data-ttu-id="005c0-212">Uruchamia ponownie usługę Serwer zasad sieciowych</span><span class="sxs-lookup"><span data-stu-id="005c0-212">Restarts Network Policy Server service</span></span>

<span data-ttu-id="005c0-213">Jeśli chcesz użyć własnych certyfikatów, należy skojarzyć publicznego certyfikatu z zasadą usługi na serwerze usługi Azure AD i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="005c0-213">If you want to use your own certificates, you need to associate the public of your certificate to the service principle on Azure AD, and so on.</span></span>

<span data-ttu-id="005c0-214">Aby użyć skryptu, dostarczają rozszerzenie swoje poświadczenia usługi Azure AD administratora i Identyfikatora dzierżawy usługi Azure AD, które wcześniej zostały skopiowane.</span><span class="sxs-lookup"><span data-stu-id="005c0-214">To use the script, provide the extension with your Azure AD Admin credentials and the Azure AD tenant ID that you copied earlier.</span></span> <span data-ttu-id="005c0-215">Uruchom skrypt na każdym serwerze NPS, w którym zainstalowano rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-215">Run the script on each NPS server where you installed the NPS extension.</span></span> <span data-ttu-id="005c0-216">Następnie wykonaj poniższe czynności:</span><span class="sxs-lookup"><span data-stu-id="005c0-216">Then do the following:</span></span>

1. <span data-ttu-id="005c0-217">Otwórz administracyjny wiersz środowiska Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="005c0-217">Open an administrative Windows PowerShell prompt.</span></span>
2. <span data-ttu-id="005c0-218">W wierszu polecenia programu PowerShell wpisz **cd "c:\Program Files\Microsoft\AzureMfa\Config"**i naciśnij klawisz **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="005c0-218">At the PowerShell prompt, type **cd ‘c:\Program Files\Microsoft\AzureMfa\Config’**, and press **ENTER**.</span></span>
3. <span data-ttu-id="005c0-219">Typ _.\AzureMfsNpsExtnConfigSetup.ps1_i naciśnij klawisz **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="005c0-219">Type _.\AzureMfsNpsExtnConfigSetup.ps1_, and press **ENTER**.</span></span> <span data-ttu-id="005c0-220">Skrypt sprawdza, czy jest zainstalowany moduł programu PowerShell usługi Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="005c0-220">The script checks to see if the Azure Active Directory PowerShell module is installed.</span></span> <span data-ttu-id="005c0-221">Jeśli nie jest zainstalowany, skrypt zainstaluje moduł.</span><span class="sxs-lookup"><span data-stu-id="005c0-221">If not installed, the script installs the module for you.</span></span>

  ![Program Azure AD PowerShell](./media/nps-extension-remote-desktop-gateway/image4.png)
  
4. <span data-ttu-id="005c0-223">Po skrypt sprawdza poprawność instalacji modułu programu PowerShell, wyświetla okno dialogowe modułu programu PowerShell usługi Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="005c0-223">After the script verifies the installation of the PowerShell module, it displays the Azure Active Directory PowerShell module dialog box.</span></span> <span data-ttu-id="005c0-224">W oknie dialogowym Wprowadź poświadczenia administratora usługi Azure AD i hasło, a następnie kliknij przycisk **logowania**.</span><span class="sxs-lookup"><span data-stu-id="005c0-224">In the dialog box, enter your Azure AD admin credentials and password, and click **Sign In**.</span></span>

  ![Konta programu Powershell](./media/nps-extension-remote-desktop-gateway/image5.png)

5. <span data-ttu-id="005c0-226">Po wyświetleniu monitu Wklej identyfikator dzierżawcy wcześniej zostały skopiowane do Schowka i naciśnij klawisz **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="005c0-226">When prompted, paste the tenant ID you copied to the clipboard earlier, and press **ENTER**.</span></span>

  ![Wprowadź identyfikator dzierżawy](./media/nps-extension-remote-desktop-gateway/image6.png)

6. <span data-ttu-id="005c0-228">Skrypt tworzy certyfikat z podpisem własnym i wykonuje inne zmiany w konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="005c0-228">The script creates a self-signed certificate and performs other configuration changes.</span></span> <span data-ttu-id="005c0-229">Dane wyjściowe powinny być jak obraz, pokazano poniżej.</span><span class="sxs-lookup"><span data-stu-id="005c0-229">The output should be like the image shown below.</span></span>

  ![Certyfikatu z podpisem własnym](./media/nps-extension-remote-desktop-gateway/image7.png)

## <a name="configure-nps-components-on-remote-desktop-gateway"></a><span data-ttu-id="005c0-231">Konfigurowanie składników serwera NPS na bramy usług pulpitu zdalnego</span><span class="sxs-lookup"><span data-stu-id="005c0-231">Configure NPS components on Remote Desktop Gateway</span></span>
<span data-ttu-id="005c0-232">W tej sekcji należy skonfigurować zasady autoryzacji połączeń bramy usług pulpitu zdalnego oraz inne ustawienia usługi RADIUS.</span><span class="sxs-lookup"><span data-stu-id="005c0-232">In this section, you configure the Remote Desktop Gateway connection authorization policies and other RADIUS settings.</span></span>

<span data-ttu-id="005c0-233">Przepływ uwierzytelniania wymaga, aby komunikaty RADIUS być wymieniane między bramy usług pulpitu zdalnego i serwera NPS, w którym jest zainstalowany serwer zasad Sieciowych.</span><span class="sxs-lookup"><span data-stu-id="005c0-233">The authentication flow requires that RADIUS messages be exchanged between the Remote Desktop Gateway and the NPS server where the NPS Server is installed.</span></span> <span data-ttu-id="005c0-234">Oznacza to, że zarówno bramy usług pulpitu zdalnego, jak i serwera NPS, w którym zainstalowano rozszerzenia serwera NPS należy skonfigurować ustawienia klientów usługi RADIUS.</span><span class="sxs-lookup"><span data-stu-id="005c0-234">This means that you must configure RADIUS client settings on both Remote Desktop Gateway and the NPS server where the NPS extension is installed.</span></span> 

### <a name="configure-remote-desktop-gateway-connection-authorization-policies-to-use-central-store"></a><span data-ttu-id="005c0-235">Skonfiguruj zasady autoryzacji połączeń bramy usług pulpitu zdalnego, aby używał magazynu centralnej</span><span class="sxs-lookup"><span data-stu-id="005c0-235">Configure Remote Desktop Gateway connection authorization policies to use central store</span></span>
<span data-ttu-id="005c0-236">Zasady autoryzacji połączeń usług pulpitu zdalnego (RD CAP) określić wymagania dotyczące połączenia z serwerem bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-236">Remote Desktop connection authorization policies (RD CAPs) specify the requirements for connecting to a Remote Desktop Gateway server.</span></span> <span data-ttu-id="005c0-237">Zasady RD CAP mogą być przechowywane lokalnie (ustawienie domyślne) lub mogą być przechowywane w centralnym magazynie RD CAP, który jest uruchomiony serwer zasad Sieciowych.</span><span class="sxs-lookup"><span data-stu-id="005c0-237">RD CAPs can be stored locally (default) or they can be stored in a central RD CAP store that is running NPS.</span></span> <span data-ttu-id="005c0-238">Aby skonfigurować integrację z usługą Azure MFA z usług pulpitu zdalnego, należy określić centralnego magazynu.</span><span class="sxs-lookup"><span data-stu-id="005c0-238">To configure integration of Azure MFA with RDS, you need to specify the use of a central store.</span></span>

1. <span data-ttu-id="005c0-239">Na serwerze bramy usług pulpitu zdalnego Otwórz **Menedżera serwera**.</span><span class="sxs-lookup"><span data-stu-id="005c0-239">On the RD Gateway server, open **Server Manager**.</span></span> 
2. <span data-ttu-id="005c0-240">W menu, kliknij polecenie **narzędzia**, wskaż polecenie **usług pulpitu zdalnego**, a następnie kliknij przycisk **Menedżera bramy usług pulpitu zdalnego**.</span><span class="sxs-lookup"><span data-stu-id="005c0-240">On the menu, click **Tools**, point to **Remote Desktop Services**, and then click **Remote Desktop Gateway Manager**.</span></span>

  ![Usługi pulpitu zdalnego](./media/nps-extension-remote-desktop-gateway/image8.png)

3. <span data-ttu-id="005c0-242">W Menedżer bramy usług pulpitu zdalnego, kliknij prawym przyciskiem myszy  **\[nazwy serwera\] (Local)**i kliknij przycisk **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="005c0-242">In the RD Gateway Manger, right-click **\[Server Name\] (Local)**, and click **Properties**.</span></span>

  ![Nazwa serwera](./media/nps-extension-remote-desktop-gateway/image9.png)

4. <span data-ttu-id="005c0-244">W oknie dialogowym właściwości, wybierz **RD CAP** kartę magazynu.</span><span class="sxs-lookup"><span data-stu-id="005c0-244">In the Properties dialog box, select the **RD CAP** Store tab.</span></span>
5. <span data-ttu-id="005c0-245">Na karcie magazynu zasad RD CAP wybierz **centralnym serwerze NPS**.</span><span class="sxs-lookup"><span data-stu-id="005c0-245">On the RD CAP Store tab, select **Central Server running NPS**.</span></span> 
6. <span data-ttu-id="005c0-246">W **wprowadź nazwę lub adres IP serwer NPS** wpisz adres IP lub serwera nazwę serwera, w którym zainstalowano rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-246">In the **Enter a name or IP address for the server running NPS** field, type the IP address or server name of the server where you installed the NPS extension.</span></span>

  ![Wprowadź nazwę lub adres IP](./media/nps-extension-remote-desktop-gateway/image10.png)
  
7. <span data-ttu-id="005c0-248">Kliknij pozycję **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="005c0-248">Click **Add**.</span></span>
8. <span data-ttu-id="005c0-249">W **wspólny klucz tajny** okno dialogowe, wpisz wspólny klucz tajny, a następnie kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="005c0-249">In the **Shared Secret** dialog box, enter a shared secret, and then click **OK**.</span></span> <span data-ttu-id="005c0-250">Upewnij się, Zapisz ten wspólny klucz tajny i bezpieczne przechowywanie rekordu.</span><span class="sxs-lookup"><span data-stu-id="005c0-250">Ensure you record this shared secret and store the record securely.</span></span>

 >[!NOTE]
 ><span data-ttu-id="005c0-251">Wspólny klucz tajny jest używany do ustanawiania relacji zaufania między serwerami usługi RADIUS i klientami.</span><span class="sxs-lookup"><span data-stu-id="005c0-251">Shared secret is used to establish trust between the RADIUS servers and clients.</span></span> <span data-ttu-id="005c0-252">Utwórz hasło długich i złożonych.</span><span class="sxs-lookup"><span data-stu-id="005c0-252">Create a long and complex password.</span></span>
 >

 ![Wspólny klucz tajny](./media/nps-extension-remote-desktop-gateway/image11.png)

9. <span data-ttu-id="005c0-254">Kliknij przycisk **OK**, aby zamknąć okno dialogowe.</span><span class="sxs-lookup"><span data-stu-id="005c0-254">Click **OK** to close the dialog box.</span></span>

### <a name="configure-radius-timeout-value-on-remote-desktop-gateway-nps"></a><span data-ttu-id="005c0-255">Skonfiguruj wartość limitu czasu usługi RADIUS na zdalnego pulpitu bramy serwera zasad Sieciowych</span><span class="sxs-lookup"><span data-stu-id="005c0-255">Configure RADIUS timeout value on Remote Desktop Gateway NPS</span></span>
<span data-ttu-id="005c0-256">Aby upewnić się, że czasu w celu zweryfikowania poświadczeń użytkowników, przeprowadzenia weryfikacji dwuetapowej, odbierania odpowiedzi i odpowiadać na komunikaty usługi RADIUS, należy dostosować wartość limitu czasu usługi RADIUS.</span><span class="sxs-lookup"><span data-stu-id="005c0-256">To ensure there is time to validate users’ credentials, perform two-step verification, receive responses, and respond to RADIUS messages, it is necessary to adjust the RADIUS timeout value.</span></span>

1. <span data-ttu-id="005c0-257">Na serwerze bramy usług pulpitu zdalnego w Menedżerze serwera kliknij **narzędzia**, a następnie kliknij przycisk **serwera zasad sieciowych**.</span><span class="sxs-lookup"><span data-stu-id="005c0-257">On the RD Gateway server, in Server Manager, click **Tools**, and then click **Network Policy Server**.</span></span> 
2. <span data-ttu-id="005c0-258">W **serwer NPS (lokalny)** rozwiń **klientów usługi RADIUS i serwerach**i wybierz **serwera RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="005c0-258">In the **NPS (Local)** console, expand **RADIUS Clients and Servers**, and select **Remote RADIUS Server**.</span></span>

 ![Serwer zdalny RADIUS](./media/nps-extension-remote-desktop-gateway/image12.png)

3. <span data-ttu-id="005c0-260">W okienku szczegółów kliknij dwukrotnie **grupy serwerów bramy usług terminalowych**.</span><span class="sxs-lookup"><span data-stu-id="005c0-260">In the details pane, double-click **TS GATEWAY SERVER GROUP**.</span></span>

 >[!NOTE]
 ><span data-ttu-id="005c0-261">Tej grupy serwerów usługi RADIUS został utworzony podczas konfigurowania centralnego serwera dla zasady serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-261">This RADIUS Server Group was created when you configured the central server for NPS policies.</span></span> <span data-ttu-id="005c0-262">Brama usług pulpitu zdalnego przesyła komunikaty RADIUS do serwera lub grupy serwerów, w przypadku więcej niż jednej grupy.</span><span class="sxs-lookup"><span data-stu-id="005c0-262">The RD Gateway forwards RADIUS messages to this server or group of servers, if more than one in the group.</span></span>
 >

4. <span data-ttu-id="005c0-263">W **właściwości grupy serwerów bramy usług terminalowych** oknie dialogowym Wybierz adres IP lub nazwę serwera zasad Sieciowych skonfigurowany do przechowywania informacji o możliwościach usług pulpitu zdalnego, a następnie kliknij przycisk **Edytuj**.</span><span class="sxs-lookup"><span data-stu-id="005c0-263">In the **TS GATEWAY SERVER GROUP Properties** dialog box, select the IP address or name of the NPS server you configured to store RD CAPs, and then click **Edit**.</span></span> 

 ![Grupy serwerów bramy usług terminalowych](./media/nps-extension-remote-desktop-gateway/image13.png)

5. <span data-ttu-id="005c0-265">W **edytowanie serwera RADIUS** okno dialogowe, wybierz opcję **równoważenia obciążenia** kartę.</span><span class="sxs-lookup"><span data-stu-id="005c0-265">In the **Edit RADIUS Server** dialog box, select the **Load Balancing** tab.</span></span>
6. <span data-ttu-id="005c0-266">W **równoważenia obciążenia** karcie **liczba sekund bez odpowiedzi, zanim żądanie zostanie uznane za** pola, zmień wartość domyślną od 3 do wartość z zakresu od 30 do 60 sekund.</span><span class="sxs-lookup"><span data-stu-id="005c0-266">In the **Load Balancing** tab, in the **Number of seconds without response before request is considered dropped** field, change the default value from 3 to a value between 30 and 60 seconds.</span></span>
7. <span data-ttu-id="005c0-267">W **liczba sekund między żądaniami, gdy serwer jest identyfikowany jako niedostępny** pól, zmienić domyślną wartość wynoszącą 30 sekund na wartość jest równa lub większa niż wartość określona w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="005c0-267">In the **Number of seconds between requests when server is identified as unavailable** field, change the default value of 30 seconds to a value that is equal to or greater than the value you specified in the previous step.</span></span>

 ![Edytowanie serwera Radius](./media/nps-extension-remote-desktop-gateway/image14.png)

8.  <span data-ttu-id="005c0-269">Kliknij dwa razy przycisk OK, aby zamknąć okno dialogowe.</span><span class="sxs-lookup"><span data-stu-id="005c0-269">Click OK two times to close the dialog boxes.</span></span>

### <a name="verify-connection-request-policies"></a><span data-ttu-id="005c0-270">Sprawdź zasady żądań połączeń</span><span class="sxs-lookup"><span data-stu-id="005c0-270">Verify Connection Request Policies</span></span> 
<span data-ttu-id="005c0-271">Domyślnie podczas konfigurowania bramy usług pulpitu zdalnego do użycia sklep centralne zasady dla zasady autoryzacji połączeń, bramy usług pulpitu zdalnego jest skonfigurowany do przekazywania żądań centralnych zasad dostępu do serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-271">By default, when you configure the RD Gateway to use a central policy store for connection authorization policies, the RD Gateway is configured to forward CAP requests to the NPS server.</span></span> <span data-ttu-id="005c0-272">Serwer zasad Sieciowych z rozszerzenia usługi Azure MFA, zainstalowane, przetwarza żądanie dostępu usługi RADIUS.</span><span class="sxs-lookup"><span data-stu-id="005c0-272">The NPS server with the Azure MFA extension installed, processes the RADIUS access request.</span></span> <span data-ttu-id="005c0-273">Poniższe kroki pokazują, jak sprawdzić domyślnej zasady żądań połączeń.</span><span class="sxs-lookup"><span data-stu-id="005c0-273">The following steps show you how to verify the default connection request policy.</span></span> 

1. <span data-ttu-id="005c0-274">W bramie usług pulpitu zdalnego, w konsoli serwera NPS (lokalny), rozwiń węzeł **zasady**i wybierz **zasady żądań połączeń**.</span><span class="sxs-lookup"><span data-stu-id="005c0-274">On the RD Gateway, in the NPS (Local) console, expand **Policies**, and select **Connection Request Policies**.</span></span>
2. <span data-ttu-id="005c0-275">Kliknij prawym przyciskiem myszy **Połącz zasady żądań**, a następnie kliknij dwukrotnie **zasady autoryzacji bramy serwera terminali**.</span><span class="sxs-lookup"><span data-stu-id="005c0-275">Right-click **Connect Request Policies**, and double-click **TS GATEWAY AUTHORIZATION POLICY**.</span></span>
3. <span data-ttu-id="005c0-276">W **właściwości zasad autoryzacji bramy serwera terminali** okno dialogowe, kliknij przycisk **ustawienia** kartę.</span><span class="sxs-lookup"><span data-stu-id="005c0-276">In the **TS GATEWAY AUTHORIZATION POLICY properties** dialog box, click the **Settings** tab.</span></span>
4. <span data-ttu-id="005c0-277">Na **ustawienia** kliknij kartę, w obszarze przesyłanie dalej żądania połączenia **uwierzytelniania**.</span><span class="sxs-lookup"><span data-stu-id="005c0-277">On **Settings** tab, under Forwarding Connection Request, click **Authentication**.</span></span> <span data-ttu-id="005c0-278">Klienta RADIUS jest skonfigurowany do przesyłania żądań uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="005c0-278">RADIUS client is configured to forward requests for authentication.</span></span>

 ![Ustawienia uwierzytelniania](./media/nps-extension-remote-desktop-gateway/image15.png)
 
5. <span data-ttu-id="005c0-280">Kliknij przycisk **anulować**.</span><span class="sxs-lookup"><span data-stu-id="005c0-280">Click **Cancel**.</span></span> 

## <a name="configure-nps-on-the-server-where-the-nps-extension-is-installed"></a><span data-ttu-id="005c0-281">Konfigurowanie serwera NPS na serwerze, na którym zainstalowano rozszerzenia serwera NPS</span><span class="sxs-lookup"><span data-stu-id="005c0-281">Configure NPS on the server where the NPS extension is installed</span></span>
<span data-ttu-id="005c0-282">Serwer NPS, w którym zainstalowano rozszerzenia serwera zasad Sieciowych musi mieć możliwość wymiany wiadomości usługi RADIUS na serwerze NPS w bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-282">The NPS server where the NPS extension is installed needs to be able to exchange RADIUS messages with the NPS server on the Remote Desktop Gateway.</span></span> <span data-ttu-id="005c0-283">Aby włączyć to wiadomości z programem exchange, musisz skonfigurować składniki serwera NPS na serwerze, na którym jest zainstalowana usługa rozszerzenia serwera NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-283">To enable this message exchange, you need to configure the NPS components on the server where the NPS extension service is installed.</span></span> 

### <a name="register-server-in-active-directory"></a><span data-ttu-id="005c0-284">Zarejestruj serwer w usłudze Active Directory</span><span class="sxs-lookup"><span data-stu-id="005c0-284">Register Server in Active Directory</span></span>
<span data-ttu-id="005c0-285">Działał prawidłowo, w tym scenariuszu, serwer zasad Sieciowych musi być zarejestrowane w usłudze Active Directory.</span><span class="sxs-lookup"><span data-stu-id="005c0-285">To function properly in this scenario, the NPS server needs to be registered in Active Directory.</span></span>

1. <span data-ttu-id="005c0-286">Otwórz **Menedżera serwera**.</span><span class="sxs-lookup"><span data-stu-id="005c0-286">Open **Server Manager**.</span></span>
2. <span data-ttu-id="005c0-287">W Menedżerze serwera kliknij **narzędzia**, a następnie kliknij przycisk **serwera zasad sieciowych**.</span><span class="sxs-lookup"><span data-stu-id="005c0-287">In Server Manager, click **Tools**, and then click **Network Policy Server**.</span></span> 
3. <span data-ttu-id="005c0-288">W konsoli serwera zasad sieciowych, kliknij prawym przyciskiem myszy **serwer NPS (lokalny)**, a następnie kliknij przycisk **Zarejestruj serwer w usłudze Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="005c0-288">In the Network Policy Server console, right-click **NPS (Local)**, and then click **Register server in Active Directory**.</span></span> 
4. <span data-ttu-id="005c0-289">Kliknij przycisk **OK** dwa razy.</span><span class="sxs-lookup"><span data-stu-id="005c0-289">Click **OK** two times.</span></span>

 ![Zarejestruj serwer w usłudze AD](./media/nps-extension-remote-desktop-gateway/image16.png)

5. <span data-ttu-id="005c0-291">Pozostaw otwarte do następnej procedury konsoli.</span><span class="sxs-lookup"><span data-stu-id="005c0-291">Leave the console open for the next procedure.</span></span>

### <a name="create-and-configure-radius-client"></a><span data-ttu-id="005c0-292">Tworzenie i konfigurowanie klienta RADIUS</span><span class="sxs-lookup"><span data-stu-id="005c0-292">Create and configure RADIUS client</span></span> 
<span data-ttu-id="005c0-293">Bramy usług pulpitu zdalnego musi być skonfigurowany jako klient usługi RADIUS na serwerze zasad Sieciowych.</span><span class="sxs-lookup"><span data-stu-id="005c0-293">The Remote Desktop Gateway needs to be configured as a RADIUS client to the NPS server.</span></span> 

1. <span data-ttu-id="005c0-294">Na serwerze NPS, w którym zainstalowane jest rozszerzenie serwera NPS, w **serwer NPS (lokalny)** konsoli, kliknij prawym przyciskiem myszy **klientów RADIUS** i kliknij przycisk **nowy**.</span><span class="sxs-lookup"><span data-stu-id="005c0-294">On the NPS server where the NPS extension is installed, in the **NPS (Local)** console, right-click **RADIUS Clients** and click **New**.</span></span>

 ![Nowi klienci usługi RADIUS](./media/nps-extension-remote-desktop-gateway/image17.png)

2. <span data-ttu-id="005c0-296">W **klienta RADIUS nowe** okna dialogowego wprowadź przyjazną nazwę, taką jak _bramy_i adres IP lub nazwa DNS serwera bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-296">In the **New RADIUS client** dialog box, provide a friendly name, such as _Gateway_, and the IP address or DNS name of the Remote Desktop Gateway server.</span></span> 
3. <span data-ttu-id="005c0-297">W **wspólne hasło** i **Potwierdź wspólny klucz tajny** wprowadź to samo hasło, używanego wcześniej.</span><span class="sxs-lookup"><span data-stu-id="005c0-297">In the **Shared secret** and the **Confirm shared secret** fields, enter the same secret that you used before.</span></span>

 ![Nazwy i adresu](./media/nps-extension-remote-desktop-gateway/image18.png)

4. <span data-ttu-id="005c0-299">Kliknij przycisk **OK** aby zamknąć okno dialogowe RADIUS nowego klienta.</span><span class="sxs-lookup"><span data-stu-id="005c0-299">Click **OK** to close the New RADIUS client dialog box.</span></span>

### <a name="configure-network-policy"></a><span data-ttu-id="005c0-300">Konfigurowanie zasad sieciowych</span><span class="sxs-lookup"><span data-stu-id="005c0-300">Configure Network Policy</span></span>
<span data-ttu-id="005c0-301">Wycofanie serwera NPS z rozszerzeniem usługi Azure MFA jest magazynu wyznaczonego centralne zasady dla zasady autoryzacji połączeń (CAP).</span><span class="sxs-lookup"><span data-stu-id="005c0-301">Recall the NPS server with the Azure MFA extension is the designated central policy store for the Connection Authorization Policy (CAP).</span></span> <span data-ttu-id="005c0-302">W związku z tym musisz wdrożyć na serwerze NPS można autoryzować żądania połączeń prawidłowe ograniczenie.</span><span class="sxs-lookup"><span data-stu-id="005c0-302">Therefore, you need to implement a CAP on the NPS server to authorize valid connections requests.</span></span>  

1. <span data-ttu-id="005c0-303">W konsoli serwera NPS (lokalny), rozwiń węzeł **zasady**i kliknij przycisk **zasady sieciowe**.</span><span class="sxs-lookup"><span data-stu-id="005c0-303">In the NPS (Local) console, expand **Policies**, and click **Network Policies**.</span></span>
2. <span data-ttu-id="005c0-304">Kliknij prawym przyciskiem myszy **połączenia z innymi serwerami dostępu**i kliknij przycisk **zduplikowane zasad**.</span><span class="sxs-lookup"><span data-stu-id="005c0-304">Right-click **Connections to other access servers**, and click **Duplicate policy**.</span></span> 

 ![Zduplikowana zasad](./media/nps-extension-remote-desktop-gateway/image19.png)

3. <span data-ttu-id="005c0-306">Kliknij prawym przyciskiem myszy **kopiowania połączenia z innymi serwerami dostępu**i kliknij przycisk **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="005c0-306">Right-click **Copy of Connections to other access servers**, and click **Properties**.</span></span>

 ![Właściwości sieci](./media/nps-extension-remote-desktop-gateway/image20.png)

4. <span data-ttu-id="005c0-308">W **kopiowania połączenia z innymi serwerami dostępu** okno dialogowe, w polu Nazwa zasady wprowadź odpowiednią nazwę, taką jak **RDG_CAP**.</span><span class="sxs-lookup"><span data-stu-id="005c0-308">In the **Copy of Connections to other access servers** dialog box, in Policy Name, enter a suitable name, such as **RDG_CAP**.</span></span> <span data-ttu-id="005c0-309">Sprawdź **zasady włączone**i wybierz **udzielić dostępu**.</span><span class="sxs-lookup"><span data-stu-id="005c0-309">Check **Policy Enabled**, and select **Grant access**.</span></span> <span data-ttu-id="005c0-310">Opcjonalnie w polu Typ dostępu do sieci, wybierz **bramy usług pulpitu zdalnego**, można także pozostawić go jako **nieokreślony**.</span><span class="sxs-lookup"><span data-stu-id="005c0-310">Optionally, in Type of network access, select **Remote Desktop Gateway**, or you can leave it as **Unspecified**.</span></span>

 ![Kopiowanie połączeń](./media/nps-extension-remote-desktop-gateway/image21.png)

5.  <span data-ttu-id="005c0-312">Kliknij przycisk **ograniczenia** i sprawdź **Zezwalaj klientom na łączenie się bez negocjowania metodę uwierzytelniania**.</span><span class="sxs-lookup"><span data-stu-id="005c0-312">Click the **Constraints** tab, and check **Allow clients to connect without negotiating an authentication method**.</span></span>

 ![Zezwalaj klientom na łączenie się](./media/nps-extension-remote-desktop-gateway/image22.png)

6. <span data-ttu-id="005c0-314">Opcjonalnie kliknij **warunki** karta i Dodaj warunki, które muszą zostać spełnione dla połączenia autoryzacji, na przykład członkostwa w określonej grupie systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="005c0-314">Optionally, click the **Conditions** tab and add conditions that must be met for the connection to be authorized, for example, membership in a specific Windows group.</span></span>

 ![Warunki](./media/nps-extension-remote-desktop-gateway/image23.png)

7. <span data-ttu-id="005c0-316">Kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="005c0-316">Click **OK**.</span></span> <span data-ttu-id="005c0-317">Po wyświetleniu monitu, aby wyświetlić odpowiedni temat pomocy, kliknij przycisk **nr**.</span><span class="sxs-lookup"><span data-stu-id="005c0-317">When prompted to view the corresponding Help topic, click **No**.</span></span>
8. <span data-ttu-id="005c0-318">Upewnij się, że nowych zasad jest na początku listy, że jest włączona, i że przyznaje ona dostęp.</span><span class="sxs-lookup"><span data-stu-id="005c0-318">Ensure that your new policy is at the top of the list, that the policy is enabled, and that it grants access.</span></span>

 ![Zasady sieciowe](./media/nps-extension-remote-desktop-gateway/image24.png)

## <a name="verify-configuration"></a><span data-ttu-id="005c0-320">Weryfikowanie konfiguracji</span><span class="sxs-lookup"><span data-stu-id="005c0-320">Verify configuration</span></span>
<span data-ttu-id="005c0-321">Aby sprawdzić konfigurację, należy zalogować się za pomocą odpowiedniego klienta RDP bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-321">To verify the configuration, you need to log on the Remote Desktop Gateway with a suitable RDP client.</span></span> <span data-ttu-id="005c0-322">Należy używać konta, które jest dozwolona przez użytkownika zasady autoryzacji połączeń i jest włączone dla usługi Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="005c0-322">Be sure to use an account that is allowed by your Connection Authorization Policies and is enabled for Azure MFA.</span></span> 

<span data-ttu-id="005c0-323">Pokaż na poniższej ilustracji, można użyć **Remote Web Access pulpitu** strony.</span><span class="sxs-lookup"><span data-stu-id="005c0-323">As show in the image below, you can use the **Remote Desktop Web Access** page.</span></span>

![Dostęp w sieci Web do usług pulpitu zdalnego](./media/nps-extension-remote-desktop-gateway/image25.png)

<span data-ttu-id="005c0-325">Po pomyślnym wprowadzania poświadczeń dla uwierzytelniania podstawowego, okno dialogowe połączenie pulpitu zdalnego, wskazuje stan inicjowania połączenia zdalnego, jak pokazano poniżej.</span><span class="sxs-lookup"><span data-stu-id="005c0-325">Upon successfully entering your credentials for primary authentication, the Remote Desktop Connect dialog box shows a status of Initiating remote connection, as shown below.</span></span> 

<span data-ttu-id="005c0-326">W przypadku pomyślnego uwierzytelnienia za pomocą metody uwierzytelniania dodatkowego wcześniej skonfigurowane w usłudze Azure MFA, są połączone z zasobem.</span><span class="sxs-lookup"><span data-stu-id="005c0-326">If you successfully authenticate with the secondary authentication method you previously configured in Azure MFA, you are connected to the resource.</span></span> <span data-ttu-id="005c0-327">Jednak dodatkowego uwierzytelniania zakończy się niepowodzeniem, są odmowa dostępu do zasobu.</span><span class="sxs-lookup"><span data-stu-id="005c0-327">However, if the secondary authentication is not successful, you are denied access to resource.</span></span> 

![Inicjowanie połączenia zdalnego](./media/nps-extension-remote-desktop-gateway/image26.png)

<span data-ttu-id="005c0-329">W poniższym przykładzie aplikacji uwierzytelniania w systemie Windows phone służy do zapewnienia dodatkowego uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="005c0-329">In the example below, the Authenticator app on a Windows phone is used to provide the secondary authentication.</span></span>

![Konta](./media/nps-extension-remote-desktop-gateway/image27.png)

<span data-ttu-id="005c0-331">Po zostały pomyślnie uwierzytelniony przy użyciu metody uwierzytelniania dodatkowego, użytkownik jest zalogowany do bramy usług pulpitu zdalnego, jak zwykle.</span><span class="sxs-lookup"><span data-stu-id="005c0-331">Once you have successfully authenticated using the secondary authentication method, you are logged into the Remote Desktop Gateway as normal.</span></span> <span data-ttu-id="005c0-332">Jednak ponieważ są wymagane do użycia dodatkowej metody uwierzytelniania przy użyciu aplikacji mobilnej na zaufanym urządzeniu, procesu logowania jest bezpieczniejsza niż jest to.</span><span class="sxs-lookup"><span data-stu-id="005c0-332">However, because you are required to use a secondary authentication method using a mobile app on a trusted device, the log-in process is more secure than it would be otherwise.</span></span>

### <a name="view-event-viewer-logs-for-successful-logon-events"></a><span data-ttu-id="005c0-333">Sprawdź dzienniki Podglądu zdarzeń dla zdarzeń pomyślnego logowania</span><span class="sxs-lookup"><span data-stu-id="005c0-333">View Event Viewer logs for successful logon events</span></span>
<span data-ttu-id="005c0-334">Aby wyświetlić zdarzeń pomyślnego logowania w dziennikach podglądu zdarzeń systemu Windows, można wydać następujące polecenie środowiska Windows PowerShell do badania dzienników usług terminalowych systemu Windows i zabezpieczeń w systemie Windows.</span><span class="sxs-lookup"><span data-stu-id="005c0-334">To view the successful sign-in events in the Windows Event Viewer logs, you can issue the following Windows PowerShell command to query the Windows Terminal Services and Windows Security logs.</span></span>

<span data-ttu-id="005c0-335">Kwerenda zdarzeń pomyślnego logowania w operacyjne dzienniki bramy _(Viewer\Applications zdarzeń i usług Logs\Microsoft\Windows\TerminalServices-Gateway\Operational_, użyj następujących poleceń:</span><span class="sxs-lookup"><span data-stu-id="005c0-335">To query successful sign-in events in the Gateway operational logs _(Event Viewer\Applications and Services Logs\Microsoft\Windows\TerminalServices-Gateway\Operational_, use the following commands:</span></span>

* <span data-ttu-id="005c0-336">_Get-WinEvent - Nazwa_dziennika Microsoft-Windows-TerminalServices — bramy/operacyjnej_ | gdzie {$_.ID - eq "300"} | FL</span><span class="sxs-lookup"><span data-stu-id="005c0-336">_Get-WinEvent -Logname Microsoft-Windows-TerminalServices-Gateway/Operational_ | where {$_.ID -eq '300'} | FL</span></span> 
* <span data-ttu-id="005c0-337">To polecenie wyświetla zdarzeń systemu Windows, w których wyświetlane są spełnione wymagania zasad autoryzacji zasobów (RD RAP) i przyznano dostęp użytkownika.</span><span class="sxs-lookup"><span data-stu-id="005c0-337">This command displays Windows events that show the user met resource authorization policy requirements (RD RAP) and was granted access.</span></span>

![Wyświetl podgląd zdarzeń](./media/nps-extension-remote-desktop-gateway/image28.png)

* <span data-ttu-id="005c0-339">_Get-WinEvent - Nazwa_dziennika Microsoft-Windows-TerminalServices — bramy/operacyjnej_ | gdzie {$_.ID - eq "200"} | FL</span><span class="sxs-lookup"><span data-stu-id="005c0-339">_Get-WinEvent -Logname Microsoft-Windows-TerminalServices-Gateway/Operational_ | where {$_.ID -eq '200'} | FL</span></span>
* <span data-ttu-id="005c0-340">To polecenie wyświetla zdarzenia, których wyświetlane, gdy użytkownik spełnione wymagania zasad autoryzacji połączeń.</span><span class="sxs-lookup"><span data-stu-id="005c0-340">This command displays the events that show when user met connection authorization policy requirements.</span></span>

![Autoryzacja połączeń](./media/nps-extension-remote-desktop-gateway/image29.png)

<span data-ttu-id="005c0-342">Można również wyświetlić ten dziennik i filtr na identyfikatorów, 300 i 200 zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="005c0-342">You can also view this log and filter on event IDs, 300 and 200.</span></span> <span data-ttu-id="005c0-343">Aby sprawdzić zdarzeń pomyślnego logowania w dziennikach podglądu zdarzeń zabezpieczeń, użyj następującego polecenia:</span><span class="sxs-lookup"><span data-stu-id="005c0-343">To query successful logon events in the Security event viewer logs, use the following command:</span></span>

* <span data-ttu-id="005c0-344">_Get-WinEvent - Nazwa_dziennika zabezpieczeń_ | gdzie {$_.ID - eq "6272"} | FL</span><span class="sxs-lookup"><span data-stu-id="005c0-344">_Get-WinEvent -Logname Security_ | where {$_.ID -eq '6272'} | FL</span></span> 
* <span data-ttu-id="005c0-345">To polecenie można uruchomić na centralnej serwera NPS lub serwer bramy usług pulpitu zdalnego.</span><span class="sxs-lookup"><span data-stu-id="005c0-345">This command can be run on either the central NPS or the RD Gateway Server.</span></span> 

![Zdarzeń pomyślnego logowania](./media/nps-extension-remote-desktop-gateway/image30.png)

<span data-ttu-id="005c0-347">Możesz również wyświetlić dziennik zabezpieczeń lub widok niestandardowy usług zasad sieciowych i dostępu w sposób przedstawiony poniżej:</span><span class="sxs-lookup"><span data-stu-id="005c0-347">You can also view the Security log or the Network Policy and Access Services custom view, as shown below:</span></span>

![Usługi zasad sieciowych i dostępu](./media/nps-extension-remote-desktop-gateway/image31.png)

<span data-ttu-id="005c0-349">Na serwerze, na którym zainstalowano rozszerzenia serwera zasad Sieciowych dla usługi Azure MFA, można znaleźć dzienniki Podglądu zdarzeń aplikacji specyficzne dla rozszerzenia w _aplikacji i usług Logs\Microsoft\AzureMfa_.</span><span class="sxs-lookup"><span data-stu-id="005c0-349">On the server where you installed the NPS extension for Azure MFA, you can find Event Viewer application logs specific to the extension at _Application and Services Logs\Microsoft\AzureMfa_.</span></span> 

![Dzienniki aplikacji Podgląd zdarzeń](./media/nps-extension-remote-desktop-gateway/image32.png)

## <a name="troubleshoot-guide"></a><span data-ttu-id="005c0-351">Rozwiązywanie problemów z przewodnika</span><span class="sxs-lookup"><span data-stu-id="005c0-351">Troubleshoot Guide</span></span>

<span data-ttu-id="005c0-352">Jeśli konfiguracja nie działa zgodnie z oczekiwaniami, zacząć rozwiązywać jest Sprawdź, czy użytkownik jest skonfigurowany do używania usługi Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="005c0-352">If the configuration is not working as expected, the first place to start to troubleshoot is to verify that the user is configured to use Azure MFA.</span></span> <span data-ttu-id="005c0-353">Użytkownik powinien połączyć się z [portalu Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="005c0-353">Have the user connect to the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="005c0-354">Jeśli użytkownicy są monitowani o podanie dodatkowej weryfikacji i można pomyślnie uwierzytelnić, można wyeliminować niepoprawnej konfiguracji usługi Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="005c0-354">If users are prompted for secondary verification and can successfully authenticate, you can eliminate an incorrect configuration of Azure MFA.</span></span>

<span data-ttu-id="005c0-355">Jeśli usługi Azure MFA działa dla użytkowników, należy przejrzeć odpowiednich dzienników zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="005c0-355">If Azure MFA is working for the user(s), you should review the relevant Event logs.</span></span> <span data-ttu-id="005c0-356">Obejmują one zdarzeń zabezpieczeń, operacyjne bramy i dzienniki usługi Azure MFA, które opisano w poprzedniej sekcji.</span><span class="sxs-lookup"><span data-stu-id="005c0-356">These include the Security Event, Gateway operational, and Azure MFA logs that are discussed in the previous section.</span></span> 

<span data-ttu-id="005c0-357">Poniżej przedstawiono przykładowe dane wyjściowe dziennika zabezpieczeń przedstawiający zdarzenia logowania nie powiodło się (6273 identyfikator zdarzenia).</span><span class="sxs-lookup"><span data-stu-id="005c0-357">Below is an example output of Security log showing a failed logon event (Event ID 6273).</span></span>

![Zdarzenia logowania nie powiodło się](./media/nps-extension-remote-desktop-gateway/image33.png)

<span data-ttu-id="005c0-359">Poniżej znajdują się zdarzenia związane z dzienników AzureMFA:</span><span class="sxs-lookup"><span data-stu-id="005c0-359">Below is a related event from the AzureMFA logs:</span></span>

![Dzienników usługi Azure MFA](./media/nps-extension-remote-desktop-gateway/image34.png)

<span data-ttu-id="005c0-361">Aby wykonywać zaawansowane rozwiązywanie problemów z opcjami, sprawdź pliki dziennika format bazy danych serwera NPS zainstalowaną usługę NPS.</span><span class="sxs-lookup"><span data-stu-id="005c0-361">To perform advanced troubleshoot options, consult the NPS database format log files where the NPS service is installed.</span></span> <span data-ttu-id="005c0-362">Te pliki dziennika są tworzone w _%SystemRoot%\System32\Logs_ folderu plików tekstowych rozdzielanych przecinkami.</span><span class="sxs-lookup"><span data-stu-id="005c0-362">These log files are created in _%SystemRoot%\System32\Logs_ folder as comma-delimited text files.</span></span> 

<span data-ttu-id="005c0-363">Aby uzyskać opis tych plików dziennika, zobacz [zinterpretować pliki dziennika Format bazy danych serwera NPS](https://technet.microsoft.com/library/cc771748.aspx).</span><span class="sxs-lookup"><span data-stu-id="005c0-363">For a description of these log files, see [Interpret NPS Database Format Log Files](https://technet.microsoft.com/library/cc771748.aspx).</span></span> <span data-ttu-id="005c0-364">Wpisy w tych plikach dziennika może być trudne zinterpretować, nie importując ich do bazy danych lub arkusz kalkulacyjny.</span><span class="sxs-lookup"><span data-stu-id="005c0-364">The entries in these log files can be difficult to interpret without importing them into a spreadsheet or a database.</span></span> <span data-ttu-id="005c0-365">Aby ułatwić interpretowanie pliki dziennika można znaleźć kilka online usługi IAS analizatory składni..</span><span class="sxs-lookup"><span data-stu-id="005c0-365">You can find several IAS parsers online to assist you in interpreting the log files.</span></span> 

<span data-ttu-id="005c0-366">Na poniższym obrazie przedstawiono dane wyjściowe tego takie do pobrania [aplikacji oprogramowania typu shareware](http://www.deepsoftware.com/iasviewer).</span><span class="sxs-lookup"><span data-stu-id="005c0-366">The image below shows the output of one such downloadable [shareware application](http://www.deepsoftware.com/iasviewer).</span></span> 

![Aplikacja "shareware"](./media/nps-extension-remote-desktop-gateway/image35.png)

<span data-ttu-id="005c0-368">Na koniec, aby uzyskać dodatkowe Rozwiązywanie problemów z opcjami, możesz użyć analizatora protokołów, takich [programu Microsoft Message Analyzer](https://technet.microsoft.com/library/jj649776.aspx).</span><span class="sxs-lookup"><span data-stu-id="005c0-368">Finally, for additional troubleshoot options, you can use a protocol analyzer, such [Microsoft Message Analyzer](https://technet.microsoft.com/library/jj649776.aspx).</span></span> 

<span data-ttu-id="005c0-369">Obraz poniżej z programu Microsoft Message Analyzer przedstawia ruch sieciowy filtrowane wg protokołu RADIUS, który zawiera nazwę użytkownika **Contoso\AliceC**.</span><span class="sxs-lookup"><span data-stu-id="005c0-369">The image below from Microsoft Message Analyzer shows network traffic filtered on RADIUS protocol that contains the user name **Contoso\AliceC**.</span></span>

![Microsoft Message Analyzer](./media/nps-extension-remote-desktop-gateway/image36.png)

## <a name="next-steps"></a><span data-ttu-id="005c0-371">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="005c0-371">Next steps</span></span>
[<span data-ttu-id="005c0-372">Jak uzyskać usługę Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="005c0-372">How to get Azure Multi-Factor Authentication</span></span>](multi-factor-authentication-versions-plans.md)

[<span data-ttu-id="005c0-373">Brama usług pulpitu zdalnego i serwer Azure Multi-Factor Authentication korzystające z usługi RADIUS</span><span class="sxs-lookup"><span data-stu-id="005c0-373">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>](multi-factor-authentication-get-started-server-rdg.md)

[<span data-ttu-id="005c0-374">Integrowanie katalogów lokalnych z usługą Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="005c0-374">Integrate your on-premises directories with Azure Active Directory</span></span>](../active-directory/connect/active-directory-aadconnect.md)
