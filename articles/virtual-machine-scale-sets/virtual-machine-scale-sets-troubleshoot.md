---
title: "Rozwiązywanie problemów z automatycznie skalowana za pomocą zestawów skali maszyny wirtualnej | Dokumentacja firmy Microsoft"
description: "Rozwiązywanie problemów z automatycznie skalowana za pomocą zestawów skali maszyny wirtualnej. Zrozumieć typowych problemów i ich rozwiązania."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: bd45a0fb99a77851aa7b91d23bd4b830b6f5cc7b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="52ffb-104">Rozwiązywanie problemów z automatycznie skalowana za pomocą zestawów skali maszyny wirtualnej</span><span class="sxs-lookup"><span data-stu-id="52ffb-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="52ffb-105">**Problem** — po utworzeniu Skalowanie automatyczne infrastruktury w usłudze Azure Resource Manager przy użyciu zestawy skalowania maszyny Wirtualnej — na przykład, przez wdrożenie szablonu następująco: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss-bottle — funkcja automatycznego skalowania — masz zdefiniowanych reguł skalowania i działa ona ponosić, z tą różnicą, że niezależnie od tego, ile obciążenia umieszczone na maszynach wirtualnych, nie będzie skalowania automatycznego.</span><span class="sxs-lookup"><span data-stu-id="52ffb-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on the VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="52ffb-106">Kroki rozwiązywania problemów</span><span class="sxs-lookup"><span data-stu-id="52ffb-106">Troubleshooting steps</span></span>
<span data-ttu-id="52ffb-107">Kilka rzeczy, które należy uwzględnić obejmują:</span><span class="sxs-lookup"><span data-stu-id="52ffb-107">Some things to consider include:</span></span>

* <span data-ttu-id="52ffb-108">Liczby rdzeni każda maszyna wirtualna ma i czy ładowanie każdego rdzenia?</span><span class="sxs-lookup"><span data-stu-id="52ffb-108">How many cores does each VM have, and are you loading each core?</span></span>
  <span data-ttu-id="52ffb-109">Przykładowy szablon Szybki Start Azure powyżej ma do_work.php skrypt, który jest ładowany przez pojedynczy rdzeń.</span><span class="sxs-lookup"><span data-stu-id="52ffb-109">The example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="52ffb-110">Jeśli używane jest większy niż rozmiar maszyny Wirtualnej, takie jak Standard_A1 lub D1 pojedynczego rdzenia maszyny Wirtualnej, a następnie należy uruchamiać wielokrotnie obciążenie.</span><span class="sxs-lookup"><span data-stu-id="52ffb-110">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need to run this load multiple times.</span></span> <span data-ttu-id="52ffb-111">Sprawdź, ile rdzenie maszyn wirtualnych, przeglądając [rozmiary dla systemu Windows maszyny wirtualne na platformie Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="52ffb-111">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="52ffb-112">Jak wiele maszyn wirtualnych w zestawie skalowania maszyn wirtualnych, możesz operacji pracy na każdej z nich?</span><span class="sxs-lookup"><span data-stu-id="52ffb-112">How many VMs in the VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="52ffb-113">Staną się skalowania zdarzeń podczas umieszczania średnie wykorzystanie Procesora przez **wszystkich** w zestawie skalowania maszyn wirtualnych przekracza wartość progową, wraz z upływem czasu wewnętrznego zdefiniowanych w zasadach automatycznego skalowania.</span><span class="sxs-lookup"><span data-stu-id="52ffb-113">A scale out event will only take place when the average CPU across **all** the VMs in a scale set exceeds the threshold value, over the time internal defined in the autoscale rules.</span></span>
* <span data-ttu-id="52ffb-114">Czy zapomniano wszelkie zdarzenia skalowania?</span><span class="sxs-lookup"><span data-stu-id="52ffb-114">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="52ffb-115">Przejrzyj dzienniki inspekcji w portalu Azure zdarzeń skali.</span><span class="sxs-lookup"><span data-stu-id="52ffb-115">Check the audit logs in the Azure portal for scale events.</span></span> <span data-ttu-id="52ffb-116">Może być wystąpił skali górę i skalowania w dół, która została pominięta.</span><span class="sxs-lookup"><span data-stu-id="52ffb-116">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="52ffb-117">Można filtrować według "Skala"...</span><span class="sxs-lookup"><span data-stu-id="52ffb-117">You can filter by “Scale”..</span></span>
  
    ![Dzienniki inspekcji][audit]
* <span data-ttu-id="52ffb-119">Wartości progowe w skali i skalowalnego w poziomie są różni się wystarczająco?</span><span class="sxs-lookup"><span data-stu-id="52ffb-119">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="52ffb-120">Załóżmy, że możesz ustawić regułę do skalowania w poziomie, gdy średnie wykorzystanie Procesora jest większa niż 50% w ciągu 5 minut, a także do skalowania w przypadku średnie wykorzystanie Procesora na mniej niż 50%.</span><span class="sxs-lookup"><span data-stu-id="52ffb-120">Suppose you set a rule to scale out when average CPU is greater than 50% over 5 minutes, and to scale in when average CPU is less than 50%.</span></span> <span data-ttu-id="52ffb-121">To spowodowałoby problem "flapping", gdy użycie procesora CPU jest bliski tego progu, z akcji skalowania stale zwiększania i zmniejszania rozmiaru zestawu.</span><span class="sxs-lookup"><span data-stu-id="52ffb-121">This would cause a “flapping” problem when CPU usage is close to this threshold, with scale actions constantly increasing and decreasing the size of the set.</span></span> <span data-ttu-id="52ffb-122">W związku z tym usługi skalowania automatycznego próbuje zapobiec "niestabilny", który można manifestu jako skalowania nie.</span><span class="sxs-lookup"><span data-stu-id="52ffb-122">Because of this, the autoscale service tries to prevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="52ffb-123">W związku z tym upewnij się, że wartości progowe skalowalnego w poziomie i w skali różnią się wystarczająco Zezwalaj odstępem Between skalowania.</span><span class="sxs-lookup"><span data-stu-id="52ffb-123">Therefore make sure your scale-out and scale-in thresholds are sufficiently different to allow some space in between scaling.</span></span>
* <span data-ttu-id="52ffb-124">Czy pisania szablonu JSON?</span><span class="sxs-lookup"><span data-stu-id="52ffb-124">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="52ffb-125">Jest łatwy do popełnione, więc uruchomienie przy użyciu szablonu, takie jak jest tą, nad którym sprawdzone do pracy i małych zmiany przyrostowe.</span><span class="sxs-lookup"><span data-stu-id="52ffb-125">It is easy to make mistakes, so start with a template like the one above which is proven to work, and make small incremental changes.</span></span> 
* <span data-ttu-id="52ffb-126">Można ręcznie skalowanie przychodzący lub wychodzący?</span><span class="sxs-lookup"><span data-stu-id="52ffb-126">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="52ffb-127">Spróbuj ponownie wdrożyć zasobów zestawu skali maszyny Wirtualnej z ustawieniem różnych "pojemność", aby ręcznie zmienić liczbę maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="52ffb-127">Try redeploying the VM Scale Set resource with a different “capacity” setting to change the number of VMs manually.</span></span> <span data-ttu-id="52ffb-128">Przykład szablonu w tym celu jest tutaj: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing — może być konieczne edytowanie szablonu, aby upewnić się, jak zestawu skalowania używa ma ten sam rozmiar maszyny.</span><span class="sxs-lookup"><span data-stu-id="52ffb-128">An example template to do this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need to edit the template to make sure it has the same machine size as your Scale Set is using.</span></span> <span data-ttu-id="52ffb-129">Czy można pomyślnie ręcznie zmienić liczbę maszyn wirtualnych, następnie wiadomo, że problem dotyczy tylko skalowania automatycznego.</span><span class="sxs-lookup"><span data-stu-id="52ffb-129">If you can successfully change the number of VMs manually, then you know the problem is isolated to autoscale.</span></span>
* <span data-ttu-id="52ffb-130">Sprawdź Twojej Microsoft.Compute/virtualMachineScaleSet i zasoby dostępne w elemencie Microsoft.Insights [Eksploratora zasobów Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="52ffb-130">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in the [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="52ffb-131">Jest to niezbędne rozwiązywania problemów, które pokazuje stan zasobów usługi Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="52ffb-131">This is an indispensable troubleshooting tool which shows you the state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="52ffb-132">Kliknij subskrypcję i przyjrzyj się grupa zasobów jest rozwiązywany problem.</span><span class="sxs-lookup"><span data-stu-id="52ffb-132">Click on your subscription and look at the Resource Group you are troubleshooting.</span></span> <span data-ttu-id="52ffb-133">W obszarze dostawcy zasobów obliczeniowych przyjrzeć się zestawu skali maszyny Wirtualnej został utworzony i sprawdź widok wystąpienia, które prezentowany jest stan wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="52ffb-133">Under the Compute resource provider look at the VM Scale Set you created and check the Instance View, which shows you the state of a deployment.</span></span> <span data-ttu-id="52ffb-134">Sprawdź również widok wystąpienia maszyny wirtualnej w zestawie skalowania maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="52ffb-134">Also check the instance view of VMs in the VM Scale Set.</span></span> <span data-ttu-id="52ffb-135">Następnie przejdź w elemencie Microsoft.Insights dostawcy zasobów i sprawdź, czy wygląd reguł skalowania automatycznego.</span><span class="sxs-lookup"><span data-stu-id="52ffb-135">Then go into the Microsoft.Insights resource provider and check the autoscale rules look good.</span></span>
* <span data-ttu-id="52ffb-136">Jest diagnostycznych rozszerzenia pracy i wysyłających dane dotyczące wydajności?</span><span class="sxs-lookup"><span data-stu-id="52ffb-136">Is the Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="52ffb-137">**Aktualizacja:** Azure automatycznego skalowania zostało rozszerzone, aby użyć potoku metryki oparte na hoście, który nie wymaga już rozszerzenie diagnostyki do zainstalowania.</span><span class="sxs-lookup"><span data-stu-id="52ffb-137">**Update:** Azure autoscale has been enhanced to use a host based metrics pipeline which no longer requires a diagnostics extension to be installed.</span></span> <span data-ttu-id="52ffb-138">Oznacza to następnych kilku akapitów już stosowane w przypadku utworzenia aplikacji Skalowanie automatyczne przy użyciu nowego potoku.</span><span class="sxs-lookup"><span data-stu-id="52ffb-138">This means the next few paragraphs no longer apply if you create an autoscaling application using the new pipeline.</span></span> <span data-ttu-id="52ffb-139">Na przykład szablonów platformy Azure, które zostały przekonwertowane na Użyj procesu hosta: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="52ffb-139">An example of Azure templates which have been converted to use the host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="52ffb-140">Przy użyciu hosta na podstawie metryki skalowania automatycznego jest lepszym rozwiązaniem w następujących sytuacjach:</span><span class="sxs-lookup"><span data-stu-id="52ffb-140">Using host based metrics for autoscale is better for the following reasons:</span></span>
  
  * <span data-ttu-id="52ffb-141">Mniej części ruchome jako rozszerzenia nie diagnostyki muszą być zainstalowane.</span><span class="sxs-lookup"><span data-stu-id="52ffb-141">Fewer moving parts as no diagnostics extensions need to be installed.</span></span>
  * <span data-ttu-id="52ffb-142">Szablony prostsze.</span><span class="sxs-lookup"><span data-stu-id="52ffb-142">Simpler templates.</span></span> <span data-ttu-id="52ffb-143">Wystarczy dodać reguły automatycznego skalowania wgląd do istniejącego szablonu zestaw skali.</span><span class="sxs-lookup"><span data-stu-id="52ffb-143">Just add insights autoscale rules to an existing scale set template.</span></span>
  * <span data-ttu-id="52ffb-144">Bardziej niezawodne, raportowanie i szybsze uruchamianie nowych maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="52ffb-144">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="52ffb-145">Tylko przyczyn można nadal używać rozszerzenia diagnostycznych będzie konieczne będzie pamięci diagnostyki raportowania/skalowania.</span><span class="sxs-lookup"><span data-stu-id="52ffb-145">The only reasons you might want to keep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="52ffb-146">Host, na podstawie metryk nie raportują pamięci.</span><span class="sxs-lookup"><span data-stu-id="52ffb-146">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="52ffb-147">Z tym pamiętać tylko wykonaj dalszej części tego artykułu, nadal używasz rozszerzenia diagnostycznych dla Twojego Skalowanie automatyczne.</span><span class="sxs-lookup"><span data-stu-id="52ffb-147">With that in mind, only follow the rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="52ffb-148">Funkcja automatycznego skalowania usługi Azure Resource Manager można pracować (ale nie ma już do) za pomocą maszyny Wirtualnej o nazwie rozszerzenia rozszerzenia diagnostyki.</span><span class="sxs-lookup"><span data-stu-id="52ffb-148">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called the Diagnostics Extension.</span></span> <span data-ttu-id="52ffb-149">Emituje on dane wydajności do konta magazynu definiowane w szablonie.</span><span class="sxs-lookup"><span data-stu-id="52ffb-149">It emits performance data to a storage account you define in the template.</span></span> <span data-ttu-id="52ffb-150">Te dane są agregowane przez usługę Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="52ffb-150">This data is then aggregated by the Azure Monitor service.</span></span>
    
    <span data-ttu-id="52ffb-151">Jeśli usługa Insights nie może odczytać danych z maszyn wirtualnych, powinien wysłać wiadomość e-mail — na przykład jeśli maszyny wirtualne zostały w dół, więc poczty e-mail (po jednym określone podczas tworzenia konta platformy Azure).</span><span class="sxs-lookup"><span data-stu-id="52ffb-151">If the Insights service can’t read data from the VMs, it is supposed to send you an email – for example if the VMs were down, so check your email (the one you specified when creating the Azure account).</span></span>
    
    <span data-ttu-id="52ffb-152">Możesz również przejść i wyglądać na dane.</span><span class="sxs-lookup"><span data-stu-id="52ffb-152">You can also go and look at the data yourself.</span></span> <span data-ttu-id="52ffb-153">Spójrz na konto magazynu Azure, w Eksploratorze chmury.</span><span class="sxs-lookup"><span data-stu-id="52ffb-153">Look at the Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="52ffb-154">Na przykład za pomocą [programu Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), zaloguj się i pobranie używasz subskrypcji platformy Azure, a nazwa konta magazynu diagnostyki występujący w odwołaniu w definicji rozszerzenia diagnostyki w szablonie wdrożenia...</span><span class="sxs-lookup"><span data-stu-id="52ffb-154">For example using the [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick the Azure subscription you’re using, and the Diagnostics storage account name referenced in the Diagnostics extension definition in your deployment template..</span></span>
    
    ![Eksplorator chmury][explorer]
    
    <span data-ttu-id="52ffb-156">W tym miejscu zobaczysz grupy tabel, w którym jest przechowywane dane z każdej maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="52ffb-156">Here you will see a bunch of tables where the data from each VM is being stored.</span></span> <span data-ttu-id="52ffb-157">Biorąc systemu Linux i metrykę procesora CPU, na przykład Szukaj podczas ostatnich wierszy.</span><span class="sxs-lookup"><span data-stu-id="52ffb-157">Taking Linux and the CPU metric as an example, look at the most recent rows.</span></span> <span data-ttu-id="52ffb-158">Eksplorator chmury programu Visual Studio obsługuje język zapytań, więc można uruchomić zapytania, takie jak "datetime gt sygnatura czasowa" 2016-02-02T21:20:00Z "" Aby upewnić się, Pobierz najnowsze zdarzenia (przyjmowane jest czas jest w formacie UTC).</span><span class="sxs-lookup"><span data-stu-id="52ffb-158">The Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” to make sure you get the most recent events (assume time is in UTC).</span></span> <span data-ttu-id="52ffb-159">Czy dane, które widać w odpowiadają reguł skalowania skonfigurowaniu?</span><span class="sxs-lookup"><span data-stu-id="52ffb-159">Does the data you see in there correspond to the scale rules you set up?</span></span> <span data-ttu-id="52ffb-160">W poniższym przykładzie Procesora dla maszyny 20 uruchomiona zwiększenie 100% w ciągu ostatnich 5 minut.</span><span class="sxs-lookup"><span data-stu-id="52ffb-160">In the example below, the CPU for machine 20 started increasing to 100% over the last 5 minutes..</span></span>
    
    ![Magazyn tabel][tables]
    
    <span data-ttu-id="52ffb-162">Jeśli dane nie są dostępne, następnie zakłada się, że problem dotyczy diagnostycznych rozszerzenia uruchomionych w maszynach wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="52ffb-162">If the data is not there, then it implies the problem is with the diagnostic extension running in the VMs.</span></span> <span data-ttu-id="52ffb-163">Jeśli dane są dostępne, oznacza to, że znajduje się problemami z regułami skali lub w usłudze Insights.</span><span class="sxs-lookup"><span data-stu-id="52ffb-163">If the data is there, it implies there is either a problem with your scale rules, or with the Insights service.</span></span> <span data-ttu-id="52ffb-164">Sprawdź [Azure stan](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="52ffb-164">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="52ffb-165">Po już został tych kroków, jeśli nadal występują problemy z automatycznego skalowania można wypróbować forach na [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), lub [przepełnienie stosu](http://stackoverflow.com/questions/tagged/azure), lub pomocy technicznej.</span><span class="sxs-lookup"><span data-stu-id="52ffb-165">Once you’ve been through these steps, if you are still having autoscale problems you could try the forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="52ffb-166">Przygotuj się na udostępnianie szablonu i widok danych wydajności.</span><span class="sxs-lookup"><span data-stu-id="52ffb-166">Be prepared to share the template and a view of the performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
