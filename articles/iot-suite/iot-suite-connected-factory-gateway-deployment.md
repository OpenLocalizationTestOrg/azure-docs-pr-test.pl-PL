---
title: "aaaDeploy pakietu IoT Azure połączenia bramy fabryki | Dokumentacja firmy Microsoft"
description: "Sposób toodeploy bramę Windows lub Linux toohello łączności tooenable połączenia fabryki wstępnie skonfigurowane rozwiązanie."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="8f0b0-103">Wdrożyć bramę Windows lub Linux hello połączone fabryki wstępnie rozwiązania</span><span class="sxs-lookup"><span data-stu-id="8f0b0-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="8f0b0-104">Witaj oprogramowania wymagane toodeploy w bramie hello połączone fabryki wstępnie skonfigurowane rozwiązanie zawiera dwa składniki:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="8f0b0-105">Witaj *OPC Proxy* ustanawia tooIoT połączenia koncentratora.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="8f0b0-106">Witaj *OPC Proxy* następnie czeka na polecenia i kontroli wiadomości z hello zintegrowane OPC przeglądarki, która jest uruchamiana w portalu rozwiązania połączonych fabryki hello.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="8f0b0-107">Witaj *wydawcy OPC* łączy tooexisting lokalnymi OPC UA serwery i przekazuje komunikaty telemetrii od nich tooIoT koncentratora.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="8f0b0-108">Oba te składniki są open source i są dostępne jako źródło w serwisie GitHub i jak kontenery Docker:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="8f0b0-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="8f0b0-109">GitHub</span></span> | <span data-ttu-id="8f0b0-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="8f0b0-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="8f0b0-111">[Wydawca OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="8f0b0-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="8f0b0-112">[Wydawca OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="8f0b0-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="8f0b0-113">[Serwer Proxy OPC][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="8f0b0-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="8f0b0-114">[Serwer Proxy OPC][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="8f0b0-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="8f0b0-115">Nie publicznych adresów IP, lub luk w zaporze bramy hello są wymagane dla obu składnika.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="8f0b0-116">Hello OPC serwera Proxy i wydawcy OPC używają tylko ruchu wychodzącego porty 443, 5671 i 8883.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="8f0b0-117">Hello kroki opisane w tym artykule opisano sposób toodeploy a bramy przy użyciu rozwiązania Docker albo [Windows](#windows-deployment) lub [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="8f0b0-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="8f0b0-118">Brama Hello umożliwia łączność toohello połączone fabryki wstępnie skonfigurowane rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="8f0b0-119">oprogramowanie bramy Hello działającą w kontenerze Docker hello jest [Azure IoT krawędzi].</span><span class="sxs-lookup"><span data-stu-id="8f0b0-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="8f0b0-120">Wdrażanie systemu Windows</span><span class="sxs-lookup"><span data-stu-id="8f0b0-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="8f0b0-121">Jeśli nie masz jeszcze urządzenie bramy, firma Microsoft zaleca się, że kupić komercyjnych bramy w jednym z naszych partnerów.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="8f0b0-122">Odwiedź hello [katalogu urządzenia Azure IoT] lista bramy urządzeń zgodnych z hello połączone fabryki rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="8f0b0-123">Postępuj zgodnie z instrukcjami hello z tooset urządzenia hello zapasowej hello bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="8f0b0-124">Można również użyć hello następujące instrukcje toomanually ustawić jedną z istniejących bram.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="8f0b0-125">Zainstaluj Docker</span><span class="sxs-lookup"><span data-stu-id="8f0b0-125">Install Docker</span></span>

<span data-ttu-id="8f0b0-126">Zainstaluj [Docker dla systemu Windows] na urządzenie bramy z systemem Windows.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="8f0b0-127">Podczas instalacji systemu Windows Docker wybrać dysk na tooshare maszyny z hosta z Docker.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="8f0b0-128">następujące zrzut ekranu przedstawia udostępniania hello D dysku w systemie Windows Hello:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Zainstaluj Docker][img-install-docker]

<span data-ttu-id="8f0b0-130">Następnie utwórz folder o nazwie **docker** w katalogu głównym hello hello udostępnionego dysku.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="8f0b0-131">Ten krok można również wykonać po zainstalowaniu docker z hello **ustawienia** menu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="8f0b0-132">Konfigurowanie bramy hello</span><span class="sxs-lookup"><span data-stu-id="8f0b0-132">Configure hello gateway</span></span>

1. <span data-ttu-id="8f0b0-133">Należy hello **iothubowner** parametry połączenia pakietu IoT Azure połączone wdrożenia bramy hello toocomplete wdrożenie fabryki.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="8f0b0-134">W hello [portalu Azure], przejdź tooyour Centrum IoT w grupie zasobów hello utworzone podczas wdrażania rozwiązania fabryki hello połączony.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="8f0b0-135">Kliknij przycisk **zasady dostępu współużytkowanego** tooaccess hello **iothubowner** ciąg połączenia:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Znajdź hello parametry połączenia Centrum IoT][img-hub-connection]

    <span data-ttu-id="8f0b0-137">Kopiuj hello **parametry połączenia — klucz podstawowy** wartość.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="8f0b0-138">Konfigurowanie bramy hello Centrum IoT, uruchamiając Witaj dwie bramy modułów **po** z wiersza polecenia, używając:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="8f0b0-139">**&lt;ApplicationName&gt; ** jest nazwa hello toogive tooyour OPC UA wydawcy w formacie hello **wydawcy.&lt; nazwę FQDN&gt;**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="8f0b0-140">Na przykład, jeśli jest nazywany siecią fabryki **myfactorynetwork.com**, hello **ApplicationName** wartość jest **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="8f0b0-141">**&lt;IoTHubOwnerConnectionString&gt; ** jest hello **iothubowner** skopiowany w poprzednim kroku hello parametry połączenia.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="8f0b0-142">Ten ciąg połączenia jest używana tylko w tym kroku, nie będzie potrzebny w hello następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="8f0b0-143">Używasz hello mapowane D:\\docker folder (hello `-v` argument) nowsze toopersist Witaj dwie certyfikatów X.509, korzystających z modułów bramy hello.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="8f0b0-144">Uruchom hello bramy</span><span class="sxs-lookup"><span data-stu-id="8f0b0-144">Run hello gateway</span></span>

1. <span data-ttu-id="8f0b0-145">Uruchom ponownie bramę hello przy użyciu następującego polecenia hello:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="8f0b0-146">Ze względów bezpieczeństwa certyfikatów X.509 hello dwa utrwalone w hello D:\\docker folder zawiera hello klucza prywatnego.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="8f0b0-147">Ogranicz dostęp toothis folderu toohello poświadczeń (zazwyczaj **Administratorzy**) Użyj kontenera Docker hello toorun.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="8f0b0-148">Kliknij prawym przyciskiem myszy hello D:\\docker folderu, wybierz **właściwości**, następnie **zabezpieczeń**, a następnie **Edytuj**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="8f0b0-149">Nadaj **Administratorzy** Pełna kontrola i usunąć inne osoby:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Udziel uprawnień tooDocker udziału][img-docker-share]

1. <span data-ttu-id="8f0b0-151">Sprawdź łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-151">Verify network connectivity.</span></span> <span data-ttu-id="8f0b0-152">W wierszu polecenia wprowadź polecenie hello `ping publisher.<your fully qualified domain name>` tooping bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="8f0b0-153">Jeśli hello docelowy jest nieosiągalny, Dodaj adres IP hello i nazwę pliku hosts toohello bramy dla bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="8f0b0-154">Witaj plik hosts znajduje się w hello **Windows\\System32\\sterowniki\\itp** folderu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="8f0b0-155">Następnie spróbuj wydawcą toohello tooconnect przy użyciu lokalnego klienta OPC UA uruchomionych na powitania bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="8f0b0-156">Witaj OPC UA punkt końcowy adres URL jest `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="8f0b0-157">Jeśli nie masz OPC Agent użytkownika klienta, możesz pobrać i użyć [open source OPC Agent użytkownika klienta].</span><span class="sxs-lookup"><span data-stu-id="8f0b0-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="8f0b0-158">Jeśli te testy lokalnego została ukończona pomyślnie, przejdziesz toohello **połączyć własny serwer UA OPC** w hello połączonych fabryki rozwiązanie portalu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="8f0b0-159">Wprowadź adres URL punktu końcowego wydawcy hello (`tcp://publisher.<your fully qualified domain name>:62222`) i kliknij przycisk **Connect**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="8f0b0-160">Zostanie wyświetlone ostrzeżenie, certyfikatu, a następnie kliknij **Kontynuuj.**</span><span class="sxs-lookup"><span data-stu-id="8f0b0-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="8f0b0-161">Obok wystąpi błąd hello tego wydawcy nie ufaj hello Agent użytkownika klienta sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="8f0b0-162">tooresolve ten błąd, hello kopiowania **Agent użytkownika klienta sieci Web** certyfikatu z hello **D:\\docker\\certyfikatów odrzucił\\certyfikaty** folderu toohello **D:\\docker\\aplikacji UA\\certyfikaty** folderu na powitania bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="8f0b0-163">Nie trzeba toorestart hello bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="8f0b0-164">Powtórz ten krok.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-164">Repeat this step.</span></span> <span data-ttu-id="8f0b0-165">Teraz możesz połączyć toohello bramy z chmury hello i są gotowe tooadd OPC UA serwerów toohello rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="8f0b0-166">Dodaj serwery OPC UA</span><span class="sxs-lookup"><span data-stu-id="8f0b0-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="8f0b0-167">Przeglądaj toohello **połączyć własny serwer UA OPC** w hello połączonych fabryki rozwiązanie portalu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="8f0b0-168">Wykonaj te same czynności, jak w powyższej sekcji tooestablish hello zaufanie między hello połączonych fabryki portalu i hello serwera OPC UA powitalne.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="8f0b0-169">Ten krok pozwala ustanowić wzajemnego zaufania certyfikatów hello z hello połączony fabryki portalu i hello OPC UA serwera i tworzy połączenie.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="8f0b0-170">Przeglądaj hello OPC UA węzły drzewa OPC UA serwera, kliknij prawym przyciskiem myszy hello OPC węzłów, a następnie wybierz **publikowania**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="8f0b0-171">Dla publikacji toowork w ten sposób hello OPC UA serwera i wydawcy hello musi znajdować się na powitania tej samej sieci.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="8f0b0-172">Innymi słowy, jeśli hello w pełni kwalifikowana nazwa domeny wydawcy hello jest **publisher.mydomain.com** nazwę FQDN hello hello OPC UA serwer musi być, na przykład **myopcuaserver.mydomain.com**. Ustawienia są różne, należy ręcznie dodać węzły toohello publishesnodes.json pliku w hello **D:\\docker** folderu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="8f0b0-173">Hello publishesnodes.json plik jest automatycznie generowany na powitania najpierw pomyślne publikowania OPC węzła.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="8f0b0-174">Dane telemetryczne teraz wypływających z urządzeniem bramy hello.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="8f0b0-175">Można wyświetlić dane telemetryczne hello w hello **lokalizacje fabryki** widok portalu połączonych fabryki hello w obszarze **nowa fabryka**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="8f0b0-176">Wdrożenie systemu Linux</span><span class="sxs-lookup"><span data-stu-id="8f0b0-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="8f0b0-177">Jeśli nie masz jeszcze urządzenie bramy, firma Microsoft zaleca się, że kupić komercyjnych bramy w jednym z naszych partnerów.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="8f0b0-178">Odwiedź hello [katalogu urządzenia Azure IoT] lista bramy urządzeń zgodnych z hello połączone fabryki rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="8f0b0-179">Postępuj zgodnie z instrukcjami hello z tooset urządzenia hello zapasowej hello bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="8f0b0-180">Można również użyć hello następujące instrukcje toomanually ustawić jedną z istniejących bram.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="8f0b0-181">[Zainstaluj Docker] na urządzeniu z systemem Linux bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="8f0b0-182">Konfigurowanie bramy hello</span><span class="sxs-lookup"><span data-stu-id="8f0b0-182">Configure hello gateway</span></span>

1. <span data-ttu-id="8f0b0-183">Należy hello **iothubowner** parametry połączenia pakietu IoT Azure połączone wdrożenia bramy hello toocomplete wdrożenie fabryki.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="8f0b0-184">W hello [portalu Azure], przejdź tooyour Centrum IoT w grupie zasobów hello utworzone podczas wdrażania rozwiązania fabryki hello połączony.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="8f0b0-185">Kliknij przycisk **zasady dostępu współużytkowanego** tooaccess hello **iothubowner** ciąg połączenia:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Znajdź hello parametry połączenia Centrum IoT][img-hub-connection]

    <span data-ttu-id="8f0b0-187">Kopiuj hello **parametry połączenia — klucz podstawowy** wartość.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="8f0b0-188">Konfigurowanie bramy hello Centrum IoT, uruchamiając Witaj dwie bramy modułów **po** z powłoki z:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="8f0b0-189">**&lt;ApplicationName&gt; ** jest nazwą hello hello OPC UA aplikacji hello bramy tworzy w formacie hello **wydawcy.&lt; nazwę FQDN&gt;**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="8f0b0-190">Na przykład **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="8f0b0-191">**&lt;IoTHubOwnerConnectionString&gt; ** jest hello **iothubowner** skopiowany w poprzednim kroku hello parametry połączenia.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="8f0b0-192">Ten ciąg połączenia jest używana tylko w tym kroku, nie będzie potrzebny w hello następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="8f0b0-193">Użyj hello **/ shared** folder (hello `-v` argument) nowszego toopersist Witaj dwie certyfikatów X.509, korzystających z modułów bramy hello.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="8f0b0-194">Uruchom hello bramy</span><span class="sxs-lookup"><span data-stu-id="8f0b0-194">Run hello gateway</span></span>

1. <span data-ttu-id="8f0b0-195">Uruchom ponownie bramę hello przy użyciu następującego polecenia hello:</span><span class="sxs-lookup"><span data-stu-id="8f0b0-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="8f0b0-196">Ze względów bezpieczeństwa certyfikatów X.509 hello dwa utrwalone w hello **/ shared** folder zawiera hello klucza prywatnego.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="8f0b0-197">Użyj toorun limit dostępu toothis folderu toohello poświadczenia hello kontenera Docker.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="8f0b0-198">tooset hello uprawnienia dla **głównego** , użyj hello `chmod` powłoki poleceń w folderze hello.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="8f0b0-199">Sprawdź łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-199">Verify network connectivity.</span></span> <span data-ttu-id="8f0b0-200">Z powłoki, wprowadź polecenie hello `ping publisher.<your fully qualified domain name>` tooping bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="8f0b0-201">Jeśli hello docelowy jest nieosiągalny, Dodaj adres IP hello i nazwę pliku hosts tooyour bramy dla bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="8f0b0-202">Witaj plik hosts znajduje się w hello **/itp** folderu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="8f0b0-203">Następnie spróbuj wydawcą toohello tooconnect przy użyciu lokalnego klienta OPC UA uruchomionych na powitania bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="8f0b0-204">Witaj OPC UA punkt końcowy adres URL jest `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="8f0b0-205">Jeśli nie masz OPC Agent użytkownika klienta, możesz pobrać i użyć [open source OPC Agent użytkownika klienta].</span><span class="sxs-lookup"><span data-stu-id="8f0b0-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="8f0b0-206">Jeśli te testy lokalnego została ukończona pomyślnie, przejdziesz toohello **połączyć własny serwer UA OPC** w hello połączonych fabryki rozwiązanie portalu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="8f0b0-207">Wprowadź adres URL punktu końcowego wydawcy hello (`tcp://publisher.<your fully qualified domain name>:62222`) i kliknij przycisk **Connect**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="8f0b0-208">Zostanie wyświetlone ostrzeżenie, certyfikatu, a następnie kliknij **Kontynuuj.**</span><span class="sxs-lookup"><span data-stu-id="8f0b0-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="8f0b0-209">Obok wystąpi błąd hello tego wydawcy nie ufaj hello Agent użytkownika klienta sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="8f0b0-210">tooresolve ten błąd, hello kopiowania **Agent użytkownika klienta sieci Web** certyfikatu z hello **/udostępnione/odrzucone certyfikatów/certyfikaty** toohello folderu **/shared/UA aplikacji/certyfikaty** folder na powitania bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="8f0b0-211">Nie trzeba toorestart hello bramy.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="8f0b0-212">Powtórz ten krok.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-212">Repeat this step.</span></span> <span data-ttu-id="8f0b0-213">Teraz możesz połączyć toohello bramy z chmury hello i są gotowe tooadd OPC UA serwerów toohello rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="8f0b0-214">Dodaj serwery OPC UA</span><span class="sxs-lookup"><span data-stu-id="8f0b0-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="8f0b0-215">Przeglądaj toohello **połączyć własny serwer UA OPC** w hello połączonych fabryki rozwiązanie portalu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="8f0b0-216">Wykonaj te same czynności, jak w powyższej sekcji tooestablish hello zaufanie między hello połączonych fabryki portalu i hello serwera OPC UA powitalne.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="8f0b0-217">Ten krok pozwala ustanowić wzajemnego zaufania certyfikatów hello z hello połączony fabryki portalu i hello OPC UA serwera i tworzy połączenie.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="8f0b0-218">Przeglądaj hello OPC UA węzły drzewa OPC UA serwera, kliknij prawym przyciskiem myszy hello OPC węzłów, a następnie wybierz **publikowania**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="8f0b0-219">Dla publikacji toowork w ten sposób hello OPC UA serwera i wydawcy hello musi znajdować się na powitania tej samej sieci.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="8f0b0-220">Innymi słowy, jeśli hello w pełni kwalifikowana nazwa domeny wydawcy hello jest **publisher.mydomain.com** nazwę FQDN hello hello OPC UA serwer musi być, na przykład **myopcuaserver.mydomain.com**. Ustawienia są różne, należy ręcznie dodać węzły toohello publishesnodes.json pliku w hello **/ shared** folderu.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="8f0b0-221">Hello publishesnodes.json jest generowana automatycznie na powitania najpierw pomyślne publikowania OPC węzła.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="8f0b0-222">Dane telemetryczne teraz wypływających z urządzeniem bramy hello.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="8f0b0-223">Można wyświetlić dane telemetryczne hello w hello **lokalizacje fabryki** widok portalu połączonych fabryki hello w obszarze **nowa fabryka**.</span><span class="sxs-lookup"><span data-stu-id="8f0b0-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8f0b0-224">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="8f0b0-224">Next steps</span></span>

<span data-ttu-id="8f0b0-225">toolearn więcej informacji na temat architektury hello fabryki połączonych hello wstępnie skonfigurowane rozwiązanie, zobacz [połączonych fabryki wstępnie skonfigurowane rozwiązanie wskazówki][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="8f0b0-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker dla systemu Windows]: https://www.docker.com/docker-windows
[Wykaz urządzenia IoT Azure]: https://catalog.azureiotsuite.com/?q=opc
[Witryna Azure Portal]: http://portal.azure.com/
[open source OPC Agent użytkownika klienta]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Zainstaluj Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT Edge]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy