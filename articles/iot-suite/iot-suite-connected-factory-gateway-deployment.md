---
title: "Wdrażanie bramy połączonych fabryki pakiet IoT Azure | Dokumentacja firmy Microsoft"
description: "Jak wdrożyć bramę Windows lub Linux, aby umożliwić łączność z połączonych fabryki wstępnie skonfigurowane rozwiązanie."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: b0e6ae705911d7c18643c77b7fe08fdffffa5eb1
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-the-connected-factory-preconfigured-solution"></a><span data-ttu-id="f02d6-103">Wdrożyć bramę Windows lub Linux dla połączonych fabryki wstępnie skonfigurowane rozwiązanie</span><span class="sxs-lookup"><span data-stu-id="f02d6-103">Deploy a gateway on Windows or Linux for the connected factory preconfigured solution</span></span>

<span data-ttu-id="f02d6-104">Oprogramowanie wymagane do wdrożenia bramy dla połączonych fabryki wstępnie skonfigurowane rozwiązanie zawiera dwa składniki:</span><span class="sxs-lookup"><span data-stu-id="f02d6-104">The software required to deploy a gateway for the connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="f02d6-105">*OPC Proxy* nawiąże połączenie z Centrum IoT.</span><span class="sxs-lookup"><span data-stu-id="f02d6-105">The *OPC Proxy* establishes a connection to IoT Hub.</span></span> <span data-ttu-id="f02d6-106">*OPC Proxy* następnie czeka na polecenia i kontroli wiadomości z zintegrowane przeglądarki OPC, która jest uruchamiana w portalu rozwiązania połączonych fabryki.</span><span class="sxs-lookup"><span data-stu-id="f02d6-106">The *OPC Proxy* then waits for command and control messages from the integrated OPC Browser that runs in the connected factory solution portal.</span></span>
* <span data-ttu-id="f02d6-107">*Wydawcy OPC* łączy się z istniejącymi lokalnymi serwerami OPC UA i przekazuje komunikaty dane telemetryczne z nich do Centrum IoT.</span><span class="sxs-lookup"><span data-stu-id="f02d6-107">The *OPC Publisher* connects to existing on-premises OPC UA servers and forwards telemetry messages from them to IoT Hub.</span></span>

<span data-ttu-id="f02d6-108">Oba te składniki są open source i są dostępne jako źródło w serwisie GitHub i jak kontenery Docker:</span><span class="sxs-lookup"><span data-stu-id="f02d6-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="f02d6-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="f02d6-109">GitHub</span></span> | <span data-ttu-id="f02d6-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="f02d6-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="f02d6-111">[Wydawca OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="f02d6-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="f02d6-112">[Wydawca OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="f02d6-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="f02d6-113">[Serwer Proxy OPC][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="f02d6-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="f02d6-114">[Serwer Proxy OPC][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="f02d6-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="f02d6-115">Nie publicznych adresów IP, lub luk w zaporze bramy są wymagane dla obu składnika.</span><span class="sxs-lookup"><span data-stu-id="f02d6-115">No public-facing IP address or holes in the gateway firewall are required for either component.</span></span> <span data-ttu-id="f02d6-116">OPC serwera Proxy i wydawcy OPC należy używać tylko ruchu wychodzącego porty 443, 5671 i 8883.</span><span class="sxs-lookup"><span data-stu-id="f02d6-116">The OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="f02d6-117">Kroki opisane w tym artykule opisano, jak wdrożyć bramę przy użyciu rozwiązania Docker na albo [Windows](#windows-deployment) lub [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="f02d6-117">The steps in this article show you how to deploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="f02d6-118">Brama umożliwia łączność z połączonych fabryki wstępnie skonfigurowane rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-118">The gateway enables connectivity to the connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="f02d6-119">Oprogramowanie bramy działającą w kontenerze Docker jest [Azure IoT krawędzi].</span><span class="sxs-lookup"><span data-stu-id="f02d6-119">The gateway software that runs in the Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="f02d6-120">Wdrażanie systemu Windows</span><span class="sxs-lookup"><span data-stu-id="f02d6-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="f02d6-121">Jeśli nie masz jeszcze urządzenie bramy, firma Microsoft zaleca się, że kupić komercyjnych bramy w jednym z naszych partnerów.</span><span class="sxs-lookup"><span data-stu-id="f02d6-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="f02d6-122">Odwiedź stronę [katalogu urządzenia Azure IoT] lista bramy urządzeń zgodnych z rozwiązania połączonych fabryki.</span><span class="sxs-lookup"><span data-stu-id="f02d6-122">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="f02d6-123">Postępuj zgodnie z instrukcjami, które pochodzą z urządzeniem, aby skonfigurować bramę.</span><span class="sxs-lookup"><span data-stu-id="f02d6-123">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="f02d6-124">Alternatywnie użyj poniższych instrukcji, aby ręcznie skonfigurować jedną z istniejących bram.</span><span class="sxs-lookup"><span data-stu-id="f02d6-124">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="f02d6-125">Zainstaluj Docker</span><span class="sxs-lookup"><span data-stu-id="f02d6-125">Install Docker</span></span>

<span data-ttu-id="f02d6-126">Zainstaluj [Docker dla systemu Windows] na urządzenie bramy z systemem Windows.</span><span class="sxs-lookup"><span data-stu-id="f02d6-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="f02d6-127">Podczas instalacji systemu Windows Docker należy wybrać dysk na komputerze hosta, aby udostępnić Docker.</span><span class="sxs-lookup"><span data-stu-id="f02d6-127">During Windows Docker setup, select a drive on your host machine to share with Docker.</span></span> <span data-ttu-id="f02d6-128">Poniższy zrzut ekranu przedstawia udostępniania dysku D w systemie Windows:</span><span class="sxs-lookup"><span data-stu-id="f02d6-128">The following screenshot shows sharing the D drive on your Windows system:</span></span>

![Zainstaluj Docker][img-install-docker]

<span data-ttu-id="f02d6-130">Następnie utwórz folder o nazwie **docker** w folderze głównym dysku udostępnionego.</span><span class="sxs-lookup"><span data-stu-id="f02d6-130">Then create a folder called **docker** in the root of the shared drive.</span></span>
<span data-ttu-id="f02d6-131">Ten krok można również wykonać po zainstalowaniu docker z **ustawienia** menu.</span><span class="sxs-lookup"><span data-stu-id="f02d6-131">You can also perform this step after installing docker from the **Settings** menu.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="f02d6-132">Konfigurowanie bramy</span><span class="sxs-lookup"><span data-stu-id="f02d6-132">Configure the gateway</span></span>

1. <span data-ttu-id="f02d6-133">Należy **iothubowner** parametry połączenia pakietu IoT Azure połączone fabryki wdrożenia do ukończenia wdrożenia bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-133">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="f02d6-134">W [portalu Azure], przejdź do Centrum IoT w grupie zasobów utworzone podczas wdrażania rozwiązania fabryka połączenia.</span><span class="sxs-lookup"><span data-stu-id="f02d6-134">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="f02d6-135">Kliknij przycisk **zasady dostępu współużytkowanego** dostępu **iothubowner** ciąg połączenia:</span><span class="sxs-lookup"><span data-stu-id="f02d6-135">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![Znajdź parametry połączenia Centrum IoT][img-hub-connection]

    <span data-ttu-id="f02d6-137">Kopiuj **parametry połączenia — klucz podstawowy** wartość.</span><span class="sxs-lookup"><span data-stu-id="f02d6-137">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="f02d6-138">Konfigurowanie bramy Centrum IoT, uruchamiając modułów dwa bramy **po** z wiersza polecenia, używając:</span><span class="sxs-lookup"><span data-stu-id="f02d6-138">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="f02d6-139">**&lt;ApplicationName&gt;**  to nazwa, która ma zostać przypisany do użytkownika wydawcy UA OPC w formacie **wydawcy.&lt; nazwę FQDN&gt;**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-139">**&lt;ApplicationName&gt;** is the name to give to your OPC UA Publisher in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="f02d6-140">Na przykład, jeśli jest nazywany siecią fabryki **myfactorynetwork.com**, **ApplicationName** wartość jest **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-140">For example, if your factory network is called **myfactorynetwork.com**, the **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="f02d6-141">**&lt;IoTHubOwnerConnectionString&gt;**  jest **iothubowner** ciąg połączenia został skopiowany w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="f02d6-141">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="f02d6-142">Ten ciąg połączenia jest używana tylko w tym kroku, nie będzie potrzebny w poniższych krokach:</span><span class="sxs-lookup"><span data-stu-id="f02d6-142">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="f02d6-143">Użyj zamapowanych D:\\docker folder ( `-v` argument) później, aby utrwalić dwóch certyfikatów X.509, korzystających z modułów bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-143">You use the mapped D:\\docker folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="f02d6-144">Uruchom bramę</span><span class="sxs-lookup"><span data-stu-id="f02d6-144">Run the gateway</span></span>

1. <span data-ttu-id="f02d6-145">Uruchom ponownie bramę przy użyciu następujących poleceń:</span><span class="sxs-lookup"><span data-stu-id="f02d6-145">Restart the gateway using the following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="f02d6-146">Ze względów bezpieczeństwa dwóch certyfikatów X.509 utrwalone w D:\\docker folder zawiera klucz prywatny.</span><span class="sxs-lookup"><span data-stu-id="f02d6-146">For security reasons, the two X.509 certificates persisted in the D:\\docker folder contain the private key.</span></span> <span data-ttu-id="f02d6-147">Ograniczanie dostępu do tego folderu do poświadczeń (zazwyczaj **Administratorzy**) używane do uruchamiania w kontenerze Docker.</span><span class="sxs-lookup"><span data-stu-id="f02d6-147">Limit access to this folder to the credentials (typically **Administrators**) you use to run the Docker container.</span></span> <span data-ttu-id="f02d6-148">Kliknij prawym przyciskiem myszy D:\\docker folderu, wybierz **właściwości**, następnie **zabezpieczeń**, a następnie **Edytuj**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-148">Right-click the D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="f02d6-149">Nadaj **Administratorzy** Pełna kontrola i usunąć inne osoby:</span><span class="sxs-lookup"><span data-stu-id="f02d6-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Udzielanie uprawnień do udziału Docker][img-docker-share]

1. <span data-ttu-id="f02d6-151">Sprawdź łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="f02d6-151">Verify network connectivity.</span></span> <span data-ttu-id="f02d6-152">W wierszu polecenia wpisz polecenie `ping publisher.<your fully qualified domain name>` na polecenie ping bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-152">From a command prompt, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="f02d6-153">Jeśli docelowy jest nieosiągalny, Dodaj adres IP i nazwę bramy w pliku hosts na bramie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-153">If the destination is unreachable, add the IP address and name of your gateway to the hosts file on your gateway.</span></span> <span data-ttu-id="f02d6-154">Plik hosts znajduje się w **Windows\\System32\\sterowniki\\itp** folderu.</span><span class="sxs-lookup"><span data-stu-id="f02d6-154">The hosts file is located in the **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="f02d6-155">Następnie próby połączenia z wydawcą zostało nawiązane przy użyciu lokalnego klienta OPC UA uruchomione w bramie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-155">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="f02d6-156">Adres URL punktu końcowego OPC UA `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="f02d6-156">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="f02d6-157">Jeśli nie masz OPC Agent użytkownika klienta, możesz pobrać i użyć [open source OPC Agent użytkownika klienta].</span><span class="sxs-lookup"><span data-stu-id="f02d6-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="f02d6-158">Jeśli te testy lokalnego została ukończona pomyślnie, przejdź do **połączyć własny serwer UA OPC** w portalu rozwiązania fabryka połączenia.</span><span class="sxs-lookup"><span data-stu-id="f02d6-158">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="f02d6-159">Wprowadź adres URL punktu końcowego wydawcy (`tcp://publisher.<your fully qualified domain name>:62222`) i kliknij przycisk **Connect**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-159">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="f02d6-160">Zostanie wyświetlone ostrzeżenie, certyfikatu, a następnie kliknij **Kontynuuj.**</span><span class="sxs-lookup"><span data-stu-id="f02d6-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="f02d6-161">Następnie występuje błąd wydawcy nie ufaj Agent użytkownika klienta sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f02d6-161">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="f02d6-162">Aby rozwiązać ten problem, skopiuj **Agent użytkownika klienta sieci Web** certyfikat od **D:\\docker\\certyfikatów odrzucił\\certyfikaty** folder **D: \\docker\\aplikacji UA\\certyfikaty** folderu w bramie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-162">To resolve this error, copy the **UA Web Client** certificate from the **D:\\docker\\Rejected Certificates\\certs** folder to the **D:\\docker\\UA Applications\\certs** folder on the gateway.</span></span> <span data-ttu-id="f02d6-163">Nie trzeba ponownie uruchomić bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-163">You do not need to restart of the gateway.</span></span> <span data-ttu-id="f02d6-164">Powtórz ten krok.</span><span class="sxs-lookup"><span data-stu-id="f02d6-164">Repeat this step.</span></span> <span data-ttu-id="f02d6-165">Teraz można podłączyć do bramy z chmury, a wszystko będzie gotowe dodać serwery OPC UA do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="f02d6-165">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="f02d6-166">Dodaj serwery OPC UA</span><span class="sxs-lookup"><span data-stu-id="f02d6-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="f02d6-167">Przejdź do **połączyć własny serwer UA OPC** w portalu rozwiązania fabryka połączenia.</span><span class="sxs-lookup"><span data-stu-id="f02d6-167">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="f02d6-168">Wykonaj te same czynności, jak w poprzedniej sekcji, aby ustanowić zaufanie między portalem fabryki połączonych i OPC UA serwera.</span><span class="sxs-lookup"><span data-stu-id="f02d6-168">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="f02d6-169">Ten krok określa wzajemnego zaufania certyfikatów z portalu fabryki połączonych i serwer OPC UA i tworzy połączenie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-169">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="f02d6-170">Przeglądanie drzewa węzłów OPC UA OPC UA serwera, kliknij prawym przyciskiem myszy węzły OPC, a następnie wybierz **publikowania**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-170">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="f02d6-171">Do publikowania działają w ten sposób, serwer OPC UA i wydawcy musi być w tej samej sieci.</span><span class="sxs-lookup"><span data-stu-id="f02d6-171">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="f02d6-172">Innymi słowy Jeśli jest w pełni kwalifikowaną nazwę wydawcy **publisher.mydomain.com** w pełni kwalifikowaną nazwę serwera OPC UA musi być, na przykład **myopcuaserver.mydomain.com**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-172">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="f02d6-173">Jeśli ustawienia są różne, można ręcznie dodać węzłów do znaleziono w pliku publishesnodes.json **D:\\docker** folderu.</span><span class="sxs-lookup"><span data-stu-id="f02d6-173">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **D:\\docker** folder.</span></span> <span data-ttu-id="f02d6-174">Plik publishesnodes.json jest generowana automatycznie na pierwszym pomyślnym publikowania OPC węzła.</span><span class="sxs-lookup"><span data-stu-id="f02d6-174">The publishesnodes.json file is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="f02d6-175">Dane telemetryczne teraz wypływających z urządzeniem bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-175">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="f02d6-176">Można wyświetlić dane telemetryczne w **lokalizacje fabryki** widok portalu fabryki połączonych w obszarze **nowa fabryka**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-176">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="f02d6-177">Wdrożenie systemu Linux</span><span class="sxs-lookup"><span data-stu-id="f02d6-177">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="f02d6-178">Jeśli nie masz jeszcze urządzenie bramy, firma Microsoft zaleca się, że kupić komercyjnych bramy w jednym z naszych partnerów.</span><span class="sxs-lookup"><span data-stu-id="f02d6-178">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="f02d6-179">Odwiedź stronę [katalogu urządzenia Azure IoT] lista bramy urządzeń zgodnych z rozwiązania połączonych fabryki.</span><span class="sxs-lookup"><span data-stu-id="f02d6-179">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="f02d6-180">Postępuj zgodnie z instrukcjami, które pochodzą z urządzeniem, aby skonfigurować bramę.</span><span class="sxs-lookup"><span data-stu-id="f02d6-180">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="f02d6-181">Alternatywnie użyj poniższych instrukcji, aby ręcznie skonfigurować jedną z istniejących bram.</span><span class="sxs-lookup"><span data-stu-id="f02d6-181">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

<span data-ttu-id="f02d6-182">[Zainstaluj Docker] na urządzeniu z systemem Linux bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-182">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="f02d6-183">Konfigurowanie bramy</span><span class="sxs-lookup"><span data-stu-id="f02d6-183">Configure the gateway</span></span>

1. <span data-ttu-id="f02d6-184">Należy **iothubowner** parametry połączenia pakietu IoT Azure połączone fabryki wdrożenia do ukończenia wdrożenia bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-184">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="f02d6-185">W [portalu Azure], przejdź do Centrum IoT w grupie zasobów utworzone podczas wdrażania rozwiązania fabryka połączenia.</span><span class="sxs-lookup"><span data-stu-id="f02d6-185">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="f02d6-186">Kliknij przycisk **zasady dostępu współużytkowanego** dostępu **iothubowner** ciąg połączenia:</span><span class="sxs-lookup"><span data-stu-id="f02d6-186">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![Znajdź parametry połączenia Centrum IoT][img-hub-connection]

    <span data-ttu-id="f02d6-188">Kopiuj **parametry połączenia — klucz podstawowy** wartość.</span><span class="sxs-lookup"><span data-stu-id="f02d6-188">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="f02d6-189">Konfigurowanie bramy Centrum IoT, uruchamiając modułów dwa bramy **po** z powłoki z:</span><span class="sxs-lookup"><span data-stu-id="f02d6-189">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="f02d6-190">**&lt;ApplicationName&gt;**  jest nazwą aplikacji OPC UA bramy tworzy w formacie **wydawcy.&lt; nazwę FQDN&gt;**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-190">**&lt;ApplicationName&gt;** is the name of the OPC UA application the gateway creates in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="f02d6-191">Na przykład **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-191">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="f02d6-192">**&lt;IoTHubOwnerConnectionString&gt;**  jest **iothubowner** ciąg połączenia został skopiowany w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="f02d6-192">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="f02d6-193">Ten ciąg połączenia jest używana tylko w tym kroku, nie będzie potrzebny w poniższych krokach:</span><span class="sxs-lookup"><span data-stu-id="f02d6-193">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="f02d6-194">Możesz użyć **/ shared** folder ( `-v` argument) później, aby utrwalić dwóch certyfikatów X.509, korzystających z modułów bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-194">You use the **/shared** folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="f02d6-195">Uruchom bramę</span><span class="sxs-lookup"><span data-stu-id="f02d6-195">Run the gateway</span></span>

1. <span data-ttu-id="f02d6-196">Uruchom ponownie bramę przy użyciu następujących poleceń:</span><span class="sxs-lookup"><span data-stu-id="f02d6-196">Restart the gateway using the following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="f02d6-197">Ze względów bezpieczeństwa dwóch certyfikatów X.509 utrwalone w **/ shared** folder zawiera klucz prywatny.</span><span class="sxs-lookup"><span data-stu-id="f02d6-197">For security reasons, the two X.509 certificates persisted in the **/shared** folder contain the private key.</span></span> <span data-ttu-id="f02d6-198">Ograniczanie dostępu do tego folderu poświadczeń, których używasz do wykonywania kontenera Docker.</span><span class="sxs-lookup"><span data-stu-id="f02d6-198">Limit access to this folder to the credentials you use to run the Docker container.</span></span> <span data-ttu-id="f02d6-199">Aby ustawić uprawnienia dla **głównego** , użyj `chmod` powłoki polecenia w folderze.</span><span class="sxs-lookup"><span data-stu-id="f02d6-199">To set the permissions for **root** only, use the `chmod` shell command on the folder.</span></span>

1. <span data-ttu-id="f02d6-200">Sprawdź łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="f02d6-200">Verify network connectivity.</span></span> <span data-ttu-id="f02d6-201">Z powłoki, wprowadź polecenie `ping publisher.<your fully qualified domain name>` na polecenie ping bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-201">From a shell, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="f02d6-202">Jeśli docelowy jest nieosiągalny, Dodaj adres IP i nazwę bramy w pliku hostów na bramie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-202">If the destination is unreachable, add the IP address and name of your gateway to your hosts file on your gateway.</span></span> <span data-ttu-id="f02d6-203">Plik hosts znajduje się w **/itp** folderu.</span><span class="sxs-lookup"><span data-stu-id="f02d6-203">The hosts file is located in the **/etc** folder.</span></span>

1. <span data-ttu-id="f02d6-204">Następnie próby połączenia z wydawcą zostało nawiązane przy użyciu lokalnego klienta OPC UA uruchomione w bramie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-204">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="f02d6-205">Adres URL punktu końcowego OPC UA `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="f02d6-205">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="f02d6-206">Jeśli nie masz OPC Agent użytkownika klienta, możesz pobrać i użyć [open source OPC Agent użytkownika klienta].</span><span class="sxs-lookup"><span data-stu-id="f02d6-206">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="f02d6-207">Jeśli te testy lokalnego została ukończona pomyślnie, przejdź do **połączyć własny serwer UA OPC** w portalu rozwiązania fabryka połączenia.</span><span class="sxs-lookup"><span data-stu-id="f02d6-207">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="f02d6-208">Wprowadź adres URL punktu końcowego wydawcy (`tcp://publisher.<your fully qualified domain name>:62222`) i kliknij przycisk **Connect**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-208">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="f02d6-209">Zostanie wyświetlone ostrzeżenie, certyfikatu, a następnie kliknij **Kontynuuj.**</span><span class="sxs-lookup"><span data-stu-id="f02d6-209">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="f02d6-210">Następnie występuje błąd wydawcy nie ufaj Agent użytkownika klienta sieci Web.</span><span class="sxs-lookup"><span data-stu-id="f02d6-210">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="f02d6-211">Aby rozwiązać ten problem, skopiuj **Agent użytkownika klienta sieci Web** certyfikat od **/udostępnione/odrzucone certyfikatów/certyfikaty** folder **/shared/UA aplikacji/certyfikaty** folderu na brama.</span><span class="sxs-lookup"><span data-stu-id="f02d6-211">To resolve this error, copy the **UA Web Client** certificate from the **/shared/Rejected Certificates/certs** folder to the **/shared/UA Applications/certs** folder on the gateway.</span></span> <span data-ttu-id="f02d6-212">Nie trzeba ponownie uruchomić bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-212">You do not need to restart of the gateway.</span></span> <span data-ttu-id="f02d6-213">Powtórz ten krok.</span><span class="sxs-lookup"><span data-stu-id="f02d6-213">Repeat this step.</span></span> <span data-ttu-id="f02d6-214">Teraz można podłączyć do bramy z chmury, a wszystko będzie gotowe dodać serwery OPC UA do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="f02d6-214">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="f02d6-215">Dodaj serwery OPC UA</span><span class="sxs-lookup"><span data-stu-id="f02d6-215">Add your OPC UA servers</span></span>

1. <span data-ttu-id="f02d6-216">Przejdź do **połączyć własny serwer UA OPC** w portalu rozwiązania fabryka połączenia.</span><span class="sxs-lookup"><span data-stu-id="f02d6-216">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="f02d6-217">Wykonaj te same czynności, jak w poprzedniej sekcji, aby ustanowić zaufanie między portalem fabryki połączonych i OPC UA serwera.</span><span class="sxs-lookup"><span data-stu-id="f02d6-217">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="f02d6-218">Ten krok określa wzajemnego zaufania certyfikatów z portalu fabryki połączonych i serwer OPC UA i tworzy połączenie.</span><span class="sxs-lookup"><span data-stu-id="f02d6-218">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="f02d6-219">Przeglądanie drzewa węzłów OPC UA OPC UA serwera, kliknij prawym przyciskiem myszy węzły OPC, a następnie wybierz **publikowania**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-219">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="f02d6-220">Do publikowania działają w ten sposób, serwer OPC UA i wydawcy musi być w tej samej sieci.</span><span class="sxs-lookup"><span data-stu-id="f02d6-220">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="f02d6-221">Innymi słowy Jeśli jest w pełni kwalifikowaną nazwę wydawcy **publisher.mydomain.com** w pełni kwalifikowaną nazwę serwera OPC UA musi być, na przykład **myopcuaserver.mydomain.com**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-221">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="f02d6-222">Jeśli ustawienia są różne, można ręcznie dodać węzłów do znaleziono w pliku publishesnodes.json **/ shared** folderu.</span><span class="sxs-lookup"><span data-stu-id="f02d6-222">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **/shared** folder.</span></span> <span data-ttu-id="f02d6-223">Publishesnodes.json jest generowana automatycznie na pierwszym pomyślnym publikowania OPC węzła.</span><span class="sxs-lookup"><span data-stu-id="f02d6-223">The publishesnodes.json is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="f02d6-224">Dane telemetryczne teraz wypływających z urządzeniem bramy.</span><span class="sxs-lookup"><span data-stu-id="f02d6-224">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="f02d6-225">Można wyświetlić dane telemetryczne w **lokalizacje fabryki** widok portalu fabryki połączonych w obszarze **nowa fabryka**.</span><span class="sxs-lookup"><span data-stu-id="f02d6-225">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f02d6-226">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="f02d6-226">Next steps</span></span>

<span data-ttu-id="f02d6-227">Aby dowiedzieć się więcej o architekturze połączonych fabryki wstępnie skonfigurowane rozwiązanie, zobacz [połączonych fabryki wstępnie skonfigurowane rozwiązanie wskazówki][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="f02d6-227">To learn more about the architecture of the connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

<span data-ttu-id="f02d6-228">[Docker dla systemu Windows]: https://www.docker.com/docker-windows</span><span class="sxs-lookup"><span data-stu-id="f02d6-228">[Docker for Windows]: https://www.docker.com/docker-windows</span></span>
<span data-ttu-id="f02d6-229">[katalogu urządzenia Azure IoT]: https://catalog.azureiotsuite.com/?q=opc</span><span class="sxs-lookup"><span data-stu-id="f02d6-229">[Azure IoT device catalog]: https://catalog.azureiotsuite.com/?q=opc</span></span>
<span data-ttu-id="f02d6-230">[portalu Azure]: http://portal.azure.com/</span><span class="sxs-lookup"><span data-stu-id="f02d6-230">[Azure portal]: http://portal.azure.com/</span></span>
<span data-ttu-id="f02d6-231">[open source OPC Agent użytkownika klienta]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span><span class="sxs-lookup"><span data-stu-id="f02d6-231">[open-source OPC UA client]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span></span>
<span data-ttu-id="f02d6-232">[Zainstaluj Docker]: https://www.docker.com/community-edition#/download</span><span class="sxs-lookup"><span data-stu-id="f02d6-232">[Install Docker]: https://www.docker.com/community-edition#/download</span></span>
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
<span data-ttu-id="f02d6-233">[Azure IoT krawędzi]: https://github.com/Azure/iot-edge</span><span class="sxs-lookup"><span data-stu-id="f02d6-233">[Azure IoT Edge]: https://github.com/Azure/iot-edge</span></span>

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy