---
title: "aaaCalling element Runbook usługi Automatyzacja Azure z dziennika alertu Analytics | Dokumentacja firmy Microsoft"
description: "Ten artykuł zawiera omówienie sposobu tooinvoke element runbook usługi Automatyzacja z alertu Analiza dzienników Microsoft OMS."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="f840f-103">Wywoływanie elementu runbook usługi Azure Automation z alertu usługi OMS Log Analytics</span><span class="sxs-lookup"><span data-stu-id="f840f-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="f840f-104">Gdy alert jest skonfigurowany w toocreate analizy dzienników rekord alertu, jeżeli wyników spełniających kryteria określonego, takich jak długimi kolekcji w określonej aplikacji proces krytyczne toohello funkcji aplikacji biznesowej lub użycie procesora nie powiedzie się i zapisuje odpowiednie zdarzenie w dzienniku zdarzeń systemu Windows hello, że alert automatycznie można uruchomić element runbook usługi Automatyzacja w tooauto próba-skorygować hello problem.</span><span class="sxs-lookup"><span data-stu-id="f840f-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="f840f-105">Istnieją dwie opcje toocall elementu runbook podczas konfigurowania hello alertu.</span><span class="sxs-lookup"><span data-stu-id="f840f-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="f840f-106">Są to:</span><span class="sxs-lookup"><span data-stu-id="f840f-106">Specifically,</span></span>

1. <span data-ttu-id="f840f-107">Skorzystanie z elementu webhook.</span><span class="sxs-lookup"><span data-stu-id="f840f-107">Using a Webhook.</span></span>
   * <span data-ttu-id="f840f-108">Jest to hello jedyną dostępną opcją, jeśli obszar roboczy OMS nie jest połączony tooan konta automatyzacji.</span><span class="sxs-lookup"><span data-stu-id="f840f-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="f840f-109">Jeśli masz już obszar roboczy OMS tooan konta automatyzacji, ta opcja jest nadal dostępny.</span><span class="sxs-lookup"><span data-stu-id="f840f-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="f840f-110">Bezpośrednie wybranie elementu runbook.</span><span class="sxs-lookup"><span data-stu-id="f840f-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="f840f-111">Ta opcja jest dostępna tylko wtedy, gdy obszar roboczy OMS hello tooan połączonego konta automatyzacji.</span><span class="sxs-lookup"><span data-stu-id="f840f-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="f840f-112">Wywoływanie elementu runbook przy użyciu elementu webhook</span><span class="sxs-lookup"><span data-stu-id="f840f-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="f840f-113">Elementu webhook umożliwia toostart określonego elementu runbook automatyzacji Azure za pomocą pojedynczego żądania HTTP.</span><span class="sxs-lookup"><span data-stu-id="f840f-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="f840f-114">Przed skonfigurowaniem hello [alert analizy dzienników](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook przy użyciu elementu webhook jako Akcja alertu, konieczne będzie toofirst tworzenia elementu webhook dla elementu runbook hello, która zostanie wywołana za pomocą tej metody.</span><span class="sxs-lookup"><span data-stu-id="f840f-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="f840f-115">Przejrzyj i wykonaj kroki hello hello [tworzenia elementu webhook](automation-webhooks.md#creating-a-webhook) artykułu i zapamiętać adresu URL elementu webhook hello toorecord odwołania podczas konfigurowania reguły alertu hello.</span><span class="sxs-lookup"><span data-stu-id="f840f-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="f840f-116">Bezpośrednie uruchamianie elementu runbook</span><span class="sxs-lookup"><span data-stu-id="f840f-116">Calling a runbook directly</span></span>

<span data-ttu-id="f840f-117">Jeśli masz hello automatyzacji & oferty kontroli zainstalowany i skonfigurowany w obszarze roboczym pakietu OMS, podczas konfigurowania opcji działania elementu Runbook hello hello alertu, można wyświetlić wszystkich elementów runbook z hello **wybrać element runbook** listy rozwijanej i wybierz hello element runbook ma toorun w odpowiedzi toohello alertu.</span><span class="sxs-lookup"><span data-stu-id="f840f-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="f840f-118">w obszarze roboczym hello chmury Azure lub hybrydowy proces roboczy elementu runbook można uruchomić elementu runbook Hello wybrane.</span><span class="sxs-lookup"><span data-stu-id="f840f-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="f840f-119">Podczas tworzenia alertu hello przy użyciu opcji elementu runbook hello elementu webhook zostaną utworzone dla hello elementu runbook.</span><span class="sxs-lookup"><span data-stu-id="f840f-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="f840f-120">Można wyświetlić elementu webhook hello Przejdź toohello konta automatyzacji i przejdź do bloku webhook toohello hello wybrany element runbook.</span><span class="sxs-lookup"><span data-stu-id="f840f-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="f840f-121">Jeśli usuniesz hello alert hello elementu webhook nie zostanie usunięta, ale hello użytkownika można usunąć elementu webhook hello ręcznie.</span><span class="sxs-lookup"><span data-stu-id="f840f-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="f840f-122">Nie jest problem Jeśli hello elementu webhook nie zostanie usunięta, jest ona tylko oddzielone elementu, który po pewnym czasie będzie konieczne toobe usunięte w kolejności toomaintain organizowane konta automatyzacji.</span><span class="sxs-lookup"><span data-stu-id="f840f-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="f840f-123">Właściwości elementu runbook (w przypadku obu opcji)</span><span class="sxs-lookup"><span data-stu-id="f840f-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="f840f-124">Obu metod wywoływania elementu runbook hello z hello analizy dzienników alert ma właściwości inaczej, wymagające toobe zrozumiał przed skonfigurowaniem reguł alertów.</span><span class="sxs-lookup"><span data-stu-id="f840f-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="f840f-125">Musisz mieć parametr wejściowy elementu runbook o nazwie **WebhookData**, którego typ to **Obiekt**.</span><span class="sxs-lookup"><span data-stu-id="f840f-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="f840f-126">Może on być wymagany lub opcjonalny.</span><span class="sxs-lookup"><span data-stu-id="f840f-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="f840f-127">Hello alert przekazuje hello wyszukiwania wyniki toohello elementu runbook za pomocą tego parametru wejściowego.</span><span class="sxs-lookup"><span data-stu-id="f840f-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="f840f-128">Musi mieć kod tooconvert hello WebhookData tooa środowiska PowerShell obiektu.</span><span class="sxs-lookup"><span data-stu-id="f840f-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="f840f-129">*$SearchResults* będzie tablicę obiektów; każdego obiektu zawiera pola hello z wyników wyszukiwania co</span><span class="sxs-lookup"><span data-stu-id="f840f-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="f840f-130">WebhookData niespójności między opcję elementu webhook hello i elementu runbook</span><span class="sxs-lookup"><span data-stu-id="f840f-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="f840f-131">Podczas konfigurowania alertów toocall elementu Webhook, wprowadź adres URL elementu webhook został utworzony dla elementu runbook i kliknij przycisk hello **Webhook testu** przycisku.</span><span class="sxs-lookup"><span data-stu-id="f840f-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="f840f-132">Hello wynikowy WebhookData wysyłane toohello elementu runbook nie zawiera albo *. Właściwości SearchResult* lub *. Wynikówwyszukiwania*.</span><span class="sxs-lookup"><span data-stu-id="f840f-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="f840f-133">Zapisanie tego alertu hello alert wyzwolenia i wywołuje element webhook hello hello WebhookData wysyłane toohello runbook zawiera *. Właściwości SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="f840f-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="f840f-134">Utwórz alert i należy skonfigurować ją toocall elementu runbook (która także tworzy elementu webhook), gdy hello alertu wyzwalaczy wysyła WebhookData toohello runbook, który zawiera *. Wynikówwyszukiwania*.</span><span class="sxs-lookup"><span data-stu-id="f840f-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="f840f-135">W związku z tym w powyższym przykładzie kodu hello, konieczne będzie tooget *. Właściwości SearchResult* Jeśli hello alert wywołania elementu webhook i będzie konieczne tooget *. Wynikówwyszukiwania* hello alert bezpośrednio wywołuje element runbook.</span><span class="sxs-lookup"><span data-stu-id="f840f-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="f840f-136">Przykładowy przewodnik</span><span class="sxs-lookup"><span data-stu-id="f840f-136">Example walkthrough</span></span>

<span data-ttu-id="f840f-137">Firma Microsoft pokazują, jak to działa przy użyciu następującego przykładu graficznym elementem runbook, który uruchamia usługę Windows hello.</span><span class="sxs-lookup"><span data-stu-id="f840f-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Graficzny element runbook uruchamiający usługę systemu Windows](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="f840f-139">Element runbook Hello ma jeden parametr wejściowy typu **obiektu** jest to **WebhookData** i obejmuje przekazywane z hello alertów zawierający dane elementu webhook hello *. Wynikówwyszukiwania*.</span><span class="sxs-lookup"><span data-stu-id="f840f-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="f840f-140">![Parametry wejściowe elementu runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="f840f-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="f840f-141">Na przykład w analizy dzienników utworzyliśmy dwa pola niestandardowe, *SvcDisplayName_CF* i *SvcState_CF*, tooextract hello wyświetlaną nazwę i hello stan usługi hello usługi (np. uruchomiona lub zatrzymana) od hello zdarzenia zapisywane w dzienniku zdarzeń systemowych toohello.</span><span class="sxs-lookup"><span data-stu-id="f840f-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="f840f-142">Następnie utworzymy regułę alertu z następującego zapytania wyszukiwania hello: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` tak, aby firma Microsoft może wykryć po zatrzymaniu hello usługi buforu wydruku na powitania systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="f840f-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="f840f-143">Może być dowolnej usługi zainteresowań, ale w tym przykładzie mamy odwołują się do jednego z hello już istniejących usług, które są dołączone do systemu operacyjnego Windows hello.</span><span class="sxs-lookup"><span data-stu-id="f840f-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="f840f-144">Hello akcji alertu jest skonfigurowany tooexecute naszych elementu runbook w tym przykładzie i uruchom na powitania hybrydowy proces roboczy elementu Runbook, które są włączone na systemów docelowych hello.</span><span class="sxs-lookup"><span data-stu-id="f840f-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="f840f-145">Witaj działanie elementu runbook kodu **pobieranie nazwy usługi z LA** przekonwertuje hello ciąg w formacie JSON na obiekt typu i filtr w elemencie hello *SvcDisplayName_CF* nazwę wyświetlaną hello tooextract hello Usługi systemu Windows i przekazany na powitania następnego działania, który sprawdzi hello zostanie zatrzymana przed podjęciem próby wykonania toorestart go.</span><span class="sxs-lookup"><span data-stu-id="f840f-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="f840f-146">*SvcDisplayName_CF* jest [niestandardowego pola](../log-analytics/log-analytics-custom-fields.md) utworzone w toodemonstrate analizy dzienników w tym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="f840f-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="f840f-147">Po zatrzymaniu usługi hello hello reguły alertów w analizy dzienników wykryje dopasowanie i wyzwolić elementu runbook hello i wysłać hello kontekst alertu toohello runbook.</span><span class="sxs-lookup"><span data-stu-id="f840f-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="f840f-148">Hello runbook podejmie akcji tooverify hello usługa zostanie zatrzymana, i jeśli tak toorestart próba hello usługi i sprawdź jej prawidłowo uruchomić i powoduje hello danych wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="f840f-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="f840f-149">Można również nie masz obszar roboczy OMS automatyzacji konto połączone tooyour przypadku czy skonfigurować regułę alertu hello element webhook akcji tootrigger hello i skonfigurowania hello runbook tooconvert hello ciąg w formacie JSON i filtr na *. Właściwości SearchResult* następujące wskazówki hello wymienionych poniżej.</span><span class="sxs-lookup"><span data-stu-id="f840f-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="f840f-150">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="f840f-150">Next steps</span></span>

* <span data-ttu-id="f840f-151">więcej informacji na temat alertów w analizy dzienników toolearn i toocreate, zobacz temat [alertów w analizy dzienników](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="f840f-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="f840f-152">toounderstand tootrigger elementów runbook przy użyciu elementu webhook, zobacz temat [elementów webhook usługi Automatyzacja Azure](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="f840f-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
