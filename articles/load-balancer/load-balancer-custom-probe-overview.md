---
title: "niestandardowe sond równoważenia aaaLoad i stan kondycji monitorowania | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak sondy toouse niestandardowych dla usługi równoważenia obciążenia Azure toomonitor wystąpień za usługą równoważenia obciążenia"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="007b0-103">Opis sond modułu równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="007b0-103">Understand load balancer probes</span></span>

<span data-ttu-id="007b0-104">Moduł równoważenia obciążenia Azure oferuje hello możliwości toomonitor hello kondycji wystąpień serwera przy użyciu sondy.</span><span class="sxs-lookup"><span data-stu-id="007b0-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="007b0-105">W przypadku awarii toorespond sondę modułu równoważenia obciążenia zatrzymuje wysyłanie nowe wystąpienie zła toohello połączenia.</span><span class="sxs-lookup"><span data-stu-id="007b0-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="007b0-106">nie dotyczy Hello istniejących połączeń i nowych połączeń są wysyłane toohealthy wystąpień.</span><span class="sxs-lookup"><span data-stu-id="007b0-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="007b0-107">Role usługi w chmurze (role procesów roboczych oraz role sieci web) skorzystać agenta gościa w celu monitorowania sondowania.</span><span class="sxs-lookup"><span data-stu-id="007b0-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="007b0-108">TCP lub HTTP niestandardowego sondy musi być skonfigurowany, korzystając z maszyn wirtualnych za usługą równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="007b0-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="007b0-109">Licznik sondy i limit czasu</span><span class="sxs-lookup"><span data-stu-id="007b0-109">Understand probe count and timeout</span></span>

<span data-ttu-id="007b0-110">Zachowanie sondowania zależy od:</span><span class="sxs-lookup"><span data-stu-id="007b0-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="007b0-111">Hello liczba pomyślnych sond, umożliwiających toobe wystąpienia oznaczone jako czas.</span><span class="sxs-lookup"><span data-stu-id="007b0-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="007b0-112">Liczba Hello sond nie powiodło się, powodujących toobe wystąpienia etykietą w dół.</span><span class="sxs-lookup"><span data-stu-id="007b0-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="007b0-113">wartość limitu czasu i częstotliwość Hello w SuccessFailCount ustalić, czy wystąpienie jest potwierdzone toobe uruchomiona lub nie działa.</span><span class="sxs-lookup"><span data-stu-id="007b0-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="007b0-114">W portalu Azure hello limit czasu hello jest wartość tootwo razy hello hello częstotliwości.</span><span class="sxs-lookup"><span data-stu-id="007b0-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="007b0-115">Witaj badania konfiguracji wszystkich wystąpień usługi równoważenia obciążenia dla punktu końcowego (czyli zestaw z równoważeniem obciążenia) musi być hello takie same.</span><span class="sxs-lookup"><span data-stu-id="007b0-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="007b0-116">Oznacza to, nie może mieć konfiguracji różnych sondowania dla każdego wystąpienia roli lub maszyny wirtualnej w hello sam hostowanej usługi dla kombinacji danego punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="007b0-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="007b0-117">Na przykład każde wystąpienie musi mieć identyczne porty lokalne i przekroczeń limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="007b0-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="007b0-118">Sonda modułu równoważenia obciążenia używa adresu IP hello 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="007b0-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="007b0-119">Ten publiczny adres IP umożliwia komunikację toointernal zasoby platformy hello Przełącz your właścicielem IP scenariusz sieci wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="007b0-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="007b0-120">Witaj wirtualnej publiczny adres IP 168.63.129.16 jest używany we wszystkich regionach i nie zmieni się.</span><span class="sxs-lookup"><span data-stu-id="007b0-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="007b0-121">Firma Microsoft zaleca Zezwalaj ten adres IP w żadnych zasad zapory lokalnej.</span><span class="sxs-lookup"><span data-stu-id="007b0-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="007b0-122">Go nie należy traktować jako zagrożenie bezpieczeństwa, ponieważ tylko hello wewnętrzny platformy Azure może pobierać wiadomości z tego adresu.</span><span class="sxs-lookup"><span data-stu-id="007b0-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="007b0-123">Jeśli nie zrobisz, będzie nieoczekiwanego zachowania w różnych scenariuszy, takich jak konfigurowanie hello tego samego zakresu adresów IP 168.63.129.16 i mających zduplikowane adresy IP.</span><span class="sxs-lookup"><span data-stu-id="007b0-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="007b0-124">Informacje o typach hello sondy</span><span class="sxs-lookup"><span data-stu-id="007b0-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="007b0-125">Sondowanie agenta gościa</span><span class="sxs-lookup"><span data-stu-id="007b0-125">Guest agent probe</span></span>

<span data-ttu-id="007b0-126">To sondowanie jest tylko dostępne dla usługi w chmurze Azure.</span><span class="sxs-lookup"><span data-stu-id="007b0-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="007b0-127">Moduł równoważenia obciążenia, korzysta z agenta gościa hello wewnątrz hello maszyny wirtualnej i nasłuchuje i wysyła odpowiedź HTTP 200 OK tylko wtedy, gdy hello wystąpienie jest w stanie gotowe hello (to znaczy nie w innym stanu takich jak zajęty, odtwarzanie lub zatrzymywanie).</span><span class="sxs-lookup"><span data-stu-id="007b0-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="007b0-128">Aby uzyskać więcej informacji, zobacz [Konfigurowanie hello pliku definicji usługi (csdef) dla sondy kondycji](https://msdn.microsoft.com/library/azure/ee758710.aspx) lub [rozpocząć tworzenie internetowy równoważenia obciążenia dla usług w chmurze](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="007b0-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="007b0-129">Dzięki czemu sondowanie agenta gościa, Oznacz wystąpienia swój stan jako niezdrowy?</span><span class="sxs-lookup"><span data-stu-id="007b0-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="007b0-130">W przypadku niepowodzenia toorespond HTTP 200 OK agenta gościa hello znaczniki usługi równoważenia obciążenia hello hello wystąpienia jako odpowiadać i kończy działanie wysyłania ruchu toothat wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="007b0-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="007b0-131">Moduł równoważenia obciążenia Hello nadal tooping hello wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="007b0-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="007b0-132">Agent gościa hello odpowie 200 protokołu HTTP, usługi równoważenia obciążenia hello wysyła wystąpienia toothat ruchu ponownie.</span><span class="sxs-lookup"><span data-stu-id="007b0-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="007b0-133">Korzystając z roli sieci web, hello kodu witryny sieci Web jest zwykle działa w w3wp.exe, który nie jest monitorowane przez hello Azure sieci szkieletowej lub agenta gościa.</span><span class="sxs-lookup"><span data-stu-id="007b0-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="007b0-134">To oznacza, że błędy w w3wp.exe (na przykład odpowiedzi HTTP 500) nie będzie toohello zgłoszone agenta gościa, a hello modułu równoważenia obciążenia nie będą brane danego wystąpienia poza obrotu.</span><span class="sxs-lookup"><span data-stu-id="007b0-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="007b0-135">Niestandardowe badanie HTTP</span><span class="sxs-lookup"><span data-stu-id="007b0-135">HTTP custom probe</span></span>

<span data-ttu-id="007b0-136">niestandardowe sondy modułu równoważenia obciążenia HTTP Hello przesłania sondowanie agenta gościa domyślne hello, co oznacza, możesz utworzyć własne niestandardowej logiki toodetermine hello kondycji hello wystąpienia roli.</span><span class="sxs-lookup"><span data-stu-id="007b0-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="007b0-137">Moduł równoważenia obciążenia Hello sondy punktu końcowego co 15 s domyślnie.</span><span class="sxs-lookup"><span data-stu-id="007b0-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="007b0-138">wystąpienie Hello jest uznawany za toobe rotacji usługi równoważenia obciążenia hello, jeśli odpowiada z 200 protokołu HTTP w hello limicie czasu (w sekundach 31 domyślnie).</span><span class="sxs-lookup"><span data-stu-id="007b0-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="007b0-139">Może to być przydatne w przypadku tooimplement własnego wystąpienia tooremove logiki z obrotu usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="007b0-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="007b0-140">Można na przykład określić tooremove wystąpienia, jeśli jest ponad 90% zasobów Procesora i zwraca stan – 200.</span><span class="sxs-lookup"><span data-stu-id="007b0-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="007b0-141">Jeśli masz role sieci web, które używają w3wp.exe, oznacza to też, możesz uzyskać automatyczne monitorowania witryny sieci Web, ponieważ błędów w kodzie witryny sieci Web, którą będzie zwracać sondę modułu równoważenia obciążenia toohello stan – 200.</span><span class="sxs-lookup"><span data-stu-id="007b0-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="007b0-142">Badanie niestandardowych Hello HTTP obsługuje ścieżek względnych i tylko protokołu HTTP.</span><span class="sxs-lookup"><span data-stu-id="007b0-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="007b0-143">Protokół HTTPS nie jest obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="007b0-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="007b0-144">Co sprawia, że badanie niestandardowych HTTP oznaczyć swój stan jako niezdrowy wystąpienia?</span><span class="sxs-lookup"><span data-stu-id="007b0-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="007b0-145">Witaj aplikacji HTTP zwraca kod odpowiedzi HTTP innych niż 200 (na przykład 403, 404 lub 500).</span><span class="sxs-lookup"><span data-stu-id="007b0-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="007b0-146">To jest dodatnią potwierdzenia, że aplikacja hello wystąpienie powinno się znaleźć poza usługi od razu.</span><span class="sxs-lookup"><span data-stu-id="007b0-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="007b0-147">Hello HTTP serwer nie odpowiada na wszystkich po hello limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="007b0-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="007b0-148">W zależności od wartość limitu czasu hello jest ustawiona, może to oznaczać tej sondy wielu żądań bez odpowiedzi przed hello sondowanie pobiera oznaczona jako nie działa z rzeczywistym użyciem (czyli przed SuccessFailCount sond są wysyłane).</span><span class="sxs-lookup"><span data-stu-id="007b0-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="007b0-149">Serwer Hello zamyka hello połączenia za pośrednictwem resetowania TCP.</span><span class="sxs-lookup"><span data-stu-id="007b0-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="007b0-150">Niestandardowe sondowaniem TCP</span><span class="sxs-lookup"><span data-stu-id="007b0-150">TCP custom probe</span></span>

<span data-ttu-id="007b0-151">Sondy protokołu TCP nawiązania połączenia, wykonując trójstopniowego z portem hello zdefiniowane.</span><span class="sxs-lookup"><span data-stu-id="007b0-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="007b0-152">Dzięki czemu niestandardowy sondowaniem TCP oznaczyć swój stan jako niezdrowy wystąpienia?</span><span class="sxs-lookup"><span data-stu-id="007b0-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="007b0-153">Witaj TCP serwer nie odpowiada na wszystkich po hello limit czasu.</span><span class="sxs-lookup"><span data-stu-id="007b0-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="007b0-154">Gdy hello sondowania jest oznaczony jako nieuruchomiona zależy od hello liczba nieudanych sondowania żądania, które były skonfigurowane toogo bez odpowiedzi, zanim oznaczysz sondowania hello jako nie działa.</span><span class="sxs-lookup"><span data-stu-id="007b0-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="007b0-155">Sonda Hello odbiera TCP zresetować z hello wystąpienia roli.</span><span class="sxs-lookup"><span data-stu-id="007b0-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="007b0-156">Aby uzyskać więcej informacji o konfigurowaniu sondy kondycji protokołu HTTP lub sondowaniem TCP, zobacz [rozpocząć tworzenie internetowy równoważenia obciążenia w Menedżerze zasobów przy użyciu programu PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="007b0-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="007b0-157">Dodaj dobrej kondycji wystąpień do obrotu usługi równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="007b0-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="007b0-158">TCP i HTTP są traktowane jako dobrej kondycji i oznacz hello wystąpienia roli co w przypadku dobrej kondycji:</span><span class="sxs-lookup"><span data-stu-id="007b0-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="007b0-159">Moduł równoważenia obciążenia Hello pobiera dodatnią sondowania hello pierwszego czasu powitalne rozruchu maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="007b0-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="007b0-160">Liczba Hello SuccessFailCount (opisanym wcześniej) określa wartość hello pomyślne sond, które są wymagane toomark wystąpienia roli hello w dobrej kondycji.</span><span class="sxs-lookup"><span data-stu-id="007b0-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="007b0-161">Jeśli usunięto wystąpienia roli, hello liczbę sond pomyślne, kolejne musi równa lub przekracza wartość hello wystąpienia roli hello toomark SuccessFailCount jako uruchomione.</span><span class="sxs-lookup"><span data-stu-id="007b0-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="007b0-162">Jeśli kondycji hello wystąpienia roli jest zmienne, usługi równoważenia obciążenia hello oczekuje już przed wprowadzeniem wystąpienia roli hello w dobrej kondycji hello.</span><span class="sxs-lookup"><span data-stu-id="007b0-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="007b0-163">Jest to realizowane za pośrednictwem zasad tooprotect hello użytkownika i infrastruktura hello.</span><span class="sxs-lookup"><span data-stu-id="007b0-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="007b0-164">Użyj analizy dzienników dla usługi równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="007b0-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="007b0-165">Można użyć [logowania dla usługi równoważenia obciążenia analytics](load-balancer-monitor-log.md) toocheck na powitania sondy kondycji stanu i badania count.</span><span class="sxs-lookup"><span data-stu-id="007b0-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="007b0-166">Rejestrowanie można łączyć z usługi Power BI lub usługi Azure Operational Insights tooprovide Statystyka stanu kondycji modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="007b0-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>
