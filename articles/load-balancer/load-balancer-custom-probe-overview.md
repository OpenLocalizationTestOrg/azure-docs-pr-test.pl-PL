---
title: "Niestandardowe sondy modułu równoważenia obciążenia i monitorowanie stanu kondycji | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak używać niestandardowych sondy dla usługi równoważenia obciążenia Azure do monitorowania wystąpień za usługą równoważenia obciążenia"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: cab028fed58d544a56f2f6b12b72364c7baf4d86
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="17037-103">Opis sond modułu równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="17037-103">Understand load balancer probes</span></span>

<span data-ttu-id="17037-104">Moduł równoważenia obciążenia Azure oferuje możliwość monitorowania kondycji wystąpień serwera przy użyciu sondy.</span><span class="sxs-lookup"><span data-stu-id="17037-104">Azure Load Balancer offers the capability to monitor the health of server instances by using probes.</span></span> <span data-ttu-id="17037-105">Podczas badania nie odpowiada, usługi równoważenia obciążenia zatrzymuje wysyłanie nowe połączenia z wystąpieniem złej kondycji.</span><span class="sxs-lookup"><span data-stu-id="17037-105">When a probe fails to respond, Load Balancer stops sending new connections to the unhealthy instance.</span></span> <span data-ttu-id="17037-106">Nie ma wpływu na istniejące połączenia, a nowe połączenia są wysyłane do dobrej kondycji wystąpień.</span><span class="sxs-lookup"><span data-stu-id="17037-106">The existing connections are not affected, and new connections are sent to healthy instances.</span></span>

<span data-ttu-id="17037-107">Role usługi w chmurze (role procesów roboczych oraz role sieci web) skorzystać agenta gościa w celu monitorowania sondowania.</span><span class="sxs-lookup"><span data-stu-id="17037-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="17037-108">TCP lub HTTP niestandardowego sondy musi być skonfigurowany, korzystając z maszyn wirtualnych za usługą równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="17037-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="17037-109">Licznik sondy i limit czasu</span><span class="sxs-lookup"><span data-stu-id="17037-109">Understand probe count and timeout</span></span>

<span data-ttu-id="17037-110">Zachowanie sondowania zależy od:</span><span class="sxs-lookup"><span data-stu-id="17037-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="17037-111">Liczba pomyślnych sond, umożliwiających wystąpienia oznaczone jako czas.</span><span class="sxs-lookup"><span data-stu-id="17037-111">The number of successful probes that allow an instance to be labeled as up.</span></span>
* <span data-ttu-id="17037-112">Liczba nieudanych sond, powodujących wystąpienia oznaczone etykietą w dół.</span><span class="sxs-lookup"><span data-stu-id="17037-112">The number of failed probes that cause an instance to be labeled as down.</span></span>

<span data-ttu-id="17037-113">Wartość limitu czasu i częstotliwość ustawiona w SuccessFailCount określić, czy wystąpienie jest potwierdzone uruchomiona lub nie działa.</span><span class="sxs-lookup"><span data-stu-id="17037-113">The timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed to be running or not running.</span></span> <span data-ttu-id="17037-114">W portalu Azure limit czasu wynosi dwa razy wartości częstotliwości.</span><span class="sxs-lookup"><span data-stu-id="17037-114">In the Azure portal, the timeout is set to two times the value of the frequency.</span></span>

<span data-ttu-id="17037-115">Badania konfiguracji wszystkich wystąpień równoważeniem obciążenia dla punktu końcowego (czyli zestaw z równoważeniem obciążenia) muszą być takie same.</span><span class="sxs-lookup"><span data-stu-id="17037-115">The probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be the same.</span></span> <span data-ttu-id="17037-116">Oznacza to, że nie może mieć konfiguracji różnych sondowania dla każdego wystąpienia roli lub maszyny wirtualnej w tej samej usługi hostowanej kombinacji danego punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="17037-116">This means you cannot have a different probe configuration for each role instance or virtual machine in the same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="17037-117">Na przykład każde wystąpienie musi mieć identyczne porty lokalne i przekroczeń limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="17037-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="17037-118">Sonda modułu równoważenia obciążenia używa adresu IP 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="17037-118">A Load Balancer probe uses the IP address 168.63.129.16.</span></span> <span data-ttu-id="17037-119">Ten publiczny adres IP umożliwia komunikację do zasobów wewnętrznych platformy dla bring-your — właścicielem — adresu IP scenariusz sieci wirtualnej platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="17037-119">This public IP address facilitates communication to internal platform resources for the bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="17037-120">Wirtualny adres IP publicznego 168.63.129.16 jest używany we wszystkich regionach i nie zmieni się.</span><span class="sxs-lookup"><span data-stu-id="17037-120">The virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="17037-121">Firma Microsoft zaleca Zezwalaj ten adres IP w żadnych zasad zapory lokalnej.</span><span class="sxs-lookup"><span data-stu-id="17037-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="17037-122">Go nie należy traktować jako zagrożenie bezpieczeństwa, ponieważ tylko wewnętrzny platformy Azure może pobierać wiadomości z tego adresu.</span><span class="sxs-lookup"><span data-stu-id="17037-122">It should not be considered a security risk because only the internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="17037-123">Jeśli nie zrobisz, będzie nieoczekiwanego zachowania w różnych scenariuszy, takich jak konfigurowanie tego samego zakresu adresów IP 168.63.129.16 i mających zduplikowane adresy IP.</span><span class="sxs-lookup"><span data-stu-id="17037-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring the same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-the-types-of-probes"></a><span data-ttu-id="17037-124">Informacje o typach sondy</span><span class="sxs-lookup"><span data-stu-id="17037-124">Learn about the types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="17037-125">Sondowanie agenta gościa</span><span class="sxs-lookup"><span data-stu-id="17037-125">Guest agent probe</span></span>

<span data-ttu-id="17037-126">To sondowanie jest tylko dostępne dla usługi w chmurze Azure.</span><span class="sxs-lookup"><span data-stu-id="17037-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="17037-127">Moduł równoważenia obciążenia, korzysta z agenta gościa na maszynie wirtualnej i nasłuchuje i wysyła odpowiedź HTTP 200 OK tylko wtedy, gdy wystąpienie jest w stanie gotowe (to znaczy nie w innym stanu takich jak zajęty, odtwarzanie lub zatrzymywanie).</span><span class="sxs-lookup"><span data-stu-id="17037-127">Load Balancer utilizes the guest agent inside the virtual machine, and then listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="17037-128">Aby uzyskać więcej informacji, zobacz [Konfigurowanie pliku definicji usługi (csdef) dla sondy kondycji](https://msdn.microsoft.com/library/azure/ee758710.aspx) lub [rozpocząć tworzenie internetowy równoważenia obciążenia dla usług w chmurze](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="17037-128">For more information, see [Configuring the service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="17037-129">Dzięki czemu sondowanie agenta gościa, Oznacz wystąpienia swój stan jako niezdrowy?</span><span class="sxs-lookup"><span data-stu-id="17037-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="17037-130">Jeśli agent gościa nie odpowiada HTTP 200 OK, usługi równoważenia obciążenia oznacza wystąpienia jako odpowiadać i zatrzymuje wysyłania ruchu do tego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="17037-130">If the guest agent fails to respond with HTTP 200 OK, the load balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="17037-131">Moduł równoważenia obciążenia w dalszym ciągu polecenie ping z wystąpieniem.</span><span class="sxs-lookup"><span data-stu-id="17037-131">The load balancer continues to ping the instance.</span></span> <span data-ttu-id="17037-132">Jeśli agent gościa odpowie 200 protokołu HTTP, usługi równoważenia obciążenia wysyła ruch do tego wystąpienia ponownie.</span><span class="sxs-lookup"><span data-stu-id="17037-132">If the guest agent responds with an HTTP 200, the load balancer sends traffic to that instance again.</span></span>

<span data-ttu-id="17037-133">Korzystając z roli sieci web, kodu witryny sieci Web zwykle działa w w3wp.exe, który nie jest monitorowane przez usługę Azure agenta sieci szkieletowej lub gościa.</span><span class="sxs-lookup"><span data-stu-id="17037-133">When you use a web role, the website code typically runs in w3wp.exe, which is not monitored by the Azure fabric or guest agent.</span></span> <span data-ttu-id="17037-134">To oznacza, że błędów w w3wp.exe (na przykład odpowiedzi HTTP 500) nie będą raportowane do agenta gościa, a moduł równoważenia obciążenia nie będą brane danego wystąpienia poza obrotu.</span><span class="sxs-lookup"><span data-stu-id="17037-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported to the guest agent, and the load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="17037-135">Niestandardowe badanie HTTP</span><span class="sxs-lookup"><span data-stu-id="17037-135">HTTP custom probe</span></span>

<span data-ttu-id="17037-136">Niestandardowe sondę modułu równoważenia obciążenia HTTP zastąpienia domyślnej sondy agenta gościa, co oznacza, możesz utworzyć własne niestandardowej logiki do ustalenia stanu wystąpienia roli.</span><span class="sxs-lookup"><span data-stu-id="17037-136">The custom HTTP Load Balancer probe overrides the default guest agent probe, which means that you can create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="17037-137">Moduł równoważenia obciążenia sondy punktu końcowego co 15 s domyślnie.</span><span class="sxs-lookup"><span data-stu-id="17037-137">The load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="17037-138">Wystąpienie jest uważana rotacji usługi równoważenia obciążenia, gdy odpowiada z 200 protokołu HTTP przed upływem limitu czasu (w sekundach 31 domyślnie).</span><span class="sxs-lookup"><span data-stu-id="17037-138">The instance is considered to be in the load balancer rotation if it responds with an HTTP 200 within the timeout period (31 seconds by default).</span></span>

<span data-ttu-id="17037-139">Może to być przydatne w przypadku implementacji logiki można usunąć wystąpienia z obrotu usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="17037-139">This can be useful if you want to implement your own logic to remove instances from load balancer rotation.</span></span> <span data-ttu-id="17037-140">Na przykład można zdecydować, że usunięcia wystąpienia, jeśli jest ponad 90% zasobów Procesora i zwraca stan – 200.</span><span class="sxs-lookup"><span data-stu-id="17037-140">For example, you could decide to remove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="17037-141">Jeśli masz role sieci web, które używają w3wp.exe, oznacza to też, możesz uzyskać automatyczne monitorowania witryny sieci Web, ponieważ błędów w kodzie witryny sieci Web zwróci stan – 200 sondę modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="17037-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status to the load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="17037-142">Badanie niestandardowych HTTP obsługuje ścieżek względnych i tylko protokołu HTTP.</span><span class="sxs-lookup"><span data-stu-id="17037-142">The HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="17037-143">Protokół HTTPS nie jest obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="17037-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="17037-144">Co sprawia, że badanie niestandardowych HTTP oznaczyć swój stan jako niezdrowy wystąpienia?</span><span class="sxs-lookup"><span data-stu-id="17037-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="17037-145">Aplikacja HTTP zwraca kod odpowiedzi HTTP innych niż 200 (na przykład 403, 404 lub 500).</span><span class="sxs-lookup"><span data-stu-id="17037-145">The HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="17037-146">To jest dodatnią potwierdzenia, że wystąpienie aplikacji powinny być brane poza eksploatacją od razu.</span><span class="sxs-lookup"><span data-stu-id="17037-146">This is a positive acknowledgment that the application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="17037-147">Serwer HTTP nie odpowiada na wszystkich po upływie limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="17037-147">The HTTP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="17037-148">W zależności od tego, która jest ustawiona wartość limitu czasu może to oznaczać tej sondy wielu żądań bez odpowiedzi przed sondy pobiera oznaczona jako nie działa z rzeczywistym użyciem (czyli przed SuccessFailCount sond są wysyłane).</span><span class="sxs-lookup"><span data-stu-id="17037-148">Depending on the timeout value that is set, this might mean that multiple probe requests go unanswered before the probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="17037-149">Serwer zamyka połączenie za pośrednictwem resetowania TCP.</span><span class="sxs-lookup"><span data-stu-id="17037-149">The server closes the connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="17037-150">Niestandardowe sondowaniem TCP</span><span class="sxs-lookup"><span data-stu-id="17037-150">TCP custom probe</span></span>

<span data-ttu-id="17037-151">Sondy protokołu TCP nawiązania połączenia, wykonując trójstopniowego z zdefiniowany port.</span><span class="sxs-lookup"><span data-stu-id="17037-151">TCP probes initiate a connection by performing a three-way handshake with the defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="17037-152">Dzięki czemu niestandardowy sondowaniem TCP oznaczyć swój stan jako niezdrowy wystąpienia?</span><span class="sxs-lookup"><span data-stu-id="17037-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="17037-153">Serwer protokołu TCP nie odpowiada na wszystkich po upływie limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="17037-153">The TCP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="17037-154">Podczas sondowania jest oznaczony jako nieuruchomiona zależy od liczby żądań zakończonych niepowodzeniem sondowania, skonfigurowane w taki sposób, aby przejść bez odpowiedzi przed oznaczeniem sondowania jako nie działa.</span><span class="sxs-lookup"><span data-stu-id="17037-154">When the probe is marked as not running depends on the number of failed probe requests that were configured to go unanswered before marking the probe as not running.</span></span>
* <span data-ttu-id="17037-155">Sonda odbiera TCP zresetować z wystąpienia roli.</span><span class="sxs-lookup"><span data-stu-id="17037-155">The probe receives a TCP reset from the role instance.</span></span>

<span data-ttu-id="17037-156">Aby uzyskać więcej informacji o konfigurowaniu sondy kondycji protokołu HTTP lub sondowaniem TCP, zobacz [rozpocząć tworzenie internetowy równoważenia obciążenia w Menedżerze zasobów przy użyciu programu PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="17037-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="17037-157">Dodaj dobrej kondycji wystąpień do obrotu usługi równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="17037-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="17037-158">TCP i HTTP są traktowane jako dobrej kondycji i Oznacz wystąpienia roli co w przypadku dobrej kondycji:</span><span class="sxs-lookup"><span data-stu-id="17037-158">TCP and HTTP probes are considered healthy and mark the role instance as healthy when:</span></span>

* <span data-ttu-id="17037-159">Moduł równoważenia obciążenia pobiera sondę dodatnią rozruchu maszyny Wirtualnej po raz pierwszy.</span><span class="sxs-lookup"><span data-stu-id="17037-159">The load balancer gets a positive probe the first time the VM boots.</span></span>
* <span data-ttu-id="17037-160">Liczba SuccessFailCount (opisanym wcześniej) definiuje wartość pomyślne sond, które są wymagane w celu oznaczenia wystąpienia roli w dobrej kondycji.</span><span class="sxs-lookup"><span data-stu-id="17037-160">The number SuccessFailCount (described earlier) defines the value of successful probes that are required to mark the role instance as healthy.</span></span> <span data-ttu-id="17037-161">Jeśli usunięto wystąpienia roli, liczbę sond pomyślne, kolejne musi równa lub przekracza wartość SuccessFailCount, aby oznaczyć wystąpienia roli co działa.</span><span class="sxs-lookup"><span data-stu-id="17037-161">If a role instance was removed, the number of successful, successive probes must equal or exceed the value of SuccessFailCount to mark the role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="17037-162">Jeśli kondycja wystąpienia roli jest zmienne, usługi równoważenia obciążenia już czeka przed wprowadzeniem wystąpienia roli w dobrej kondycji.</span><span class="sxs-lookup"><span data-stu-id="17037-162">If the health of a role instance is fluctuating, the load balancer waits longer before putting the role instance back in the healthy state.</span></span> <span data-ttu-id="17037-163">Można to zrobić za pomocą zasady w celu ochrony infrastruktury i użytkownika.</span><span class="sxs-lookup"><span data-stu-id="17037-163">This is done via policy to protect the user and the infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="17037-164">Użyj analizy dzienników dla usługi równoważenia obciążenia</span><span class="sxs-lookup"><span data-stu-id="17037-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="17037-165">Można użyć [logowania dla usługi równoważenia obciążenia analytics](load-balancer-monitor-log.md) Aby sprawdzić stan kondycji sondowania i licznik sondy.</span><span class="sxs-lookup"><span data-stu-id="17037-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) to check on the probe health status and probe count.</span></span> <span data-ttu-id="17037-166">Rejestrowanie umożliwia z usługi Power BI lub usługi Azure Operational Insights dostarczania statystyki dotyczące stanu kondycji modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="17037-166">Logging can be used with Power BI or Azure Operational Insights to provide statistics about Load Balancer health status.</span></span>
