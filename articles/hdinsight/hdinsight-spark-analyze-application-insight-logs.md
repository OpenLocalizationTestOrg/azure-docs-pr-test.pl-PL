---
title: "aaaAnalyze szczegółowe informacje o aplikacji dzienniki z Spark - Azure HDInsight | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak tooexport szczegółowe informacje o aplikacji dzienniki tooblob magazynu, a następnie analizować dzienniki hello z platformy Spark w usłudze HDInsight."
services: hdinsight
documentationcenter: 
author: Blackmist
manager: jhubbard
editor: cgronlun
ms.assetid: 883beae6-9839-45b5-94f7-7eb0f4534ad5
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 08/15/2017
ms.author: larryfr
ms.openlocfilehash: 11ed8cf68dba8d5f9d6e4a65eba0d2b5a950cd00
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="analyze-application-insights-telemetry-logs-with-spark-on-hdinsight"></a><span data-ttu-id="42f01-103">Analizowanie dzienników telemetrii usługi Application Insights z platformy Spark w usłudze HDInsight</span><span class="sxs-lookup"><span data-stu-id="42f01-103">Analyze Application Insights telemetry logs with Spark on HDInsight</span></span>

<span data-ttu-id="42f01-104">Dowiedz się, jak Spark toouse na tooanalyze HDInsight dane telemetryczne szczegółowe informacje o aplikacji.</span><span class="sxs-lookup"><span data-stu-id="42f01-104">Learn how toouse Spark on HDInsight tooanalyze Application Insight telemetry data.</span></span>

<span data-ttu-id="42f01-105">[Visual Studio Application Insights](../application-insights/app-insights-overview.md) jest usługa analizy, który monitoruje aplikacje sieci web.</span><span class="sxs-lookup"><span data-stu-id="42f01-105">[Visual Studio Application Insights](../application-insights/app-insights-overview.md) is an analytics service that monitors your web applications.</span></span> <span data-ttu-id="42f01-106">Dane telemetryczne generowane przez usługę Application Insights może być eksportowany tooAzure magazynu.</span><span class="sxs-lookup"><span data-stu-id="42f01-106">Telemetry data generated by Application Insights can be exported tooAzure Storage.</span></span> <span data-ttu-id="42f01-107">Po hello danych w magazynie Azure HDInsight mogą być używane tooanalyze go.</span><span class="sxs-lookup"><span data-stu-id="42f01-107">Once hello data is in Azure Storage, HDInsight can be used tooanalyze it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="42f01-108">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="42f01-108">Prerequisites</span></span>

* <span data-ttu-id="42f01-109">Aplikacja, która jest skonfigurowana toouse Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-109">An application that is configured toouse Application Insights.</span></span>

* <span data-ttu-id="42f01-110">Znajomość tworzenia klastra usługi HDInsight opartej na systemie Linux.</span><span class="sxs-lookup"><span data-stu-id="42f01-110">Familiarity with creating a Linux-based HDInsight cluster.</span></span> <span data-ttu-id="42f01-111">Aby uzyskać więcej informacji, zobacz [utworzyć Spark w usłudze HDInsight](hdinsight-apache-spark-jupyter-spark-sql.md).</span><span class="sxs-lookup"><span data-stu-id="42f01-111">For more information, see [Create Spark on HDInsight](hdinsight-apache-spark-jupyter-spark-sql.md).</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="42f01-112">kroki Hello w tym dokumencie wymagają klastra usługi HDInsight, który używa systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="42f01-112">hello steps in this document require an HDInsight cluster that uses Linux.</span></span> <span data-ttu-id="42f01-113">Linux jest hello tylko system operacyjny używany w usłudze HDInsight w wersji 3.4 lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="42f01-113">Linux is hello only operating system used on HDInsight version 3.4 or greater.</span></span> <span data-ttu-id="42f01-114">Aby uzyskać więcej informacji, zobacz sekcję [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement) (Wycofanie usługi HDInsight w systemie Windows).</span><span class="sxs-lookup"><span data-stu-id="42f01-114">For more information, see [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span></span>

* <span data-ttu-id="42f01-115">Przeglądarka sieci web.</span><span class="sxs-lookup"><span data-stu-id="42f01-115">A web browser.</span></span>

<span data-ttu-id="42f01-116">Witaj następujące zasoby używane w programie tworzenia i testowania w tym dokumencie:</span><span class="sxs-lookup"><span data-stu-id="42f01-116">hello following resources were used in developing and testing this document:</span></span>

* <span data-ttu-id="42f01-117">Dane telemetrii usługi Application Insights został wygenerowany za pomocą [aplikacji sieci web Node.js skonfigurowane usługi Application Insights toouse](../application-insights/app-insights-nodejs.md).</span><span class="sxs-lookup"><span data-stu-id="42f01-117">Application Insights telemetry data was generated using a [Node.js web app configured toouse Application Insights](../application-insights/app-insights-nodejs.md).</span></span>

* <span data-ttu-id="42f01-118">Platforma Spark opartych na systemie Linux w klastrze usługi HDInsight w wersji 3.5 było używane tooanalyze hello danych.</span><span class="sxs-lookup"><span data-stu-id="42f01-118">A Linux-based Spark on HDInsight cluster version 3.5 was used tooanalyze hello data.</span></span>

## <a name="architecture-and-planning"></a><span data-ttu-id="42f01-119">Planowanie i architektura</span><span class="sxs-lookup"><span data-stu-id="42f01-119">Architecture and planning</span></span>

<span data-ttu-id="42f01-120">powitania po diagram ilustruje hello architektury usługi, w tym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="42f01-120">hello following diagram illustrates hello service architecture of this example:</span></span>

![Diagram przedstawiający dane przepływające z usługi Application Insights tooblob magazynu, a następnie przetwarzanych przez Spark w usłudze HDInsight](./media/hdinsight-spark-analyze-application-insight-logs/appinsightshdinsight.png)

### <a name="azure-storage"></a><span data-ttu-id="42f01-122">Azure Storage</span><span class="sxs-lookup"><span data-stu-id="42f01-122">Azure storage</span></span>

<span data-ttu-id="42f01-123">Usługi Application Insights może być skonfigurowany toocontinuously eksportowania telemetrii informacji tooblobs.</span><span class="sxs-lookup"><span data-stu-id="42f01-123">Application Insights can be configured toocontinuously export telemetry information tooblobs.</span></span> <span data-ttu-id="42f01-124">HDInsight można następnie odczytywane dane przechowywane w obiektach blob hello.</span><span class="sxs-lookup"><span data-stu-id="42f01-124">HDInsight can then read data stored in hello blobs.</span></span> <span data-ttu-id="42f01-125">Istnieją jednak niektóre wymagania, które należy wykonać:</span><span class="sxs-lookup"><span data-stu-id="42f01-125">However, there are some requirements that you must follow:</span></span>

* <span data-ttu-id="42f01-126">**Lokalizacja**: hello konta magazynu i HDInsight znajdują się w różnych lokalizacjach, może zwiększyć czas oczekiwania.</span><span class="sxs-lookup"><span data-stu-id="42f01-126">**Location**: If hello Storage Account and HDInsight are in different locations, it may increase latency.</span></span> <span data-ttu-id="42f01-127">Zwiększa także kosztów, opłaty za wyjście są stosowane toodata przenoszenia między regionami.</span><span class="sxs-lookup"><span data-stu-id="42f01-127">It also increases cost, as egress charges are applied toodata moving between regions.</span></span>

    > [!WARNING]
    > <span data-ttu-id="42f01-128">Używanie konta magazynu w innej lokalizacji niż HDInsight nie jest obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="42f01-128">Using a Storage Account in a different location than HDInsight is not supported.</span></span>

* <span data-ttu-id="42f01-129">**Typ obiektu blob**: HDInsight obsługuje tylko blokowe obiekty BLOB.</span><span class="sxs-lookup"><span data-stu-id="42f01-129">**Blob type**: HDInsight only supports block blobs.</span></span> <span data-ttu-id="42f01-130">Usługa Application Insights domyślnie toousing blokowych obiektów blob, dlatego powinna działać domyślnie z usługą HDInsight.</span><span class="sxs-lookup"><span data-stu-id="42f01-130">Application Insights defaults toousing block blobs, so should work by default with HDInsight.</span></span>

<span data-ttu-id="42f01-131">Informacje dotyczące dodawania istniejącego klastra usługi HDInsight tooan dodatkowego miejsca do magazynowania, zobacz hello [dodać dodatkowe konta magazynu](hdinsight-hadoop-add-storage.md) dokumentu.</span><span class="sxs-lookup"><span data-stu-id="42f01-131">For information on adding additional storage tooan existing HDInsight cluster, see hello [Add additional storage accounts](hdinsight-hadoop-add-storage.md) document.</span></span>

### <a name="data-schema"></a><span data-ttu-id="42f01-132">Schemat danych</span><span class="sxs-lookup"><span data-stu-id="42f01-132">Data schema</span></span>

<span data-ttu-id="42f01-133">Usługa Application Insights udostępnia [wyeksportować modelu danych](../application-insights/app-insights-export-data-model.md) informacje o formacie danych telemetrycznych hello wyeksportowane tooblobs.</span><span class="sxs-lookup"><span data-stu-id="42f01-133">Application Insights provides [export data model](../application-insights/app-insights-export-data-model.md) information for hello telemetry data format exported tooblobs.</span></span> <span data-ttu-id="42f01-134">Hello kroków w tym dokumencie za pomocą programu Spark SQL toowork hello danych.</span><span class="sxs-lookup"><span data-stu-id="42f01-134">hello steps in this document use Spark SQL toowork with hello data.</span></span> <span data-ttu-id="42f01-135">Spark SQL może automatycznie generować schematu dla struktury danych JSON hello zarejestrowane przez usługę Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-135">Spark SQL can automatically generate a schema for hello JSON data structure logged by Application Insights.</span></span>

## <a name="export-telemetry-data"></a><span data-ttu-id="42f01-136">Eksportowanie danych telemetrii</span><span class="sxs-lookup"><span data-stu-id="42f01-136">Export telemetry data</span></span>

<span data-ttu-id="42f01-137">Wykonaj kroki hello w [skonfigurować eksportu ciągłego](../application-insights/app-insights-export-telemetry.md) tooconfigure Twojego usługi Application Insights tooexport telemetrii informacji tooan magazynu Azure blob.</span><span class="sxs-lookup"><span data-stu-id="42f01-137">Follow hello steps in [Configure Continuous Export](../application-insights/app-insights-export-telemetry.md) tooconfigure your Application Insights tooexport telemetry information tooan Azure storage blob.</span></span>

## <a name="configure-hdinsight-tooaccess-hello-data"></a><span data-ttu-id="42f01-138">Konfigurowanie usługi HDInsight tooaccess hello danych</span><span class="sxs-lookup"><span data-stu-id="42f01-138">Configure HDInsight tooaccess hello data</span></span>

<span data-ttu-id="42f01-139">W przypadku tworzenia klastra usługi HDInsight, należy dodać konto magazynu hello podczas tworzenia klastra.</span><span class="sxs-lookup"><span data-stu-id="42f01-139">If you are creating an HDInsight cluster, add hello storage account during cluster creation.</span></span>

<span data-ttu-id="42f01-140">tooadd hello konta magazynu Azure tooan istniejącego klastra, użyj informacji hello w hello [dodać dodatkowe konta magazynu](hdinsight-hadoop-add-storage.md) dokumentu.</span><span class="sxs-lookup"><span data-stu-id="42f01-140">tooadd hello Azure Storage Account tooan existing cluster, use hello information in hello [Add additional Storage Accounts](hdinsight-hadoop-add-storage.md) document.</span></span>

## <a name="analyze-hello-data-pyspark"></a><span data-ttu-id="42f01-141">Analizowanie danych hello: PySpark</span><span class="sxs-lookup"><span data-stu-id="42f01-141">Analyze hello data: PySpark</span></span>

1. <span data-ttu-id="42f01-142">Z hello [portalu Azure](https://portal.azure.com), wybierz użytkownika Spark w klastrze usługi HDInsight.</span><span class="sxs-lookup"><span data-stu-id="42f01-142">From hello [Azure portal](https://portal.azure.com), select your Spark on HDInsight cluster.</span></span> <span data-ttu-id="42f01-143">Z hello **szybkie linki** zaznacz **pulpitów nawigacyjnych klastrów**, a następnie wybierz **notesu Jupyter** w bloku klastra Dashboard__ hello.</span><span class="sxs-lookup"><span data-stu-id="42f01-143">From hello **Quick Links** section, select **Cluster Dashboards**, and then select **Jupyter Notebook** from hello Cluster Dashboard__ blade.</span></span>

    ![Witaj pulpitów nawigacyjnych klastrów](./media/hdinsight-spark-analyze-application-insight-logs/clusterdashboards.png)

2. <span data-ttu-id="42f01-145">Witaj prawym górnym rogu strony Jupyter hello, wybierz **nowy**, a następnie **PySpark**.</span><span class="sxs-lookup"><span data-stu-id="42f01-145">In hello upper right corner of hello Jupyter page, select **New**, and then **PySpark**.</span></span> <span data-ttu-id="42f01-146">Otwiera nową kartę przeglądarki zawierające notesu Jupyter na podstawie języka Python.</span><span class="sxs-lookup"><span data-stu-id="42f01-146">A new browser tab containing a Python-based Jupyter Notebook opens.</span></span>

3. <span data-ttu-id="42f01-147">W pierwszym polu hello (nazywane **komórki**) na stronie powitania wprowadź hello następującego tekstu:</span><span class="sxs-lookup"><span data-stu-id="42f01-147">In hello first field (called a **cell**) on hello page, enter hello following text:</span></span>

   ```python
   sc._jsc.hadoopConfiguration().set('mapreduce.input.fileinputformat.input.dir.recursive', 'true')
   ```

    <span data-ttu-id="42f01-148">Ten kod konfiguruje strukturę katalogów Spark toorecursively dostępu hello hello danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="42f01-148">This code configures Spark toorecursively access hello directory structure for hello input data.</span></span> <span data-ttu-id="42f01-149">Telemetrię usługi Application Insights jest rejestrowane tooa katalogu struktury podobne toohello `/{telemetry type}/YYYY-MM-DD/{##}/`.</span><span class="sxs-lookup"><span data-stu-id="42f01-149">Application Insights telemetry is logged tooa directory structure similar toohello `/{telemetry type}/YYYY-MM-DD/{##}/`.</span></span>

4. <span data-ttu-id="42f01-150">Użyj **SHIFT + ENTER** toorun hello kodu.</span><span class="sxs-lookup"><span data-stu-id="42f01-150">Use **SHIFT+ENTER** toorun hello code.</span></span> <span data-ttu-id="42f01-151">Na powitania po lewej stronie komórki Witaj "\*" pojawia się między tooindicate nawiasy hello jest wykonywana hello kodu w tej komórce.</span><span class="sxs-lookup"><span data-stu-id="42f01-151">On hello left side of hello cell, an '\*' appears between hello brackets tooindicate that hello code in this cell is being executed.</span></span> <span data-ttu-id="42f01-152">Po zakończeniu instalacji hello "\*" zmienia numer tooa i dane wyjściowe podobne toohello następującego tekstu jest wyświetlana poniżej komórki hello:</span><span class="sxs-lookup"><span data-stu-id="42f01-152">Once it completes, hello '\*' changes tooa number, and output similar toohello following text is displayed below hello cell:</span></span>

        Creating SparkContext as 'sc'

        ID    YARN Application ID    Kind    State    Spark UI    Driver log    Current session?
        3    application_1468969497124_0001    pyspark    idle    Link    Link    ✔

        Creating HiveContext as 'sqlContext'
        SparkContext and HiveContext created. Executing user code ...
5. <span data-ttu-id="42f01-153">Nowe komórki jest tworzony poniżej hello pierwszy z nich.</span><span class="sxs-lookup"><span data-stu-id="42f01-153">A new cell is created below hello first one.</span></span> <span data-ttu-id="42f01-154">Wprowadź powitania po tekst w komórce nowe hello.</span><span class="sxs-lookup"><span data-stu-id="42f01-154">Enter hello following text in hello new cell.</span></span> <span data-ttu-id="42f01-155">Zastąp `CONTAINER` i `STORAGEACCOUNT` z nazwą konta magazynu Azure hello i nazwa kontenera obiektów blob, który zawiera dane usługi Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-155">Replace `CONTAINER` and `STORAGEACCOUNT` with hello Azure storage account name and blob container name that contains Application Insights data.</span></span>

   ```python
   %%bash
   hdfs dfs -ls wasb://CONTAINER@STORAGEACCOUNT.blob.core.windows.net/
   ```

    <span data-ttu-id="42f01-156">Użyj **SHIFT + ENTER** tooexecute tej komórki.</span><span class="sxs-lookup"><span data-stu-id="42f01-156">Use **SHIFT+ENTER** tooexecute this cell.</span></span> <span data-ttu-id="42f01-157">Zostanie wyświetlony wynik toohello podobne, następującego tekstu:</span><span class="sxs-lookup"><span data-stu-id="42f01-157">You see a result similar toohello following text:</span></span>

        Found 1 items
        drwxrwxrwx   -          0 1970-01-01 00:00 wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_2bededa61bc741fbdee6b556571a4831

    <span data-ttu-id="42f01-158">Ścieżka wasb Hello zwrócona jest lokalizacja hello hello danych telemetrii usługi Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-158">hello wasb path returned is hello location of hello Application Insights telemetry data.</span></span> <span data-ttu-id="42f01-159">Zmień hello `hdfs dfs -ls` wiersz zwrócony hello komórki toouse hello wasb ścieżki, a następnie użyj **SHIFT + ENTER** toorun hello ponownie komórki.</span><span class="sxs-lookup"><span data-stu-id="42f01-159">Change hello `hdfs dfs -ls` line in hello cell toouse hello wasb path returned, and then use **SHIFT+ENTER** toorun hello cell again.</span></span> <span data-ttu-id="42f01-160">Teraz, wyniki hello powinien być wyświetlany hello katalogi, które zawierają dane telemetryczne.</span><span class="sxs-lookup"><span data-stu-id="42f01-160">This time, hello results should display hello directories that contain telemetry data.</span></span>

   > [!NOTE]
   > <span data-ttu-id="42f01-161">Dla pozostałych hello hello kroki opisane w tej sekcji, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` użyto katalogu.</span><span class="sxs-lookup"><span data-stu-id="42f01-161">For hello remainder of hello steps in this section, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` directory was used.</span></span> <span data-ttu-id="42f01-162">Struktury katalogów mogą się różnić.</span><span class="sxs-lookup"><span data-stu-id="42f01-162">Your directory structure may be different.</span></span>

6. <span data-ttu-id="42f01-163">W następnej komórki hello, wprowadź hello następującego kodu: Zastąp `WASB_PATH` ze ścieżką hello hello w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="42f01-163">In hello next cell, enter hello following code: Replace `WASB_PATH` with hello path from hello previous step.</span></span>

   ```python
   jsonFiles = sc.textFile('WASB_PATH')
   jsonData = sqlContext.read.json(jsonFiles)
   ```

    <span data-ttu-id="42f01-164">Ten kod tworzy dataframe z hello wyeksportowane przez hello Eksport ciągły proces pliki w formacie JSON.</span><span class="sxs-lookup"><span data-stu-id="42f01-164">This code creates a dataframe from hello JSON files exported by hello continuous export process.</span></span> <span data-ttu-id="42f01-165">Użyj **SHIFT + ENTER** toorun tej komórki.</span><span class="sxs-lookup"><span data-stu-id="42f01-165">Use **SHIFT+ENTER** toorun this cell.</span></span>
7. <span data-ttu-id="42f01-166">W następnej komórki hello wprowadź i uruchom powitania po tooview hello schematu, Spark utworzony hello JSON plików:</span><span class="sxs-lookup"><span data-stu-id="42f01-166">In hello next cell, enter and run hello following tooview hello schema that Spark created for hello JSON files:</span></span>

   ```python
   jsonData.printSchema()
   ```

    <span data-ttu-id="42f01-167">Witaj schematu dla każdego typu danych telemetrycznych różni się.</span><span class="sxs-lookup"><span data-stu-id="42f01-167">hello schema for each type of telemetry is different.</span></span> <span data-ttu-id="42f01-168">Witaj poniższym przykładzie jest hello schematem generowany dla żądań sieci web (dane przechowywane w hello `Requests` podkatalogu):</span><span class="sxs-lookup"><span data-stu-id="42f01-168">hello following example is hello schema that is generated for web requests (data stored in hello `Requests` subdirectory):</span></span>

        root
        |-- context: struct (nullable = true)
        |    |-- application: struct (nullable = true)
        |    |    |-- version: string (nullable = true)
        |    |-- custom: struct (nullable = true)
        |    |    |-- dimensions: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |    |-- metrics: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- eventTime: string (nullable = true)
        |    |    |-- isSynthetic: boolean (nullable = true)
        |    |    |-- samplingRate: double (nullable = true)
        |    |    |-- syntheticSource: string (nullable = true)
        |    |-- device: struct (nullable = true)
        |    |    |-- browser: string (nullable = true)
        |    |    |-- browserVersion: string (nullable = true)
        |    |    |-- deviceModel: string (nullable = true)
        |    |    |-- deviceName: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- osVersion: string (nullable = true)
        |    |    |-- type: string (nullable = true)
        |    |-- location: struct (nullable = true)
        |    |    |-- city: string (nullable = true)
        |    |    |-- clientip: string (nullable = true)
        |    |    |-- continent: string (nullable = true)
        |    |    |-- country: string (nullable = true)
        |    |    |-- province: string (nullable = true)
        |    |-- operation: struct (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |-- session: struct (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- isFirst: boolean (nullable = true)
        |    |-- user: struct (nullable = true)
        |    |    |-- anonId: string (nullable = true)
        |    |    |-- isAuthenticated: boolean (nullable = true)
        |-- internal: struct (nullable = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- documentVersion: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |-- request: array (nullable = true)
        |    |-- element: struct (containsNull = true)
        |    |    |-- count: long (nullable = true)
        |    |    |-- durationMetric: struct (nullable = true)
        |    |    |    |-- count: double (nullable = true)
        |    |    |    |-- max: double (nullable = true)
        |    |    |    |-- min: double (nullable = true)
        |    |    |    |-- sampledValue: double (nullable = true)
        |    |    |    |-- stdDev: double (nullable = true)
        |    |    |    |-- value: double (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |    |-- responseCode: long (nullable = true)
        |    |    |-- success: boolean (nullable = true)
        |    |    |-- url: string (nullable = true)
        |    |    |-- urlData: struct (nullable = true)
        |    |    |    |-- base: string (nullable = true)
        |    |    |    |-- hashTag: string (nullable = true)
        |    |    |    |-- host: string (nullable = true)
        |    |    |    |-- protocol: string (nullable = true)
8. <span data-ttu-id="42f01-169">Użyj powitania po dataframe hello tooregister jako tabeli tymczasowej i uruchomienie na powitania danych zapytania:</span><span class="sxs-lookup"><span data-stu-id="42f01-169">Use hello following tooregister hello dataframe as a temporary table and run a query against hello data:</span></span>

   ```python
   jsonData.registerTempTable("requests")
   df = sqlContext.sql("select context.location.city from requests where context.location.city is not null")
   df.show()
   ```

    <span data-ttu-id="42f01-170">To zapytanie zwraca informacje Miasto hello hello górny 20 rekordów, w którym context.location.city nie jest zerowa.</span><span class="sxs-lookup"><span data-stu-id="42f01-170">This query returns hello city information for hello top 20 records where context.location.city is not null.</span></span>

   > [!NOTE]
   > <span data-ttu-id="42f01-171">Struktura kontekstu Hello znajduje się w wszystkie dane telemetryczne zarejestrowane przez usługę Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-171">hello context structure is present in all telemetry logged by Application Insights.</span></span> <span data-ttu-id="42f01-172">element Miasto Hello może nie można wypełnić w dziennikach.</span><span class="sxs-lookup"><span data-stu-id="42f01-172">hello city element may not be populated in your logs.</span></span> <span data-ttu-id="42f01-173">Użyj tooidentify schematu hello inne elementy, które można wykonać zapytanie zawierające dane dla dzienników.</span><span class="sxs-lookup"><span data-stu-id="42f01-173">Use hello schema tooidentify other elements that you can query that may contain data for your logs.</span></span>

    <span data-ttu-id="42f01-174">Ta kwerenda zwraca informacje toohello podobne następującego tekstu:</span><span class="sxs-lookup"><span data-stu-id="42f01-174">This query returns information similar toohello following text:</span></span>

        +---------+
        |     city|
        +---------+
        | Bellevue|
        |  Redmond|
        |  Seattle|
        |Charlotte|
        ...
        +---------+

## <a name="analyze-hello-data-scala"></a><span data-ttu-id="42f01-175">Analizowanie danych hello: Scala</span><span class="sxs-lookup"><span data-stu-id="42f01-175">Analyze hello data: Scala</span></span>

1. <span data-ttu-id="42f01-176">Z hello [portalu Azure](https://portal.azure.com), wybierz użytkownika Spark w klastrze usługi HDInsight.</span><span class="sxs-lookup"><span data-stu-id="42f01-176">From hello [Azure portal](https://portal.azure.com), select your Spark on HDInsight cluster.</span></span> <span data-ttu-id="42f01-177">Z hello **szybkie linki** zaznacz **pulpitów nawigacyjnych klastrów**, a następnie wybierz **notesu Jupyter** w bloku klastra Dashboard__ hello.</span><span class="sxs-lookup"><span data-stu-id="42f01-177">From hello **Quick Links** section, select **Cluster Dashboards**, and then select **Jupyter Notebook** from hello Cluster Dashboard__ blade.</span></span>

    ![Witaj pulpitów nawigacyjnych klastrów](./media/hdinsight-spark-analyze-application-insight-logs/clusterdashboards.png)
2. <span data-ttu-id="42f01-179">Witaj prawym górnym rogu strony Jupyter hello, wybierz **nowy**, a następnie **Scala**.</span><span class="sxs-lookup"><span data-stu-id="42f01-179">In hello upper right corner of hello Jupyter page, select **New**, and then **Scala**.</span></span> <span data-ttu-id="42f01-180">Pojawi się na nowej karcie przeglądarki zawierające notesu Jupyter opartych na języku Scala.</span><span class="sxs-lookup"><span data-stu-id="42f01-180">A new browser tab containing a Scala-based Jupyter Notebook appears.</span></span>
3. <span data-ttu-id="42f01-181">W pierwszym polu hello (nazywane **komórki**) na stronie powitania wprowadź hello następującego tekstu:</span><span class="sxs-lookup"><span data-stu-id="42f01-181">In hello first field (called a **cell**) on hello page, enter hello following text:</span></span>

   ```scala
   sc.hadoopConfiguration.set("mapreduce.input.fileinputformat.input.dir.recursive", "true")
   ```

    <span data-ttu-id="42f01-182">Ten kod konfiguruje strukturę katalogów Spark toorecursively dostępu hello hello danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="42f01-182">This code configures Spark toorecursively access hello directory structure for hello input data.</span></span> <span data-ttu-id="42f01-183">Telemetrii usługi Application Insights rejestrowane za podobną strukturę katalogów tooa`/{telemetry type}/YYYY-MM-DD/{##}/`.</span><span class="sxs-lookup"><span data-stu-id="42f01-183">Application Insights telemetry is logged tooa directory structure similar too`/{telemetry type}/YYYY-MM-DD/{##}/`.</span></span>

4. <span data-ttu-id="42f01-184">Użyj **SHIFT + ENTER** toorun hello kodu.</span><span class="sxs-lookup"><span data-stu-id="42f01-184">Use **SHIFT+ENTER** toorun hello code.</span></span> <span data-ttu-id="42f01-185">Na powitania po lewej stronie komórki Witaj "\*" pojawia się między tooindicate nawiasy hello jest wykonywana hello kodu w tej komórce.</span><span class="sxs-lookup"><span data-stu-id="42f01-185">On hello left side of hello cell, an '\*' appears between hello brackets tooindicate that hello code in this cell is being executed.</span></span> <span data-ttu-id="42f01-186">Po zakończeniu instalacji hello "\*" zmienia numer tooa i dane wyjściowe podobne toohello następującego tekstu jest wyświetlana poniżej komórki hello:</span><span class="sxs-lookup"><span data-stu-id="42f01-186">Once it completes, hello '\*' changes tooa number, and output similar toohello following text is displayed below hello cell:</span></span>

        Creating SparkContext as 'sc'

        ID    YARN Application ID    Kind    State    Spark UI    Driver log    Current session?
        3    application_1468969497124_0001    spark    idle    Link    Link    ✔

        Creating HiveContext as 'sqlContext'
        SparkContext and HiveContext created. Executing user code ...
5. <span data-ttu-id="42f01-187">Nowe komórki jest tworzony poniżej hello pierwszy z nich.</span><span class="sxs-lookup"><span data-stu-id="42f01-187">A new cell is created below hello first one.</span></span> <span data-ttu-id="42f01-188">Wprowadź powitania po tekst w komórce nowe hello.</span><span class="sxs-lookup"><span data-stu-id="42f01-188">Enter hello following text in hello new cell.</span></span> <span data-ttu-id="42f01-189">Zastąp `CONTAINER` i `STORAGEACCOUNT` z nazwą konta magazynu Azure hello i nazwa kontenera obiektów blob, który zawiera usługi Application Insights dzienniki.</span><span class="sxs-lookup"><span data-stu-id="42f01-189">Replace `CONTAINER` and `STORAGEACCOUNT` with hello Azure storage account name and blob container name that contains Application Insights logs.</span></span>

   ```scala
   %%bash
   hdfs dfs -ls wasb://CONTAINER@STORAGEACCOUNT.blob.core.windows.net/
   ```

    <span data-ttu-id="42f01-190">Użyj **SHIFT + ENTER** tooexecute tej komórki.</span><span class="sxs-lookup"><span data-stu-id="42f01-190">Use **SHIFT+ENTER** tooexecute this cell.</span></span> <span data-ttu-id="42f01-191">Zostanie wyświetlony wynik toohello podobne, następującego tekstu:</span><span class="sxs-lookup"><span data-stu-id="42f01-191">You see a result similar toohello following text:</span></span>

        Found 1 items
        drwxrwxrwx   -          0 1970-01-01 00:00 wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_2bededa61bc741fbdee6b556571a4831

    <span data-ttu-id="42f01-192">Ścieżka wasb Hello zwrócona jest lokalizacja hello hello danych telemetrii usługi Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-192">hello wasb path returned is hello location of hello Application Insights telemetry data.</span></span> <span data-ttu-id="42f01-193">Zmień hello `hdfs dfs -ls` wiersz zwrócony hello komórki toouse hello wasb ścieżki, a następnie użyj **SHIFT + ENTER** toorun hello ponownie komórki.</span><span class="sxs-lookup"><span data-stu-id="42f01-193">Change hello `hdfs dfs -ls` line in hello cell toouse hello wasb path returned, and then use **SHIFT+ENTER** toorun hello cell again.</span></span> <span data-ttu-id="42f01-194">Teraz, wyniki hello powinien być wyświetlany hello katalogi, które zawierają dane telemetryczne.</span><span class="sxs-lookup"><span data-stu-id="42f01-194">This time, hello results should display hello directories that contain telemetry data.</span></span>

   > [!NOTE]
   > <span data-ttu-id="42f01-195">Dla pozostałych hello hello kroki opisane w tej sekcji, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` użyto katalogu.</span><span class="sxs-lookup"><span data-stu-id="42f01-195">For hello remainder of hello steps in this section, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` directory was used.</span></span> <span data-ttu-id="42f01-196">Ten katalog nie istnieje, chyba że jest dane telemetryczne dla aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="42f01-196">This directory may not exist unless your telemetry data is for a web app.</span></span>

6. <span data-ttu-id="42f01-197">W następnej komórki hello, wprowadź hello następującego kodu: Zastąp `WASB\_PATH` ze ścieżką hello hello w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="42f01-197">In hello next cell, enter hello following code: Replace `WASB\_PATH` with hello path from hello previous step.</span></span>

   ```scala
   var jsonFiles = sc.textFile('WASB_PATH')
   val sqlContext = new org.apache.spark.sql.SQLContext(sc)
   var jsonData = sqlContext.read.json(jsonFiles)
   ```

    <span data-ttu-id="42f01-198">Ten kod tworzy dataframe z hello wyeksportowane przez hello Eksport ciągły proces pliki w formacie JSON.</span><span class="sxs-lookup"><span data-stu-id="42f01-198">This code creates a dataframe from hello JSON files exported by hello continuous export process.</span></span> <span data-ttu-id="42f01-199">Użyj **SHIFT + ENTER** toorun tej komórki.</span><span class="sxs-lookup"><span data-stu-id="42f01-199">Use **SHIFT+ENTER** toorun this cell.</span></span>

7. <span data-ttu-id="42f01-200">W następnej komórki hello wprowadź i uruchom powitania po tooview hello schematu, Spark utworzony hello JSON plików:</span><span class="sxs-lookup"><span data-stu-id="42f01-200">In hello next cell, enter and run hello following tooview hello schema that Spark created for hello JSON files:</span></span>

   ```scala
   jsonData.printSchema
   ```

    <span data-ttu-id="42f01-201">Witaj schematu dla każdego typu danych telemetrycznych różni się.</span><span class="sxs-lookup"><span data-stu-id="42f01-201">hello schema for each type of telemetry is different.</span></span> <span data-ttu-id="42f01-202">Witaj poniższym przykładzie jest hello schematem generowany dla żądań sieci web (dane przechowywane w hello `Requests` podkatalogu):</span><span class="sxs-lookup"><span data-stu-id="42f01-202">hello following example is hello schema that is generated for web requests (data stored in hello `Requests` subdirectory):</span></span>

        root
        |-- context: struct (nullable = true)
        |    |-- application: struct (nullable = true)
        |    |    |-- version: string (nullable = true)
        |    |-- custom: struct (nullable = true)
        |    |    |-- dimensions: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |    |-- metrics: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- eventTime: string (nullable = true)
        |    |    |-- isSynthetic: boolean (nullable = true)
        |    |    |-- samplingRate: double (nullable = true)
        |    |    |-- syntheticSource: string (nullable = true)
        |    |-- device: struct (nullable = true)
        |    |    |-- browser: string (nullable = true)
        |    |    |-- browserVersion: string (nullable = true)
        |    |    |-- deviceModel: string (nullable = true)
        |    |    |-- deviceName: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- osVersion: string (nullable = true)
        |    |    |-- type: string (nullable = true)
        |    |-- location: struct (nullable = true)
        |    |    |-- city: string (nullable = true)
        |    |    |-- clientip: string (nullable = true)
        |    |    |-- continent: string (nullable = true)
        |    |    |-- country: string (nullable = true)
        |    |    |-- province: string (nullable = true)
        |    |-- operation: struct (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |-- session: struct (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- isFirst: boolean (nullable = true)
        |    |-- user: struct (nullable = true)
        |    |    |-- anonId: string (nullable = true)
        |    |    |-- isAuthenticated: boolean (nullable = true)
        |-- internal: struct (nullable = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- documentVersion: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |-- request: array (nullable = true)
        |    |-- element: struct (containsNull = true)
        |    |    |-- count: long (nullable = true)
        |    |    |-- durationMetric: struct (nullable = true)
        |    |    |    |-- count: double (nullable = true)
        |    |    |    |-- max: double (nullable = true)
        |    |    |    |-- min: double (nullable = true)
        |    |    |    |-- sampledValue: double (nullable = true)
        |    |    |    |-- stdDev: double (nullable = true)
        |    |    |    |-- value: double (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |    |-- responseCode: long (nullable = true)
        |    |    |-- success: boolean (nullable = true)
        |    |    |-- url: string (nullable = true)
        |    |    |-- urlData: struct (nullable = true)
        |    |    |    |-- base: string (nullable = true)
        |    |    |    |-- hashTag: string (nullable = true)
        |    |    |    |-- host: string (nullable = true)
        |    |    |    |-- protocol: string (nullable = true)

8. <span data-ttu-id="42f01-203">Użyj powitania po dataframe hello tooregister jako tabeli tymczasowej i uruchomienie na powitania danych zapytania:</span><span class="sxs-lookup"><span data-stu-id="42f01-203">Use hello following tooregister hello dataframe as a temporary table and run a query against hello data:</span></span>

   ```scala
   jsonData.registerTempTable("requests")
   var city = sqlContext.sql("select context.location.city from requests where context.location.city is not null limit 10").show()
   ```

    <span data-ttu-id="42f01-204">To zapytanie zwraca informacje Miasto hello hello górny 20 rekordów, w którym context.location.city nie jest zerowa.</span><span class="sxs-lookup"><span data-stu-id="42f01-204">This query returns hello city information for hello top 20 records where context.location.city is not null.</span></span>

   > [!NOTE]
   > <span data-ttu-id="42f01-205">Struktura kontekstu Hello znajduje się w wszystkie dane telemetryczne zarejestrowane przez usługę Application Insights.</span><span class="sxs-lookup"><span data-stu-id="42f01-205">hello context structure is present in all telemetry logged by Application Insights.</span></span> <span data-ttu-id="42f01-206">element Miasto Hello może nie można wypełnić w dziennikach.</span><span class="sxs-lookup"><span data-stu-id="42f01-206">hello city element may not be populated in your logs.</span></span> <span data-ttu-id="42f01-207">Użyj tooidentify schematu hello inne elementy, które można wykonać zapytanie zawierające dane dla dzienników.</span><span class="sxs-lookup"><span data-stu-id="42f01-207">Use hello schema tooidentify other elements that you can query that may contain data for your logs.</span></span>
   >
   >

    <span data-ttu-id="42f01-208">Ta kwerenda zwraca informacje toohello podobne następującego tekstu:</span><span class="sxs-lookup"><span data-stu-id="42f01-208">This query returns information similar toohello following text:</span></span>

        +---------+
        |     city|
        +---------+
        | Bellevue|
        |  Redmond|
        |  Seattle|
        |Charlotte|
        ...
        +---------+

## <a name="next-steps"></a><span data-ttu-id="42f01-209">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="42f01-209">Next steps</span></span>

<span data-ttu-id="42f01-210">Więcej przykładów dotyczących przy użyciu Spark toowork przy użyciu danych i usług Azure Zobacz hello w następujących dokumentach:</span><span class="sxs-lookup"><span data-stu-id="42f01-210">For more examples of using Spark toowork with data and services in Azure, see hello following documents:</span></span>

* [<span data-ttu-id="42f01-211">Platforma Spark i analiza biznesowa: interakcyjna analiza danych na platformie Spark w usłudze HDInsight z użyciem narzędzi do analizy biznesowej</span><span class="sxs-lookup"><span data-stu-id="42f01-211">Spark with BI: Perform interactive data analysis using Spark in HDInsight with BI tools</span></span>](hdinsight-apache-spark-use-bi-tools.md)
* [<span data-ttu-id="42f01-212">Platforma Spark i usługa Machine Learning: korzystanie z platformy Spark w usłudze HDInsight do analizy temperatury w budynku z użyciem danych HVAC</span><span class="sxs-lookup"><span data-stu-id="42f01-212">Spark with Machine Learning: Use Spark in HDInsight for analyzing building temperature using HVAC data</span></span>](hdinsight-apache-spark-ipython-notebook-machine-learning.md)
* [<span data-ttu-id="42f01-213">Platforma Spark przy użyciu Machine Learning: Korzystanie z platformy Spark w wyników inspekcji żywności toopredict HDInsight</span><span class="sxs-lookup"><span data-stu-id="42f01-213">Spark with Machine Learning: Use Spark in HDInsight toopredict food inspection results</span></span>](hdinsight-apache-spark-machine-learning-mllib-ipython.md)
* [<span data-ttu-id="42f01-214">Przesyłanie strumieniowe Spark: Korzystanie z platformy Spark w usłudze HDInsight do tworzenia aplikacji przesyłania strumieniowego</span><span class="sxs-lookup"><span data-stu-id="42f01-214">Spark Streaming: Use Spark in HDInsight for building streaming applications</span></span>](hdinsight-apache-spark-eventhub-streaming.md)
* [<span data-ttu-id="42f01-215">Analiza dzienników witryny sieci Web na platformie Spark w usłudze HDInsight</span><span class="sxs-lookup"><span data-stu-id="42f01-215">Website log analysis using Spark in HDInsight</span></span>](hdinsight-apache-spark-custom-library-website-log-analysis.md)

<span data-ttu-id="42f01-216">Aby uzyskać informacje na temat tworzenia i uruchamiania aplikacji Spark Zobacz hello w następujących dokumentach:</span><span class="sxs-lookup"><span data-stu-id="42f01-216">For information on creating and running Spark applications, see hello following documents:</span></span>

* [<span data-ttu-id="42f01-217">Tworzenie autonomicznych aplikacji przy użyciu języka Scala</span><span class="sxs-lookup"><span data-stu-id="42f01-217">Create a standalone application using Scala</span></span>](hdinsight-apache-spark-create-standalone-application.md)
* [<span data-ttu-id="42f01-218">Zdalne uruchamianie zadań w klastrze Spark przy użyciu programu Livy</span><span class="sxs-lookup"><span data-stu-id="42f01-218">Run jobs remotely on a Spark cluster using Livy</span></span>](hdinsight-apache-spark-livy-rest-interface.md)
