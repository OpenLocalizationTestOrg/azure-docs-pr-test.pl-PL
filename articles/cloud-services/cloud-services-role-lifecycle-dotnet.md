---
title: "Obsługi zdarzeń cyklu życia usługi w chmurze | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak metod cyklu życia roli usługi w chmurze można użyć w .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: eb78c05df3b3cdf3887334c11bdabd5cebb74747
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="customize-the-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="d997b-103">Dostosowywanie cyklu życia roli Sieć Web lub Proces roboczy na platformie .NET</span><span class="sxs-lookup"><span data-stu-id="d997b-103">Customize the Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="d997b-104">Podczas tworzenia roli procesu roboczego, można rozszerzyć [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) klasy, która udostępnia metody pominięcia, które pozwalają na odpowiadanie na zdarzenia cyklu życia.</span><span class="sxs-lookup"><span data-stu-id="d997b-104">When you create a worker role, you extend the [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you to override that let you respond to lifecycle events.</span></span> <span data-ttu-id="d997b-105">Dla ról sieć web tej klasy jest opcjonalny, dlatego możesz korzystać na odpowiadanie na zdarzenia cyklu życia.</span><span class="sxs-lookup"><span data-stu-id="d997b-105">For web roles this class is optional, so you must use it to respond to lifecycle events.</span></span>

## <a name="extend-the-roleentrypoint-class"></a><span data-ttu-id="d997b-106">Rozszerzenie klasy RoleEntryPoint</span><span class="sxs-lookup"><span data-stu-id="d997b-106">Extend the RoleEntryPoint class</span></span>
<span data-ttu-id="d997b-107">[RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) klasa zawiera metody, które są wywoływane przez platformę Azure podczas jego **uruchamia**, **uruchamia**, lub **zatrzymuje** roli sieci web lub procesu roboczego.</span><span class="sxs-lookup"><span data-stu-id="d997b-107">The [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="d997b-108">Opcjonalnie można zastąpić te metody do zarządzania roli inicjowania, roli zamknięcia sekwencji lub wątku wykonawczego roli.</span><span class="sxs-lookup"><span data-stu-id="d997b-108">You can optionally override these methods to manage role initialization, role shutdown sequences, or the execution thread of the role.</span></span> 

<span data-ttu-id="d997b-109">Podczas rozszerzania **RoleEntryPoint**, należy zwrócić uwagę na następujące metody:</span><span class="sxs-lookup"><span data-stu-id="d997b-109">When extending **RoleEntryPoint**, you should be aware of the following behaviors of the methods:</span></span>

* <span data-ttu-id="d997b-110">[OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) i [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) metody zwracać wartość logiczną, można powrócić **false** z tych metod.</span><span class="sxs-lookup"><span data-stu-id="d997b-110">The [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible to return **false** from these methods.</span></span>
  
   <span data-ttu-id="d997b-111">Jeśli kod zwraca **false**, nagle zakończenia procesu roli, bez konieczności uruchamiania żadnych zamykania może być w miejscu.</span><span class="sxs-lookup"><span data-stu-id="d997b-111">If your code returns **false**, the role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="d997b-112">Ogólnie rzecz biorąc, należy unikać zwracanie **false** z **OnStart** metody.</span><span class="sxs-lookup"><span data-stu-id="d997b-112">In general, you should avoid returning **false** from the **OnStart** method.</span></span>
* <span data-ttu-id="d997b-113">Wszelkie nieprzechwycony wyjątek w obrębie przeciążenia **RoleEntryPoint** metoda jest traktowana jako nieobsługiwany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="d997b-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="d997b-114">Jeśli wystąpi wyjątek w jednej z metod cyklu życia, Azure zostanie podniesiony [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) zdarzeń, a następnie proces zostanie zakończony.</span><span class="sxs-lookup"><span data-stu-id="d997b-114">If an exception occurs within one of the lifecycle methods, Azure will raise the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then the process is terminated.</span></span> <span data-ttu-id="d997b-115">Po roli użytkownika został przełączony w tryb offline, zostanie ono uruchomione na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="d997b-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="d997b-116">Gdy wystąpi nieobsługiwany wyjątek, [zatrzymywanie](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) nie zdarzenia i **OnStop** nie jest wywoływana metoda.</span><span class="sxs-lookup"><span data-stu-id="d997b-116">When an unhandled exception occurs, the [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and the **OnStop** method is not called.</span></span>

<span data-ttu-id="d997b-117">Jeśli roli użytkownika nie można uruchomić lub jest odtwarzania między inicjowanie zajęte, a stanów zatrzymywania, kodu może zgłaszanie nieobsługiwany wyjątek w obrębie jednego zdarzenia cyklu życia każdej roli ponownym uruchomieniu.</span><span class="sxs-lookup"><span data-stu-id="d997b-117">If your role does not start, or is recycling between the initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of the lifecycle events each time the role restarts.</span></span> <span data-ttu-id="d997b-118">W takim przypadku należy użyć [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) zdarzenie, aby ustalić przyczynę wyjątku i odpowiednią obsługę.</span><span class="sxs-lookup"><span data-stu-id="d997b-118">In this case, use the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event to determine the cause of the exception and handle it appropriately.</span></span> <span data-ttu-id="d997b-119">Roli użytkownika może też zwracać z [Uruchom](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) metodę, która powoduje, że rola do ponownego uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="d997b-119">Your role may also be returning from the [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes the role to restart.</span></span> <span data-ttu-id="d997b-120">Aby uzyskać więcej informacji na temat stanów wdrożenia, zobacz [typowe problemy z którego przyczyna role do odtworzenia](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="d997b-120">For more information about deployment states, see [Common Issues Which Cause Roles to Recycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="d997b-121">Jeśli używasz **Azure Tools dla programu Microsoft Visual Studio** do tworzenia aplikacji, automatycznie rozszerzenia szablonów projektu roli **RoleEntryPoint** klasy, w *WebRole.cs* i *WorkerRole.cs* plików.</span><span class="sxs-lookup"><span data-stu-id="d997b-121">If you are using the **Azure Tools for Microsoft Visual Studio** to develop your application, the role project templates automatically extend the **RoleEntryPoint** class for you, in the *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="d997b-122">OnStart — metoda</span><span class="sxs-lookup"><span data-stu-id="d997b-122">OnStart method</span></span>
<span data-ttu-id="d997b-123">**OnStart** metoda jest wywoływana, gdy wystąpienie roli w tryb online na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="d997b-123">The **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="d997b-124">Podczas wykonywania kodu OnStart wystąpienia roli jest oznaczony jako **zajęty** i żaden ruch zewnętrzny zostanie skierowany do niej przez moduł równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="d997b-124">While the OnStart code is executing, the role instance is marked as **Busy** and no external traffic will be directed to it by the load balancer.</span></span> <span data-ttu-id="d997b-125">Należy przesłonić tę metodę do wykonywania pracy inicjowania, takie jak wdrażanie programów obsługi zdarzeń i uruchamianie [diagnostyki Azure](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="d997b-125">You can override this method to perform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="d997b-126">Jeśli **OnStart** zwraca **true**, wystąpienie został pomyślnie zainicjowany i Azure wywołuje **RoleEntryPoint.Run** metody.</span><span class="sxs-lookup"><span data-stu-id="d997b-126">If **OnStart** returns **true**, the instance is successfully initialized and Azure calls the **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="d997b-127">Jeśli **OnStart** zwraca **false**, roli kończy się bezpośrednio, bez wykonywania żadnych planowanego zamknięcia sekwencji.</span><span class="sxs-lookup"><span data-stu-id="d997b-127">If **OnStart** returns **false**, the role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="d997b-128">Poniższy przykładowy kod przedstawia sposób przesłonięcia **OnStart** metody.</span><span class="sxs-lookup"><span data-stu-id="d997b-128">The following code example shows how to override the **OnStart** method.</span></span> <span data-ttu-id="d997b-129">Ta metoda umożliwia skonfigurowanie i rozpoczyna się monitora diagnostycznego w momencie wystąpienia roli uruchamia i konfiguruje transferu danych logowania do konta magazynu:</span><span class="sxs-lookup"><span data-stu-id="d997b-129">This method configures and starts a diagnostic monitor when the role instance starts and sets up a transfer of logging data to a storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="d997b-130">OnStop — metoda</span><span class="sxs-lookup"><span data-stu-id="d997b-130">OnStop method</span></span>
<span data-ttu-id="d997b-131">**OnStop** metoda jest wywoływana po wystąpienia roli została podjęta w trybie offline przez platformę Azure i przed kończy proces.</span><span class="sxs-lookup"><span data-stu-id="d997b-131">The **OnStop** method is called after a role instance has been taken offline by Azure and before the process exits.</span></span> <span data-ttu-id="d997b-132">Mogą przesłaniać tę metodę do wywołania kodu wymaganego dla wystąpienia roli do zamknięty.</span><span class="sxs-lookup"><span data-stu-id="d997b-132">You can override this method to call code required for your role instance to cleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d997b-133">Kodu uruchamianego w **OnStop** metoda ma przez ograniczony czas na zakończenie wywołanego przyczyn innych niż zamknięcia zainicjowanego przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d997b-133">Code running in the **OnStop** method has a limited time to finish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="d997b-134">Po upływie tego czasu, proces jest zakończony, dlatego należy się upewnić, że kod w **OnStop** metody można szybko uruchomić lub zaakceptować nie działa do zakończenia.</span><span class="sxs-lookup"><span data-stu-id="d997b-134">After this time elapses, the process is terminated, so you must make sure that code in the **OnStop** method can run quickly or tolerates not running to completion.</span></span> <span data-ttu-id="d997b-135">**OnStop** metoda jest wywoływana po wykonaniu **zatrzymywanie** zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="d997b-135">The **OnStop** method is called after the **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="d997b-136">Run — metoda</span><span class="sxs-lookup"><span data-stu-id="d997b-136">Run method</span></span>
<span data-ttu-id="d997b-137">Można zastąpić **Uruchom** metody do wykonania wątku długotrwałe dla swojego wystąpienia roli.</span><span class="sxs-lookup"><span data-stu-id="d997b-137">You can override the **Run** method to implement a long-running thread for your role instance.</span></span>

<span data-ttu-id="d997b-138">Zastępowanie **Uruchom** — metoda nie jest wymagana; Domyślna implementacja uruchamia wątku, który jest w stanie uśpienia nieskończona.</span><span class="sxs-lookup"><span data-stu-id="d997b-138">Overriding the **Run** method is not required; the default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="d997b-139">Jeśli zastąpienie **Uruchom** metody kodu powinna zablokować nieskończoność.</span><span class="sxs-lookup"><span data-stu-id="d997b-139">If you do override the **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="d997b-140">Jeśli **Uruchom** metoda zwróci wartość, rola zostanie automatycznie bezpiecznie odtworzony; innymi słowy, zgłasza Azure **zatrzymywanie** zdarzeń i wywołania **OnStop** metody tak, aby sekwencjach zamknięcia może zostać wykonana, przed roli do trybu offline.</span><span class="sxs-lookup"><span data-stu-id="d997b-140">If the **Run** method returns, the role is automatically gracefully recycled; in other words, Azure raises the **Stopping** event and calls the **OnStop** method so that your shutdown sequences may be executed before the role is taken offline.</span></span>

### <a name="implementing-the-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="d997b-141">Implementacja metody cyklu życia ASP.NET dla roli sieci web</span><span class="sxs-lookup"><span data-stu-id="d997b-141">Implementing the ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="d997b-142">Można użyć metody cyklu życia ASP.NET, oprócz tych zapewnianych przez **RoleEntryPoint** klasy zarządzania sekwencjami inicjowania i zamykania dla roli sieci web.</span><span class="sxs-lookup"><span data-stu-id="d997b-142">You can use the ASP.NET lifecycle methods, in addition to those provided by the **RoleEntryPoint** class, to manage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="d997b-143">Może to być przydatne do celów zgodności, jeśli są przenoszenia istniejących aplikacji ASP.NET do platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="d997b-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application to Azure.</span></span> <span data-ttu-id="d997b-144">Metody cyklu życia ASP.NET są wywoływane z poziomu **RoleEntryPoint** metody.</span><span class="sxs-lookup"><span data-stu-id="d997b-144">The ASP.NET lifecycle methods are called from within the **RoleEntryPoint** methods.</span></span> <span data-ttu-id="d997b-145">**Aplikacji\_Start** metoda jest wywoływana po wykonaniu **RoleEntryPoint.OnStart** zakończeniu działania metody.</span><span class="sxs-lookup"><span data-stu-id="d997b-145">The **Application\_Start** method is called after the **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="d997b-146">**Aplikacji\_zakończenia** metoda jest wywoływana przed **RoleEntryPoint.OnStop** metoda jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="d997b-146">The **Application\_End** method is called before the **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d997b-147">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="d997b-147">Next steps</span></span>
<span data-ttu-id="d997b-148">Dowiedz się, jak [Utwórz pakiet usługi chmury](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="d997b-148">Learn how to [create a cloud service package](cloud-services-model-and-package.md).</span></span>

