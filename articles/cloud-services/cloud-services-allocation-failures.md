---
title: "Rozwiązywanie problemów z przydziałem usługi w chmurze | Dokumentacja firmy Microsoft"
description: "Rozwiązywanie problemów z błędami alokacji podczas wdrażania usługi Cloud Services na platformie Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: 3379b6d9bea874abecae7e56d30cfb15e6b0c2fc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="f1bcb-103">Rozwiązywanie problemów z błędami alokacji podczas wdrażania usługi Cloud Services na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="f1bcb-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="f1bcb-104">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="f1bcb-104">Summary</span></span>
<span data-ttu-id="f1bcb-105">Podczas wdrażania wystąpienia usługi w chmurze lub dodać nową sieć web lub wystąpień roli procesu roboczego, Microsoft Azure przydziela zasoby obliczeniowe.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-105">When you deploy instances to a Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="f1bcb-106">Czasami może pojawić błędy podczas wykonywania tych operacji nawet zanim przejdziesz limity subskrypcji platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-106">You may occasionally receive errors when performing these operations even before you reach the Azure subscription limits.</span></span> <span data-ttu-id="f1bcb-107">W tym artykule opisano przyczyny niektórych typowych błędów alokacji i sugeruje możliwe korygowania.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-107">This article explains the causes of some of the common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="f1bcb-108">Informacje również mogą być przydatne podczas planowania wdrożenia usługi.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-108">The information may also be useful when you plan the deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="f1bcb-109">Tło — jak działa alokacji</span><span class="sxs-lookup"><span data-stu-id="f1bcb-109">Background – How allocation works</span></span>
<span data-ttu-id="f1bcb-110">Serwery w centrach danych platformy Azure są dzielone w klastrach.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-110">The servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="f1bcb-111">Nowe żądanie alokacji usługi chmury nastąpiła w wielu klastrach.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="f1bcb-112">Podczas wdrażania usługi w chmurze (w albo tymczasowym czy produkcyjnym), który usługa w chmurze początkowo pobiera przypięty do klastra.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-112">When the first instance is deployed to a cloud service(in either staging or production), that cloud service gets pinned to a cluster.</span></span> <span data-ttu-id="f1bcb-113">Wszystkie dodatkowe wdrożenia usługi w chmurze nastąpi w tym samym klastrze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-113">Any further deployments for the cloud service will happen in the same cluster.</span></span> <span data-ttu-id="f1bcb-114">W tym artykule firma Microsoft będzie odwoływać się do tego, jak "przypięty do klastra".</span><span class="sxs-lookup"><span data-stu-id="f1bcb-114">In this article, we'll refer to this as "pinned to a cluster".</span></span> <span data-ttu-id="f1bcb-115">Poniższy diagram 1 przedstawiono w przypadku normalnych alokacji, która nastąpiła w wielu klastrach; Diagram 2 przedstawia to alokacji który zawiera przypięta do klastra 2, ponieważ jest to, gdzie jest hostowana istniejących CS_1 usługi w chmurze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-115">Diagram 1 below illustrates the case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates the case of an allocation that's pinned to Cluster 2 because that's where the existing Cloud Service CS_1 is hosted.</span></span>

![Diagram alokacji](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="f1bcb-117">Dlaczego sytuacji błąd alokacji</span><span class="sxs-lookup"><span data-stu-id="f1bcb-117">Why allocation failure happens</span></span>
<span data-ttu-id="f1bcb-118">Żądanie alokacji jest przypięta do klastra, ma wyższy stopień można znaleźć zwolnić zasoby, ponieważ pula zasobów dostępny jest ograniczona do klastra.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-118">When an allocation request is pinned to a cluster, there's a higher chance of failing to find free resources since the available resource pool is limited to a cluster.</span></span> <span data-ttu-id="f1bcb-119">Ponadto jeśli żądanie alokacji jest przypięta do klastra, ale typ zasobu, która miała nie jest obsługiwany przez ten klaster, żądanie zakończy się niepowodzeniem nawet wtedy, gdy klaster ma bezpłatnego zasobu.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-119">Furthermore, if your allocation request is pinned to a cluster but the type of resource you requested is not supported by that cluster, your request will fail even if the cluster has free resource.</span></span> <span data-ttu-id="f1bcb-120">Poniższy diagram 3 ilustruje przypadek, w których alokacji przypiętych nie powiedzie się, ponieważ klaster tylko kandydujące nie ma zwolnić zasoby.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-120">Diagram 3 below illustrates the case where a pinned allocation fails because the only candidate cluster does not have free resources.</span></span> <span data-ttu-id="f1bcb-121">Diagram 4 przedstawia przypadek, w którym przypiętych alokacji nie działa, ponieważ klastra tylko kandydata nie obsługuje żądany rozmiar maszyny Wirtualnej, nawet jeśli klaster ma zwolnić zasoby.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-121">Diagram 4 illustrates the case where a pinned allocation fails because the only candidate cluster does not support the requested VM size, even though the cluster has free resources.</span></span>

![Błąd alokacji przypiętych](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="f1bcb-123">Rozwiązywanie problemów z błędami alokacji dla usług w chmurze</span><span class="sxs-lookup"><span data-stu-id="f1bcb-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="f1bcb-124">Komunikat o błędzie</span><span class="sxs-lookup"><span data-stu-id="f1bcb-124">Error Message</span></span>
<span data-ttu-id="f1bcb-125">Może zostać wyświetlony następujący komunikat o błędzie:</span><span class="sxs-lookup"><span data-stu-id="f1bcb-125">You may see the following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable to satisfy constraints in request. The requested new service deployment is bound to an Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains the new deployment to specific Azure resources. Please retry later or try reducing the VM size or number of role instances. Alternatively, if possible, remove the aforementioned constraints or try deploying to a different region."

### <a name="common-issues"></a><span data-ttu-id="f1bcb-126">Typowe problemy</span><span class="sxs-lookup"><span data-stu-id="f1bcb-126">Common Issues</span></span>
<span data-ttu-id="f1bcb-127">Poniżej przedstawiono typowe scenariusze alokacji, które powodują żądanie alokacji przypięty do jednego klastra.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-127">Here are the common allocation scenarios that cause an allocation request to be pinned to a single cluster.</span></span>

* <span data-ttu-id="f1bcb-128">Wdrażanie do miejsca przemieszczania — Jeśli usługa w chmurze ma wdrożenia w każdym miejscu, następnie usługa w chmurze całego jest przypięta do określonego klastra.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-128">Deploying to Staging Slot - If a cloud service has a deployment in either slot, then the entire cloud service is pinned to a specific cluster.</span></span>  <span data-ttu-id="f1bcb-129">Oznacza to, że jeśli wdrożenia już istnieje w miejscu produkcyjnym, następnie nowe wdrożenie przemieszczania może zostać przydzielone tylko w tym samym klastrze miejsca produkcji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-129">This means that if a deployment already exists in the production slot, then a new staging deployment can only be allocated in the same cluster as the production slot.</span></span> <span data-ttu-id="f1bcb-130">Jeśli klaster jest bliskie pojemności, żądanie może zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-130">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="f1bcb-131">Skalowanie — Dodawanie nowych wystąpień do istniejącej usługi w chmurze należy przydzielić w tym samym klastrze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-131">Scaling - Adding new instances to an existing cloud service must allocate in the same cluster.</span></span>  <span data-ttu-id="f1bcb-132">Zazwyczaj można przydzielić pomniejszonego skalowanie żądania, ale nie zawsze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="f1bcb-133">Jeśli klaster jest bliskie pojemności, żądanie może zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-133">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="f1bcb-134">Grupa koligacji — nowe wdrożenie do usługi w chmurze pusty mogą zostać przydzieleni przez sieci szkieletowej w programie dowolnego klastra w danym regionie, chyba że usługa w chmurze jest przypięta do grupy koligacji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-134">Affinity Group - A new deployment to an empty cloud service can be allocated by the fabric in any cluster in that region, unless the cloud service is pinned to an affinity group.</span></span> <span data-ttu-id="f1bcb-135">Wdrożenia w tej samej grupie koligacji będą podejmowane w tym samym klastrze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-135">Deployments to the same affinity group will be attempted on the same cluster.</span></span> <span data-ttu-id="f1bcb-136">Jeśli klaster jest bliskie pojemności, żądanie może zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-136">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="f1bcb-137">Grupy koligacji vNet - starszych sieci wirtualnych zostały powiązane grup koligacji zamiast regionów, a usługi w chmurze w tych sieciach wirtualnych czy przypięty do klastra grupy koligacji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-137">Affinity Group vNet - Older Virtual Networks were tied to affinity groups instead of regions, and cloud services in these Virtual Networks would be pinned to the affinity group cluster.</span></span> <span data-ttu-id="f1bcb-138">Sieć wirtualna tego typu wdrożenia będą podejmowane w klastrze przypięty.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-138">Deployments to this type of virtual network will be attempted on the pinned cluster.</span></span> <span data-ttu-id="f1bcb-139">Jeśli klaster jest bliskie pojemności, żądanie może zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-139">If the cluster is nearing capacity, the request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="f1bcb-140">Rozwiązania</span><span class="sxs-lookup"><span data-stu-id="f1bcb-140">Solutions</span></span>
1. <span data-ttu-id="f1bcb-141">Wdrożenie nowej usługi w chmurze — to rozwiązanie jest może być najbardziej popularnych, który zezwala platformy wybierz ze wszystkich klastrów w tym regionie.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-141">Redeploy to a new cloud service - This solution is likely to be most successful as it allows the platform to choose from all clusters in that region.</span></span>

   * <span data-ttu-id="f1bcb-142">Wdrażanie obciążenie na nową usługę w chmurze</span><span class="sxs-lookup"><span data-stu-id="f1bcb-142">Deploy the workload to a new cloud service</span></span>  
   * <span data-ttu-id="f1bcb-143">Zaktualizuj CNAME lub rekord, aby przesyłały ruch do nowej usługi w chmurze</span><span class="sxs-lookup"><span data-stu-id="f1bcb-143">Update the CNAME or A record to point traffic to the new cloud service</span></span>
   * <span data-ttu-id="f1bcb-144">Po zero ruch będzie starej lokacji, można usunąć starego usługi w chmurze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-144">Once zero traffic is going to the old site, you can delete the old cloud service.</span></span> <span data-ttu-id="f1bcb-145">To rozwiązanie powinno spowodować przestojów.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="f1bcb-146">Usuń zarówno produkcyjne i przejściowe miejsc — to rozwiązanie zachowa istniejącą nazwę DNS, ale spowoduje, że przestój do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime to your application.</span></span>

   * <span data-ttu-id="f1bcb-147">Usuń produkcyjne i przejściowe miejsc istniejącą usługę w chmurze, dzięki czemu usługa w chmurze jest pusta, a następnie</span><span class="sxs-lookup"><span data-stu-id="f1bcb-147">Delete the production and staging slots of an existing cloud service so that the cloud service is empty, and then</span></span>
   * <span data-ttu-id="f1bcb-148">Utwórz nowe wdrożenie w istniejącej usłudze w chmurze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-148">Create a new deployment in the existing cloud service.</span></span> <span data-ttu-id="f1bcb-149">To spowoduje próbę ponownego alokacji na wszystkich klastrach w regionie.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-149">This will re-attempt to allocation on all clusters in the region.</span></span> <span data-ttu-id="f1bcb-150">Upewnij się, że usługa w chmurze nie są powiązane z grupą koligacji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-150">Ensure the cloud service is not tied to an affinity group.</span></span>
3. <span data-ttu-id="f1bcb-151">Zastrzeżony adres IP — to rozwiązanie zachowa IP istniejącego rozwiązania, ale spowoduje, że przestój do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime to your application.</span></span>  

   * <span data-ttu-id="f1bcb-152">Tworzenie zastrzeżonego adresu IP istniejącego wdrożenia przy użyciu programu Powershell</span><span class="sxs-lookup"><span data-stu-id="f1bcb-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="f1bcb-153">Wykonaj #2 powyższego, upewniając się określić nowy zastrzeżony adres IP w CSCFG usługi.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-153">Follow #2 from above, making sure to specify the new ReservedIP in the service's CSCFG.</span></span>
4. <span data-ttu-id="f1bcb-154">Usuń grupę koligacji dla nowych wdrożeń - grup koligacji nie są zalecane.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="f1bcb-155">Wykonaj kroki #1 powyżej, aby wdrożyć nową usługę w chmurze.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-155">Follow steps for #1 above to deploy a new cloud service.</span></span> <span data-ttu-id="f1bcb-156">Upewnij się, usługa w chmurze nie jest w grupie koligacji.</span><span class="sxs-lookup"><span data-stu-id="f1bcb-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="f1bcb-157">Konwertuj na regionalną sieć wirtualną — zobacz [jak przeprowadzić migrację z grup koligacji do regionalną sieć wirtualną (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="f1bcb-157">Convert to a Regional Virtual Network - See [How to migrate from Affinity Groups to a Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
