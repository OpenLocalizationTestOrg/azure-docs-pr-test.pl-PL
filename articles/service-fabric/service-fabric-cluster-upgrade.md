---
title: "Uaktualnienia klastra usługi sieć szkieletowa usług Azure | Dokumentacja firmy Microsoft"
description: "Uaktualnienie kodu sieci szkieletowej usług i/lub konfigurację, która działa w klastrze usługi sieć szkieletowa usług, w tym ustawieniu trybu aktualizacji klastra, certyfikaty, dodawanie portów aplikacji, sposób poprawek systemu operacyjnego, uaktualnienie i tak dalej. Czego można oczekiwać po uaktualnienia są wykonywane?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 7ea71ab891583c51b3c07a4d0a9f0b4f54e56669
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="1fd9c-104">Uaktualnianie klastra usługi sieć szkieletowa usług Azure</span><span class="sxs-lookup"><span data-stu-id="1fd9c-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="1fd9c-105">Klastrze platformy Azure</span><span class="sxs-lookup"><span data-stu-id="1fd9c-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="1fd9c-106">Autonomiczny klastra</span><span class="sxs-lookup"><span data-stu-id="1fd9c-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="1fd9c-107">Systemu nowoczesnych projektowanie na możliwość ma kluczowe znaczenie dla osiągnięcia długoterminowym sukcesie produktu.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-107">For any modern system, designing for upgradability is key to achieving long-term success of your product.</span></span> <span data-ttu-id="1fd9c-108">Klaster sieci szkieletowej usług Azure jest z zasobem, który jest właścicielem, ale jest częściowo zarządzany przez firmę Microsoft.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="1fd9c-109">W tym artykule opisano, co jest zarządzana automatycznie i samodzielnie skonfigurować.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-the-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="1fd9c-110">Kontrolowanie wersję sieci szkieletowej, która działa w klastrze</span><span class="sxs-lookup"><span data-stu-id="1fd9c-110">Controlling the fabric version that runs on your Cluster</span></span>
<span data-ttu-id="1fd9c-111">Można ustawić do otrzymywania uaktualnień automatyczne sieci szkieletowej, zgodnie z ich wydania przez firmę Microsoft lub wybrać wersję obsługiwanych sieci szkieletowej, które chcesz klastra w klastrze.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-111">You can set your cluster to receive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster to be on.</span></span>

<span data-ttu-id="1fd9c-112">Możesz to zrobić przez ustawienie konfiguracji klastra "parametr upgrademode musi mieć" w portalu lub przy użyciu Menedżera zasobów w czasie tworzenia lub nowsza w klastrze na żywo</span><span class="sxs-lookup"><span data-stu-id="1fd9c-112">You do this by setting the "upgradeMode" cluster configuration on the portal or using Resource Manager at the time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="1fd9c-113">Upewnij się zachować klastra zawsze uruchomiona wersja obsługiwanych sieci szkieletowej.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-113">Make sure to keep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="1fd9c-114">Gdy firma Microsoft ogłaszamy wydanie programu nowa wersja usługi service fabric, poprzednia wersja jest oznaczony do zakończenia wsparcia po co najmniej 60 dni.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-114">As and when we announce the release of a new version of service fabric, the previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="1fd9c-115">nowe wersje są ogłaszane [na blogu zespołu usługi sieć szkieletowa](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="1fd9c-115">the  The new releases are announced [on the service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="1fd9c-116">Nową wersję jest dostępna do wyboru następnie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-116">The new release is available to choose then.</span></span> 
> 
> 

<span data-ttu-id="1fd9c-117">14 dni przed wygaśnięciem zlecenia, które klaster działa, kondycji zdarzenie jest generowane wstawiana klastra do stanu kondycji ostrzeżenia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-117">14 days prior to the expiry of the release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="1fd9c-118">Gdy klaster będzie pozostawał w stanie ostrzeżenia, aż do uaktualnienia do wersji obsługiwanych sieci szkieletowej.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-118">The cluster remains in a warning state until you upgrade to a supported fabric version.</span></span>

### <a name="setting-the-upgrade-mode-via-portal"></a><span data-ttu-id="1fd9c-119">Ustawianie trybu uaktualniania za pośrednictwem portalu</span><span class="sxs-lookup"><span data-stu-id="1fd9c-119">Setting the upgrade mode via portal</span></span>
<span data-ttu-id="1fd9c-120">Podczas tworzenia klastra, można ustawić klastra na automatycznie lub ręcznie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-120">You can set the cluster to automatic or manual when you are creating the cluster.</span></span>

![Create_Manualmode][Create_Manualmode]

<span data-ttu-id="1fd9c-122">Klastra można ustawić na tryb automatyczny lub ręczny, gdy w klastrze na żywo przy użyciu środowisko zarządzania.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-122">You can set the cluster to automatic or manual when on a live cluster, using the manage experience.</span></span> 

#### <a name="upgrading-to-a-new-version-on-a-cluster-that-is-set-to-manual-mode-via-portal"></a><span data-ttu-id="1fd9c-123">Uaktualnienie do nowej wersji w klastrze, który ma ustawioną wartość ręczny tryb za pośrednictwem portalu.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-123">Upgrading to a new version on a cluster that is set to Manual mode via portal.</span></span>
<span data-ttu-id="1fd9c-124">Aby uaktualnić program do nowej wersji, wszystko, co należy zrobić to wybierz z listy rozwijanej dostępnych wersji i Zapisz.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-124">To upgrade to a new version, all you need to do is select the available version from the dropdown and save.</span></span> <span data-ttu-id="1fd9c-125">Uaktualnienie sieci szkieletowej pobiera rozpoczęte automatycznie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-125">The Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="1fd9c-126">Zasady dotyczące kondycji klastra (kombinację kondycji węzła i kondycję wszystkich aplikacji uruchomionych w klastrze) są przestrzegane podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-126">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="1fd9c-127">Jeśli zasady dotyczące kondycji klastra nie są spełnione, uaktualnienie zostanie wycofana.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-127">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="1fd9c-128">Przewiń w dół tego dokumentu, aby dowiedzieć się więcej na temat ustawiania tych zasad dotyczących kondycji niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-128">Scroll down this document to read more on how to set those custom health policies.</span></span> 

<span data-ttu-id="1fd9c-129">Po rozwiązaniu problemów, które spowodowało wycofywanie, musisz zainicjować aktualizację ponownie, wykonując te same kroki jako przed.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-129">Once you have fixed the issues that resulted in the rollback, you need to initiate the upgrade again, by following the same steps as before.</span></span>

![Manage_Automaticmode][Manage_Automaticmode]

### <a name="setting-the-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="1fd9c-131">Ustawianie trybu uaktualnienia za pomocą szablonu usługi Resource Manager</span><span class="sxs-lookup"><span data-stu-id="1fd9c-131">Setting the upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="1fd9c-132">Dodaj konfigurację "parametr upgrademode musi mieć" w definicji zasobu Microsoft.ServiceFabric/clusters i ustaw "clusterCodeVersion" do wersji obsługiwanych sieci szkieletowej, jak pokazano poniżej, a następnie wdrożyć szablon.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-132">Add the "upgradeMode" configuration to the Microsoft.ServiceFabric/clusters resource definition and set the "clusterCodeVersion" to one of the supported fabric versions as shown below and then deploy the template.</span></span> <span data-ttu-id="1fd9c-133">Prawidłowe wartości dla "parametr upgrademode musi mieć" to "Ręczny" lub "Automatyczny"</span><span class="sxs-lookup"><span data-stu-id="1fd9c-133">The valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![ARMUpgradeMode][ARMUpgradeMode]

#### <a name="upgrading-to-a-new-version-on-a-cluster-that-is-set-to-manual-mode-via-a-resource-manager-template"></a><span data-ttu-id="1fd9c-135">Uaktualnienie do nowej wersji w klastrze, który ma ustawioną wartość ręczny tryb za pomocą szablonu usługi Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-135">Upgrading to a new version on a cluster that is set to Manual mode via a Resource Manager template.</span></span>
<span data-ttu-id="1fd9c-136">Gdy klaster jest w trybie ręcznym, aby uaktualnić do nowej wersji, zmień "clusterCodeVersion" do obsługiwanej wersji i wdrożyć go.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-136">When the cluster is in Manual mode, to upgrade to a new version, change the "clusterCodeVersion" to a supported version and deploy it.</span></span> <span data-ttu-id="1fd9c-137">Wdrożenie szablonu, kopnięć uaktualnienia sieci szkieletowej pobiera rozpoczęte automatycznie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-137">The deployment of the template, kicks of the Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="1fd9c-138">Zasady dotyczące kondycji klastra (kombinację kondycji węzła i kondycję wszystkich aplikacji uruchomionych w klastrze) są przestrzegane podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-138">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="1fd9c-139">Jeśli zasady dotyczące kondycji klastra nie są spełnione, uaktualnienie zostanie wycofana.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-139">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="1fd9c-140">Przewiń w dół tego dokumentu, aby dowiedzieć się więcej na temat ustawiania tych zasad dotyczących kondycji niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-140">Scroll down this document to read more on how to set those custom health policies.</span></span> 

<span data-ttu-id="1fd9c-141">Po rozwiązaniu problemów, które spowodowało wycofywanie, musisz zainicjować aktualizację ponownie, wykonując te same kroki jako przed.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-141">Once you have fixed the issues that resulted in the rollback, you need to initiate the upgrade again, by following the same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="1fd9c-142">Pobierz listę wszystkich dostępnych wersji dla wszystkich środowisk w ramach danej subskrypcji</span><span class="sxs-lookup"><span data-stu-id="1fd9c-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="1fd9c-143">Uruchom następujące polecenie, a następnie należy pobrać dane wyjściowe podobne do poniższego.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-143">Run the following command, and you should get an output similar to this.</span></span>

<span data-ttu-id="1fd9c-144">"supportExpiryUtc" informuje użytkownika w przypadku danej wersji wygaśnie lub jego ważność wygasła.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="1fd9c-145">Najnowsza wersja nie ma prawidłowej daty — ma wartość "9999-12-31T23:59:59.9999999", co oznacza tylko, że data wygaśnięcia nie jest jeszcze ustawiony.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-145">The latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that the expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-the-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="1fd9c-146">Zachowania uaktualnienia sieci szkieletowej, gdy tryb uaktualniania klastra automatyczne</span><span class="sxs-lookup"><span data-stu-id="1fd9c-146">Fabric upgrade behavior when the cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="1fd9c-147">Firma Microsoft udostępnia kodu sieci szkieletowej i konfigurację, która działa w klastrze platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-147">Microsoft maintains the fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="1fd9c-148">Możemy przeprowadzić automatycznych uaktualnień monitorowanych oprogramowania na zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-148">We perform automatic monitored upgrades to the software on an as-needed basis.</span></span> <span data-ttu-id="1fd9c-149">Te uaktualnienia może być kodu i konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="1fd9c-150">Aby upewnić się, że aplikacja wystąpi nie wpływu lub minimalny wpływ z powodu te uaktualnienia, możemy przeprowadzić uaktualnienia w następujących faz:</span><span class="sxs-lookup"><span data-stu-id="1fd9c-150">To make sure that your application suffers no impact or minimal impact due to these upgrades, we perform the upgrades in the following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="1fd9c-151">Faza 1: Uaktualnianie jest przeprowadzane przy użyciu wszystkich zasad dotyczących kondycji klastra</span><span class="sxs-lookup"><span data-stu-id="1fd9c-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="1fd9c-152">W tej fazie uaktualnień kontynuować domeny uaktualnienia pojedynczo, a aplikacje, które były uruchomione w klastrze kontynuował pracę bez żadnego przestoju.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-152">During this phase, the upgrades proceed one upgrade domain at a time, and the applications that were running in the cluster continue to run without any downtime.</span></span> <span data-ttu-id="1fd9c-153">Zasady dotyczące kondycji klastra (kombinację kondycji węzła i kondycję wszystkich aplikacji uruchomionych w klastrze) są przestrzegane podczas uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-153">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="1fd9c-154">Jeśli zasady dotyczące kondycji klastra nie są spełnione, uaktualnienie zostanie wycofana.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-154">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="1fd9c-155">Następnie zostanie wysłana wiadomość e-mail do właściciela subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-155">Then an email is sent to the owner of the subscription.</span></span> <span data-ttu-id="1fd9c-156">Wiadomości e-mail zawiera następujące informacje:</span><span class="sxs-lookup"><span data-stu-id="1fd9c-156">The email contains the following information:</span></span>

* <span data-ttu-id="1fd9c-157">Powiadomienie Musieliśmy przywracać stanu sprzed uaktualnienia klastra.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-157">Notification that we had to roll back a cluster upgrade.</span></span>
* <span data-ttu-id="1fd9c-158">Sugerowane akcje naprawcze, jeśli istnieje.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="1fd9c-159">Liczba dni (n), dopóki nie możemy wykonać fazy 2.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-159">The number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="1fd9c-160">Spróbujemy wykonaj to samo uaktualnienie kilka razy w przypadku uaktualniania nie powiodło się ze względów infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-160">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="1fd9c-161">Po n dni od wysłania wiadomości e-mail możemy przejść do fazy 2.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-161">After the n days from the date the email was sent, we proceed to Phase 2.</span></span>

<span data-ttu-id="1fd9c-162">Jeśli zasady dotyczące kondycji klastra są spełnione, uaktualnianie jest uznawany za pomyślny i oznaczone jako ukończone.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-162">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="1fd9c-163">Może to nastąpić podczas początkowej uaktualnienia lub dowolnym powtórki uaktualnienia w tej fazie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-163">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="1fd9c-164">Nie ma żadnych wiadomości e-mail z potwierdzeniem pomyślnego uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="1fd9c-165">Pozwoli to uniknąć wysyłanie zostanie zbyt dużo żądań wiadomości e-mail — odbieranie wiadomości e-mail powinno ono występować jako wyjątek do normalnego.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-165">This is to avoid sending you too many emails--receiving an email should be seen as an exception to normal.</span></span> <span data-ttu-id="1fd9c-166">Oczekujemy większość uaktualnienia klastra została wykonana pomyślnie bez wpływu na dostępność Twojej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-166">We expect most of the cluster upgrades to succeed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="1fd9c-167">Faza 2: Uaktualnianie jest przeprowadzane przy użyciu tylko zasady dotyczące kondycji domyślne</span><span class="sxs-lookup"><span data-stu-id="1fd9c-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="1fd9c-168">Zasady dotyczące kondycji w tej fazie są ustawiane w taki sposób, że liczba aplikacje, które zostały dobrej kondycji na początku uaktualnienia nie zmienia się w czasie trwania procesu uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-168">The health policies in this phase are set in such a way that the number of applications that were healthy at the beginning of the upgrade remains the same for the duration of the upgrade process.</span></span> <span data-ttu-id="1fd9c-169">Jak Faza 1 uaktualnień fazy 2 kontynuacji jedną domenę uaktualnienia w czasie, a aplikacje, które były uruchomione w klastrze kontynuował pracę bez żadnego przestoju.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-169">As in Phase 1, the Phase 2 upgrades proceed one upgrade domain at a time, and the applications that were running in the cluster continue to run without any downtime.</span></span> <span data-ttu-id="1fd9c-170">Zasady dotyczące kondycji klastra (kombinację kondycji węzła i kondycję wszystkich aplikacji uruchomionych w klastrze) są przestrzegane na czas trwania uaktualniania.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-170">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to for the duration of the upgrade.</span></span>

<span data-ttu-id="1fd9c-171">Jeśli zasady dotyczące kondycji klastra skutkuje nie są spełnione, uaktualnienie zostanie wycofana.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-171">If the cluster health policies in effect are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="1fd9c-172">Następnie zostanie wysłana wiadomość e-mail do właściciela subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-172">Then an email is sent to the owner of the subscription.</span></span> <span data-ttu-id="1fd9c-173">Wiadomości e-mail zawiera następujące informacje:</span><span class="sxs-lookup"><span data-stu-id="1fd9c-173">The email contains the following information:</span></span>

* <span data-ttu-id="1fd9c-174">Powiadomienie Musieliśmy przywracać stanu sprzed uaktualnienia klastra.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-174">Notification that we had to roll back a cluster upgrade.</span></span>
* <span data-ttu-id="1fd9c-175">Sugerowane akcje naprawcze, jeśli istnieje.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="1fd9c-176">Liczba dni (n), dopóki nie możemy wykonać fazy 3.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-176">The number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="1fd9c-177">Spróbujemy wykonaj to samo uaktualnienie kilka razy w przypadku uaktualniania nie powiodło się ze względów infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-177">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="1fd9c-178">Przypomnienie e-mail jest wysyłana kilka dni, n dni są włączone.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="1fd9c-179">Po n dni od wysłania wiadomości e-mail możemy przejść do fazy 3.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-179">After the n days from the date the email was sent, we proceed to Phase 3.</span></span> <span data-ttu-id="1fd9c-180">Wiadomości e-mail, który możemy wysłać Faza 2 należy podjąć poważnie i należy podjąć działania naprawcze.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-180">The emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="1fd9c-181">Jeśli zasady dotyczące kondycji klastra są spełnione, uaktualnianie jest uznawany za pomyślny i oznaczone jako ukończone.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-181">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="1fd9c-182">Może to nastąpić podczas początkowej uaktualnienia lub dowolnym powtórki uaktualnienia w tej fazie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-182">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="1fd9c-183">Nie ma żadnych wiadomości e-mail z potwierdzeniem pomyślnego uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="1fd9c-184">Faza 3: Uaktualnianie jest przeprowadzane za pomocą zasady dotyczące kondycji aktywnego</span><span class="sxs-lookup"><span data-stu-id="1fd9c-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="1fd9c-185">Te zasady dotyczące kondycji w tej fazie są przeznaczone dla zakończenie uaktualniania, a nie kondycji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-185">These health policies in this phase are geared towards completion of the upgrade rather than the health of the applications.</span></span> <span data-ttu-id="1fd9c-186">Bardzo mało uaktualnienia klastra przechodzili na tym etapie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="1fd9c-187">Jeśli klaster pobiera na tym etapie, istnieje duże prawdopodobieństwo, że aplikacja staje się nieprawidłowy, i/lub utratę dostępności.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-187">If your cluster gets to this phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="1fd9c-188">Podobnie jak w dwóch fazach, Faza 3 uaktualnień kontynuować jedną domenę uaktualnienia naraz.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-188">Similar to the other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="1fd9c-189">Jeśli zasady dotyczące kondycji klastra nie są spełnione, uaktualnienie zostanie wycofana.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-189">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="1fd9c-190">Spróbujemy wykonaj to samo uaktualnienie kilka razy w przypadku uaktualniania nie powiodło się ze względów infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-190">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="1fd9c-191">Po utworzeniu tego klastra jest przypięty tak, aby go nie będziesz już otrzymywać pomocy technicznej i/lub uaktualnień.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-191">After that, the cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="1fd9c-192">Do właściciela subskrypcji, oraz czynności zaradczych zostanie wysłana wiadomość e-mail z tymi informacjami.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-192">An email with this information is sent to the subscription owner, along with the remedial actions.</span></span> <span data-ttu-id="1fd9c-193">Firma Microsoft nie oczekuje żadnych klastrów można uzyskać w stanie, w którym fazy 3 nie powiodło się.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-193">We do not expect any clusters to get into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="1fd9c-194">Jeśli zasady dotyczące kondycji klastra są spełnione, uaktualnianie jest uznawany za pomyślny i oznaczone jako ukończone.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-194">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="1fd9c-195">Może to nastąpić podczas początkowej uaktualnienia lub dowolnym powtórki uaktualnienia w tej fazie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-195">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="1fd9c-196">Nie ma żadnych wiadomości e-mail z potwierdzeniem pomyślnego uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="1fd9c-197">Konfiguracje klastrów, które kontrolujesz</span><span class="sxs-lookup"><span data-stu-id="1fd9c-197">Cluster configurations that you control</span></span>
<span data-ttu-id="1fd9c-198">Oprócz tego sprawdzić możliwości można ustawić klastra w tryb uaktualniania, w tym miejscu są konfiguracje, które można zmienić w klastrze na żywo.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-198">In addition to the ability to set the cluster upgrade mode, Here are the configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="1fd9c-199">Certyfikaty</span><span class="sxs-lookup"><span data-stu-id="1fd9c-199">Certificates</span></span>
<span data-ttu-id="1fd9c-200">Możesz dodać nowe lub łatwo usunąć certyfikaty dla klastra i klienta za pośrednictwem portalu.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-200">You can add new or delete certificates for the cluster and client via the portal easily.</span></span> <span data-ttu-id="1fd9c-201">Zapoznaj się [tego dokumentu, aby uzyskać szczegółowe instrukcje](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="1fd9c-201">Refer to [this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Zrzut ekranu pokazujący odciski palców certyfikatów w portalu Azure.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="1fd9c-203">Porty aplikacji</span><span class="sxs-lookup"><span data-stu-id="1fd9c-203">Application ports</span></span>
<span data-ttu-id="1fd9c-204">Porty aplikacji można zmienić, zmieniając właściwości zasobów usługi równoważenia obciążenia, które są skojarzone z typem węzła.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-204">You can change application ports by changing the Load Balancer resource properties that are associated with the node type.</span></span> <span data-ttu-id="1fd9c-205">Mogą korzystać z portalu lub środowiska PowerShell usługi Resource Manager można korzystać bezpośrednio.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-205">You can use the portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="1fd9c-206">Aby otworzyć nowy port na wszystkich maszynach wirtualnych typu węzła, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="1fd9c-206">To open a new port on all VMs in a node type, do the following:</span></span>

1. <span data-ttu-id="1fd9c-207">Dodaj nowy sondy do odpowiedniej usługi równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-207">Add a new probe to the appropriate load balancer.</span></span>
   
    <span data-ttu-id="1fd9c-208">Jeśli wdrożono klastra przy użyciu portalu usługi równoważenia obciążenia są nazywane "LB Nazwa grupy zasobów-NodeTypename", po jednej dla każdego typu węzła.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-208">If you deployed your cluster by using the portal, the load balancers are named "LB-name of the Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="1fd9c-209">Ponieważ nazwy usługi równoważenia obciążenia różnią się tylko w obrębie grupy zasobów, najlepiej wyszukiwania je w obszarze określonej grupy zasobów.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-209">Since the load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Zrzut ekranu przedstawiający dodawanie badanie równoważenia obciążenia w portalu.][AddingProbes]
2. <span data-ttu-id="1fd9c-211">Dodaj nową regułę modułu równoważenia obciążenia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-211">Add a new rule to the load balancer.</span></span>
   
    <span data-ttu-id="1fd9c-212">Dodaj nową regułę do tego samego modułu równoważenia obciążenia przy użyciu sondowania, który został utworzony w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-212">Add a new rule to the same load balancer by using the probe that you created in the previous step.</span></span>
   
    ![Dodawanie nowej reguły równoważenia obciążenia w portalu.][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="1fd9c-214">Właściwości umieszczania</span><span class="sxs-lookup"><span data-stu-id="1fd9c-214">Placement properties</span></span>
<span data-ttu-id="1fd9c-215">Dla każdego typu węzła możesz dodać niestandardowe właściwości umieszczania, które ma być używany w aplikacjach.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-215">For each of the node types, you can add custom placement properties that you want to use in your applications.</span></span> <span data-ttu-id="1fd9c-216">Typ NodeType jest używanej bez dodawania go jawnie właściwości domyślnej.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="1fd9c-217">Szczegółowe informacje dotyczące stosowania ograniczeń umieszczania, właściwości węzła i sposób definiowania ich, zapoznaj się z rozdziałem "Ograniczenia i węzła właściwości umieszczania" w dokumencie zasobu klastra sieci szkieletowej programu Service Manager na [opisujące klastra Your](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="1fd9c-217">For details on the use of placement constraints, node properties, and how to define them, refer to the section "Placement Constraints and Node Properties" in the Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="1fd9c-218">Metryki pojemności</span><span class="sxs-lookup"><span data-stu-id="1fd9c-218">Capacity metrics</span></span>
<span data-ttu-id="1fd9c-219">Dla każdego typu węzła możesz dodać niestandardowe metryki pojemności, który ma być używany w celu raportowania obciążenia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-219">For each of the node types, you can add custom capacity metrics that you want to use in your applications to report load.</span></span> <span data-ttu-id="1fd9c-220">Aby uzyskać więcej informacji dotyczących korzystania z metryki pojemności do raportu obciążenia, znajduje się w dokumentach zasobu klastra sieci szkieletowej programu Service Manager w [opisujące Your klastra](service-fabric-cluster-resource-manager-cluster-description.md) i [metryki i obciążenia](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="1fd9c-220">For details on the use of capacity metrics to report load, refer to the Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="1fd9c-221">Zasady kondycji sieci szkieletowej ustawienia uaktualnienia —</span><span class="sxs-lookup"><span data-stu-id="1fd9c-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="1fd9c-222">Można określić, czy zasady niestandardowe kondycji dla uaktualnienia programu fabric.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="1fd9c-223">Jeśli została wybrana klastra sieci szkieletowej automatycznych uaktualnień, te zasady zostać zastosowane do pierwszą fazę aktualizacje automatyczne sieci szkieletowej.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-223">If you have set your cluster to Automatic fabric upgrades, then these policies get applied to the Phase-1 of the automatic fabric upgrades.</span></span>
<span data-ttu-id="1fd9c-224">Jeśli ustawiono klastra sieci szkieletowej ręcznego uaktualnienia, te zasady zostać zastosowane podczas wybierania nowej wersji wyzwalania systemu zaczną działać poza uaktualnienia sieci szkieletowej w klastrze.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering the system to kick off the fabric upgrade in your cluster.</span></span> <span data-ttu-id="1fd9c-225">Jeśli nie zastępują zasady, zostaną użyte wartości domyślne.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-225">If you do not override the policies, the defaults are used.</span></span>

<span data-ttu-id="1fd9c-226">Można określić zasady dotyczące kondycji niestandardowych lub Przejrzyj bieżące ustawienia w obszarze bloku "uaktualnienia programu fabric", wybierając Zaawansowane ustawienia uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-226">You can specify the custom health policies or review the current settings under the "fabric upgrade" blade, by selecting the advanced upgrade settings.</span></span> <span data-ttu-id="1fd9c-227">Przejrzyj poniższe obraz na temat.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-227">Review the following picture on how to.</span></span> 

![Zarządzanie zasadami kondycji niestandardowych][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="1fd9c-229">Dostosowywanie ustawień sieci szkieletowej dla klastra</span><span class="sxs-lookup"><span data-stu-id="1fd9c-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="1fd9c-230">Zapoznaj się [ustawień sieci szkieletowej klastra sieci szkieletowej usług](service-fabric-cluster-fabric-settings.md) na co jest i jak można dostosować je.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-230">Refer to [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-the-vms-that-make-up-the-cluster"></a><span data-ttu-id="1fd9c-231">Poprawek systemu operacyjnego na maszynach wirtualnych, które tworzą klastra</span><span class="sxs-lookup"><span data-stu-id="1fd9c-231">OS patches on the VMs that make up the cluster</span></span>
<span data-ttu-id="1fd9c-232">Zapoznaj się [poprawki aplikacji aranżacji](service-fabric-patch-orchestration-application.md) którego można wdrożyć w klastrze, aby instalować poprawki z usługi Windows Update w sposób orchestrated zachować dostępność usług cały czas.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-232">Refer to [Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster to install patches from Windows Update in an orchestrated manner, keeping the services available all the time.</span></span> 

### <a name="os-upgrades-on-the-vms-that-make-up-the-cluster"></a><span data-ttu-id="1fd9c-233">Uaktualnień systemu operacyjnego na maszynach wirtualnych, które tworzą klastra</span><span class="sxs-lookup"><span data-stu-id="1fd9c-233">OS upgrades on the VMs that make up the cluster</span></span>
<span data-ttu-id="1fd9c-234">Jeśli musisz uaktualnić obrazu systemu operacyjnego w przypadku maszyn wirtualnych klastra, należy to robić jedną maszynę Wirtualną w czasie.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-234">If you must upgrade the OS image on the virtual machines of the cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="1fd9c-235">Przydadzą się osobom odpowiedzialnym dla tego uaktualnienia — nie ma obecnie nie automatyzacji tego.</span><span class="sxs-lookup"><span data-stu-id="1fd9c-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1fd9c-236">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="1fd9c-236">Next steps</span></span>
* <span data-ttu-id="1fd9c-237">Dowiedz się, jak dostosować niektóre [ustawień sieci szkieletowej klastra sieci szkieletowej usług](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="1fd9c-237">Learn how to customize some of the [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="1fd9c-238">Dowiedz się, jak [i wylogowywanie skalowanie klastra](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="1fd9c-238">Learn how to [scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="1fd9c-239">Dowiedz się więcej o [uaktualnienia aplikacji](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="1fd9c-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
