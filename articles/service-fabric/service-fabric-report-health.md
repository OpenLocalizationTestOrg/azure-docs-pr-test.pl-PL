---
title: "Dodawanie niestandardowych raportów kondycji sieci szkieletowej usług | Dokumentacja firmy Microsoft"
description: "Opisuje sposób wysyłania raportów o kondycji niestandardowych do jednostki kondycji sieci szkieletowej usług Azure. Zawiera zalecenia dotyczące projektowania i wdrażania raportów o kondycji jakości."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: ed10eef347d4d93012078456b3a145589e66d30e
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/18/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="2c5b1-104">Dodawanie niestandardowych raportów kondycji usługi Service Fabric</span><span class="sxs-lookup"><span data-stu-id="2c5b1-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="2c5b1-105">Sieć szkieletowa usług Azure wprowadza [model kondycji](service-fabric-health-introduction.md) umożliwiającą Flaga zła klastra i warunki aplikacji na konkretnych obiektów.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed to flag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="2c5b1-106">Model kondycji używa **Raporty kondycji** (składników systemu i watchdogs).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-106">The health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="2c5b1-107">Celem jest łatwe i szybkie diagnozowanie i naprawy.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-107">The goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="2c5b1-108">Moduły zapisujące usługi należy wziąć pod uwagę góry o kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-108">Service writers need to think upfront about health.</span></span> <span data-ttu-id="2c5b1-109">Wszelkie warunek, który może mieć wpływ na kondycji należy podać, zwłaszcza, jeśli może pomóc problemów flagi bliski katalogu głównego.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-109">Any condition that can impact health should be reported on, especially if it can help flag problems close to the root.</span></span> <span data-ttu-id="2c5b1-110">Informacje o kondycji można oszczędzić czas i wysiłek na analizie i debugowania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-110">The health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="2c5b1-111">Przydatność jest jasne, szczególnie, gdy usługa jest uruchomiona na dużą skalę w chmurze (prywatny czy Azure).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-111">The usefulness is especially clear once the service is up and running at scale in the cloud (private or Azure).</span></span>

<span data-ttu-id="2c5b1-112">Monitor Raporty sieci szkieletowej usług określone warunki zainteresowań.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-112">The Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="2c5b1-113">Zgłaszają przy użyciu tych warunków na podstawie ich lokalnego widoku.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="2c5b1-114">[Magazynu kondycji](service-fabric-health-introduction.md#health-store) agreguje dane kondycji wysyłane przez wszystkie raporty w celu ustalenia, czy jednostki są globalnie dobrej kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-114">The [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters to determine whether entities are globally healthy.</span></span> <span data-ttu-id="2c5b1-115">Model jest przeznaczony do sformatowanego, elastyczne i łatwe w użyciu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-115">The model is intended to be rich, flexible, and easy to use.</span></span> <span data-ttu-id="2c5b1-116">Jakość raportów kondycji określa dokładność widoku kondycji klastra.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-116">The quality of the health reports determines the accuracy of the health view of the cluster.</span></span> <span data-ttu-id="2c5b1-117">Fałszywych alarmów, przedstawiających błędnie zła problemów może niekorzystnie wpłynąć na uaktualnienia lub innych usług używających danych kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="2c5b1-118">Przykładami takich usług są usługi repair i mechanizmów alertów.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="2c5b1-119">W związku z tym rozwagą jest potrzebna do zapewnienia raportów, które przechwytywania warunki odsetek w najlepszy możliwy sposób.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-119">Therefore, some thought is needed to provide reports that capture conditions of interest in the best possible way.</span></span>

<span data-ttu-id="2c5b1-120">Do projektowania i implementacji raportowania kondycji watchdogs i składników systemu musi:</span><span class="sxs-lookup"><span data-stu-id="2c5b1-120">To design and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="2c5b1-121">Zdefiniuj warunek, z którymi są zainteresowani, jak jest monitorowany i wpływ funkcję klastra lub aplikacji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-121">Define the condition they are interested in, the way it is monitored, and the impact on the cluster or application functionality.</span></span> <span data-ttu-id="2c5b1-122">Na podstawie tych informacji, wybierz właściwość raportu kondycji i stan kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-122">Based on this information, decide on the health report property and health state.</span></span>
* <span data-ttu-id="2c5b1-123">Określić [jednostki](service-fabric-health-introduction.md#health-entities-and-hierarchy) stosowanym do raportu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-123">Determine the [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that the report applies to.</span></span>
* <span data-ttu-id="2c5b1-124">Określić, gdzie raportowania gotowe, z usługi lub z programu alarmowego wewnętrznych lub zewnętrznych.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-124">Determine where the reporting is done, from within the service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="2c5b1-125">Zdefiniuj źródło używany do identyfikowania osoby zgłaszającej.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-125">Define a source used to identify the reporter.</span></span>
* <span data-ttu-id="2c5b1-126">Wybierz strategię raportowania, okresowo lub na przejścia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="2c5b1-127">Zalecaną metodą jest okresowo, ponieważ wymaga prostsze kodu i jest mniej podatne na błędy.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-127">The recommended way is periodically, as it requires simpler code and is less prone to errors.</span></span>
* <span data-ttu-id="2c5b1-128">Określ, jak długo raportu zła warunki powinny pozostać w magazynie kondycji i jak powinny zostać wyczyszczone.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-128">Determine how long the report for unhealthy conditions should stay in the health store and how it should be cleared.</span></span> <span data-ttu-id="2c5b1-129">Korzystając z tych informacji, decyduje o czas wygaśnięcia raportu i zachowanie Usuń na wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-129">Using this information, decide the report's time to live and remove-on-expiration behavior.</span></span>

<span data-ttu-id="2c5b1-130">Jak wspomniano, raportowanie może odbywać się od:</span><span class="sxs-lookup"><span data-stu-id="2c5b1-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="2c5b1-131">Monitorowane repliki usługi sieć szkieletowa usług.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-131">The monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="2c5b1-132">Wewnętrzny watchdogs wdrożony jako usługa sieci szkieletowej usług (na przykład sieci szkieletowej usług bezstanowych Usługa monitoruje warunki i generuje raporty).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="2c5b1-133">Watchdogs mogą być wdrażane wszystkie węzły lub mogą być koligowane z monitorowanej usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-133">The watchdogs can be deployed an all nodes or can be affinitized to the monitored service.</span></span>
* <span data-ttu-id="2c5b1-134">Wewnętrzny watchdogs, uruchom na węzłach sieci szkieletowej usług, które są *nie* zaimplementowane jako usługi sieci szkieletowej usług.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-134">Internal watchdogs that run on the Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="2c5b1-135">Watchdogs zewnętrznych, które sondowania zasobu z *poza* klastra sieci szkieletowej usług (na przykład monitorowania usługi, takiej jak Gomez).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-135">External watchdogs that probe the resource from *outside* the Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="2c5b1-136">Fabrycznej klaster został wypełniony raportów o kondycji wysyłane przez składniki systemu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-136">Out of the box, the cluster is populated with health reports sent by the system components.</span></span> <span data-ttu-id="2c5b1-137">Dowiedz się więcej o [przy użyciu kondycji systemu raportów do rozwiązywania problemów](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="2c5b1-138">Raporty użytkownika musi zostać wysłany [jednostki kondycji](service-fabric-health-introduction.md#health-entities-and-hierarchy) które już zostały utworzone przez system.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-138">The user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by the system.</span></span>
> 
> 

<span data-ttu-id="2c5b1-139">Raz kondycji raportowania, że projekt jest wyczyszczone, raportów o kondycji mogą być wysyłane łatwe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-139">Once the health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="2c5b1-140">Można użyć [klienta fabricclient z rolą](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) do raportu kondycji, jeśli klaster nie jest [bezpiecznego](service-fabric-cluster-security.md) lub jeśli klienta programu fabric ma uprawnienia administratora.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) to report health if the cluster is not [secure](service-fabric-cluster-security.md) or if the fabric client has admin privileges.</span></span> <span data-ttu-id="2c5b1-141">Raportowanie może odbywać się za pośrednictwem interfejsu API przez przy użyciu [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), za pomocą programu PowerShell lub za pośrednictwem REST.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-141">Reporting can be done through the API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="2c5b1-142">Konfiguracja pokrętła partii raportów, aby uzyskać lepszą wydajność.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="2c5b1-143">Raport kondycji jest synchroniczne, i reprezentuje tylko pracy weryfikacji po stronie klienta.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-143">Report health is synchronous, and it represents only the validation work on the client side.</span></span> <span data-ttu-id="2c5b1-144">Fakt, że raport jest akceptowane przez klienta kondycji lub `Partition` lub `CodePackageActivationContext` obiektów nie oznacza, że jest ono stosowane w magazynie.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-144">The fact that the report is accepted by the health client or the `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in the store.</span></span> <span data-ttu-id="2c5b1-145">Jest wysyłane asynchronicznie, być może umieścić w zadaniu wsadowym razem z innymi raportami.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="2c5b1-146">Przetwarzanie na serwerze nadal może zakończyć się niepowodzeniem: numer sekwencji może być stałe, jednostki, na którym należy zastosować raport został usunięty, itp.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-146">The processing on the server may still fail: the sequence number could be stale, the entity on which the report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="2c5b1-147">Kondycji klienta</span><span class="sxs-lookup"><span data-stu-id="2c5b1-147">Health client</span></span>
<span data-ttu-id="2c5b1-148">Raporty kondycji są wysyłane do magazynu kondycji za pomocą klienta kondycji, które znajdują się wewnątrz klienta sieci szkieletowej.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-148">The health reports are sent to the health store through a health client, which lives inside the fabric client.</span></span> <span data-ttu-id="2c5b1-149">Kondycji klienta można skonfigurować następujące ustawienia:</span><span class="sxs-lookup"><span data-stu-id="2c5b1-149">The health client can be configured with the following settings:</span></span>

* <span data-ttu-id="2c5b1-150">**HealthReportSendInterval**: opóźnienie między czas raportu jest dodawany do klienta i są wysyłane do magazynu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-150">**HealthReportSendInterval**: The delay between the time the report is added to the client and the time it is sent to the health store.</span></span> <span data-ttu-id="2c5b1-151">Używane do raportów usługi partia zadań w pojedynczym komunikacie zamiast wysyłania jeden komunikat dla każdego raportu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-151">Used to batch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="2c5b1-152">Przetwarzanie wsadowe poprawia wydajność.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-152">The batching improves performance.</span></span> <span data-ttu-id="2c5b1-153">Wartość domyślna: 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="2c5b1-154">**HealthReportRetrySendInterval**: interwał, jaką kondycji klienta wysyła ponownie kondycji wszystkich raportów w magazynie kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-154">**HealthReportRetrySendInterval**: The interval at which the health client resends accumulated health reports to the health store.</span></span> <span data-ttu-id="2c5b1-155">Wartość domyślna: 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="2c5b1-156">**HealthOperationTimeout**: limit czasu dla raportu wiadomość wysłana do magazynu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-156">**HealthOperationTimeout**: The timeout period for a report message sent to the health store.</span></span> <span data-ttu-id="2c5b1-157">Jeśli upłynie limit czasu wiadomości, kondycji klient ponawia próbę go do momentu magazynu kondycji potwierdza, że raport został przetworzony.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-157">If a message times out, the health client retries it until the health store confirms that the report has been processed.</span></span> <span data-ttu-id="2c5b1-158">Wartość domyślna: dwie minuty.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="2c5b1-159">Jeśli raporty są przetwarzane wsadowo, klient sieci szkieletowej musi utrzymywać ich aktywność dla co najmniej HealthReportSendInterval, aby upewnić się, że są one wysyłane.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-159">When the reports are batched, the fabric client must be kept alive for at least the HealthReportSendInterval to ensure that they are sent.</span></span> <span data-ttu-id="2c5b1-160">Jeśli komunikat zostanie utracony lub magazynu kondycji nie może zastosować je z powodu błędów przejściowych, klienta programu fabric musi być aktywne już aby nadać mu w taki sposób, aby ponowić próbę.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-160">If the message is lost or the health store cannot apply them due to transient errors, the fabric client must be kept alive longer to give it a chance to retry.</span></span>
> 
> 

<span data-ttu-id="2c5b1-161">Buforowanie na kliencie przyjmuje unikatowości raporty pod uwagę.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-161">The buffering on the client takes the uniqueness of the reports into consideration.</span></span> <span data-ttu-id="2c5b1-162">Na przykład określonego zły osoby zgłaszającej zgłoszenie 100 raportów na sekundę na tę samą właściwość o tej samej jednostki, raporty są zastępowane ostatniej wersji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-162">For example, if a particular bad reporter is reporting 100 reports per second on the same property of the same entity, the reports are replaced with the last version.</span></span> <span data-ttu-id="2c5b1-163">Istnieje co najwyżej jeden taki raport w kolejce klienta.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-163">At most one such report exists in the client queue.</span></span> <span data-ttu-id="2c5b1-164">Jeśli skonfigurowano przetwarzanie wsadowe liczbę raportów wysyłane do magazynu kondycji jest tylko jeden interwał wysyłania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-164">If batching is configured, the number of reports sent to the health store is just one per send interval.</span></span> <span data-ttu-id="2c5b1-165">Ten raport jest ostatni raport dodany odzwierciedla najbardziej bieżącego stanu jednostki.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-165">This report is the last added report, which reflects the most current state of the entity.</span></span>
<span data-ttu-id="2c5b1-166">Określ parametry konfiguracji po `FabricClient` jest tworzony przez przekazanie [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) z odpowiednie wartości dla wpisy dotyczące kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with the desired values for health-related entries.</span></span>

<span data-ttu-id="2c5b1-167">Poniższy przykład tworzy klienta sieci szkieletowej i określa, czy raporty mają być wysyłane w przypadku, gdy są one dodawane.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-167">The following example creates a fabric client and specifies that the reports should be sent when they are added.</span></span> <span data-ttu-id="2c5b1-168">Limity czasu i błędy, które można ponowić ponownych prób nastąpić co 40 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="2c5b1-169">Zaleca się pozostawienie ustawienia, które Ustaw domyślnego klienta sieci szkieletowej `HealthReportSendInterval` 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-169">We recommend keeping the default fabric client settings, which set `HealthReportSendInterval` to 30 seconds.</span></span> <span data-ttu-id="2c5b1-170">To ustawienie zapewnia optymalną wydajność ze względu na przetwarzanie wsadowe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-170">This setting ensures optimal performance due to batching.</span></span> <span data-ttu-id="2c5b1-171">Krytyczne raportów, które muszą zostać przesłane tak szybko, jak to możliwe, należy użyć `HealthReportSendOptions` z Immediate `true` w [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="2c5b1-172">Raporty natychmiastowego obejścia interwał przetwarzanie wsadowe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-172">Immediate reports bypass the batching interval.</span></span> <span data-ttu-id="2c5b1-173">Użyj tej flagi ostrożność; chcemy skorzystać klient kondycji przetwarzanie wsadowe, jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-173">Use this flag with care; we want to take advantage of the health client batching whenever possible.</span></span> <span data-ttu-id="2c5b1-174">Wyślij natychmiastowego jest również przydatny podczas zamykania klienta sieci szkieletowej (na przykład proces wykrył nieprawidłowy stan i konieczność jej zamknięcia zapobiegające efekty uboczne).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-174">Immediate send is also useful when the fabric client is closing (for example, the process has determined invalid state and needs to shut down to prevent side effects).</span></span> <span data-ttu-id="2c5b1-175">Zapewnia send optymalnych wszystkich raportów.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-175">It ensures a best-effort send of the accumulated reports.</span></span> <span data-ttu-id="2c5b1-176">Po dodaniu jeden raport z flagą natychmiastowego kondycji klienta partii skumulowany raporty od czasu ostatniego wysłania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-176">When one report is added with Immediate flag, the health client batches all the accumulated reports since last send.</span></span>

<span data-ttu-id="2c5b1-177">Takie same parametry można określić podczas tworzenia połączenia z klastrem za pomocą programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-177">Same parameters can be specified when a connection to a cluster is created through PowerShell.</span></span> <span data-ttu-id="2c5b1-178">Poniższy przykład uruchamia połączenie z lokalnym klastrem:</span><span class="sxs-lookup"><span data-stu-id="2c5b1-178">The following example starts a connection to a local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="2c5b1-179">Podobnie do interfejsu API, raporty można wysyłać przy użyciu `-Immediate` przełącznika wysłanych od razu, niezależnie od `HealthReportSendInterval` wartość.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-179">Similarly to API, reports can be sent using `-Immediate` switch to be sent immediately, regardless of the `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="2c5b1-180">Dla pozostałych raporty są wysyłane do bramy sieci szkieletowej usług klienta wewnętrznej sieci szkieletowej.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-180">For REST, the reports are sent to the Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="2c5b1-181">Domyślnie ten klient jest skonfigurowany do wysyłania raportów umieścić w zadaniu wsadowym co 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-181">By default, this client is configured to send reports batched every 30 seconds.</span></span> <span data-ttu-id="2c5b1-182">Ustawienia konfiguracji klastra można zmienić interwał partii `HttpGatewayHealthReportSendInterval` na `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-182">You can change the batch interval with the cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="2c5b1-183">Jak wspomniano, lepszym rozwiązaniem jest na wysyłanie raportów o `Immediate` wartość true.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-183">As mentioned, a better option is to send the reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="2c5b1-184">Aby upewnić się, że nieautoryzowanego usługi nie można utworzyć raportu kondycji dla obiektów w klastrze, należy skonfigurować serwer do akceptowania żądań tylko od klientów zabezpieczonych.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-184">To ensure that unauthorized services can't report health against the entities in the cluster, configure the server to accept requests only from secured clients.</span></span> <span data-ttu-id="2c5b1-185">`FabricClient` Używane na potrzeby raportowania musi mieć z włączonymi zabezpieczeniami mógł komunikować się z klastrem (na przykład z uwierzytelnianiem Kerberos lub certyfikatów).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-185">The `FabricClient` used for reporting must have security enabled to be able to communicate with the cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="2c5b1-186">Przeczytaj więcej na temat [klastra zabezpieczeń](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="2c5b1-187">Raport z niskim poziomem uprawnień Services</span><span class="sxs-lookup"><span data-stu-id="2c5b1-187">Report from within low privilege services</span></span>
<span data-ttu-id="2c5b1-188">Jeśli nie ma dostępu administratora do klastra usługi sieć szkieletowa usług, mogą raportować kondycję na jednostkach z bieżącego kontekstu za pomocą `Partition` lub `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-188">If Service Fabric services do not have admin access to the cluster, you can report health on entities from the current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="2c5b1-189">W przypadku usług bezstanowych użyj [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) raport ma dotyczyć bieżącego wystąpienia usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) to report on the current service instance.</span></span>
* <span data-ttu-id="2c5b1-190">Usługi stanowej, użyj [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) raport ma dotyczyć bieżącej repliki.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) to report on current replica.</span></span>
* <span data-ttu-id="2c5b1-191">Użyj [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) raport ma dotyczyć bieżącego obiektu partycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) to report on the current partition entity.</span></span>
* <span data-ttu-id="2c5b1-192">Użyj [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) raport ma dotyczyć bieżącej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) to report on current application.</span></span>
* <span data-ttu-id="2c5b1-193">Użyj [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) raport ma dotyczyć bieżącej aplikacji wdrożonych w bieżącym węźle.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) to report on the current application deployed on the current node.</span></span>
* <span data-ttu-id="2c5b1-194">Użyj [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) raport ma dotyczyć pakietu usług dla aplikacji wdrożonych w bieżącym węźle.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) to report on a service package for the application deployed on the current node.</span></span>

> [!NOTE]
> <span data-ttu-id="2c5b1-195">Wewnętrznie `Partition` i `CodePackageActivationContext` przechowywania kondycji klient skonfigurowany przy użyciu ustawień domyślnych.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-195">Internally, the `Partition` and the `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="2c5b1-196">Zgodnie z objaśnieniem dla [kondycji klienta](service-fabric-report-health.md#health-client), raporty są umieszczane w partii i wysyłane przez czasomierz.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-196">As explained for the [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="2c5b1-197">Obiekty powinny życiu mieć możliwość wysyłania raportu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-197">The objects should be kept alive to have a chance to send the report.</span></span>
> 
> 

<span data-ttu-id="2c5b1-198">Można określić `HealthReportSendOptions` podczas wysyłania raportów za pośrednictwem `Partition` i `CodePackageActivationContext` kondycji interfejsów API.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="2c5b1-199">Jeśli masz krytyczne raportów, które muszą zostać przesłane tak szybko, jak to możliwe, użyj `HealthReportSendOptions` z Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="2c5b1-200">Raporty natychmiastowego obejścia przetwarzanie wsadowe Interwał wewnętrznego kondycji klienta.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-200">Immediate reports bypass the batching interval of the internal health client.</span></span> <span data-ttu-id="2c5b1-201">Jak wspomniano wcześniej, użyj tej flagi ostrożność; chcemy skorzystać klient kondycji przetwarzanie wsadowe, jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-201">As mentioned before, use this flag with care; we want to take advantage of the health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="2c5b1-202">Projektowanie raportowania kondycji</span><span class="sxs-lookup"><span data-stu-id="2c5b1-202">Design health reporting</span></span>
<span data-ttu-id="2c5b1-203">Pierwszym krokiem podczas generowania raportów wysokiej jakości identyfikuje warunki, które mogą mieć wpływ na kondycję usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-203">The first step in generating high-quality reports is identifying the conditions that can impact the health of the service.</span></span> <span data-ttu-id="2c5b1-204">Wszelkie warunek, który może pomóc flagi problemów w usłudze lub klastrze podczas jej uruchamiania--lub lepszy, zanim się stanie, problem — może potencjalnie zapisać miliardów dolarów.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-204">Any condition that can help flag problems in the service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="2c5b1-205">Zalety mniej czas przestoju, mniejszą liczbę godzin nocy poświęcony na wykrywanie i naprawianie problemów i wyższe zadowolenia klienta.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-205">The benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="2c5b1-206">Po zidentyfikowaniu warunki autorzy programu alarmowego muszą ustalić przyczynę najlepszy sposób, aby monitorować ich równowagi między koszty i użyteczność.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-206">Once the conditions are identified, watchdog writers need to figure out the best way to monitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="2c5b1-207">Rozważmy na przykład usługi, który wykonuje obliczenia złożonych, które używają niektóre pliki tymczasowe w udziale.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="2c5b1-208">Programu alarmowego można monitorować udziału, aby upewnić się, że jest dostępna wystarczająca ilość miejsca.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-208">A watchdog could monitor the share to ensure that enough space is available.</span></span> <span data-ttu-id="2c5b1-209">Można go nasłuchiwania powiadomień o zmianach pliku lub katalogu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="2c5b1-210">Można go raportować ostrzeżenie, jeśli próg góry, a zgłaszać błąd, gdy udział jest pełna.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-210">It could report a warning if an upfront threshold is reached, and report an error if the share is full.</span></span> <span data-ttu-id="2c5b1-211">Na ostrzeżenie, można uruchomić system naprawy, czyszczenie starszych plików w udziale.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-211">On a warning, a repair system could start cleaning up older files on the share.</span></span> <span data-ttu-id="2c5b1-212">W przypadku wystąpienia błędu systemu naprawy można przenieść repliki usługi do innego węzła.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-212">On an error, a repair system could move the service replica to another node.</span></span> <span data-ttu-id="2c5b1-213">Należy pamiętać, opisu stanów warunku pod względem kondycji: stan warunek, który jest uznawana za dobrej kondycji (ok) lub złej kondycji (ostrzeżenia lub błędu).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-213">Note how the condition states are described in terms of health: the state of the condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="2c5b1-214">Po ustawieniu monitorowania szczegółów, Edytor programu alarmowego należy dowiedzieć się, jak do zaimplementowania programu alarmowego.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-214">Once the monitoring details are set, a watchdog writer needs to figure out how to implement the watchdog.</span></span> <span data-ttu-id="2c5b1-215">Jeśli warunki można ustalić na podstawie w ramach usługi, programu alarmowego może być częścią samej usługi monitorowane.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-215">If the conditions can be determined from within the service, the watchdog can be part of the monitored service itself.</span></span> <span data-ttu-id="2c5b1-216">Na przykład kodu usługi można Sprawdź użycie udziału, a następnie składają raporty za każdym razem, gdy próbuje zapisać plik.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-216">For example, the service code can check the share usage, and then report every time it tries to write a file.</span></span> <span data-ttu-id="2c5b1-217">Zaletą tej metody jest raportowania proste.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-217">The advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="2c5b1-218">Należy uważać, aby zapobiec usterki programu alarmowego wpływu na funkcjonalność usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-218">Care must be taken to prevent watchdog bugs from impacting the service functionality.</span></span>

<span data-ttu-id="2c5b1-219">Raportowanie w programie monitorowanej usługi nie zawsze jest opcją.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-219">Reporting from within the monitored service is not always an option.</span></span> <span data-ttu-id="2c5b1-220">Nie można wykryć warunki strażnika w ramach usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-220">A watchdog within the service may not be able to detect the conditions.</span></span> <span data-ttu-id="2c5b1-221">Może nie dysponować logiki lub określenie danych.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-221">It may not have the logic or data to make the determination.</span></span> <span data-ttu-id="2c5b1-222">Obciążenie monitorowania warunków może być wysokie.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-222">The overhead of monitoring the conditions may be high.</span></span> <span data-ttu-id="2c5b1-223">Warunki również nie mogą być specyficzne dla usługi, ale zamiast tego wpływa na interakcje między usługami.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-223">The conditions also may not be specific to a service, but instead affect interactions between services.</span></span> <span data-ttu-id="2c5b1-224">Inną opcją jest watchdogs w klastrze jako osobne procesy.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-224">Another option is to have watchdogs in the cluster as separate processes.</span></span> <span data-ttu-id="2c5b1-225">Watchdogs monitorować warunki i raportów, bez wywierania wpływu na usług w dowolny sposób.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-225">The watchdogs monitor the conditions and report, without affecting the main services in any way.</span></span> <span data-ttu-id="2c5b1-226">Na przykład watchdogs te można można zaimplementować jako usługi bezstanowej w tej samej aplikacji wdrożone na wszystkich węzłach lub tych samych węzłów jako usługa.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-226">For example, these watchdogs could be implemented as stateless services in the same application, deployed on all nodes or on the same nodes as the service.</span></span>

<span data-ttu-id="2c5b1-227">Czasami programu alarmowego uruchamianych w klastrze nie ma możliwości użycia albo.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-227">Sometimes, a watchdog running in the cluster is not an option either.</span></span> <span data-ttu-id="2c5b1-228">Jeśli stan monitorowanych się dostępności lub funkcji usługi użytkownicy widzą go, jest najlepszym rozwiązaniem jest watchdogs w tym samym miejscu jako klienci użytkownika.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-228">If the monitored condition is the availability or functionality of the service as users see it, it's best to have the watchdogs in the same place as the user clients.</span></span> <span data-ttu-id="2c5b1-229">One testowania czynności w taki sam sposób jak użytkownicy połączeń telefonicznych z nimi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-229">There, they can test the operations in the same way users call them.</span></span> <span data-ttu-id="2c5b1-230">Na przykład można mieć programu alarmowego, znajduje się poza klastrem, wysyła żądania do usługi i sprawdza opóźnienia i poprawność wyniku.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-230">For example, you can have a watchdog that lives outside the cluster, issues requests to the service, and checks the latency and correctness of the result.</span></span> <span data-ttu-id="2c5b1-231">(Dla usługi Kalkulator, na przykład 2 + 2 zwróci 4 w rozsądnym czasie?)</span><span class="sxs-lookup"><span data-stu-id="2c5b1-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="2c5b1-232">Po sfinalizowany szczegóły dotyczące programu alarmowego, należy podjąć decyzję dotyczącą na identyfikator źródła, który unikatowo identyfikuje go.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-232">Once the watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="2c5b1-233">Jeśli wiele watchdogs tego samego typu mieszkają w klastrze, muszą one zgłosić na różnych obiektów, lub jeśli zgłaszają na tej samej jednostki, użyj Identyfikatora innego źródła lub właściwości.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-233">If multiple watchdogs of the same type are living in the cluster, they must report on different entities, or, if they report on the same entity, use different source ID or property.</span></span> <span data-ttu-id="2c5b1-234">W ten sposób ich raporty mogą współistnieć.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-234">This way, their reports can coexist.</span></span> <span data-ttu-id="2c5b1-235">Właściwość raport o kondycji należy przechwytywać monitorowanych warunku.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-235">The property of the health report should capture the monitored condition.</span></span> <span data-ttu-id="2c5b1-236">(Na przykład powyżej, właściwość może być **ShareSize**.) Jeśli wiele raportów dotyczą tego samego warunku, właściwość powinien zawierać niektóre informacje dynamicznych, która umożliwia współistnienie raportów.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-236">(For the example above, the property could be **ShareSize**.) If multiple reports apply to the same condition, the property should contain some dynamic information that allows reports to coexist.</span></span> <span data-ttu-id="2c5b1-237">Na przykład, jeśli wiele udziałów muszą być monitorowane, nazwa właściwości może być **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-237">For example, if multiple shares need to be monitored, the property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="2c5b1-238">Czy *nie* korzystać z magazynu kondycji, aby zachować informacje o stanie.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-238">Do *not* use the health store to keep status information.</span></span> <span data-ttu-id="2c5b1-239">Należy podać tylko informacje dotyczące kondycji jako kondycji, jak te informacje ma wpływ na ocenę kondycji jednostki.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-239">Only health-related information should be reported as health, as this information impacts the health evaluation of an entity.</span></span> <span data-ttu-id="2c5b1-240">Magazynu kondycji nie został zaprojektowany jako magazynu ogólnego przeznaczenia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-240">The health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="2c5b1-241">Używa logiki oceny kondycji agregacji wszystkie dane do stanu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-241">It uses health evaluation logic to aggregate all data into the health state.</span></span> <span data-ttu-id="2c5b1-242">Wysyłanie informacji o kondycji (takich jak raportowanie stanu ze stanem kondycji OK) niezwiązanych ze sobą bez wpływu na stan kondycji zagregowane, ale może negatywnie wpłynąć na wydajność magazynu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-242">Sending information unrelated to health (like reporting status with a health state of OK) doesn't impact the aggregated health state, but it can negatively affect the performance of the health store.</span></span>
> 
> 

<span data-ttu-id="2c5b1-243">Następny punkt decyzji znajduje się na jakiej encji do raportu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-243">The next decision point is which entity to report on.</span></span> <span data-ttu-id="2c5b1-244">Większość czasu warunek wyraźnie idetifies jednostki.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-244">Most of the time, the condition clearly idetifies the entity.</span></span> <span data-ttu-id="2c5b1-245">Wybierz obiekt z najlepsze możliwe stopnia szczegółowości.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-245">Choose the entity with best possible granularity.</span></span> <span data-ttu-id="2c5b1-246">Jeśli warunek ma wpływ na wszystkie repliki na partycji, zgłoś na partycji, nie w usłudze.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-246">If a condition impacts all replicas in a partition, report on the partition, not on the service.</span></span> <span data-ttu-id="2c5b1-247">Brak sytuacjach wyjątkowych, gdy potrzebne jest więcej myśl, mimo że.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="2c5b1-248">Jeśli warunek ma wpływ na jednostkę, takich jak repliki, ale desire ma mieć warunek oflagowane więcej niż czas trwania życia repliki, a następnie należy podać na partycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-248">If the condition impacts an entity, such as a replica, but the desire is to have the condition flagged for more than the duration of replica life, then it should be reported on the partition.</span></span> <span data-ttu-id="2c5b1-249">W przeciwnym razie po usunięciu repliki magazynu kondycji czyści jego raporty.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-249">Otherwise, when the replica is deleted, the health store cleans up all its reports.</span></span> <span data-ttu-id="2c5b1-250">Autorzy programu alarmowego muszą myśleć o okresy istnienia jednostki i raportu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-250">Watchdog writers must think about the lifetimes of the entity and the report.</span></span> <span data-ttu-id="2c5b1-251">Musi być jasne podczas raportu należy oczyścić z magazynu (na przykład błędu zgłoszonego z jednostką już ma zastosowanie).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="2c5b1-252">Oto przykład umieszcza razem punktów, które I opisem.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-252">Let's look at an example that puts together the points I described.</span></span> <span data-ttu-id="2c5b1-253">Należy rozważyć aplikacji usługi sieć szkieletowa składa się z głównym usługi stanowej trwałe i dodatkowej usługi bezstanowej wdrożone na wszystkich węzłach (jeden typ dodatkowej usługi dla poszczególnych typów zadań).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="2c5b1-254">Wzorzec ma kolejki przetwarzania, która zawiera polecenia ma być wykonane przez pomocnicze bazy danych.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-254">The master has a processing queue that contains commands to be executed by secondaries.</span></span> <span data-ttu-id="2c5b1-255">Pomocnicze bazy danych wykonaj żądań przychodzących i wysyłanie sygnałów wstecz potwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-255">The secondaries execute the incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="2c5b1-256">Jeden warunek, który może być monitorowany jest długość kolejki przetwarzania wzorca.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-256">One condition that could be monitored is the length of the master processing queue.</span></span> <span data-ttu-id="2c5b1-257">Jeśli długość kolejki głównej osiągnie próg, ostrzeżenie jest raportowana.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-257">If the master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="2c5b1-258">Ostrzeżenie wskazuje, że pomocnicze bazy danych nie może obsłużyć obciążenia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-258">The warning indicates that the secondaries can't handle the load.</span></span> <span data-ttu-id="2c5b1-259">Jeśli kolejka osiągnie maksymalną długość polecenia są usuwane, jest zgłaszany błąd, ponieważ usługa nie można odzyskać.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-259">If the queue reaches the maximum length and commands are dropped, an error is reported, as the service can't recover.</span></span> <span data-ttu-id="2c5b1-260">Raporty mogą być we właściwości **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-260">The reports can be on the property **QueueStatus**.</span></span> <span data-ttu-id="2c5b1-261">Programu alarmowego znajdują się wewnątrz usługi, a jest okresowo przesyłane na głównym repliki podstawowej.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-261">The watchdog lives inside the service, and it's sent periodically on the master primary replica.</span></span> <span data-ttu-id="2c5b1-262">Czas wygaśnięcia wynosi dwie minuty, a wysłaniem okresowo co 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-262">The time to live is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="2c5b1-263">Jeśli podstawowy ulegnie awarii, raportu jest automatycznie czyszczone z magazynu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-263">If the primary goes down, the report is cleaned up automatically from store.</span></span> <span data-ttu-id="2c5b1-264">Jeśli replika usługa działa, ale jest on zakleszczone lub inne problemy raportu wygaśnie w magazynie kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-264">If the service replica is up, but it is deadlocked or having other issues, the report expires in the health store.</span></span> <span data-ttu-id="2c5b1-265">W takim przypadku jednostki jest oceniane w błąd.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-265">In this case, the entity is evaluated at error.</span></span>

<span data-ttu-id="2c5b1-266">Inny warunek, który może być monitorowany jest czas wykonania zadania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="2c5b1-267">Wzorzec dystrybuuje zadania pomocnicze bazy danych na podstawie typu zadań.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-267">The master distributes tasks to the secondaries based on the task type.</span></span> <span data-ttu-id="2c5b1-268">W zależności od projektu wzorzec można sondować pomocnicze bazy danych dla stanu zadania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-268">Depending on the design, the master could poll the secondaries for task status.</span></span> <span data-ttu-id="2c5b1-269">Można również poczekać, aż pomocnicze bazy danych do wysyłania potwierdzeń wstecz sygnałów, gdy są one wykonywane.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-269">It could also wait for secondaries to send back acknowledgement signals when they are done.</span></span> <span data-ttu-id="2c5b1-270">W drugim przypadku należy uważać, aby wykryć sytuacje, w którym struktury pomocnicze bazy danych lub komunikaty zostaną utracone.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-270">In the second case, care must be taken to detect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="2c5b1-271">Jedną z opcji jest wzorca wysłać żądanie ping do tej samej dodatkowej, której odsyła jego stan.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-271">One option is for the master to send a ping request to the same secondary, which sends back its status.</span></span> <span data-ttu-id="2c5b1-272">Jeśli brak stan nie zostanie odebrana, wzorzec uzna awarii i zmienia harmonogram zadania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-272">If no status is received, the master considers it a failure and reschedules the task.</span></span> <span data-ttu-id="2c5b1-273">To zachowanie przyjęto założenie, że zadania są idempotentności.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-273">This behavior assumes that the tasks are idempotent.</span></span>

<span data-ttu-id="2c5b1-274">Stan monitorowanych można przetłumaczyć jako ostrzeżenie, jeśli zadanie nie zostanie zrobione w określonym czasie (**t1**, na przykład 10 minut).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-274">The monitored condition can be translated as a warning if the task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="2c5b1-275">Jeśli zadanie nie zostało ukończone w czasie (**t2**, na przykład 20 minut), monitorowanych warunku można przetłumaczyć jako błąd.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-275">If the task is not completed in time (**t2**, for example 20 minutes), the monitored condition can be translated as Error.</span></span> <span data-ttu-id="2c5b1-276">Ta raportowania może odbywać się na wiele sposobów:</span><span class="sxs-lookup"><span data-stu-id="2c5b1-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="2c5b1-277">Główny repliki podstawowej raporty okresowo od siebie samego.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-277">The master primary replica reports on itself periodically.</span></span> <span data-ttu-id="2c5b1-278">Może mieć jedną właściwość dla wszystkich zadań oczekujących w kolejce.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-278">You can have one property for all pending tasks in the queue.</span></span> <span data-ttu-id="2c5b1-279">Jeśli co najmniej jedno zadanie trwa dłużej, stan raportu we właściwości **PendingTasks** jest ostrzeżenia lub błędu, zależnie od potrzeb.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-279">If at least one task takes longer, the report status on the property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="2c5b1-280">Jeśli nie ma żadnych oczekujących zadań lub wszystkich zadań rozpoczął wykonywanie sekwencji, stan raportu jest OK.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-280">If there are no pending tasks or all tasks started execution, the report status is OK.</span></span> <span data-ttu-id="2c5b1-281">Zadania są trwałe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-281">The tasks are persistent.</span></span> <span data-ttu-id="2c5b1-282">Podstawowy ulegnie awarii, mogą nadal raport prawidłowo nowo utworzonego podstawowej.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-282">If the primary goes down, the newly promoted primary can continue to report properly.</span></span>
* <span data-ttu-id="2c5b1-283">Inny proces programu alarmowego (w chmurze lub zewnętrznego) sprawdza zadań (z zewnątrz, na podstawie wyniku żądaną zadania) aby zobaczyć, czy zostały zakończone.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-283">Another watchdog process (in the cloud or external) checks the tasks (from outside, based on the desired task result) to see if they are completed.</span></span> <span data-ttu-id="2c5b1-284">Jeśli nie przestrzegania progów, raport jest wysyłany na głównym usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-284">If they do not respect the thresholds, a report is sent on the master service.</span></span> <span data-ttu-id="2c5b1-285">Raport zostanie także wysłana na każdego zadania, które obejmuje identyfikatora zadania, takie jak **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-285">A report is also sent on each task that includes the task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="2c5b1-286">Raporty mają być wysyłane tylko w stan złej kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="2c5b1-287">Ustaw czas na żywo na kilka minut i oznacz raportów została usunięta po wygasną zapewnienie oczyszczania.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-287">Set time to live to a few minutes, and mark the reports to be removed when they expire to ensure cleanup.</span></span>
* <span data-ttu-id="2c5b1-288">Pomocniczy, który wykonuje zadania raportów, gdy trwa dłużej niż oczekiwano go uruchomić.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-288">The secondary that is executing a task reports when it takes longer than expected to run it.</span></span> <span data-ttu-id="2c5b1-289">Raporty dla wystąpienia usługi o właściwości **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-289">It reports on the service instance on the property **PendingTasks**.</span></span> <span data-ttu-id="2c5b1-290">Raport określa wystąpienie usługi, które występują problemy, ale nie przechwytuje sytuacji, gdy wystąpienie zaniku.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-290">The report pinpoints the service instance that has issues, but it doesn't capture the situation where the instance dies.</span></span> <span data-ttu-id="2c5b1-291">Raporty są następnie wyczyścić.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-291">The reports are cleaned up then.</span></span> <span data-ttu-id="2c5b1-292">Można go raport dotyczący dodatkowej usługi.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-292">It could report on the secondary service.</span></span> <span data-ttu-id="2c5b1-293">Pomocniczy wykona zadania, dodatkowej wystąpienia czyści raportu z magazynu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-293">If the secondary completes the task, the secondary instance clears the report from the store.</span></span> <span data-ttu-id="2c5b1-294">Raport nie przechwytuje sytuacji, gdy komunikat potwierdzenia zostaną utracone i zadanie nie zostało zakończone z punktu widzenia głównego.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-294">The report doesn't capture the situation where the acknowledgement message is lost and the task is not finished from the master's point of view.</span></span>

<span data-ttu-id="2c5b1-295">Jednak raportowania odbywa się w przypadkach opisanych powyżej, raporty są przechwytywane kondycji aplikacji podczas oceny kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-295">However the reporting is done in the cases described above, the reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="2c5b1-296">Raport okresowo a na przejście</span><span class="sxs-lookup"><span data-stu-id="2c5b1-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="2c5b1-297">Przy użyciu modelu raportowania kondycji watchdogs raporty można wysyłać okresowo lub przejścia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-297">By using the health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="2c5b1-298">Zalecaną metodą raportowania programu alarmowego jest okresowo, ponieważ kod jest znacznie prostsza i mniej podatna na błędy.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-298">The recommended way for watchdog reporting is periodically, because the code is much simpler and less prone to errors.</span></span> <span data-ttu-id="2c5b1-299">Watchdogs starań musi być tak proste, jak to możliwe uniknąć błędów, które mogą powodować nieprawidłowe raporty.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-299">The watchdogs must strive to be as simple as possible to avoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="2c5b1-300">Niepoprawna *zła* wpływ na raporty oceny kondycji i scenariusze, w oparciu o kondycji, w tym uaktualnienia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="2c5b1-301">Niepoprawna *dobrej kondycji* raporty ukrycie problemów w klastrze, który nie jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-301">Incorrect *healthy* reports hide issues in the cluster, which is not desired.</span></span>

<span data-ttu-id="2c5b1-302">Okresowe raportowania programu alarmowego może być zaimplementowany z czasomierzem.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-302">For periodic reporting, the watchdog can be implemented with a timer.</span></span> <span data-ttu-id="2c5b1-303">Wywołanie zwrotne czasomierza programu alarmowego można sprawdzić stan i wysłać raport na podstawie bieżącego stanu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-303">On a timer callback, the watchdog can check the state and send a report based on the current state.</span></span> <span data-ttu-id="2c5b1-304">Nie istnieje potrzeba Zobacz, który raport został wysłany wcześniej, czy wydawać żadnych optymalizacji pod względem obsługi wiadomości.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-304">There is no need to see which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="2c5b1-305">Kondycji klienta jest przetwarzanie wsadowe logiki, aby pomóc w wydajności.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-305">The health client has batching logic to help with performance.</span></span> <span data-ttu-id="2c5b1-306">Gdy klient kondycji jest aktywne, ponowną wewnętrznie aż do raportu zostało potwierdzone przez magazynu kondycji lub programu alarmowego generuje nowszej raport o tej samej jednostki, właściwości i źródła.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-306">While the health client is kept alive, it retries internally until the report is acknowledged by the health store or the watchdog generates a newer report with the same entity, property, and source.</span></span>

<span data-ttu-id="2c5b1-307">Raporty dotyczące przejścia wymaga obsługi dokładne stanu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="2c5b1-308">Programu alarmowego monitoruje niektóre warunki i raporty, tylko po zmianie warunków.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-308">The watchdog monitors some conditions and reports only when the conditions change.</span></span> <span data-ttu-id="2c5b1-309">Odwróć tego podejścia jest potrzebne są mniej raportów.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-309">The upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="2c5b1-310">Wadą interfejsu jest złożona logika programu alarmowego.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-310">The downside is that the logic of the watchdog is complex.</span></span> <span data-ttu-id="2c5b1-311">Programu alarmowego muszą zachować warunków lub raporty, dzięki czemu mogą być kontrolowane ustalenie zmiany stanu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-311">The watchdog must maintain the conditions or the reports, so that they can be inspected to determine state changes.</span></span> <span data-ttu-id="2c5b1-312">W tryb failover należy uważać z raportami dodane, ale jeszcze nie są wysyłane do magazynu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-312">On failover, care must be taken with reports added, but not yet sent to the health store.</span></span> <span data-ttu-id="2c5b1-313">Numer sekwencyjny musi być coraz większe.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-313">The sequence number must be ever-increasing.</span></span> <span data-ttu-id="2c5b1-314">Jeśli nie, raporty są odrzucane jako przestarzały.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-314">If not, the reports are rejected as stale.</span></span> <span data-ttu-id="2c5b1-315">W rzadkich przypadkach, gdy poniesienia utraty danych synchronizacja może być wymagana między stan osoby zgłaszającej i stanu magazynu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-315">In the rare cases where data loss is incurred, synchronization may be needed between the state of the reporter and the state of the health store.</span></span>

<span data-ttu-id="2c5b1-316">Raporty dotyczące przejścia sens dla usług raportowania, za pomocą `Partition` lub `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="2c5b1-317">Jeśli lokalny obiekt (repliki lub wdrożony pakiet usługi / wdrożonych aplikacji) jest usunięty, jego raporty zostaną również usunięte.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-317">When the local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="2c5b1-318">To automatyczne oczyszczanie zwalnia potrzebę synchronizacja osoby zgłaszającej i magazynu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-318">This automatic cleanup relaxes the need for synchronization between reporter and health store.</span></span> <span data-ttu-id="2c5b1-319">Jeśli raport dotyczy partycji nadrzędnej lub aplikacji nadrzędnej, szczególną uwagę musi być przełączona w tryb failover w celu uniknięcia starych raportów w magazynie kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-319">If the report is for parent partition or parent application, care must be taken on failover to avoid stale reports in the health store.</span></span> <span data-ttu-id="2c5b1-320">Logika musi zostać dodany do utrzymania poprawnego stanu i wyczyść raportu z magazynu, jeśli nie jest już potrzebne.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-320">Logic must be added to maintain the correct state and clear the report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="2c5b1-321">Implementowanie raportowania kondycji</span><span class="sxs-lookup"><span data-stu-id="2c5b1-321">Implement health reporting</span></span>
<span data-ttu-id="2c5b1-322">Po zatwierdzeniu treść jednostki i raportu Wyczyść, wysyłania raportów o kondycji jest możliwe za pośrednictwem interfejsu API środowiska PowerShell i REST.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-322">Once the entity and report details are clear, sending health reports can be done through the API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="2c5b1-323">Interfejs API</span><span class="sxs-lookup"><span data-stu-id="2c5b1-323">API</span></span>
<span data-ttu-id="2c5b1-324">Aby zgłosić za pośrednictwem interfejsu API, musisz utworzyć specyficzne dla typu jednostki, interesujące raport ma dotyczyć raport o kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-324">To report through the API, you need to create a health report specific to the entity type they want to report on.</span></span> <span data-ttu-id="2c5b1-325">Nadaj raportu do kondycji klienta.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-325">Give the report to a health client.</span></span> <span data-ttu-id="2c5b1-326">Można również utworzyć informacje o kondycji i przekaż go do Popraw metod raportowania na `Partition` lub `CodePackageActivationContext` raport ma dotyczyć bieżącego jednostek.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-326">Alternatively, create a health information and pass it to correct reporting methods on `Partition` or `CodePackageActivationContext` to report on current entities.</span></span>

<span data-ttu-id="2c5b1-327">W poniższym przykładzie przedstawiono okresowych raportów z strażnika w klastrze.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-327">The following example shows periodic reporting from a watchdog within the cluster.</span></span> <span data-ttu-id="2c5b1-328">Programu alarmowego sprawdza, czy zasób zewnętrzny można uzyskać z w węźle.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-328">The watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="2c5b1-329">Zasób jest wymagane przez manifest usługi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-329">The resource is needed by a service manifest within the application.</span></span> <span data-ttu-id="2c5b1-330">Jeśli zasób jest niedostępny, innych usług w aplikacji mogą nadal działać prawidłowo.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-330">If the resource is unavailable, the other services within the application can still function properly.</span></span> <span data-ttu-id="2c5b1-331">W związku z tym raport jest wysyłany w jednostce pakietu wdrożonej usługi co 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-331">Therefore, the report is sent on the deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether the resource can be accessed from the node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as the connectivity is needed by the specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, the report is already queued on the health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until the report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="2c5b1-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="2c5b1-332">PowerShell</span></span>
<span data-ttu-id="2c5b1-333">Wysyłanie raportów o kondycji z  **ServiceFabric wysyłania*EntityType*HealthReport **.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="2c5b1-334">W poniższym przykładzie przedstawiono okresowych raportów na wartościach Procesora w węźle.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-334">The following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="2c5b1-335">Raporty mają być wysyłane co 30 sekund i mają czas wygaśnięcia wynosi dwie minuty.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-335">The reports should be sent every 30 seconds, and they have a time to live of two minutes.</span></span> <span data-ttu-id="2c5b1-336">Jeśli wygasną, osoby zgłaszającej występują problemy, więc węzeł jest oceniane w błąd.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-336">If they expire, the reporter has issues, so the node is evaluated at error.</span></span> <span data-ttu-id="2c5b1-337">Gdy Procesora jest powyżej wartości progowej, raport ma stan kondycji ostrzeżenia.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-337">When the CPU is above a threshold, the report has a health state of warning.</span></span> <span data-ttu-id="2c5b1-338">Jeśli Procesor pozostaje powyżej progu przez ponad skonfigurowanym czasie, będzie zgłaszane jako błąd.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-338">When the CPU remains above a threshold for more than the configured time, it's reported as an error.</span></span> <span data-ttu-id="2c5b1-339">W przeciwnym razie reportera, który wysyła kondycję OK.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-339">Otherwise, the reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="2c5b1-340">Poniższy przykład zgłosi ostrzeżenie przejściowy na replice.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-340">The following example reports a transient warning on a replica.</span></span> <span data-ttu-id="2c5b1-341">Identyfikator partycji, a następnie identyfikator repliki najpierw pobiera dla usługi, który jest zainteresowana.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-341">It first gets the partition ID and then the replica ID for the service it is interested in.</span></span> <span data-ttu-id="2c5b1-342">Następnie wysyła raport z **PowershellWatcher** we właściwości **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-342">It then sends a report from **PowershellWatcher** on the property **ResourceDependency**.</span></span> <span data-ttu-id="2c5b1-343">Raport ma znaczenie tylko dwóch minut, a zostanie automatycznie usunięte z magazynu.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-343">The report is of interest for only two minutes, and it is removed from the store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "The external resource that the primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : The external resource that the primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="2c5b1-344">REST</span><span class="sxs-lookup"><span data-stu-id="2c5b1-344">REST</span></span>
<span data-ttu-id="2c5b1-345">Wysyłanie raportów o kondycji za pomocą usługi REST z żądania POST, przejdź do żądanego jednostki, które w treści opis raportu kondycji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-345">Send health reports using REST with POST requests that go to the desired entity and have in the body the health report description.</span></span> <span data-ttu-id="2c5b1-346">Zobacz na przykład, jak wysyłać REST [klastra raportów o kondycji](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) lub [raportów o kondycji usługi](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="2c5b1-346">For example, see how to send REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="2c5b1-347">Obsługiwane są wszystkie jednostki.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2c5b1-348">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="2c5b1-348">Next steps</span></span>
<span data-ttu-id="2c5b1-349">Na podstawie kondycji danych, moduły zapisujące usługi i Administratorzy klastra/aplikacji można traktować sposobów, aby korzystać z informacji.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-349">Based on the health data, service writers and cluster/application administrators can think of ways to consume the information.</span></span> <span data-ttu-id="2c5b1-350">Na przykład one można skonfigurować alerty na podstawie stanu kondycji do wychwytywania poważne problemy, zanim one powodować awarie.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-350">For example, they can set up alerts based on health status to catch severe issues before they provoke outages.</span></span> <span data-ttu-id="2c5b1-351">Administratorzy mogą również skonfigurować systemy naprawy Aby automatycznie rozwiązać problemy.</span><span class="sxs-lookup"><span data-stu-id="2c5b1-351">Administrators can also set up repair systems to fix issues automatically.</span></span>

[<span data-ttu-id="2c5b1-352">Wprowadzenie do kondycji sieci szkieletowej usług monitorowania</span><span class="sxs-lookup"><span data-stu-id="2c5b1-352">Introduction to Service Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="2c5b1-353">Wyświetl raporty dotyczące kondycji sieci szkieletowej usług</span><span class="sxs-lookup"><span data-stu-id="2c5b1-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="2c5b1-354">Jak zgłosić i Sprawdź kondycję usług</span><span class="sxs-lookup"><span data-stu-id="2c5b1-354">How to report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="2c5b1-355">Użyj systemowych raportów kondycji do rozwiązywania problemów</span><span class="sxs-lookup"><span data-stu-id="2c5b1-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="2c5b1-356">Monitorowanie i diagnozowania usług lokalnie</span><span class="sxs-lookup"><span data-stu-id="2c5b1-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="2c5b1-357">Uaktualnianie aplikacji sieci szkieletowej usług</span><span class="sxs-lookup"><span data-stu-id="2c5b1-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

