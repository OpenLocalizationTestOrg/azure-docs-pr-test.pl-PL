---
title: "aaaOverview życia hello Azure Usługa sieci szkieletowej niezawodnych usług | Dokumentacja firmy Microsoft"
description: "Dowiedz się więcej o hello zdarzenia różnych cyklu życia w sieci szkieletowej usług niezawodne usługi"
services: Service-Fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: vturecek;
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 0d75ed5ee7cda85ac9af6a02e160727277804a2b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="0a128-103">Przegląd cyklu życia niezawodne usługi</span><span class="sxs-lookup"><span data-stu-id="0a128-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="0a128-104">C# w systemie Windows</span><span class="sxs-lookup"><span data-stu-id="0a128-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="0a128-105">Java w systemie Linux</span><span class="sxs-lookup"><span data-stu-id="0a128-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="0a128-106">Rozważania na temat cykli hello niezawodnych usług, podstawy hello życia hello są najważniejsze hello.</span><span class="sxs-lookup"><span data-stu-id="0a128-106">When thinking about hello lifecycles of Reliable Services, hello basics of hello lifecycle are hello most important.</span></span> <span data-ttu-id="0a128-107">Ogólnie rzecz biorąc:</span><span class="sxs-lookup"><span data-stu-id="0a128-107">In general:</span></span>

- <span data-ttu-id="0a128-108">Podczas uruchamiania</span><span class="sxs-lookup"><span data-stu-id="0a128-108">During Startup</span></span>
  - <span data-ttu-id="0a128-109">Usługi są wykonane</span><span class="sxs-lookup"><span data-stu-id="0a128-109">Services are constructed</span></span>
  - <span data-ttu-id="0a128-110">Mieć możliwość tooconstruct i zwraca zero lub więcej obiektów nasłuchujących</span><span class="sxs-lookup"><span data-stu-id="0a128-110">They have an opportunity tooconstruct and return zero or more listeners</span></span>
  - <span data-ttu-id="0a128-111">Wszystkie zwracane obiekty nasłuchujące są otwarte, zezwolenie na komunikację z usługą hello</span><span class="sxs-lookup"><span data-stu-id="0a128-111">Any returned listeners are opened, allowing communication with hello service</span></span>
  - <span data-ttu-id="0a128-112">RunAsync usługi Hello, którego metoda jest wywoływana, dzięki czemu hello usługa toodo długotrwałe lub pracy w tle</span><span class="sxs-lookup"><span data-stu-id="0a128-112">hello Service's RunAsync method is called, allowing hello service toodo long running or background work</span></span>
- <span data-ttu-id="0a128-113">Podczas zamykania</span><span class="sxs-lookup"><span data-stu-id="0a128-113">During shutdown</span></span>
  - <span data-ttu-id="0a128-114">tooRunAsync przekazany token anulowania Hello została anulowana, a odbiorników hello są zamknięte</span><span class="sxs-lookup"><span data-stu-id="0a128-114">hello cancellation token passed tooRunAsync is canceled, and hello listeners are closed</span></span>
  - <span data-ttu-id="0a128-115">To znaczy po zakończeniu sam obiekt usługi hello jest niszczone</span><span class="sxs-lookup"><span data-stu-id="0a128-115">Once that is complete, hello service object itself is destructed</span></span>

<span data-ttu-id="0a128-116">Szczegóły dotyczące hello są dokładne uporządkowanie tych zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="0a128-116">There are details around hello exact ordering of these events.</span></span> <span data-ttu-id="0a128-117">W szczególności hello kolejność zdarzeń mogą się nieznacznie zmieniać w zależności od tego, czy hello niezawodnej usługi jest Stateless lub Stateful.</span><span class="sxs-lookup"><span data-stu-id="0a128-117">In particular, hello order of events may change slightly depending on whether hello Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="0a128-118">Ponadto usługi stanowej, zostały toodeal ze scenariuszem głównej wymiany hello.</span><span class="sxs-lookup"><span data-stu-id="0a128-118">In addition, for stateful services, we have toodeal with hello Primary swap scenario.</span></span> <span data-ttu-id="0a128-119">Podczas tej sekwencji hello rolę podstawową jest przeniesione tooanother repliki (lub wróci) bez usługi hello zamykanie.</span><span class="sxs-lookup"><span data-stu-id="0a128-119">During this sequence, hello role of Primary is transferred tooanother replica (or comes back) without hello service shutting down.</span></span> <span data-ttu-id="0a128-120">Na koniec mamy toothink o warunkach błędu lub niepowodzenie.</span><span class="sxs-lookup"><span data-stu-id="0a128-120">Finally, we have toothink about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="0a128-121">Uruchamianie usługi bezstanowej</span><span class="sxs-lookup"><span data-stu-id="0a128-121">Stateless service startup</span></span>
<span data-ttu-id="0a128-122">Witaj cyklem życia usługi bezstanowej jest bardzo prosta.</span><span class="sxs-lookup"><span data-stu-id="0a128-122">hello lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="0a128-123">Poniżej przedstawiono kolejność zdarzeń hello:</span><span class="sxs-lookup"><span data-stu-id="0a128-123">Here's hello order of events:</span></span>

1. <span data-ttu-id="0a128-124">Witaj usługi jest tworzony</span><span class="sxs-lookup"><span data-stu-id="0a128-124">hello Service is constructed</span></span>
2. <span data-ttu-id="0a128-125">Następnie w dwie czynności równoległe stanie:</span><span class="sxs-lookup"><span data-stu-id="0a128-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="0a128-126">`StatelessService.CreateServiceInstanceListeners()`jest wywoływany i wszystkie zwracane obiekty nasłuchujące są otwarte.</span><span class="sxs-lookup"><span data-stu-id="0a128-126">`StatelessService.CreateServiceInstanceListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="0a128-127">`ICommunicationListener.OpenAsync()`jest wywoływane dla każdego odbiornika</span><span class="sxs-lookup"><span data-stu-id="0a128-127">`ICommunicationListener.OpenAsync()` is called on each listener</span></span>
    - <span data-ttu-id="0a128-128">Witaj usługi `StatelessService.RunAsync()` metoda jest wywoływana</span><span class="sxs-lookup"><span data-stu-id="0a128-128">hello service's `StatelessService.RunAsync()` method is called</span></span>
3. <span data-ttu-id="0a128-129">Jeśli jest obecny, hello usługi `StatelessService.OnOpenAsync()` metoda jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-129">If present, hello service's `StatelessService.OnOpenAsync()` method is called.</span></span> <span data-ttu-id="0a128-130">Jest to rzadko zastąpienia, ale jest ona dostępna.</span><span class="sxs-lookup"><span data-stu-id="0a128-130">This is an uncommon override, but it is available.</span></span>

<span data-ttu-id="0a128-131">Jest toonote ważna jest kolejność nie między toocreate wywołania hello i otwórz hello odbiorników i RunAsync.</span><span class="sxs-lookup"><span data-stu-id="0a128-131">It is important toonote that there is no ordering between hello calls toocreate and open hello listeners and RunAsync.</span></span> <span data-ttu-id="0a128-132">przed rozpoczęciem RunAsync odbiorników Hello może zostać otwarty.</span><span class="sxs-lookup"><span data-stu-id="0a128-132">hello listeners may open before RunAsync is started.</span></span> <span data-ttu-id="0a128-133">Podobnie RunAsync może się okazać wywoływane przed odbiorników komunikacji hello są otwarte lub nawet zostały wykonane.</span><span class="sxs-lookup"><span data-stu-id="0a128-133">Similarly, RunAsync may end up invoked before hello communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="0a128-134">Jeśli wymagana jest każdej synchronizacji, jest pozostawiany jako implementujący toohello wykonywania.</span><span class="sxs-lookup"><span data-stu-id="0a128-134">If any synchronization is required, it is left as an exercise toohello implementer.</span></span> <span data-ttu-id="0a128-135">Typowe rozwiązania:</span><span class="sxs-lookup"><span data-stu-id="0a128-135">Common solutions:</span></span>

  - <span data-ttu-id="0a128-136">Czasami odbiorników nie może działać, dopóki niektóre informacje o utworzeniu lub pracy wykonanej.</span><span class="sxs-lookup"><span data-stu-id="0a128-136">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="0a128-137">Dla usług bezstanowych, które pracy zwykle można zrobić w innych lokalizacjach, takich jak:</span><span class="sxs-lookup"><span data-stu-id="0a128-137">For stateless services that work can usually be done in other locations, such as:</span></span> 
    - <span data-ttu-id="0a128-138">w Konstruktorze hello usługi</span><span class="sxs-lookup"><span data-stu-id="0a128-138">in hello service's constructor</span></span>
    - <span data-ttu-id="0a128-139">Podczas hello `CreateServiceInstanceListeners()` wywołania</span><span class="sxs-lookup"><span data-stu-id="0a128-139">during hello `CreateServiceInstanceListeners()` call</span></span>
    - <span data-ttu-id="0a128-140">jako część konstrukcji hello odbiornika hello, sama</span><span class="sxs-lookup"><span data-stu-id="0a128-140">as a part of hello construction of hello listener itself</span></span>
  - <span data-ttu-id="0a128-141">Czasami hello kodu w RunAsync nie chce toostart dopóki odbiorników hello są otwarte.</span><span class="sxs-lookup"><span data-stu-id="0a128-141">Sometimes hello code in RunAsync does not want toostart until hello listeners are open.</span></span> <span data-ttu-id="0a128-142">W takim przypadku niezbędne jest dodatkowe koordynacji.</span><span class="sxs-lookup"><span data-stu-id="0a128-142">In this case additional coordination is necessary.</span></span> <span data-ttu-id="0a128-143">Jednym z typowych rozwiązań jest niektórych flagi w odbiorników hello wskazujący po zakończeniu.</span><span class="sxs-lookup"><span data-stu-id="0a128-143">One common solution is some flag within hello listeners indicating when they have completed.</span></span> <span data-ttu-id="0a128-144">Ta flaga jest sprawdzany w RunAsync przed kontynuowaniem pracy tooactual.</span><span class="sxs-lookup"><span data-stu-id="0a128-144">This flag is then checked in RunAsync before continuing tooactual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="0a128-145">Zamykanie usługi bezstanowej</span><span class="sxs-lookup"><span data-stu-id="0a128-145">Stateless service shutdown</span></span>
<span data-ttu-id="0a128-146">Podczas zamykania usługi bezstanowej powitalne tego samego wzorca występuje tylko w odwrotnej:</span><span class="sxs-lookup"><span data-stu-id="0a128-146">When shutting down a stateless service, hello same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="0a128-147">Równoległe</span><span class="sxs-lookup"><span data-stu-id="0a128-147">In parallel</span></span>
    - <span data-ttu-id="0a128-148">Są zamykane wszystkie otwarte odbiorników.</span><span class="sxs-lookup"><span data-stu-id="0a128-148">Any open listeners are Closed.</span></span> <span data-ttu-id="0a128-149">`ICommunicationListener.CloseAsync()`jest wywoływana na każdym odbiornika.</span><span class="sxs-lookup"><span data-stu-id="0a128-149">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="0a128-150">token anulowania Hello przekazano zbyt`RunAsync()` zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="0a128-150">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="0a128-151">Sprawdzanie, czy hello token anulowania na `IsCancellationRequested` właściwość zwraca wartość true i jeśli wywołuje hello token `ThrowIfCancellationRequested` metoda zgłasza `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="0a128-151">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="0a128-152">Raz `CloseAsync()` uzupełnia w każdym odbiornika i `RunAsync()` również zakończeniu hello usługi `StatelessService.OnCloseAsync()` metoda jest wywoływana, jeśli jest obecny.</span><span class="sxs-lookup"><span data-stu-id="0a128-152">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatelessService.OnCloseAsync()` method is called, if present.</span></span> <span data-ttu-id="0a128-153">Jest rzadko toooverride `StatelessService.OnCloseAsync()`.</span><span class="sxs-lookup"><span data-stu-id="0a128-153">It is uncommon toooverride `StatelessService.OnCloseAsync()`.</span></span>
3. <span data-ttu-id="0a128-154">Po `StatelessService.OnCloseAsync()` zakończeniu obiektu usługi hello jest niszczone</span><span class="sxs-lookup"><span data-stu-id="0a128-154">After `StatelessService.OnCloseAsync()` completes, hello service object is destructed</span></span>

## <a name="stateful-service-startup"></a><span data-ttu-id="0a128-155">Uruchamianie usługi stanowej</span><span class="sxs-lookup"><span data-stu-id="0a128-155">Stateful service Startup</span></span>
<span data-ttu-id="0a128-156">Stanowe usługi mają podobne usługi toostateless wzorzec, kilka zmian.</span><span class="sxs-lookup"><span data-stu-id="0a128-156">Stateful services have a similar pattern toostateless services, with a few changes.</span></span> <span data-ttu-id="0a128-157">Podczas uruchamiania usługi stanowej, hello kolejność zdarzeń wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="0a128-157">When starting up a stateful service, hello order of events is as follows:</span></span>

1. <span data-ttu-id="0a128-158">Witaj usługi jest tworzony</span><span class="sxs-lookup"><span data-stu-id="0a128-158">hello Service is constructed</span></span>
2. <span data-ttu-id="0a128-159">`StatefulServiceBase.OnOpenAsync()`jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-159">`StatefulServiceBase.OnOpenAsync()` is called.</span></span> <span data-ttu-id="0a128-160">To jest zastępowany uncommonly hello usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-160">This is uncommonly overridden in hello service.</span></span>
3. <span data-ttu-id="0a128-161">Witaj, następujące elementy wystąpić równolegle</span><span class="sxs-lookup"><span data-stu-id="0a128-161">hello following things happen in parallel</span></span>
    - <span data-ttu-id="0a128-162">`StatefulServiceBase.CreateServiceReplicaListeners()`jest wywoływany</span><span class="sxs-lookup"><span data-stu-id="0a128-162">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked</span></span> 
      - <span data-ttu-id="0a128-163">Jeśli usługa hello jest podstawowym wszystkie zwracane obiekty nasłuchujące są otwarte.</span><span class="sxs-lookup"><span data-stu-id="0a128-163">If hello service is a Primary all returned listeners are Opened.</span></span> <span data-ttu-id="0a128-164">`ICommunicationListener.OpenAsync()`jest wywoływana na każdym odbiornika.</span><span class="sxs-lookup"><span data-stu-id="0a128-164">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
      - <span data-ttu-id="0a128-165">Jeśli usługa hello jest pomocniczego, tylko te odbiorniki oznaczona jako `ListenOnSecondary = true` są otwarte.</span><span class="sxs-lookup"><span data-stu-id="0a128-165">If hello service is a Secondary, only those listeners marked as `ListenOnSecondary = true` are opened.</span></span> <span data-ttu-id="0a128-166">Odbiorniki otwarte na pomocnicze bazy danych jest mniej typowych.</span><span class="sxs-lookup"><span data-stu-id="0a128-166">Having listeners that are open on Secondaries is less common.</span></span>
    - <span data-ttu-id="0a128-167">Witaj, jeśli hello usługi jest obecnie podstawowa, usługa hello `StatefulServiceBase.RunAsync()` metoda jest wywoływana</span><span class="sxs-lookup"><span data-stu-id="0a128-167">hello if hello Service is currently a Primary, hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
4. <span data-ttu-id="0a128-168">Po hello wszystkie repliki odbiornika `OpenAsync()` ukończenia wywołania i `RunAsync()` jest nazywany `StatefulServiceBase.OnChangeRoleAsync()` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-168">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` is called, `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="0a128-169">To jest zastępowany uncommonly hello usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-169">This is uncommonly overridden in hello service.</span></span>

<span data-ttu-id="0a128-170">Podobnie toostateless usług, nie istnieje żadne koordynację między tymi hello kolejności, w których hello odbiorników są tworzone i otworzyć i gdy jest wywoływana RunAsync.</span><span class="sxs-lookup"><span data-stu-id="0a128-170">Similarly toostateless services, there's no coordination between hello order in which hello listeners are created and opened and when RunAsync is called.</span></span> <span data-ttu-id="0a128-171">Jeśli potrzebujesz koordynacji rozwiązań hello są znacznie hello tego samego.</span><span class="sxs-lookup"><span data-stu-id="0a128-171">If you need coordination, hello solutions are much hello same.</span></span> <span data-ttu-id="0a128-172">Istnieje jeden przypadek dodatkowe: powiedzieć, że wywołania hello otrzymywanych odbiorników komunikacji hello wymagają informacje przechowywane w niektórych [niezawodnej kolekcje](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="0a128-172">THere is one additional case: say that hello calls arriving at hello communication listeners require information kept inside some [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="0a128-173">Ponieważ odbiorników komunikacji hello można otworzyć przed hello niezawodnej kolekcje są do odczytu lub zapisu, a przed RunAsync można uruchomić, niektóre dodatkowe koordynacji jest konieczne.</span><span class="sxs-lookup"><span data-stu-id="0a128-173">Because hello communication listeners could open before hello reliable collections are readable or writeable, and before RunAsync could start, some additional coordination is necessary.</span></span> <span data-ttu-id="0a128-174">Witaj najprostszym i najbardziej typowe rozwiązania dotyczy tooreturn odbiorników komunikacji hello niektórych kod błędu: hello klienta używa tooknow tooretry hello żądania.</span><span class="sxs-lookup"><span data-stu-id="0a128-174">hello simplest and most common solution is for hello communication listeners tooreturn some error code that hello client uses tooknow tooretry hello request.</span></span>

## <a name="stateful-service-shutdown"></a><span data-ttu-id="0a128-175">Zamknięcie usługi stanowej</span><span class="sxs-lookup"><span data-stu-id="0a128-175">Stateful service Shutdown</span></span>
<span data-ttu-id="0a128-176">Podobnie usług tooStateless zdarzenia cyklu życia hello podczas zamykania są takie same jak podczas uruchamiania Witaj, lecz wycofane.</span><span class="sxs-lookup"><span data-stu-id="0a128-176">Similarly tooStateless services, hello lifecycle events during shutdown are hello same as during startup, but reversed.</span></span> <span data-ttu-id="0a128-177">Gdy trwa zamykanie usługi stanowej, hello miejsce następujące zdarzenia:</span><span class="sxs-lookup"><span data-stu-id="0a128-177">When a stateful service is being shut down, hello following events occur:</span></span>

1. <span data-ttu-id="0a128-178">Równoległe</span><span class="sxs-lookup"><span data-stu-id="0a128-178">In parallel</span></span>
    - <span data-ttu-id="0a128-179">Są zamykane wszystkie otwarte odbiorników.</span><span class="sxs-lookup"><span data-stu-id="0a128-179">Any open listeners are Closed.</span></span> <span data-ttu-id="0a128-180">`ICommunicationListener.CloseAsync()`jest wywoływana na każdym odbiornika.</span><span class="sxs-lookup"><span data-stu-id="0a128-180">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="0a128-181">token anulowania Hello przekazano zbyt`RunAsync()` zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="0a128-181">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="0a128-182">Sprawdzanie, czy hello token anulowania na `IsCancellationRequested` właściwość zwraca wartość true i jeśli wywołuje hello token `ThrowIfCancellationRequested` metoda zgłasza `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="0a128-182">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="0a128-183">Raz `CloseAsync()` uzupełnia w każdym odbiornika i `RunAsync()` również zakończeniu hello usługi `StatefulServiceBase.OnChangeRoleAsync()` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-183">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="0a128-184">(To jest uncommonly zastąpiona w usłudze hello.)</span><span class="sxs-lookup"><span data-stu-id="0a128-184">(This is uncommonly overridden in hello service.)</span></span>
    - <span data-ttu-id="0a128-185">Oczekiwanie na RunAsync toocomplete jest konieczne tylko wtedy, jeśli podstawowy został tej repliki usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-185">Waiting for RunAsync toocomplete is only necessary if this service replica was a Primary.</span></span>
3. <span data-ttu-id="0a128-186">Raz hello `StatefulServiceBase.OnChangeRoleAsync()` metody zakończeniu hello `StatefulServiceBase.OnCloseAsync()` metoda jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-186">Once hello `StatefulServiceBase.OnChangeRoleAsync()` method completes, hello `StatefulServiceBase.OnCloseAsync()` method is called.</span></span> <span data-ttu-id="0a128-187">Jest to rzadko zastąpienia, ale jest ona dostępna.</span><span class="sxs-lookup"><span data-stu-id="0a128-187">This is an uncommon override, but it is available.</span></span>
3. <span data-ttu-id="0a128-188">Po `StatefulServiceBase.OnCloseAsync()` zakończeniu obiektu usługi hello jest niszczone.</span><span class="sxs-lookup"><span data-stu-id="0a128-188">After `StatefulServiceBase.OnCloseAsync()` completes, hello service object is destructed.</span></span>

## <a name="stateful-service-primary-swaps"></a><span data-ttu-id="0a128-189">Zamienia głównej usługi stanowej</span><span class="sxs-lookup"><span data-stu-id="0a128-189">Stateful service primary swaps</span></span>
<span data-ttu-id="0a128-190">Po uruchomieniu usługi stanowej hello głównej replik tej usługi stanowej może zawierać tylko ich odbiorników komunikacji otworzyć i ich wywołano metodę RunAsync.</span><span class="sxs-lookup"><span data-stu-id="0a128-190">While a stateful service is running, only hello Primary replicas of that stateful services have their communication listeners opened and their RunAsync method called.</span></span> <span data-ttu-id="0a128-191">Pomocniczy są wykonane, ale Zobacz nie kolejne wywołania.</span><span class="sxs-lookup"><span data-stu-id="0a128-191">Secondary are constructed but see no further calls.</span></span> <span data-ttu-id="0a128-192">Po uruchomieniu usługi stanowej jednak repliki, który jest obecnie hello podstawowej można zmienić.</span><span class="sxs-lookup"><span data-stu-id="0a128-192">While a stateful service is running however, which replica is currently hello Primary can change.</span></span> <span data-ttu-id="0a128-193">Co to znaczy w kategoriach zdarzenia cyklu życia hello widoczne dla repliki Hello zachowanie hello stanowe repliki widzi zależy od tego, czy jest hello repliki trwa obniżyć poziom jest podwyższany podczas wymiany hello.</span><span class="sxs-lookup"><span data-stu-id="0a128-193">What does this mean in terms of hello lifecycle events that a replica can see? hello behavior hello stateful replica sees depends on whether it is hello replica being demoted or promoted during hello swap.</span></span>

### <a name="for-hello-primary-being-demoted"></a><span data-ttu-id="0a128-194">Dla hello jest obniżenie poziomu podstawowego</span><span class="sxs-lookup"><span data-stu-id="0a128-194">For hello primary being demoted</span></span>
<span data-ttu-id="0a128-195">Sieć szkieletowa usług musi toostop tej repliki, przetwarzanie wiadomości i zakończyć pracę tła, których wykonywanie operacji.</span><span class="sxs-lookup"><span data-stu-id="0a128-195">Service Fabric needs this replica toostop processing messages and quit any background work it is doing.</span></span> <span data-ttu-id="0a128-196">W związku z tym kroku wygląda podobnie toowhen hello usługa ta jest zamykany.</span><span class="sxs-lookup"><span data-stu-id="0a128-196">As a result, this step looks similar toowhen hello service is being shut down.</span></span> <span data-ttu-id="0a128-197">Jeden różnica polega na tym hello usługi nie jest niszczone lub zamknięte, ponieważ pozostaje pomocniczego.</span><span class="sxs-lookup"><span data-stu-id="0a128-197">One difference is that hello Service isn't destructed or closed since it remains as a Secondary.</span></span> <span data-ttu-id="0a128-198">Witaj następujące interfejsy API są nazywane:</span><span class="sxs-lookup"><span data-stu-id="0a128-198">hello following APIs are called:</span></span>

1. <span data-ttu-id="0a128-199">Równoległe</span><span class="sxs-lookup"><span data-stu-id="0a128-199">In parallel</span></span>
    - <span data-ttu-id="0a128-200">Są zamykane wszystkie otwarte odbiorników.</span><span class="sxs-lookup"><span data-stu-id="0a128-200">Any open listeners are Closed.</span></span> <span data-ttu-id="0a128-201">`ICommunicationListener.CloseAsync()`jest wywoływana na każdym odbiornika.</span><span class="sxs-lookup"><span data-stu-id="0a128-201">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="0a128-202">token anulowania Hello przekazano zbyt`RunAsync()` zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="0a128-202">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="0a128-203">Sprawdzanie, czy hello token anulowania na `IsCancellationRequested` właściwość zwraca wartość true i jeśli wywołuje hello token `ThrowIfCancellationRequested` metoda zgłasza `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="0a128-203">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="0a128-204">Raz `CloseAsync()` uzupełnia w każdym odbiornika i `RunAsync()` również zakończeniu hello usługi `StatefulServiceBase.OnChangeRoleAsync()` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-204">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="0a128-205">To jest zastępowany uncommonly hello usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-205">This is uncommonly overridden in hello service.</span></span>

### <a name="for-hello-secondary-being-promoted"></a><span data-ttu-id="0a128-206">Dla hello dodatkowej, której poziom jest podwyższany</span><span class="sxs-lookup"><span data-stu-id="0a128-206">For hello secondary being promoted</span></span>
<span data-ttu-id="0a128-207">Podobnie sieci szkieletowej usług wymaga tego toostart repliki nasłuchuje wiadomości umieszczonego hello i uruchomić wszystkie zadania w tle, który go dba o.</span><span class="sxs-lookup"><span data-stu-id="0a128-207">Similarly, Service Fabric needs this replica toostart listening for messages on hello wire and start any background tasks it cares about.</span></span> <span data-ttu-id="0a128-208">Dzięki temu wygląda ten proces, podobne usługi hello toowhen jest tworzona, z wyjątkiem ta replika hello się już istnieje.</span><span class="sxs-lookup"><span data-stu-id="0a128-208">As a result, this process looks similar toowhen hello service is created, except that hello replica itself already exists.</span></span> <span data-ttu-id="0a128-209">Witaj następujące interfejsy API są nazywane:</span><span class="sxs-lookup"><span data-stu-id="0a128-209">hello following APIs are called:</span></span>

1. <span data-ttu-id="0a128-210">Równoległe</span><span class="sxs-lookup"><span data-stu-id="0a128-210">In parallel</span></span>
    - <span data-ttu-id="0a128-211">`StatefulServiceBase.CreateServiceReplicaListeners()`jest wywoływany i wszystkie zwracane obiekty nasłuchujące są otwarte.</span><span class="sxs-lookup"><span data-stu-id="0a128-211">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="0a128-212">`ICommunicationListener.OpenAsync()`jest wywoływana na każdym odbiornika.</span><span class="sxs-lookup"><span data-stu-id="0a128-212">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="0a128-213">Witaj usługi `StatefulServiceBase.RunAsync()` metoda jest wywoływana</span><span class="sxs-lookup"><span data-stu-id="0a128-213">hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
2. <span data-ttu-id="0a128-214">Po hello wszystkie repliki odbiornika `OpenAsync()` ukończenia wywołania i `RunAsync()` została wywołana, `StatefulServiceBase.OnChangeRoleAsync()` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="0a128-214">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` has been called,  `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="0a128-215">To jest zastępowany uncommonly hello usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-215">This is uncommonly overridden in hello service.</span></span>

### <a name="common-issues-during-stateful-service-shutdown-and-primary-demotion"></a><span data-ttu-id="0a128-216">Typowe problemy podczas zamykania usługi stanowej i obniżania poziomu podstawowego</span><span class="sxs-lookup"><span data-stu-id="0a128-216">Common issues during stateful service shutdown and primary demotion</span></span>
<span data-ttu-id="0a128-217">Zmiany usługi sieć szkieletowa hello podstawowej usługi stanowej z różnych przyczyn.</span><span class="sxs-lookup"><span data-stu-id="0a128-217">Service Fabric changes hello Primary of a stateful service for a variety of reasons.</span></span> <span data-ttu-id="0a128-218">Witaj najczęściej są [klastra, ponowne równoważenie](service-fabric-cluster-resource-manager-balancing.md) i [uaktualniania aplikacji](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="0a128-218">hello most common are [cluster rebalancing](service-fabric-cluster-resource-manager-balancing.md) and [application upgrade](service-fabric-application-upgrade.md).</span></span> <span data-ttu-id="0a128-219">Podczas tych czynności (a także podczas zamykania usługi normalnych, jak można zobaczyć, czy usługa hello usunięto), ważne jest, że hello względem usługi hello `CancellationToken`.</span><span class="sxs-lookup"><span data-stu-id="0a128-219">During these operations (as well as during normal service shutdown, like you'd see if hello service was deleted), it is important that hello service respect hello `CancellationToken`.</span></span> <span data-ttu-id="0a128-220">Usługi, które nie obsługują anulowania prawidłowo może wystąpić pewne problemy.</span><span class="sxs-lookup"><span data-stu-id="0a128-220">Services that do not handle cancellation cleanly will experience several issues.</span></span> <span data-ttu-id="0a128-221">W szczególności tych operacji będzie zajmować dużo czasu, ponieważ oczekuje na powitania toostop usług bezpiecznie sieci szkieletowej usług.</span><span class="sxs-lookup"><span data-stu-id="0a128-221">In particular, these operations will be slow since Service Fabric waits for hello services toostop gracefully.</span></span> <span data-ttu-id="0a128-222">Ostatecznie to prowadzić toofailed uaktualnienia tego limitu czasu i wycofać.</span><span class="sxs-lookup"><span data-stu-id="0a128-222">This can ultimately lead toofailed upgrades that time out and roll back.</span></span> <span data-ttu-id="0a128-223">Token anulowania hello toohonor błąd może również spowodować imbalanced klastrów, ponieważ węzłów uzyskiwanie dostępu, ale nie można rebalanced hello usługi, ponieważ trwa zbyt długo toomove je w innym miejscu.</span><span class="sxs-lookup"><span data-stu-id="0a128-223">Failure toohonor hello cancellation token can also cause imbalanced clusters because nodes get hot but hello services can't be rebalanced since it takes too long toomove them elsewhere.</span></span> 

<span data-ttu-id="0a128-224">Ponieważ hello usługi stanowej, również jest prawdopodobne, że używają hello [niezawodnej kolekcje](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="0a128-224">Since hello services are stateful, it is also likely that they are using hello [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="0a128-225">W sieci szkieletowej usług podczas obniżania poziomu głównego, jednym z hello pierwszych rzeczy, które się stanie, jest odebraniu podstawowy stan toohello dostęp do zapisu.</span><span class="sxs-lookup"><span data-stu-id="0a128-225">In Service Fabric, when a Primary is demoted, one of hello first things that happens is that write access toohello underlying state is revoked.</span></span> <span data-ttu-id="0a128-226">Prowadzi to drugi zestaw tooa problemów, które mogą mieć wpływ na hello cyklu życia usług.</span><span class="sxs-lookup"><span data-stu-id="0a128-226">This leads tooa second set of issues that can impact hello service lifecycle.</span></span> <span data-ttu-id="0a128-227">kolekcje Hello zwracany wyjątków na podstawie czasu hello i czy repliki hello jest przenoszony lub zamykania.</span><span class="sxs-lookup"><span data-stu-id="0a128-227">hello collections return Exceptions based on hello timing and whether hello replica is being moved or shut down.</span></span> <span data-ttu-id="0a128-228">Te wyjątki powinny być traktowane jako poprawnie.</span><span class="sxs-lookup"><span data-stu-id="0a128-228">These exceptions should be handled correctly.</span></span> <span data-ttu-id="0a128-229">Wyjątki generowane przez sieć szkieletowa usług można podzielić na stałe [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) i przejściowych [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) kategorii.</span><span class="sxs-lookup"><span data-stu-id="0a128-229">Exceptions thrown by Service Fabric fall into permanent [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) and transient [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) categories.</span></span> <span data-ttu-id="0a128-230">Stałe wyjątki powinny być rejestrowane i zgłoszony podczas wyjątki przejściowej hello może ponowione opartych na logice niektórych ponów próbę.</span><span class="sxs-lookup"><span data-stu-id="0a128-230">Permanent exceptions should be logged and thrown, while hello transient exceptions may be retried based on some retry logic.</span></span>

<span data-ttu-id="0a128-231">Obsługa wyjątków hello, które pochodzą od stosowania hello `ReliableCollections` w połączeniu z zdarzenia cyklu życia usługi jest ważnym elementem przetestowaniu i zweryfikowaniu niezawodnej usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-231">Handling hello exceptions that come from use of hello `ReliableCollections` in conjunction with service lifecycle events is an important part of testing and validating a Reliable Service.</span></span> <span data-ttu-id="0a128-232">Witaj zalecenie jest zawsze toorun usługi Obciążenie podczas wykonywania uaktualnienia i [testowania chaos](service-fabric-controlled-chaos.md) przed wdrożeniem kiedykolwiek tooproduction.</span><span class="sxs-lookup"><span data-stu-id="0a128-232">hello recommendation is always toorun your service under load while performing upgrades and [chaos testing](service-fabric-controlled-chaos.md) before ever deploying tooproduction.</span></span> <span data-ttu-id="0a128-233">Te podstawowe kroki pomoc, sprawdź, czy usługa jest poprawnie zaimplementowana i poprawnie obsługuje zdarzenia cyklu życia.</span><span class="sxs-lookup"><span data-stu-id="0a128-233">These basic steps help ensure that your service is correctly implemented and handles lifecycle events correctly.</span></span>


## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="0a128-234">Uwagi dotyczące cyklu życia usług</span><span class="sxs-lookup"><span data-stu-id="0a128-234">Notes on service lifecycle</span></span>
  - <span data-ttu-id="0a128-235">Zarówno hello `RunAsync()` — metoda i hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` wywołania są opcjonalne.</span><span class="sxs-lookup"><span data-stu-id="0a128-235">Both hello `RunAsync()` method and hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="0a128-236">Usługa może mieć ich, zarówno lub nie.</span><span class="sxs-lookup"><span data-stu-id="0a128-236">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="0a128-237">Na przykład, jeśli usługa hello ma jego pracy w wywołaniach toouser odpowiedzi, jest niepotrzebna dla niego tooimplement `RunAsync()`.</span><span class="sxs-lookup"><span data-stu-id="0a128-237">For example, if hello service does all its work in response toouser calls, there is no need for it tooimplement `RunAsync()`.</span></span> <span data-ttu-id="0a128-238">Wymagane są tylko hello odbiorników komunikacji i ich skojarzonego kodu.</span><span class="sxs-lookup"><span data-stu-id="0a128-238">Only hello communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="0a128-239">Podobnie tworzenie i zwracanie odbiorników komunikacji jest opcjonalne, ponieważ usługa hello może mieć tylko tła pracy toodo i dlatego tylko musi tooimplement`RunAsync()`</span><span class="sxs-lookup"><span data-stu-id="0a128-239">Similarly, creating and returning communication listeners is optional, as hello service may have only background work toodo, and so only needs tooimplement `RunAsync()`</span></span>
  - <span data-ttu-id="0a128-240">Jest on prawidłowy dla toocomplete usługi `RunAsync()` pomyślnie i z powrotem od niego.</span><span class="sxs-lookup"><span data-stu-id="0a128-240">It is valid for a service toocomplete `RunAsync()` successfully and return from it.</span></span> <span data-ttu-id="0a128-241">Kończenie pracy nie jest warunek błędu.</span><span class="sxs-lookup"><span data-stu-id="0a128-241">Completing is not a failure condition.</span></span> <span data-ttu-id="0a128-242">Kończenie pracy `RunAsync()` wskazuje, czy praca w tle hello hello usługi zostało zakończone.</span><span class="sxs-lookup"><span data-stu-id="0a128-242">Completing `RunAsync()` indicates that hello background work of hello service has completed.</span></span> <span data-ttu-id="0a128-243">Dla stanowych usług niezawodne `RunAsync()` zostanie ponownie wywołany, jeśli replika hello nastąpiło obniżenie poziomu z głównej tooSecondary i podwyższenia poziomu tooPrimary Wstecz.</span><span class="sxs-lookup"><span data-stu-id="0a128-243">For stateful reliable services, `RunAsync()` is called again if hello replica were demoted from Primary tooSecondary and then promoted back tooPrimary.</span></span>
  - <span data-ttu-id="0a128-244">Jeśli zamknie usługę `RunAsync()` przez zgłaszanie nieoczekiwany wyjątek, powoduje błąd.</span><span class="sxs-lookup"><span data-stu-id="0a128-244">If a service exits from `RunAsync()` by throwing some unexpected exception, this constitutes a failure.</span></span> <span data-ttu-id="0a128-245">Obiekt usługi Hello jest zamknięta i zgłoszony błąd kondycji.</span><span class="sxs-lookup"><span data-stu-id="0a128-245">hello service object is shut down and a health error reported.</span></span>
  - <span data-ttu-id="0a128-246">Gdy nie ma żadnego limitu czasu na zwracanie z tych metod, natychmiast utraty hello możliwości toowrite tooReliable kolekcji i z tego powodu nie można ukończyć rzeczywistą pracę.</span><span class="sxs-lookup"><span data-stu-id="0a128-246">While there is no time limit on returning from these methods, you immediately lose hello ability toowrite tooReliable Collections and therefore cannot complete any real work.</span></span> <span data-ttu-id="0a128-247">Należy zwrócić możliwie jak najszybciej po otrzymaniu żądania anulowania hello jest zalecane.</span><span class="sxs-lookup"><span data-stu-id="0a128-247">It is recommended that you return as quickly as possible upon receiving hello cancellation request.</span></span> <span data-ttu-id="0a128-248">Jeśli usługa nie odpowiada wywołania toothese interfejsu API w rozsądnym czasie, Service Fabric może wymusić przerwanie usługi.</span><span class="sxs-lookup"><span data-stu-id="0a128-248">If your service does not respond toothese API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="0a128-249">Zwykle to tylko odbywa się podczas uaktualniania aplikacji lub gdy usługa jest usuwana.</span><span class="sxs-lookup"><span data-stu-id="0a128-249">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="0a128-250">Tego limitu czasu wynosi 15 minut domyślnie.</span><span class="sxs-lookup"><span data-stu-id="0a128-250">This timeout is 15 minutes by default.</span></span>
  - <span data-ttu-id="0a128-251">Błędy w hello `OnCloseAsync()` doprowadzi do ścieżki `OnAbort()` wywoływana, która jest możliwość optymalnych ostatniej szansy hello usługi tooclean w górę i zwolnić wszystkie zasoby, które zostały przejęte one.</span><span class="sxs-lookup"><span data-stu-id="0a128-251">Failures in hello `OnCloseAsync()` path result in `OnAbort()` being called which is a last-chance best-effort opportunity for hello service tooclean up and release any resources that they have claimed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0a128-252">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="0a128-252">Next steps</span></span>
- [<span data-ttu-id="0a128-253">Wprowadzenie tooReliable usług</span><span class="sxs-lookup"><span data-stu-id="0a128-253">Introduction tooReliable Services</span></span>](service-fabric-reliable-services-introduction.md)
- [<span data-ttu-id="0a128-254">Niezawodne usługi szybki start</span><span class="sxs-lookup"><span data-stu-id="0a128-254">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
- [<span data-ttu-id="0a128-255">Niezawodne usługi advanced użycia</span><span class="sxs-lookup"><span data-stu-id="0a128-255">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
