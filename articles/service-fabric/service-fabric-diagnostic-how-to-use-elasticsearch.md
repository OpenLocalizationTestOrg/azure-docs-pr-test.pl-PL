---
title: "Przy użyciu Elasticsearch jako magazyn śledzenia aplikacji sieci szkieletowej usług | Dokumentacja firmy Microsoft"
description: "Opis sposobu aplikacji usługi Service Fabric użyciu Elasticsearch i Kibana wyszukiwania za pomocą śladów aplikacji (Dzienniki) i przechowywać indeksu,"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: 2d2ceceea131b41ad1a1735aaa2a859d035ab098
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="caddb-103">Przechowywanie Elasticsearch używany jako śledzenia aplikacji sieci szkieletowej usług</span><span class="sxs-lookup"><span data-stu-id="caddb-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="caddb-104">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="caddb-104">Introduction</span></span>
<span data-ttu-id="caddb-105">W tym artykule opisano sposób [sieć szkieletowa usług Azure](https://azure.microsoft.com/documentation/services/service-fabric/) aplikacje mogą używać **Elasticsearch** i **Kibana** dla magazynu śledzenia aplikacji, indeksowanie i wyszukiwanie.</span><span class="sxs-lookup"><span data-stu-id="caddb-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="caddb-106">[Elasticsearch](https://www.elastic.co/guide/index.html) jest open source, rozproszone i skalowalne w czasie rzeczywistym wyszukiwania i analiza mechanizm, który dobrze nadaje się do tego zadania.</span><span class="sxs-lookup"><span data-stu-id="caddb-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="caddb-107">Można go zainstalować na maszynach wirtualnych Windows i Linux, działają na platformie Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="caddb-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="caddb-108">Elasticsearch wydajnie może przetwarzać *strukturalnych* śladów utworzone przy użyciu technologii, takich jak **funkcji Śledzenie zdarzeń systemu Windows ()**.</span><span class="sxs-lookup"><span data-stu-id="caddb-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="caddb-109">ETW jest używany przez środowisko uruchomieniowe usługi sieć szkieletowa do źródła informacji diagnostycznych (śladów).</span><span class="sxs-lookup"><span data-stu-id="caddb-109">ETW is used by Service Fabric runtime to source diagnostic information (traces).</span></span> <span data-ttu-id="caddb-110">Jest zalecana metoda zbyt źródła ich informacje diagnostyczne, aplikacji sieci szkieletowej usług.</span><span class="sxs-lookup"><span data-stu-id="caddb-110">It is the recommended method for Service Fabric applications to source their diagnostic information, too.</span></span> <span data-ttu-id="caddb-111">Ten sam mechanizm umożliwia korelacji między dostarczone przez środowisko uruchomieniowe i aplikacja dostarczona śladów i sprawia, że rozwiązania problemu.</span><span class="sxs-lookup"><span data-stu-id="caddb-111">Using the same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="caddb-112">Interfejs API rejestrowania obejmują szablony projektów sieci szkieletowej usług w programie Visual Studio (oparte na .NET **EventSource** klasy) który emituje śladów ETW. domyślnie.</span><span class="sxs-lookup"><span data-stu-id="caddb-112">Service Fabric project templates in Visual Studio include a logging API (based on the .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="caddb-113">Ogólne omówienie aplikacji usługi Service Fabric śledzenia przy użyciu funkcji ETW, zobacz [monitorowania i diagnozowania usług w Instalatorze programowanie komputera lokalnego](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="caddb-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="caddb-114">Dla danych śledzenia w Elasticsearch muszą być zarejestrowane w węzłach klastra sieci szkieletowej usług w czasie rzeczywistym (gdy aplikacja jest uruchomiona) i wysyłane do punktu końcowego Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="caddb-114">For the traces to show up in Elasticsearch, they need to be captured at the Service Fabric cluster nodes in real time (while the application is running) and sent to an Elasticsearch endpoint.</span></span> <span data-ttu-id="caddb-115">Dostępne są dwie główne opcje do przechwytywania śledzenia:</span><span class="sxs-lookup"><span data-stu-id="caddb-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="caddb-116">**W procesie przechwytywania śledzenia**</span><span class="sxs-lookup"><span data-stu-id="caddb-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="caddb-117">Aplikacja lub bardziej precyzyjnie procesu usługi, jest odpowiedzialny za wysyłanie danych diagnostycznych w magazynie śledzenia (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="caddb-117">The application, or more precisely, service process, is responsible for sending out the diagnostic data to the trace store (Elasticsearch).</span></span>
* <span data-ttu-id="caddb-118">**Przechwytywanie śledzenia poza procesem.**</span><span class="sxs-lookup"><span data-stu-id="caddb-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="caddb-119">Oddzielnym agentem jest przechwytywanie śladów pochodzących z procesu usługi lub procesów i wysyłania ich do sklepu śledzenia.</span><span class="sxs-lookup"><span data-stu-id="caddb-119">A separate agent is capturing traces from the service process or processes and sending them to the trace store.</span></span>

<span data-ttu-id="caddb-120">Poniżej możemy opisano, jak skonfigurować Elasticsearch na platformie Azure, omówiono w nim zalety i wady obu przechwytywania opcje i wyjaśniono, jak skonfigurować usługę sieci szkieletowej usług w celu wysyłania danych do Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="caddb-120">Below, we describe how to set up Elasticsearch on Azure, discuss the pros and cons for both capture options, and explain how to configure a Service Fabric service to send data to Elasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="caddb-121">Konfigurowanie Elasticsearch na platformie Azure</span><span class="sxs-lookup"><span data-stu-id="caddb-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="caddb-122">Najbardziej oczywistym sposobem skonfigurowania usługi Elasticsearch na platformie Azure jest za pośrednictwem [ **szablonów usługi Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="caddb-122">The most straightforward way to set up the Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="caddb-123">Zaawansowane [szablon szybkiego startu usługi Azure Resource Manager dla Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) jest dostępna z repozytorium szablonów Szybki Start Azure.</span><span class="sxs-lookup"><span data-stu-id="caddb-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="caddb-124">Ten szablon używa oddzielny magazyn kont dla jednostki skali (grupy węzłów).</span><span class="sxs-lookup"><span data-stu-id="caddb-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="caddb-125">Można również udostępniać, klienckim oddzielnie i węzły serwera z różnymi konfiguracjami oraz różne numery dyskach danych dołączonych.</span><span class="sxs-lookup"><span data-stu-id="caddb-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="caddb-126">W tym miejscu korzystamy z innego szablonu, nazywane **ES MultiNode** z [repozytorium Azure narzędzia diagnostyczne](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="caddb-126">Here, we use another template, called **ES-MultiNode** from the [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="caddb-127">Ten szablon jest łatwiejsza w użyciu, i tworzy klastra Elasticsearch zabezpieczone przy użyciu podstawowego uwierzytelniania HTTP.</span><span class="sxs-lookup"><span data-stu-id="caddb-127">This template is easier to use, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="caddb-128">Przed kontynuowaniem pobierz repozytorium z serwisu GitHub do komputera (przez klonowanie repozytorium lub pobieranie pliku zip).</span><span class="sxs-lookup"><span data-stu-id="caddb-128">Before you proceed, download the repository from GitHub to your machine (by either cloning the repository or downloading a zip file).</span></span> <span data-ttu-id="caddb-129">Szablon ES MultiNode znajduje się w folderze o tej samej nazwie.</span><span class="sxs-lookup"><span data-stu-id="caddb-129">The ES-MultiNode template is located in the folder with the same name.</span></span>

### <a name="prepare-a-machine-to-run-elasticsearch-installation-scripts"></a><span data-ttu-id="caddb-130">Przygotowanie maszyny do uruchamiania skryptów instalacji Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="caddb-130">Prepare a machine to run Elasticsearch installation scripts</span></span>
<span data-ttu-id="caddb-131">Najprostszym sposobem, aby użyć szablonu ES MultiNode odbywa się za pośrednictwem dostarczonego skryptu programu PowerShell systemu Azure o nazwie `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="caddb-131">The easiest way to use the ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="caddb-132">Aby użyć tego skryptu, musisz zainstalować moduły programu PowerShell i narzędzie **openssl**.</span><span class="sxs-lookup"><span data-stu-id="caddb-132">To use this script, you need to install PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="caddb-133">Drugie jest niezbędny do utworzenia klucza SSH, który może służyć do administrowania klastrem Elasticsearch zdalnie.</span><span class="sxs-lookup"><span data-stu-id="caddb-133">The latter is needed for creating an SSH key that can be used to administer your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="caddb-134">`CreateElasticSearchCluster`skrypt jest przeznaczona dla łatwość użycia przy użyciu szablonu ES MultiNode z komputera z systemem Windows.</span><span class="sxs-lookup"><span data-stu-id="caddb-134">`CreateElasticSearchCluster` script is designed for ease of use with the ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="caddb-135">Można użyć szablonu na komputerze z systemem innym niż Windows, ale w tym scenariuszu wykracza poza zakres tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="caddb-135">It is possible to use the template on a non-Windows machine, but that scenario is beyond the scope of this article.</span></span>

1. <span data-ttu-id="caddb-136">Jeśli ich nie zainstalowano już, zainstaluj [ **modułów programu Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="caddb-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="caddb-137">Po wyświetleniu monitu kliknij przycisk **Uruchom**, następnie **zainstalować**.</span><span class="sxs-lookup"><span data-stu-id="caddb-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="caddb-138">Program Azure PowerShell 1.3 lub nowszy jest wymagany.</span><span class="sxs-lookup"><span data-stu-id="caddb-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="caddb-139">**Openssl** narzędzie znajduje się w dystrybucji [ **Git dla systemu Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="caddb-139">The **openssl** tool is included in the distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="caddb-140">Jeśli jeszcze tego nie zrobiono, zainstaluj [Git dla systemu Windows](http://www.git-scm.com/downloads) teraz.</span><span class="sxs-lookup"><span data-stu-id="caddb-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="caddb-141">(Domyślne opcje instalacji są OK).</span><span class="sxs-lookup"><span data-stu-id="caddb-141">(The default installation options are OK.)</span></span>
3. <span data-ttu-id="caddb-142">Przy założeniu, że Git został zainstalowany, ale nie jest uwzględniony w ścieżce systemowej, Otwórz okno programu Microsoft Azure PowerShell i uruchom następujące polecenia:</span><span class="sxs-lookup"><span data-stu-id="caddb-142">Assuming that Git has been installed but not included in the system path, open a Microsoft Azure PowerShell window and run the following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="caddb-143">Zastąp `<Git installation folder>` z lokalizacji Git na tym komputerze; wartość domyślna to **"C:\Program Files\Git"**.</span><span class="sxs-lookup"><span data-stu-id="caddb-143">Replace the `<Git installation folder>` with the Git location on your machine; the default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="caddb-144">Należy zwrócić uwagę na początku ścieżki pierwszym znakiem średnika.</span><span class="sxs-lookup"><span data-stu-id="caddb-144">Note the semicolon character at the beginning of the first path.</span></span>
4. <span data-ttu-id="caddb-145">Upewnij się, że użytkownik jest zalogowany na platformie Azure (za pośrednictwem [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) polecenia cmdlet) i po wybraniu subskrypcji, które mają być używane do tworzenia klastra elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-145">Ensure that you are logged on to Azure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected the subscription that should be used to create your Elastic Search cluster.</span></span> <span data-ttu-id="caddb-146">Można sprawdzić, czy wybrano poprawną subskrypcję za pomocą `Get-AzureRmContext` i `Get-AzureRmSubscription` polecenia cmdlet.</span><span class="sxs-lookup"><span data-stu-id="caddb-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="caddb-147">Jeśli jeszcze tego nie zrobiono tego wcześniej, zmień bieżący katalog na folder ES MultiNode.</span><span class="sxs-lookup"><span data-stu-id="caddb-147">If you haven't done so already, change the current directory to the ES-MultiNode folder.</span></span>

### <a name="run-the-createelasticsearchcluster-script"></a><span data-ttu-id="caddb-148">Uruchom skrypt CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="caddb-148">Run the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="caddb-149">Przed uruchomieniem skryptu Otwórz `azuredeploy-parameters.json` pliku Sprawdź i podaj wartości parametrów skryptu.</span><span class="sxs-lookup"><span data-stu-id="caddb-149">Before you run the script, open the `azuredeploy-parameters.json` file and verify or provide values for the script parameters.</span></span> <span data-ttu-id="caddb-150">Dostępne są następujące parametry:</span><span class="sxs-lookup"><span data-stu-id="caddb-150">The following parameters are provided:</span></span>

| <span data-ttu-id="caddb-151">Nazwa parametru</span><span class="sxs-lookup"><span data-stu-id="caddb-151">Parameter Name</span></span> | <span data-ttu-id="caddb-152">Opis</span><span class="sxs-lookup"><span data-stu-id="caddb-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="caddb-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="caddb-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="caddb-154">Nazwa, która służy do tworzenia publicznie widoczna nazwa DNS dla klastra elastycznej wyszukiwania (dołączając do podanej nazwy domeny region platformy Azure).</span><span class="sxs-lookup"><span data-stu-id="caddb-154">The name that is used to create the publicly visible DNS name for the Elastic Search cluster (by appending the Azure region domain to the provided name).</span></span> <span data-ttu-id="caddb-155">Na przykład jeśli wartość tego parametru jest "myBigCluster", a wybrany region platformy Azure to zachodnie stany USA, wynikowa nazwa DNS dla klastra jest myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="caddb-155">For example, if this parameter value is "myBigCluster" and the chosen Azure region is West US, the resulting DNS name for the cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="caddb-156">Ta nazwa służy również jako nazwę wiele artefakty skojarzone z klastrem elastycznej wyszukiwania, takie jak bazy danych, nazwy węzła głównego.</span><span class="sxs-lookup"><span data-stu-id="caddb-156">This name also serves as a root name for many artifacts associated with the Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="caddb-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="caddb-157">adminUsername</span></span> |<span data-ttu-id="caddb-158">Nazwa konta administratora do zarządzania klastrem elastycznej wyszukiwania (odpowiadające im klucze SSH wygenerowaniu automatycznie).</span><span class="sxs-lookup"><span data-stu-id="caddb-158">The name of the administrator account for managing the Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="caddb-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="caddb-159">dataNodeCount</span></span> |<span data-ttu-id="caddb-160">Liczba węzłów w klastrze elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-160">The number of nodes in the Elastic Search cluster.</span></span> <span data-ttu-id="caddb-161">Bieżąca wersja skryptu nie rozróżnia między węzłami danych i zapytania. wszystkie węzły odtworzyć obie role.</span><span class="sxs-lookup"><span data-stu-id="caddb-161">The current version of the script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="caddb-162">Wartość domyślna to 3 węzłach.</span><span class="sxs-lookup"><span data-stu-id="caddb-162">Defaults to 3 nodes.</span></span> |
| <span data-ttu-id="caddb-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="caddb-163">dataDiskSize</span></span> |<span data-ttu-id="caddb-164">Rozmiar dysków danych (w GB) przypisany do każdego węzła danych.</span><span class="sxs-lookup"><span data-stu-id="caddb-164">The size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="caddb-165">Każdy węzeł odbiera 4 dyski danych, przeznaczona wyłącznie do usługi wyszukiwania elastycznej.</span><span class="sxs-lookup"><span data-stu-id="caddb-165">Each node receives 4 data disks, exclusively dedicated to Elastic Search service.</span></span> |
| <span data-ttu-id="caddb-166">Region</span><span class="sxs-lookup"><span data-stu-id="caddb-166">region</span></span> |<span data-ttu-id="caddb-167">Nazwa regionu Azure, gdzie powinien być zlokalizowany klastra elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-167">The name of Azure region where the Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="caddb-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="caddb-168">esUserName</span></span> |<span data-ttu-id="caddb-169">Nazwa użytkownika użytkownik, który jest skonfigurowany do dostępu do klastra ES (zgodnie z uwierzytelniania podstawowego HTTP).</span><span class="sxs-lookup"><span data-stu-id="caddb-169">The user name of the user that is configured to have access to ES cluster (subject to HTTP basic authentication).</span></span> <span data-ttu-id="caddb-170">Hasło nie jest częścią pliku parametrów i należy podać podczas `CreateElasticSearchCluster` skrypt zostanie wywołany.</span><span class="sxs-lookup"><span data-stu-id="caddb-170">The password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="caddb-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="caddb-171">vmSizeDataNodes</span></span> |<span data-ttu-id="caddb-172">Rozmiar maszyny wirtualnej platformy Azure dla węzłów klastra elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-172">The Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="caddb-173">Wartość domyślna to Standard_D2.</span><span class="sxs-lookup"><span data-stu-id="caddb-173">Defaults to Standard_D2.</span></span> |

<span data-ttu-id="caddb-174">Teraz można przystąpić do uruchomienia skryptu.</span><span class="sxs-lookup"><span data-stu-id="caddb-174">Now you are ready to run the script.</span></span> <span data-ttu-id="caddb-175">Należy wydać następujące polecenie:</span><span class="sxs-lookup"><span data-stu-id="caddb-175">Issue the following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="caddb-176">gdzie</span><span class="sxs-lookup"><span data-stu-id="caddb-176">where</span></span> 

| <span data-ttu-id="caddb-177">Nazwa parametru skryptu</span><span class="sxs-lookup"><span data-stu-id="caddb-177">Script Parameter Name</span></span> | <span data-ttu-id="caddb-178">Opis</span><span class="sxs-lookup"><span data-stu-id="caddb-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="caddb-179">Nazwa grupy zasobów platformy Azure, która będzie zawierać wszystkich zasobów klastra elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-179">The name of the Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="caddb-180">Nazwa region platformy Azure, w którym ma zostać utworzony klaster elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-180">The name of the Azure region where the Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="caddb-181">Hasło użytkownika elastycznej wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="caddb-181">The password for the Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="caddb-182">Jeśli otrzymasz NullReferenceException z polecenia cmdlet Test-AzureResourceGroup pamiętasz do logowania się do platformy Azure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="caddb-182">If you get a NullReferenceException from the Test-AzureResourceGroup cmdlet, you have forgotten to log on to Azure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="caddb-183">Jeśli okaże się, że błąd został spowodowany przez wartość parametru szablonu niewłaściwy wystąpi błąd uruchomienia skryptu, Popraw plik parametru i ponownie uruchom skrypt z nazwą grupy innego zasobu.</span><span class="sxs-lookup"><span data-stu-id="caddb-183">If you get an error from running the script and you determine that the error was caused by a wrong template parameter value, correct the parameter file and run the script again with a different resource group name.</span></span> <span data-ttu-id="caddb-184">Można ponownie użyć tej samej nazwy grupy zasobów i mieć skrypt czyszczenia starego przez dodanie `-RemoveExistingResourceGroup` parametr, aby można było wywołać skryptu.</span><span class="sxs-lookup"><span data-stu-id="caddb-184">You can also reuse the same resource group name and have the script clean up the old one by adding the `-RemoveExistingResourceGroup` parameter to the script invocation.</span></span>

### <a name="result-of-running-the-createelasticsearchcluster-script"></a><span data-ttu-id="caddb-185">Wynik uruchomienia skryptu CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="caddb-185">Result of running the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="caddb-186">Po uruchomieniu `CreateElasticSearchCluster` skryptu następujące główne artefakty zostanie utworzony.</span><span class="sxs-lookup"><span data-stu-id="caddb-186">After you run the `CreateElasticSearchCluster` script, the following main artifacts will be created.</span></span> <span data-ttu-id="caddb-187">W tym przykładzie przyjęto założenie, że użyto "myBigCluster" jako wartości `dnsNameForLoadBalancerIP` parametr i że region, w którym utworzono klaster jest zachodnie stany USA.</span><span class="sxs-lookup"><span data-stu-id="caddb-187">For this example we assume that you have used "myBigCluster" as the value of the `dnsNameForLoadBalancerIP` parameter and that the region where you created the cluster is West US.</span></span>

| <span data-ttu-id="caddb-188">Artefaktów</span><span class="sxs-lookup"><span data-stu-id="caddb-188">Artifact</span></span> | <span data-ttu-id="caddb-189">Nazwa, lokalizacja i uwagi</span><span class="sxs-lookup"><span data-stu-id="caddb-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="caddb-190">Klucz SSH dla administracji zdalnej</span><span class="sxs-lookup"><span data-stu-id="caddb-190">SSH key for remote administration</span></span> |<span data-ttu-id="caddb-191">Plik myBigCluster.key (w katalogu, z którego zostało uruchomione CreateElasticSearchCluster).</span><span class="sxs-lookup"><span data-stu-id="caddb-191">myBigCluster.key file (in the directory from which the CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="caddb-192">Ten plik klucza może służyć do połączenia do węzła administratora i (za pośrednictwem węzła administratora) danych w węzłach klastra.</span><span class="sxs-lookup"><span data-stu-id="caddb-192">This key file can be used to connect to the admin node and (through the admin node) to data nodes in the cluster.</span></span> |
| <span data-ttu-id="caddb-193">Węzeł administratora</span><span class="sxs-lookup"><span data-stu-id="caddb-193">Admin node</span></span> |<span data-ttu-id="caddb-194">myBigCluster admin.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="caddb-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="caddb-195">Dedykowane maszyny Wirtualnej dla zdalnego administrowania klastrami Elasticsearch — tylko jeden, który zezwala na zewnętrzne połączenia SSH.</span><span class="sxs-lookup"><span data-stu-id="caddb-195">A dedicated VM for remote Elasticsearch cluster administration--the only one that allows external SSH connections.</span></span> <span data-ttu-id="caddb-196">Jest uruchamiany na tej samej sieci wirtualnej wszystkie węzły klastra Elasticsearch, ale nie uruchamia wszystkie usługi Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="caddb-196">It runs on the same virtual network as all the Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="caddb-197">Węzły danych</span><span class="sxs-lookup"><span data-stu-id="caddb-197">Data nodes</span></span> |<span data-ttu-id="caddb-198">myBigCluster1...</span><span class="sxs-lookup"><span data-stu-id="caddb-198">myBigCluster1 …</span></span> <span data-ttu-id="caddb-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="caddb-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="caddb-200">Węzły danych, które są uruchomione usługi Elasticsearch i Kibana.</span><span class="sxs-lookup"><span data-stu-id="caddb-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="caddb-201">Możesz połączyć za pośrednictwem protokołu SSH w każdym węźle, ale tylko za pomocą węzła administratora.</span><span class="sxs-lookup"><span data-stu-id="caddb-201">You can connect via SSH to each node, but only via the admin node.</span></span> |
| <span data-ttu-id="caddb-202">Elasticsearch klastra</span><span class="sxs-lookup"><span data-stu-id="caddb-202">Elasticsearch cluster</span></span> |<span data-ttu-id="caddb-203">http://myBigCluster.westus.cloudapp.Azure.com/ES/</span><span class="sxs-lookup"><span data-stu-id="caddb-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="caddb-204">Podstawowy punkt końcowy dla klastra Elasticsearch (Uwaga sufiks /es).</span><span class="sxs-lookup"><span data-stu-id="caddb-204">The primary endpoint for the Elasticsearch cluster (note the /es suffix).</span></span> <span data-ttu-id="caddb-205">Jest on chroniony podstawowego uwierzytelniania HTTP (poświadczenia zostały określone parametry esUserName/esPassword szablonu ES MultiNode).</span><span class="sxs-lookup"><span data-stu-id="caddb-205">It is protected by basic HTTP authentication (the credentials were the specified esUserName/esPassword parameters of the ES-MultiNode template).</span></span> <span data-ttu-id="caddb-206">Klaster ma również nagłówek wtyczki zainstalowane (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) dla administracji podstawowy klaster.</span><span class="sxs-lookup"><span data-stu-id="caddb-206">The cluster has also the head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="caddb-207">Usługa Kibana</span><span class="sxs-lookup"><span data-stu-id="caddb-207">Kibana service</span></span> |<span data-ttu-id="caddb-208">http://myBigCluster.westus.cloudapp.Azure.com</span><span class="sxs-lookup"><span data-stu-id="caddb-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="caddb-209">Usługa Kibana jest skonfigurowana tak, aby wyświetlić dane utworzonego klastra Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="caddb-209">The Kibana service is set up to show data from the created Elasticsearch cluster.</span></span> <span data-ttu-id="caddb-210">Jest on chroniony tych samych poświadczeń uwierzytelniania jako samego klastra.</span><span class="sxs-lookup"><span data-stu-id="caddb-210">It is protected by the same authentication credentials as the cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="caddb-211">W trakcie i przechwytywanie śledzenia poza procesem.</span><span class="sxs-lookup"><span data-stu-id="caddb-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="caddb-212">We wprowadzeniu wspomniano dwa podstawowe sposoby zbierania danych diagnostycznych: w trakcie i poza procesem.</span><span class="sxs-lookup"><span data-stu-id="caddb-212">In the introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="caddb-213">Każdy ma mocne i słabe strony.</span><span class="sxs-lookup"><span data-stu-id="caddb-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="caddb-214">Zalety **w procesie przechwytywania śledzenia** obejmują:</span><span class="sxs-lookup"><span data-stu-id="caddb-214">Advantages of the **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="caddb-215">*Łatwe konfigurowanie i wdrażanie*</span><span class="sxs-lookup"><span data-stu-id="caddb-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="caddb-216">Konfiguracja zbierania danych diagnostycznych jest tylko część konfiguracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="caddb-216">The configuration of diagnostic data collection is just part of the application configuration.</span></span> <span data-ttu-id="caddb-217">To ułatwia zawsze Zachowuj "synchronizację" z resztą aplikacji.</span><span class="sxs-lookup"><span data-stu-id="caddb-217">It is easy to always keep it "in sync" with the rest of the application.</span></span>
   * <span data-ttu-id="caddb-218">Dla każdej aplikacji lub na usługi konfiguracji jest łatwo osiągalny.</span><span class="sxs-lookup"><span data-stu-id="caddb-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="caddb-219">Zazwyczaj przechwytywania śledzenia poza procesem wymaga oddzielnego wdrażania i konfiguracji agenta diagnostyki, jest bardzo administracyjne zadania i potencjalne źródła błędów.</span><span class="sxs-lookup"><span data-stu-id="caddb-219">Out-of-process trace capturing usually requires a separate deployment and configuration of the diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="caddb-220">Technologia określonego agenta umożliwia często tylko jedno wystąpienie agenta dla jednej maszyny wirtualnej (węzeł).</span><span class="sxs-lookup"><span data-stu-id="caddb-220">The particular agent technology often allows only one instance of the agent per virtual machine (node).</span></span> <span data-ttu-id="caddb-221">Oznacza to tej konfiguracji dla kolekcji Konfiguracja diagnostyczna jest współdzielona przez wszystkie aplikacje i usługi działające na tym węźle.</span><span class="sxs-lookup"><span data-stu-id="caddb-221">This means that configuration for the collection of the diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="caddb-222">*Elastyczność*</span><span class="sxs-lookup"><span data-stu-id="caddb-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="caddb-223">Aplikacja może wysyłać dane wszędzie tam, gdzie należy przejść, tak długo, jak jest biblioteka klienta, która obsługuje system magazynowania wybranych danych.</span><span class="sxs-lookup"><span data-stu-id="caddb-223">The application can send the data wherever it needs to go, as long as there is a client library that supports the targeted data storage system.</span></span> <span data-ttu-id="caddb-224">Można dodać nowego wychwytywanie pożądane.</span><span class="sxs-lookup"><span data-stu-id="caddb-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="caddb-225">Złożone zasady przechwytywania, filtrowania i agregacja danych może być zaimplementowany.</span><span class="sxs-lookup"><span data-stu-id="caddb-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="caddb-226">Przechwytywanie śledzenia poza procesem często jest ograniczona przez sink danych, które obsługuje agenta.</span><span class="sxs-lookup"><span data-stu-id="caddb-226">An out-of-process trace capturing is often limited by the data sinks that the agent supports.</span></span> <span data-ttu-id="caddb-227">Niektóre agenci są rozszerzalne.</span><span class="sxs-lookup"><span data-stu-id="caddb-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="caddb-228">*Dostęp do danych aplikacji wewnętrznych i kontekstu*</span><span class="sxs-lookup"><span data-stu-id="caddb-228">*Access to internal application data and context*</span></span>
   
   * <span data-ttu-id="caddb-229">Podsystem diagnostycznych uruchomiony proces aplikacji/usługi można łatwo rozszerzyć śladów z informacje kontekstowe.</span><span class="sxs-lookup"><span data-stu-id="caddb-229">The diagnostic subsystem running inside the application/service process can easily augment the traces with contextual information.</span></span>
   * <span data-ttu-id="caddb-230">W ujęciu poza procesem dane należy wysłać do agenta za pomocą mechanizmu komunikacji międzyprocesowej, takich jak zdarzenia śledzenia systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="caddb-230">In the out-of-process approach, the data must be sent to an agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="caddb-231">Ten mechanizm można skonfigurować dodatkowe ograniczenia.</span><span class="sxs-lookup"><span data-stu-id="caddb-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="caddb-232">Zalety **przechwytywania śledzenia poza procesem** obejmują:</span><span class="sxs-lookup"><span data-stu-id="caddb-232">Advantages of the **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="caddb-233">*Możliwość monitorowania aplikacji i zbieranie zestawy awaryjne*</span><span class="sxs-lookup"><span data-stu-id="caddb-233">*The ability to monitor the application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="caddb-234">W trakcie śledzenia przechwytywania może się nie powieść, jeśli aplikacja nie powiedzie się lub ulega awarii.</span><span class="sxs-lookup"><span data-stu-id="caddb-234">In-process trace capturing may be unsuccessful if the application fails to start or crashes.</span></span> <span data-ttu-id="caddb-235">Niezależnego agenta ma znacznie zwiększa prawdopodobieństwo Przechwytywanie istotne informacje dotyczące rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="caddb-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="caddb-236">*Dojrzałości, niezawodności i wydajności sprawdzonych*</span><span class="sxs-lookup"><span data-stu-id="caddb-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="caddb-237">Agent opracowane przez dostawcę platformy (na przykład agent programu Microsoft Azure Diagnostics) została rygorystyczne testowania i ograniczania funkcjonalności bitwy.</span><span class="sxs-lookup"><span data-stu-id="caddb-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject to rigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="caddb-238">Z śledzenia w procesie przechwytywania można uważać, aby zapewnić, że działania wysyłanie danych diagnostycznych z procesu aplikacji nie zakłócać głównych zadań aplikacji lub doprowadzić do problemów chronometrażu lub wydajności.</span><span class="sxs-lookup"><span data-stu-id="caddb-238">With in-process trace capturing, care must be taken to ensure that the activity of sending diagnostic data from an application process does not interfere with the application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="caddb-239">Agent niezależnie uruchomiona jest mniej podatne na te problemy i specjalnie z myślą o ograniczyć jej wpływ na system.</span><span class="sxs-lookup"><span data-stu-id="caddb-239">An independently running agent is less prone to these issues and is specifically designed to limit its impact on the system.</span></span>

<span data-ttu-id="caddb-240">Istnieje możliwość łączenia i korzystać z obu podejść.</span><span class="sxs-lookup"><span data-stu-id="caddb-240">It is possible to combine and benefit from both approaches.</span></span> <span data-ttu-id="caddb-241">W rzeczywistości może być najlepszym rozwiązaniem dla wielu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="caddb-241">Indeed, it might be the best solution for many applications.</span></span>

<span data-ttu-id="caddb-242">W tym miejscu użyjemy **biblioteki Microsoft.Diagnostic.Listeners** i śledzenia w procesie przechwytywania do wysyłania danych z aplikacji do klastra Elasticsearch sieci szkieletowej usług.</span><span class="sxs-lookup"><span data-stu-id="caddb-242">Here, we use the **Microsoft.Diagnostic.Listeners library** and the in-process trace capturing to send data from a Service Fabric application to an Elasticsearch cluster.</span></span>

## <a name="use-the-listeners-library-to-send-diagnostic-data-to-elasticsearch"></a><span data-ttu-id="caddb-243">Wyślij dane diagnostyczne do Elasticsearch przy użyciu biblioteki obiektów nasłuchujących</span><span class="sxs-lookup"><span data-stu-id="caddb-243">Use the Listeners library to send diagnostic data to Elasticsearch</span></span>
<span data-ttu-id="caddb-244">Biblioteka Microsoft.Diagnostic.Listeners jest częścią PartyCluster przykładowej aplikacji sieci szkieletowej usług.</span><span class="sxs-lookup"><span data-stu-id="caddb-244">The Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="caddb-245">Aby użyć go:</span><span class="sxs-lookup"><span data-stu-id="caddb-245">To use it:</span></span>

1. <span data-ttu-id="caddb-246">Pobierz [próbki PartyCluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) z usługi GitHub.</span><span class="sxs-lookup"><span data-stu-id="caddb-246">Download [the PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="caddb-247">Skopiuj projektów Microsoft.Diagnostics.Listeners i Microsoft.Diagnostics.Listeners.Fabric (całe foldery) z katalog przykładu PartyCluster do folderu rozwiązania aplikacji, która ma wysyłać dane do Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="caddb-247">Copy the Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from the PartyCluster sample directory to the solution folder of the application that is supposed to send the data to Elasticsearch.</span></span>
3. <span data-ttu-id="caddb-248">Otwórz rozwiązanie docelowych, kliknij prawym przyciskiem myszy węzeł rozwiązania w Eksploratorze rozwiązań i wybierz **Dodaj istniejący projekt**.</span><span class="sxs-lookup"><span data-stu-id="caddb-248">Open the target solution, right-click the solution node in the Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="caddb-249">Dodaj Microsoft.Diagnostics.Listeners projektu do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="caddb-249">Add the Microsoft.Diagnostics.Listeners project to the solution.</span></span> <span data-ttu-id="caddb-250">Powtórzenie Microsoft.Diagnostics.Listeners.Fabric projektu.</span><span class="sxs-lookup"><span data-stu-id="caddb-250">Repeat the same for the Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="caddb-251">Dodaj odwołanie do projektu z projektów z usługi do dwa projekty dodany.</span><span class="sxs-lookup"><span data-stu-id="caddb-251">Add a project reference from your service project(s) to the two added projects.</span></span> <span data-ttu-id="caddb-252">(Każda usługa, która ma wysyłać dane do Elasticsearch powinien odwoływać się Microsoft.Diagnostics.EventListeners i Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="caddb-252">(Each service that is supposed to send data to Elasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Odwołania do bibliotek Microsoft.Diagnostics.EventListeners i Microsoft.Diagnostics.EventListeners.Fabric][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="caddb-254">Wersja usługi sieć szkieletowa ogólnej dostępności i pakiet Microsoft.Diagnostics.Tracing Nuget</span><span class="sxs-lookup"><span data-stu-id="caddb-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="caddb-255">Aplikacji skompilowanej za pomocą wersji dostępności usługi sieć szkieletowa ogólne (2.0.135 wydane 31 marca 2016) docelowej **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="caddb-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="caddb-256">Ta wersja jest najwyższa wersja programu .NET Framework obsługiwane przez platformę Azure w czasie wersja Ogólnodostępna.</span><span class="sxs-lookup"><span data-stu-id="caddb-256">This version is the highest version of the .NET Framework supported by Azure at the time of the GA release.</span></span> <span data-ttu-id="caddb-257">Niestety ta wersja platformy nie ma niektórych interfejsów API odbiornika danych wymaga biblioteki Microsoft.Diagnostics.Listeners.</span><span class="sxs-lookup"><span data-stu-id="caddb-257">Unfortunately, this version of the framework lacks certain EventListener APIs that the Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="caddb-258">Ponieważ EventSource (składnik, który stanowi podstawę rejestrowania interfejsów API w sieci szkieletowej aplikacji) i odbiornika danych są ściśle powiązane, każdy projekt, który korzysta z biblioteki Microsoft.Diagnostics.Listeners użyć alternatywnej implementacji obiektu EventSource.</span><span class="sxs-lookup"><span data-stu-id="caddb-258">Because EventSource (the component that forms the basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses the Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="caddb-259">Ta implementacja jest zapewniana przez **pakietu Microsoft.Diagnostics.Tracing Nuget**, utworzone przez firmę Microsoft.</span><span class="sxs-lookup"><span data-stu-id="caddb-259">This implementation is provided by the **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="caddb-260">Pakiet jest pełni zgodny z EventSource zawarte w ramach, więc zmiany w kodzie nie powinno być konieczne niż zmiany przywoływanego przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="caddb-260">The package is fully backward-compatible with EventSource included in the framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="caddb-261">Aby rozpocząć korzystanie z implementacji Microsoft.Diagnostics.Tracing klasy źródła zdarzeń, wykonaj następujące kroki dla każdego projektu usługi, który należy do wysyłania danych do Elasticsearch:</span><span class="sxs-lookup"><span data-stu-id="caddb-261">To start using the Microsoft.Diagnostics.Tracing implementation of the EventSource class, follow these steps for each service project that needs to send data to Elasticsearch:</span></span>

1. <span data-ttu-id="caddb-262">Kliknij prawym przyciskiem myszy projekt usługi i wybierz polecenie **Zarządzaj pakietami Nuget**.</span><span class="sxs-lookup"><span data-stu-id="caddb-262">Right-click on the service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="caddb-263">Przełącz się do źródła pakietu nuget.org (Jeśli nie została jeszcze wybrana) i wyszukaj "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="caddb-263">Switch to the nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="caddb-264">Zainstaluj `Microsoft.Diagnostics.Tracing.EventSource` pakiet (i jego zależności).</span><span class="sxs-lookup"><span data-stu-id="caddb-264">Install the `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="caddb-265">Otwórz **ServiceEventSource.cs** lub **ActorEventSource.cs** pliku w projekcie usługi i Zastąp `using System.Diagnostics.Tracing` dyrektywy u góry pliku z `using Microsoft.Diagnostics.Tracing` dyrektywy.</span><span class="sxs-lookup"><span data-stu-id="caddb-265">Open the **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace the `using System.Diagnostics.Tracing` directive on top of the file with the `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="caddb-266">Te czynności nie będzie konieczne raz **.NET Framework 4.6** jest obsługiwana przez system Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="caddb-266">These steps will not be necessary once the **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="caddb-267">Podczas tworzenia wystąpienia Elasticsearch odbiornika i konfiguracji</span><span class="sxs-lookup"><span data-stu-id="caddb-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="caddb-268">Ostatnim krokiem wysyłanie danych diagnostycznych do Elasticsearch jest utworzenie wystąpienia `ElasticSearchListener` i konfigurowanie go z Elasticsearch połączenia danych.</span><span class="sxs-lookup"><span data-stu-id="caddb-268">The final step for sending diagnostic data to Elasticsearch is to create an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="caddb-269">Odbiornik automatycznie przechwytuje wszystkie zdarzenia wywoływane za pośrednictwem klas źródła zdarzeń zdefiniowanych w projekcie usługi.</span><span class="sxs-lookup"><span data-stu-id="caddb-269">The listener automatically captures all events raised via EventSource classes defined in the service project.</span></span> <span data-ttu-id="caddb-270">Musi to być aktywne przez cały okres istnienia usługi, dlatego najlepszym miejscem, aby go utworzyć w kodzie inicjowania usługi.</span><span class="sxs-lookup"><span data-stu-id="caddb-270">It needs to be alive during the lifetime of the service, so the best place to create it is in the service initialization code.</span></span> <span data-ttu-id="caddb-271">Oto, jak kod inicjujący usługi bezstanowej może wyglądać po niezbędne zmiany (dodatki wskazano w komentarzach począwszy `****`):</span><span class="sxs-lookup"><span data-stu-id="caddb-271">Here is how the initialization code for a stateless service could look after the necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add the following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is the entry point of the service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // The ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name to a .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of the class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that the ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="caddb-272">Dane połączenia Elasticsearch powinno znajdować się w osobnej sekcji w pliku konfiguracji usługi (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="caddb-272">Elasticsearch connection data should be put in a separate section in the service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="caddb-273">Nazwa sekcji musi odpowiadać wartości przekazanych do `FabricConfigurationProvider` konstruktora, na przykład:</span><span class="sxs-lookup"><span data-stu-id="caddb-273">The name of the section must correspond to the value passed to the `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="caddb-274">Wartości `serviceUri`, `userName` i `password` odpowiada adres punktu końcowego klastra Elasticsearch Elasticsearch nazwy użytkownika i hasła, odpowiednio parametry.</span><span class="sxs-lookup"><span data-stu-id="caddb-274">The values of `serviceUri`, `userName` and `password` parameters correspond to the Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="caddb-275">`indexNamePrefix`jest prefiksem dla indeksów Elasticsearch; Biblioteka Microsoft.Diagnostics.Listeners tworzy nowy indeks danych raz dziennie.</span><span class="sxs-lookup"><span data-stu-id="caddb-275">`indexNamePrefix` is the prefix for Elasticsearch indexes; the Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="caddb-276">Weryfikacja</span><span class="sxs-lookup"><span data-stu-id="caddb-276">Verification</span></span>
<span data-ttu-id="caddb-277">Gotowe.</span><span class="sxs-lookup"><span data-stu-id="caddb-277">That's it!</span></span> <span data-ttu-id="caddb-278">Teraz gdy uruchomiona jest usługa, rozpoczyna się wysyłanie śladów do usługi Elasticsearch określony w konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="caddb-278">Now, whenever the service is run, it starts sending traces to the Elasticsearch service specified in the configuration.</span></span> <span data-ttu-id="caddb-279">Możesz sprawdzić, czy to otwarcie interfejsu użytkownika Kibana skojarzony z wystąpieniem Elasticsearch docelowej.</span><span class="sxs-lookup"><span data-stu-id="caddb-279">You can verify this by opening the Kibana UI associated with the target Elasticsearch instance.</span></span> <span data-ttu-id="caddb-280">W naszym przykładzie adres strony jest http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="caddb-280">In our example, the page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="caddb-281">Sprawdź, czy indeksy z prefiksem nazwy wybrany dla `ElasticSearchListener` rzeczywiście zostały utworzone i wypełniane przy użyciu danych wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="caddb-281">Check that indexes with the name prefix chosen for the `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Zdarzenia aplikacji PartyCluster przedstawiający Kibana][2]

## <a name="next-steps"></a><span data-ttu-id="caddb-283">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="caddb-283">Next steps</span></span>
* [<span data-ttu-id="caddb-284">Więcej informacji na temat diagnozowania i monitorowanie usługi sieci szkieletowej usług</span><span class="sxs-lookup"><span data-stu-id="caddb-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
