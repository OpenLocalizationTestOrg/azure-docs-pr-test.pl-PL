---
title: "Transakcje i tryby blokady na platformie Azure usługi sieci szkieletowej niezawodnej kolekcje | Dokumentacja firmy Microsoft"
description: "Menedżer niezawodnej stanu sieci szkieletowej usługi Azure i transakcji niezawodnej kolekcje i blokowania."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 3452473f5b2f86d29e46339c997193bc6403736a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/11/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="9116d-103">Transakcje i tryby blokady w kolekcjach niezawodnej sieci szkieletowej usług Azure</span><span class="sxs-lookup"><span data-stu-id="9116d-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="9116d-104">Transakcji</span><span class="sxs-lookup"><span data-stu-id="9116d-104">Transaction</span></span>
<span data-ttu-id="9116d-105">Sekwencja operacji wykonywanych jako pojedyncza jednostka logiczna pracy jest transakcja.</span><span class="sxs-lookup"><span data-stu-id="9116d-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="9116d-106">Transakcji musi mieć następujące właściwości ACID.</span><span class="sxs-lookup"><span data-stu-id="9116d-106">A transaction must exhibit the following ACID properties.</span></span> <span data-ttu-id="9116d-107">(zobacz: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="9116d-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="9116d-108">**Niepodzielność**: transakcji musi być Atomowej jednostki pracy.</span><span class="sxs-lookup"><span data-stu-id="9116d-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="9116d-109">Innymi słowy wszystkie zmiany danych są wykonywane albo żadna z nich jest wykonywana.</span><span class="sxs-lookup"><span data-stu-id="9116d-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="9116d-110">**Spójność**: po zakończeniu transakcji musi pozostać wszystkie dane w spójnym stanie.</span><span class="sxs-lookup"><span data-stu-id="9116d-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="9116d-111">Wszystkie struktur danych wewnętrznych musi być prawidłowy na końcu transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-111">All internal data structures must be correct at the end of the transaction.</span></span>
* <span data-ttu-id="9116d-112">**Izolacja**: zmiany dokonane przez równoczesnych transakcji musi być odizolowany od zmiany dokonane przez równoczesnych transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-112">**Isolation**: Modifications made by concurrent transactions must be isolated from the modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="9116d-113">Poziom izolacji używany podczas operacji w ramach ITransaction jest określana przez IReliableState wykonywania operacji.</span><span class="sxs-lookup"><span data-stu-id="9116d-113">The isolation level used for an operation within an ITransaction is determined by the IReliableState performing the operation.</span></span>
* <span data-ttu-id="9116d-114">**Trwałość**: po zakończeniu transakcji jego skutków obowiązują trwale w systemie.</span><span class="sxs-lookup"><span data-stu-id="9116d-114">**Durability**: After a transaction has completed, its effects are permanently in place in the system.</span></span> <span data-ttu-id="9116d-115">Modyfikacje utrwalić nawet w przypadku awarii systemu.</span><span class="sxs-lookup"><span data-stu-id="9116d-115">The modifications persist even in the event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="9116d-116">Poziom izolacji</span><span class="sxs-lookup"><span data-stu-id="9116d-116">Isolation levels</span></span>
<span data-ttu-id="9116d-117">Poziom izolacji definiuje stopień, do którego transakcja musi być odizolowany od zmiany dokonane przez inne transakcje.</span><span class="sxs-lookup"><span data-stu-id="9116d-117">Isolation level defines the degree to which the transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="9116d-118">Istnieją dwa poziomy izolacji, które są obsługiwane w kolekcjach niezawodnej:</span><span class="sxs-lookup"><span data-stu-id="9116d-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="9116d-119">**Odczyt powtarzalny**: Określa, czy instrukcje nie można odczytać danych, które zostały zmodyfikowane, ale nie zostały jeszcze zatwierdzone przez inne transakcje i że nie inne transakcje nie mogą zmodyfikować danych został odczytany przez bieżącą transakcję zakończenie bieżącej transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by the current transaction until the current transaction finishes.</span></span> <span data-ttu-id="9116d-120">Aby uzyskać więcej informacji, zobacz [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="9116d-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="9116d-121">**Migawki**: Określa, że dane odczytane przez żadnej instrukcji w transakcji jest spójna transakcyjnie wersji danych, które istniały na początku transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-121">**Snapshot**: Specifies that data read by any statement in a transaction is the transactionally consistent version of the data that existed at the start of the transaction.</span></span>
  <span data-ttu-id="9116d-122">Transakcja może rozpoznawać tylko zmiany danych, które zostały zatwierdzone przed rozpoczęciem transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-122">The transaction can recognize only data modifications that were committed before the start of the transaction.</span></span>
  <span data-ttu-id="9116d-123">Dane zmiany wprowadzone przez inne transakcje po rozpoczęciu bieżącej transakcji nie są widoczne dla instrukcji wykonywania w bieżącej transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-123">Data modifications made by other transactions after the start of the current transaction are not visible to statements executing in the current transaction.</span></span>
  <span data-ttu-id="9116d-124">Efekt jest tak, jakby instrukcje w transakcji migawki danych zatwierdzone znajdowały się na początku transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-124">The effect is as if the statements in a transaction get a snapshot of the committed data as it existed at the start of the transaction.</span></span>
  <span data-ttu-id="9116d-125">Migawki są spójne w kolekcjach wiarygodne.</span><span class="sxs-lookup"><span data-stu-id="9116d-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="9116d-126">Aby uzyskać więcej informacji, zobacz [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="9116d-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="9116d-127">Kolekcje niezawodnej automatycznie wybrać poziom izolacji dla danej operacji odczytu, w zależności od operacji i Rola repliki w czasie tworzenia transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-127">Reliable Collections automatically choose the isolation level to use for a given read operation depending on the operation and the role of the replica at the time of transaction's creation.</span></span>
<span data-ttu-id="9116d-128">Poniżej znajduje się tabela, która przedstawia wartości domyślnych poziomu izolacji operacje słownika niezawodnych i kolejki.</span><span class="sxs-lookup"><span data-stu-id="9116d-128">Following is the table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="9116d-129">Operacja \ roli</span><span class="sxs-lookup"><span data-stu-id="9116d-129">Operation \ Role</span></span> | <span data-ttu-id="9116d-130">Podstawowy</span><span class="sxs-lookup"><span data-stu-id="9116d-130">Primary</span></span> | <span data-ttu-id="9116d-131">Pomocniczy</span><span class="sxs-lookup"><span data-stu-id="9116d-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="9116d-132">Odczyt pojedynczej jednostki</span><span class="sxs-lookup"><span data-stu-id="9116d-132">Single Entity Read</span></span> |<span data-ttu-id="9116d-133">Powtarzalnego odczytu</span><span class="sxs-lookup"><span data-stu-id="9116d-133">Repeatable Read</span></span> |<span data-ttu-id="9116d-134">Snapshot</span><span class="sxs-lookup"><span data-stu-id="9116d-134">Snapshot</span></span> |
| <span data-ttu-id="9116d-135">Wyliczenie, liczba</span><span class="sxs-lookup"><span data-stu-id="9116d-135">Enumeration, Count</span></span> |<span data-ttu-id="9116d-136">Snapshot</span><span class="sxs-lookup"><span data-stu-id="9116d-136">Snapshot</span></span> |<span data-ttu-id="9116d-137">Snapshot</span><span class="sxs-lookup"><span data-stu-id="9116d-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="9116d-138">Typowe przykłady dla jednej operacji jednostki `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="9116d-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="9116d-139">Słownik niezawodnej oraz niezawodnej kolejki obsługuje zapisuje swój odczytu.</span><span class="sxs-lookup"><span data-stu-id="9116d-139">Both the Reliable Dictionary and the Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="9116d-140">Innymi słowy wszelkie zapisu w obrębie transakcji będą widoczne dla następujących odczytu, który należy do tej samej transakcji.</span><span class="sxs-lookup"><span data-stu-id="9116d-140">In other words, any write within a transaction will be visible to a following read that belongs to the same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="9116d-141">Blokady</span><span class="sxs-lookup"><span data-stu-id="9116d-141">Locks</span></span>
<span data-ttu-id="9116d-142">W kolekcjach niezawodnej wszystkie transakcje wdrożenie rygorystyczne dwie fazy blokowania: transakcji nie zwalnia blokad ustawił aż do zakończenia transakcji z przerwania lub zatwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="9116d-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release the locks it has acquired until the transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="9116d-143">Słownik niezawodnej używa blokowania dla wszystkich operacji pojedynczy element na poziomie wiersza.</span><span class="sxs-lookup"><span data-stu-id="9116d-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="9116d-144">Kolejka niezawodnych zamienia poza współbieżności dla właściwości FIFO transakcyjnej strict.</span><span class="sxs-lookup"><span data-stu-id="9116d-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="9116d-145">Kolejka niezawodnych używa operacji blokad poziomu umożliwiające utworzenie jednej transakcji `TryPeekAsync` i/lub `TryDequeueAsync` i transakcja o `EnqueueAsync` naraz.</span><span class="sxs-lookup"><span data-stu-id="9116d-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="9116d-146">Pamiętaj, że aby zachować FIFO, jeśli `TryPeekAsync` lub `TryDequeueAsync` kiedykolwiek przestrzega, że kolejka niezawodnych jest pusta, również spowoduje to zablokowanie `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="9116d-146">Note that to preserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that the Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="9116d-147">Zawsze mieć blokady na wyłączność operacje zapisu.</span><span class="sxs-lookup"><span data-stu-id="9116d-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="9116d-148">Dla operacji odczytu blokowania zależy od kilku czynników.</span><span class="sxs-lookup"><span data-stu-id="9116d-148">For read operations, the locking depends on a couple of factors.</span></span>
<span data-ttu-id="9116d-149">Żadnej operacji odczytu wykonywane przy użyciu izolacji migawki jest nieblokującą.</span><span class="sxs-lookup"><span data-stu-id="9116d-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="9116d-150">Wszelkie operacje odczytu powtarzalne domyślnie przyjmuje współużytkowane blokady.</span><span class="sxs-lookup"><span data-stu-id="9116d-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="9116d-151">Jednak do żadnej operacji odczytu obsługującego powtarzalnego odczytu użytkownika można uzyskać blokady aktualizacji zamiast blokady współużytkowane.</span><span class="sxs-lookup"><span data-stu-id="9116d-151">However, for any read operation that supports Repeatable Read, the user can ask for an Update lock instead of the Shared lock.</span></span>
<span data-ttu-id="9116d-152">Blokady aktualizacji jest asymetrycznego blokady zapobiegające wspólnej formy zakleszczenia, gdy wiele transakcji blokowania zasobów potencjalnych aktualizacji w późniejszym czasie.</span><span class="sxs-lookup"><span data-stu-id="9116d-152">An Update lock is an asymmetric lock used to prevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="9116d-153">Macierz zgodności blokad można znaleźć w poniższej tabeli:</span><span class="sxs-lookup"><span data-stu-id="9116d-153">The lock compatibility matrix can be found in the following table:</span></span>

| <span data-ttu-id="9116d-154">Żądanie \ przyznane</span><span class="sxs-lookup"><span data-stu-id="9116d-154">Request \ Granted</span></span> | <span data-ttu-id="9116d-155">Brak</span><span class="sxs-lookup"><span data-stu-id="9116d-155">None</span></span> | <span data-ttu-id="9116d-156">Udostępniona</span><span class="sxs-lookup"><span data-stu-id="9116d-156">Shared</span></span> | <span data-ttu-id="9116d-157">Aktualizacja</span><span class="sxs-lookup"><span data-stu-id="9116d-157">Update</span></span> | <span data-ttu-id="9116d-158">Wyłączności</span><span class="sxs-lookup"><span data-stu-id="9116d-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="9116d-159">Udostępniona</span><span class="sxs-lookup"><span data-stu-id="9116d-159">Shared</span></span> |<span data-ttu-id="9116d-160">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="9116d-160">No conflict</span></span> |<span data-ttu-id="9116d-161">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="9116d-161">No conflict</span></span> |<span data-ttu-id="9116d-162">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-162">Conflict</span></span> |<span data-ttu-id="9116d-163">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-163">Conflict</span></span> |
| <span data-ttu-id="9116d-164">Aktualizacja</span><span class="sxs-lookup"><span data-stu-id="9116d-164">Update</span></span> |<span data-ttu-id="9116d-165">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="9116d-165">No conflict</span></span> |<span data-ttu-id="9116d-166">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="9116d-166">No conflict</span></span> |<span data-ttu-id="9116d-167">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-167">Conflict</span></span> |<span data-ttu-id="9116d-168">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-168">Conflict</span></span> |
| <span data-ttu-id="9116d-169">Wyłączności</span><span class="sxs-lookup"><span data-stu-id="9116d-169">Exclusive</span></span> |<span data-ttu-id="9116d-170">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="9116d-170">No conflict</span></span> |<span data-ttu-id="9116d-171">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-171">Conflict</span></span> |<span data-ttu-id="9116d-172">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-172">Conflict</span></span> |<span data-ttu-id="9116d-173">Konflikt</span><span class="sxs-lookup"><span data-stu-id="9116d-173">Conflict</span></span> |

<span data-ttu-id="9116d-174">Argument limitu czasu w niezawodnej interfejsów API kolekcji jest używana do wykrywania zakleszczeń.</span><span class="sxs-lookup"><span data-stu-id="9116d-174">Time-out argument in the Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="9116d-175">Na przykład dwie transakcje (T1 a T2) próbuje odczytywanie i aktualizowanie K1.</span><span class="sxs-lookup"><span data-stu-id="9116d-175">For example, two transactions (T1 and T2) are trying to read and update K1.</span></span>
<span data-ttu-id="9116d-176">Możliwe jest ich do zakleszczenia, ponieważ oba mających blokady udostępnione.</span><span class="sxs-lookup"><span data-stu-id="9116d-176">It is possible for them to deadlock, because they both end up having the Shared lock.</span></span>
<span data-ttu-id="9116d-177">W takim przypadku limit czasu będzie jedną lub obie czynności.</span><span class="sxs-lookup"><span data-stu-id="9116d-177">In this case, one or both of the operations will time out.</span></span>

<span data-ttu-id="9116d-178">W tym scenariuszu zakleszczenie jest doskonałym przykładem jak blokady aktualizacji można zapobiec zakleszczenia.</span><span class="sxs-lookup"><span data-stu-id="9116d-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9116d-179">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="9116d-179">Next steps</span></span>
* [<span data-ttu-id="9116d-180">Praca z elementami Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="9116d-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="9116d-181">Niezawodne usługi powiadomień</span><span class="sxs-lookup"><span data-stu-id="9116d-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="9116d-182">Niezawodne usługi Kopia zapasowa i przywracanie (odzyskiwania po awarii)</span><span class="sxs-lookup"><span data-stu-id="9116d-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="9116d-183">Stan niezawodny Menedżera konfiguracji</span><span class="sxs-lookup"><span data-stu-id="9116d-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="9116d-184">Dokumentacja dla deweloperów niezawodnej kolekcji</span><span class="sxs-lookup"><span data-stu-id="9116d-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

