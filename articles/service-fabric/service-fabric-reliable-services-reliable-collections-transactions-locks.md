---
title: "aaaTransactions i tryby blokady w kolekcjach niezawodnej sieci szkieletowej usług Azure | Dokumentacja firmy Microsoft"
description: "Menedżer niezawodnej stanu sieci szkieletowej usługi Azure i transakcji niezawodnej kolekcje i blokowania."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="d3f93-103">Transakcje i tryby blokady w kolekcjach niezawodnej sieci szkieletowej usług Azure</span><span class="sxs-lookup"><span data-stu-id="d3f93-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="d3f93-104">Transakcji</span><span class="sxs-lookup"><span data-stu-id="d3f93-104">Transaction</span></span>
<span data-ttu-id="d3f93-105">Sekwencja operacji wykonywanych jako pojedyncza jednostka logiczna pracy jest transakcja.</span><span class="sxs-lookup"><span data-stu-id="d3f93-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="d3f93-106">Transakcji musi mieć następujące właściwości ACID hello.</span><span class="sxs-lookup"><span data-stu-id="d3f93-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="d3f93-107">(zobacz: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="d3f93-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="d3f93-108">**Niepodzielność**: transakcji musi być Atomowej jednostki pracy.</span><span class="sxs-lookup"><span data-stu-id="d3f93-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="d3f93-109">Innymi słowy wszystkie zmiany danych są wykonywane albo żadna z nich jest wykonywana.</span><span class="sxs-lookup"><span data-stu-id="d3f93-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="d3f93-110">**Spójność**: po zakończeniu transakcji musi pozostać wszystkie dane w spójnym stanie.</span><span class="sxs-lookup"><span data-stu-id="d3f93-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="d3f93-111">Wszystkie struktur danych wewnętrznych musi być prawidłowy na końcu hello hello transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="d3f93-112">**Izolacja**: zmiany dokonane przez równoczesnych transakcji musi być odizolowany od hello zmiany dokonane przez równoczesnych transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="d3f93-113">poziom izolacji Hello używane dla operacji w ramach ITransaction jest określana przez hello IReliableState zostanie wykonana operacja hello.</span><span class="sxs-lookup"><span data-stu-id="d3f93-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="d3f93-114">**Trwałość**: po zakończeniu transakcji jego skutków są trwale w miejscu systemu hello.</span><span class="sxs-lookup"><span data-stu-id="d3f93-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="d3f93-115">modyfikacje Hello utrwalić nawet w przypadku hello awarii systemu.</span><span class="sxs-lookup"><span data-stu-id="d3f93-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="d3f93-116">Poziom izolacji</span><span class="sxs-lookup"><span data-stu-id="d3f93-116">Isolation levels</span></span>
<span data-ttu-id="d3f93-117">Stopień hello określa poziom izolacji transakcji hello toowhich musi być odizolowany od zmiany dokonane przez inne transakcje.</span><span class="sxs-lookup"><span data-stu-id="d3f93-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="d3f93-118">Istnieją dwa poziomy izolacji, które są obsługiwane w kolekcjach niezawodnej:</span><span class="sxs-lookup"><span data-stu-id="d3f93-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="d3f93-119">**Odczyt powtarzalny**: Określa, że instrukcji nie można odczytać danych, które zostały zmodyfikowane, ale nie zostały jeszcze zatwierdzone przez inne transakcje i że żadne inne transakcje można modyfikować danych został odczytany przez hello bieżącej transakcji do bieżącego hello Zakończenie transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="d3f93-120">Aby uzyskać więcej informacji, zobacz [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="d3f93-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="d3f93-121">**Migawki**: Określa, że dane odczytane przez żadnej instrukcji w transakcji jest spójna transakcyjnie wersji hello hello danych, które istniały na początku hello hello transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="d3f93-122">Transakcja Hello może rozpoznawać tylko zmiany danych, które zostały zatwierdzone przed rozpoczęciem powitalne hello transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="d3f93-123">Modyfikacje dane wprowadzane przez inne transakcje po hello początek hello bieżącej transakcji nie są widoczne toostatements wykonywania w bieżącej transakcji hello.</span><span class="sxs-lookup"><span data-stu-id="d3f93-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="d3f93-124">efekt Hello jest tak, jakby instrukcje hello w transakcji migawki danych hello zatwierdzone znajdowały się na początku hello hello transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="d3f93-125">Migawki są spójne w kolekcjach wiarygodne.</span><span class="sxs-lookup"><span data-stu-id="d3f93-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="d3f93-126">Aby uzyskać więcej informacji, zobacz [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="d3f93-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="d3f93-127">Kolekcje niezawodnej automatycznie wybrać hello toouse poziom izolacji dla danej operacji odczytu, w zależności od operacji hello i roli hello hello repliki bazy danych w czasie hello tworzenia transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="d3f93-128">Poniżej znajduje się hello tabeli, która przedstawia wartości domyślnych poziomu izolacji operacje słownika niezawodnych i kolejki.</span><span class="sxs-lookup"><span data-stu-id="d3f93-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="d3f93-129">Operacja \ roli</span><span class="sxs-lookup"><span data-stu-id="d3f93-129">Operation \ Role</span></span> | <span data-ttu-id="d3f93-130">Podstawowy</span><span class="sxs-lookup"><span data-stu-id="d3f93-130">Primary</span></span> | <span data-ttu-id="d3f93-131">Pomocniczy</span><span class="sxs-lookup"><span data-stu-id="d3f93-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="d3f93-132">Odczyt pojedynczej jednostki</span><span class="sxs-lookup"><span data-stu-id="d3f93-132">Single Entity Read</span></span> |<span data-ttu-id="d3f93-133">Powtarzalnego odczytu</span><span class="sxs-lookup"><span data-stu-id="d3f93-133">Repeatable Read</span></span> |<span data-ttu-id="d3f93-134">Snapshot</span><span class="sxs-lookup"><span data-stu-id="d3f93-134">Snapshot</span></span> |
| <span data-ttu-id="d3f93-135">Wyliczenie, liczba</span><span class="sxs-lookup"><span data-stu-id="d3f93-135">Enumeration, Count</span></span> |<span data-ttu-id="d3f93-136">Snapshot</span><span class="sxs-lookup"><span data-stu-id="d3f93-136">Snapshot</span></span> |<span data-ttu-id="d3f93-137">Snapshot</span><span class="sxs-lookup"><span data-stu-id="d3f93-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="d3f93-138">Typowe przykłady dla jednej operacji jednostki `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="d3f93-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="d3f93-139">Zarówno hello słownika niezawodnych i hello kolejka niezawodnych obsługuje zapisuje swój odczytu.</span><span class="sxs-lookup"><span data-stu-id="d3f93-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="d3f93-140">Innymi słowy, wszelkie zapisu w obrębie transakcji będą widoczne tooa następujące odczytywane należący toohello tej samej transakcji.</span><span class="sxs-lookup"><span data-stu-id="d3f93-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="d3f93-141">Blokady</span><span class="sxs-lookup"><span data-stu-id="d3f93-141">Locks</span></span>
<span data-ttu-id="d3f93-142">W kolekcjach niezawodnej wszystkie transakcje wdrożenie rygorystyczne dwie fazy blokowania: transakcji zwolnienia blokad hello ustawił aż do zakończenia hello transakcji z przerwania lub zatwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="d3f93-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="d3f93-143">Słownik niezawodnej używa blokowania dla wszystkich operacji pojedynczy element na poziomie wiersza.</span><span class="sxs-lookup"><span data-stu-id="d3f93-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="d3f93-144">Kolejka niezawodnych zamienia poza współbieżności dla właściwości FIFO transakcyjnej strict.</span><span class="sxs-lookup"><span data-stu-id="d3f93-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="d3f93-145">Kolejka niezawodnych używa operacji blokad poziomu umożliwiające utworzenie jednej transakcji `TryPeekAsync` i/lub `TryDequeueAsync` i transakcja o `EnqueueAsync` naraz.</span><span class="sxs-lookup"><span data-stu-id="d3f93-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="d3f93-146">Należy pamiętać, że toopreserve FIFO, jeśli `TryPeekAsync` lub `TryDequeueAsync` kiedykolwiek przestrzega czy hello niezawodnej kolejka jest pusta, również spowoduje to zablokowanie `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="d3f93-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="d3f93-147">Zawsze mieć blokady na wyłączność operacje zapisu.</span><span class="sxs-lookup"><span data-stu-id="d3f93-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="d3f93-148">Dla operacji odczytu hello blokowania zależy od kilka czynników.</span><span class="sxs-lookup"><span data-stu-id="d3f93-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="d3f93-149">Żadnej operacji odczytu wykonywane przy użyciu izolacji migawki jest nieblokującą.</span><span class="sxs-lookup"><span data-stu-id="d3f93-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="d3f93-150">Wszelkie operacje odczytu powtarzalne domyślnie przyjmuje współużytkowane blokady.</span><span class="sxs-lookup"><span data-stu-id="d3f93-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="d3f93-151">Jednak do żadnej operacji odczytu obsługującego powtarzalnego odczytu hello użytkownika można uzyskać blokady aktualizacji zamiast hello blokady współużytkowane.</span><span class="sxs-lookup"><span data-stu-id="d3f93-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="d3f93-152">Blokady aktualizacji jest asymetrycznego blokady używane tooprevent wspólnej formy zakleszczenia, gdy wiele transakcji blokowania zasobów potencjalnych aktualizacji w późniejszym czasie.</span><span class="sxs-lookup"><span data-stu-id="d3f93-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="d3f93-153">macierz zgodności blokad Hello znajdują się w hello w poniższej tabeli:</span><span class="sxs-lookup"><span data-stu-id="d3f93-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="d3f93-154">Żądanie \ przyznane</span><span class="sxs-lookup"><span data-stu-id="d3f93-154">Request \ Granted</span></span> | <span data-ttu-id="d3f93-155">Brak</span><span class="sxs-lookup"><span data-stu-id="d3f93-155">None</span></span> | <span data-ttu-id="d3f93-156">Udostępniona</span><span class="sxs-lookup"><span data-stu-id="d3f93-156">Shared</span></span> | <span data-ttu-id="d3f93-157">Aktualizacja</span><span class="sxs-lookup"><span data-stu-id="d3f93-157">Update</span></span> | <span data-ttu-id="d3f93-158">Wyłączności</span><span class="sxs-lookup"><span data-stu-id="d3f93-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="d3f93-159">Udostępniona</span><span class="sxs-lookup"><span data-stu-id="d3f93-159">Shared</span></span> |<span data-ttu-id="d3f93-160">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="d3f93-160">No conflict</span></span> |<span data-ttu-id="d3f93-161">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="d3f93-161">No conflict</span></span> |<span data-ttu-id="d3f93-162">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-162">Conflict</span></span> |<span data-ttu-id="d3f93-163">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-163">Conflict</span></span> |
| <span data-ttu-id="d3f93-164">Aktualizacja</span><span class="sxs-lookup"><span data-stu-id="d3f93-164">Update</span></span> |<span data-ttu-id="d3f93-165">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="d3f93-165">No conflict</span></span> |<span data-ttu-id="d3f93-166">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="d3f93-166">No conflict</span></span> |<span data-ttu-id="d3f93-167">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-167">Conflict</span></span> |<span data-ttu-id="d3f93-168">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-168">Conflict</span></span> |
| <span data-ttu-id="d3f93-169">Wyłączności</span><span class="sxs-lookup"><span data-stu-id="d3f93-169">Exclusive</span></span> |<span data-ttu-id="d3f93-170">Nie konfliktów</span><span class="sxs-lookup"><span data-stu-id="d3f93-170">No conflict</span></span> |<span data-ttu-id="d3f93-171">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-171">Conflict</span></span> |<span data-ttu-id="d3f93-172">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-172">Conflict</span></span> |<span data-ttu-id="d3f93-173">Konflikt</span><span class="sxs-lookup"><span data-stu-id="d3f93-173">Conflict</span></span> |

<span data-ttu-id="d3f93-174">Argument limitu czasu w hello niezawodnej kolekcji interfejsów API jest używany do wykrywania zakleszczeń.</span><span class="sxs-lookup"><span data-stu-id="d3f93-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="d3f93-175">Na przykład dwie transakcje (T1 a T2) próbujesz tooread i zaktualizuj K1.</span><span class="sxs-lookup"><span data-stu-id="d3f93-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="d3f93-176">Istnieje możliwość ich toodeadlock, ponieważ oba mających hello udostępnione blokady.</span><span class="sxs-lookup"><span data-stu-id="d3f93-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="d3f93-177">W takim przypadku jednego lub obu z operacji hello będzie upłynął limit czasu.</span><span class="sxs-lookup"><span data-stu-id="d3f93-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="d3f93-178">W tym scenariuszu zakleszczenie jest doskonałym przykładem jak blokady aktualizacji można zapobiec zakleszczenia.</span><span class="sxs-lookup"><span data-stu-id="d3f93-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d3f93-179">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="d3f93-179">Next steps</span></span>
* [<span data-ttu-id="d3f93-180">Praca z elementami Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="d3f93-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="d3f93-181">Niezawodne usługi powiadomień</span><span class="sxs-lookup"><span data-stu-id="d3f93-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="d3f93-182">Niezawodne usługi Kopia zapasowa i przywracanie (odzyskiwania po awarii)</span><span class="sxs-lookup"><span data-stu-id="d3f93-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="d3f93-183">Stan niezawodny Menedżera konfiguracji</span><span class="sxs-lookup"><span data-stu-id="d3f93-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="d3f93-184">Dokumentacja dla deweloperów niezawodnej kolekcji</span><span class="sxs-lookup"><span data-stu-id="d3f93-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

