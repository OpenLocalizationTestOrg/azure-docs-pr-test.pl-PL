---
title: "Optymalizacja routingu usługi ExpressRoute: Azure| Microsoft Docs"
description: "Ta strona zawiera szczegóły dotyczące sposobu toooptimize routingu, jeśli masz więcej niż jeden ExpressRoute obwody który połączenia między firmą Microsoft a corp sieci."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="ac5d5-103">Optymalizacja routingu usługi ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="ac5d5-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="ac5d5-104">Jeśli masz wiele obwody usługi ExpressRoute, masz więcej niż jeden tooMicrosoft tooconnect ścieżki.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="ac5d5-105">W związku z tym nieoptymalne routingu może się tak zdarzyć - oznacza to, że ruchu może potrwać dłużej tooreach ścieżka firmy Microsoft i sieci tooyour firmy Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="ac5d5-106">Witaj dłużej hello ścieżki sieciowej, większego opóźnienia hello hello.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="ac5d5-107">Opóźnienie ma bezpośredni wpływ na wydajność aplikacji i środowisko użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="ac5d5-108">W tym artykule zilustrować ten problem, a także opisano, jak toooptimize routingu przy użyciu hello standardowych technologii routingu.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="ac5d5-109">Nieoptymalne routingu z tooMicrosoft klienta</span><span class="sxs-lookup"><span data-stu-id="ac5d5-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="ac5d5-110">Spójrzmy Zamknij na powitania problem routingu za przykład.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="ac5d5-111">Załóżmy, że masz dwie oddziałów w hello USA, drugi w Gdańsku, a drugi w Nowym Jorku.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="ac5d5-112">Biura są połączone za pośrednictwem sieci WAN, która może być Twoją siecią podstawową lub siecią IP VPN dostawcy usług.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="ac5d5-113">Masz dwie obwody usługi ExpressRoute, jeden Indie Zachodnie nam i jeden w nam wschodnie, które także są połączone w sieci WAN hello.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="ac5d5-114">Oczywiście masz dwie ścieżki tooconnect toohello sieci firmy Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="ac5d5-115">Teraz wyobraź sobie, że dysponujesz wdrożeniem platformy Azure (np. usługą Azure App Service) zarówno w zachodnich, jak i wschodnich stanach USA.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="ac5d5-116">Masz zamiar jest tooconnect użytkowników w Warszawie tooAzure nam Zachodnia, jak i użytkowników w Nowym Jorku tooAzure nam wschodnie, ponieważ administrator usługi służy do anonsowania, że użytkowników w każdej office access hello w pobliżu usług platformy Azure dla środowiska optymalne.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="ac5d5-117">Niestety hello plan działa dobrym rozwiązaniem dla użytkowników wschodniego hello, ale nie dla hello zachodnie wybrzeże użytkowników.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="ac5d5-118">Witaj przyczyną problemu hello jest hello poniżej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="ac5d5-119">Obwód usługi ExpressRoute możemy anonsują tooyou zarówno prefiks hello w Azure nam wschodnie (23.100.0.0/16) i prefiksu hello w Azure nam zachodnie (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="ac5d5-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="ac5d5-120">Jeśli nie wiesz, które prefiks jest w danym regionie, nie masz tootreat może on inaczej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="ac5d5-121">Sieci WAN może wziąć pod uwagę zarówno prefiksy hello są bliższe wschód tooUS niż zachodnie nam i w związku z tym trasy toohello użytkownicy obu office obwodu usługi expressroute w nam wschodnie.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="ac5d5-122">W celu hello będziesz mieć wielu użytkowników niezadowolonych hello Gdańsku pakietu office.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problem ExpressRoute przypadek 1 - nieoptymalne routingu z tooMicrosoft klienta](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="ac5d5-124">Rozwiązanie: użyj społeczności BGP</span><span class="sxs-lookup"><span data-stu-id="ac5d5-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="ac5d5-125">toooptimize routingu dla obu użytkowników pakietu office, należy tooknow prefiks, który pochodzi z Azure nam Zachodnia, które z Azure nam wschodnie.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="ac5d5-126">Kodujemy te informacje przy użyciu [wartości społeczności BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="ac5d5-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="ac5d5-127">Firma Microsoft przypisane unikatowe tooeach wartość społeczności BGP regionu Azure, np. „12076:51004” dla wschodnich, a „12076:51006” dla zachodnich stanów USA.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="ac5d5-128">Skoro już wiesz, który prefiks odpowiada któremu regionowi świadczenia usługi Azure, możesz skonfigurować preferowany obwód usługi ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="ac5d5-129">Ponieważ używamy informacje routingu tooexchange BGP hello, można użyć protokołu BGP w lokalnym preferencji tooinfluence routingu.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="ac5d5-130">W naszym przykładzie można przypisać wyższej too13.100.0.0/16 wartość preferencji lokalnego Indie Zachodnie nam niż w nam wschodnie i podobnie wyższej too23.100.0.0/16 wartość preferencji lokalnego w nam wschodnie niż Indie Zachodnie NAS.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="ac5d5-131">Ta konfiguracja będzie upewnij się, po obu tooMicrosoft ścieżki są dostępne, użytkownikom w Warszawie będzie trwać hello obwodu usługi expressroute w tooAzure tooconnect zachodnie nam nam zachodnie użytkowników w Nowym Jorku podjąć hello ExpressRoute w tooAzure nam wschodnie nam wschodnie .</span><span class="sxs-lookup"><span data-stu-id="ac5d5-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="ac5d5-132">Routing jest zoptymalizowany po obu stronach.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-132">Routing is optimized on both sides.</span></span> 

![Rozwiązanie przypadku 1 dotyczącego usługi ExpressRoute — używanie społeczności BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="ac5d5-134">Witaj tę samą metodę, przy użyciu lokalnego preferencji, może być zastosowane toorouting z klienta tooAzure sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="ac5d5-135">Nie możemy tagu prefiksy toohello wartość społeczności BGP anonsowane z sieci tooyour platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="ac5d5-136">Jednak ponieważ wiadomo, które wdrożenia sieci wirtualnej jest Zamknij toowhich z pakietu office, można skonfigurować routery odpowiednio tooprefer jeden tooanother obwodu usługi ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="ac5d5-137">Nieoptymalne routingu z toocustomer firmy Microsoft</span><span class="sxs-lookup"><span data-stu-id="ac5d5-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="ac5d5-138">Oto inny przykład gdzie połączenia od firmy Microsoft trwać dłużej tooreach ścieżki sieci.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="ac5d5-139">W tym przypadku używasz lokalnych serwerów programu Exchange i usługi Exchange Online w [środowisku hybrydowym](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac5d5-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="ac5d5-140">Biura są tooa połączenia sieci WAN.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="ac5d5-141">Ogłosić prefiksy hello serwerów lokalnych w obu tooMicrosoft Twojego oddziałów za pośrednictwem hello dwa obwody usługi ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="ac5d5-142">Exchange Online spowoduje zainicjowanie połączenia toohello lokalnych serwerów w przypadkach, takich jak migracja skrzynki pocztowej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="ac5d5-143">Niestety tooyour połączenia hello Gdańsku office jest routingiem toohello obwodu usługi expressroute w nam wschodnie przed przechodzenie hello całego kontynencie toohello wstecz zachodnie wybrzeże.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="ac5d5-144">Witaj przyczyną problemu hello jest podobne toohello pierwszy z nich.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="ac5d5-145">Bez żadnych wskazówki sieci firmy Microsoft hello nie wiadomo, które prefiks klienta jest Zamknij tooUS Wschodnia i która z nich zamknąć tooUS zachodnie.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="ac5d5-146">Zdarza się toopick hello nieprawidłowy tooyour office w Gdańsku.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute przypadku 2 - nieoptymalne routingu z toocustomer firmy Microsoft](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="ac5d5-148">Rozwiązanie: użyj dołączania ścieżki AS</span><span class="sxs-lookup"><span data-stu-id="ac5d5-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="ac5d5-149">Istnieją dwa rozwiązania toohello problem.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="ac5d5-150">Witaj najpierw jeden jest po prostu anonsowanie prefiksu użytkownika lokalnego dla pakietu office Gdańsku 177.2.0.0/31 obwodu ExpressRoute hello Indie Zachodnie nam oraz lokalnej prefiks dla pakietu office z nowego Jorku, 177.2.0.2/31 obwodu ExpressRoute hello w nam wschodnie.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="ac5d5-151">W związku z tym jest tylko jedną ścieżkę dla Microsoft tooconnect tooeach biur.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="ac5d5-152">Nie ma żadnych niejednoznaczności i routing zostaje zoptymalizowany.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="ac5d5-153">Ten projekt należy toothink o strategii trybu failover.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="ac5d5-154">W hello zdarzenie, które hello tooMicrosoft ścieżkę za pośrednictwem usługi ExpressRoute został przerwany, konieczne toomake się, że usługi Exchange Online można nadal tooyour serwerów lokalnych.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="ac5d5-155">drugim rozwiązaniem Hello jest nadal tooadvertise zarówno prefiksy hello na obu obwody usługi ExpressRoute, czy dodatkowo możesz Przekaż nam wskazówkę prefiks, który jest toowhich Zamknij jedną biur.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="ac5d5-156">Ponieważ firma Microsoft obsługuje dołączanie ścieżki AS protokołu BGP, można skonfigurować hello ścieżki AS routingu tooinfluence prefiks.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="ac5d5-157">W tym przykładzie możesz zwiększyć hello ścieżki AS dla 172.2.0.0/31 w nam wschodnie tak, aby firma Microsoft preferowane obwodu ExpressRoute hello Indie Zachodnie nam na ruch kierowany do tego prefiksu (zgodnie z naszej sieci będą wydaje się, że prefiks toothis ścieżka hello jest krótszy, Indie Zachodnie hello).</span><span class="sxs-lookup"><span data-stu-id="ac5d5-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="ac5d5-158">Podobnie można wydłużyć hello ścieżki AS dla 172.2.0.2/31 Indie Zachodnie nam tak, aby firma Microsoft będzie preferowane hello obwodu usługi expressroute w nam wschodnie.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="ac5d5-159">Routing zostaje zoptymalizowany dla obu biur.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="ac5d5-160">W tym projekcie jeśli jeden obwód usługi ExpressRoute zostanie uszkodzony, usługa Exchange Online może nadal uzyskać dostęp do użytkownika za pośrednictwem innego obwodu usługi ExpressRoute i sieci WAN.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="ac5d5-161">Usuwamy prywatnych numerów hello ścieżki AS dla prefiksów hello ODBIERANE na Peering firmy Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="ac5d5-162">Należy tooappend publicznego jako liczby w hello ścieżki AS tooinfluence routingu dla Peering firmy Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Rozwiązanie przypadku 2 dotyczącego usługi ExpressRoute — używanie dołączania ścieżki AS](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="ac5d5-164">Gdy hello podanych tutaj przykładów dla firmy Microsoft i publicznej komunikacji równorzędnych, firma Microsoft obsługuje hello takie same możliwości dla prywatnej komunikacji równorzędnej hello.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="ac5d5-165">Dołączanie ścieżki AS hello działa także w jeden pojedynczy obwodu ExpressRoute, wybór hello tooinfluence hello ścieżki podstawowego i pomocniczego.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="ac5d5-166">Suboptymalny routing między sieciami wirtualnymi</span><span class="sxs-lookup"><span data-stu-id="ac5d5-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="ac5d5-167">Z usługi ExpressRoute, można włączyć tooVirtual sieci wirtualnej sieci (co jest także znana jako "Sieci wirtualnej") komunikację przez łączenie ich tooan obwodu ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="ac5d5-168">Łącząc je toomultiple obwody usługi ExpressRoute, routing nieoptymalne może nastąpić między hello sieci wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="ac5d5-169">Rozważmy przykład.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-169">Let's consider an example.</span></span> <span data-ttu-id="ac5d5-170">Dostępne są dwa obwody usługi ExpressRoute: jeden w zachodnich stanach USA i jeden we wschodnich stanach USA.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="ac5d5-171">W każdym regionie znajdują się dwie sieci wirtualne.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-171">In each region, you have two VNets.</span></span> <span data-ttu-id="ac5d5-172">Serwerów sieci web są wdrażane w jednej sieci wirtualnej i serwerów aplikacji w hello innych.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="ac5d5-173">W celu zapewnienia nadmiarowości łącze Witaj dwie sieci wirtualne w każdy region tooboth hello lokalnego obwodu usługi expressroute i hello zdalnego obwodu usługi expressroute.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="ac5d5-174">Jak są widoczne poniżej, w każdej sieci wirtualnej istnieją dwie ścieżki toohello innych sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="ac5d5-175">Hello sieci wirtualne nie wiadomo, które obwodu ExpressRoute jest lokalny, a które z nich jest zdalny.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="ac5d5-176">W związku z tym tak samo, jak routingu ruchu między sieciami wirtualnymi saldo tooload równości-koszt-Multi-Path (ECMP), niektóre przepływy ruchu potrwa hello dłuższe ścieżki i pobrać kierowane na powitania zdalnego obwodu ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Przypadek 3 dotyczący usługi ExpressRoute — suboptymalny routing między sieciami wirtualnymi](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="ac5d5-178">Rozwiązanie: przypisywanie połączenia toolocal wysokiej wagi</span><span class="sxs-lookup"><span data-stu-id="ac5d5-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="ac5d5-179">rozwiązanie Hello jest proste.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-179">hello solution is simple.</span></span> <span data-ttu-id="ac5d5-180">Ponieważ wiadomo, gdzie obwody sieci wirtualnych i hello hello są, chcesz nam powiedzieć których ścieżka powinna preferowane każdej sieci wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="ac5d5-181">W szczególności w tym przykładzie należy przypisać wyższe wagi toohello połączenie lokalne niż toohello połączenia zdalnego (Zobacz przykład konfiguracji hello [tutaj](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="ac5d5-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="ac5d5-182">Prefiks hello hello odebrania sieci wirtualnej innych sieci wirtualnej na wiele połączeń go preferowane hello połączenia z hello najwyższej wagi toosend ruch kierowany do tego prefiksu.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Rozwiązanie ExpressRoute przypadku 3 - przypisać wagi wysokiej toolocal połączenia](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="ac5d5-184">Można również wpływ routingu w sieci lokalnej tooyour sieci wirtualnej, jeśli masz wiele obwody usługi ExpressRoute, konfigurując wagi hello połączenia zamiast stosować ścieżki AS dołączanie techniki opisane w hello drugi scenariusz powyżej.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="ac5d5-185">Dla każdego prefiksu zawsze zajmiemy hello wagi połączenia przed hello długość ścieżki AS podczas podejmowania decyzji o sposobie toosend ruchu.</span><span class="sxs-lookup"><span data-stu-id="ac5d5-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
