---
title: "Dane wyjściowe JSON dla usługi Stream Analytics | Dokumentacja firmy Microsoft"
description: "Dowiedz się, jak Stream Analytics można kierować bazy danych rozwiązania Cosmos Azure dla danych wyjściowych JSON archiwizowania danych i zapytania o małych opóźnieniach na dane JSON bez struktury."
keywords: "Dane wyjściowe JSON"
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: cc80b0080c806541362a1ef2d71b95862bd51ca2
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/29/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="5dc4e-104">Docelowej bazy danych rozwiązania Cosmos Azure dla danych wyjściowych JSON z usługi Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="5dc4e-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="5dc4e-105">Analiza strumienia może kierować [bazy danych Azure rozwiązania Cosmos](https://azure.microsoft.com/services/documentdb/) dla danych wyjściowych JSON, włączanie archiwizacji i małych opóźnieniach kwerend danych na dane JSON bez struktury.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="5dc4e-106">W tym dokumencie opisano najważniejsze wskazówki dotyczące implementowania tej konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="5dc4e-107">Dla osób, które znają rozwiązania Cosmos DB, Przyjrzyjmy się [ścieżka szkoleniowa dotycząca usługi Azure rozwiązania Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) rozpocząć pracę.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) to get started.</span></span> 

<span data-ttu-id="5dc4e-108">Uwaga: DB rozwiązania Cosmos oparty na interfejsach API DB Mongo kolekcji nie jest obecnie obsługiwany.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="5dc4e-109">Podstawy DB rozwiązania Cosmos jako miejsce docelowe danych wyjściowych</span><span class="sxs-lookup"><span data-stu-id="5dc4e-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="5dc4e-110">Dane wyjściowe bazy danych Azure rozwiązania Cosmos w Stream Analytics umożliwia zapisywanie strumienia przetwarzanie wyników jako dane wyjściowe JSON do kolekcji z bazy danych rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-110">The Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="5dc4e-111">Analiza strumienia nie powoduje utworzenia kolekcji w bazie danych, zamiast konieczności wyprzedzeniem je utworzyć.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-111">Stream Analytics does not create collections in your database, instead requiring you to create them upfront.</span></span> <span data-ttu-id="5dc4e-112">Jest tak, aby rozliczeń kosztów rozwiązania Cosmos DB kolekcje są niewidoczne dla użytkownika i tak, aby dostroić wydajność, spójność i pojemność kolekcji bezpośrednio za pomocą [rozwiązania Cosmos DB API](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="5dc4e-112">This is so that the billing costs of Cosmos DB collections are transparent to you, and so that you can tune the performance, consistency and capacity of your collections directly using the [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="5dc4e-113">Zalecamy użycie jednej bazy danych DB rozwiązania Cosmos na zadanie przesyłania strumieniowego logicznie Rozdziel kolekcji dla zadania przesyłania strumieniowego.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-113">We recommend using one Cosmos DB Database per streaming job to logically separate your collections for a streaming job.</span></span>

<span data-ttu-id="5dc4e-114">Niektóre opcje kolekcji DB rozwiązania Cosmos są szczegółowo opisane poniżej.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-114">Some of the Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="5dc4e-115">Dostosuj spójności, dostępnością i opóźnieniem</span><span class="sxs-lookup"><span data-stu-id="5dc4e-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="5dc4e-116">Aby była zgodna z wymaganiami aplikacji z DB rozwiązania Cosmos umożliwia prawidłowo dostrajania bazy danych i kolekcji i wprowadzić kompromis między spójności, dostępności i opóźnień.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-116">To match your application requirements, Cosmos DB allows you to fine tune the database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="5dc4e-117">W zależności od tego, jakiego poziomu spójności odczytu potrzeb scenariusz przed zapisu i odczytu opóźnienia, możesz wybrać poziom spójności na konta bazy danych.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="5dc4e-118">Domyślnie DB rozwiązania Cosmos umożliwia również synchroniczne indeksowania na każdej operacji CRUD do kolekcji.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation to your collection.</span></span> <span data-ttu-id="5dc4e-119">To jest inną opcją przydatne do kontrolowania wydajności zapisu/odczytu w bazie danych rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-119">This is another useful option to control the write/read performance in Cosmos DB.</span></span> <span data-ttu-id="5dc4e-120">Aby uzyskać więcej informacji na ten temat, zapoznaj się [Zmień poziomy spójności bazy danych i zapytania](../documentdb/documentdb-consistency-levels.md) artykułu.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-120">For further information on this topic, review the [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="5dc4e-121">Upserts z usługi Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="5dc4e-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="5dc4e-122">Stream Analytics integracji z rozwiązania Cosmos DB umożliwia wstawić lub zaktualizować rekord w kolekcji rozwiązania Cosmos bazy danych na podstawie danego kolumny Identyfikator dokumentu.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-122">Stream Analytics integration with Cosmos DB allows you to insert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="5dc4e-123">To jest również nazywany *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-123">This is also referred to as an *Upsert*.</span></span>

<span data-ttu-id="5dc4e-124">Stream Analytics wykorzystuje optymistycznej podejście Upsert, w której aktualizacje są wykonywane tylko po insert nie powiedzie się z powodu konfliktu identyfikator dokumentu.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due to a Document ID conflict.</span></span> <span data-ttu-id="5dc4e-125">Ta aktualizacja jest wykonywane przez Stream Analytics poprawek, dlatego umożliwia korzystanie z częściowa aktualizacji do dokumentu, tj. dodanie nowych właściwości lub zastąpienie istniejącej właściwości jest wykonywana stopniowo.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates to the document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="5dc4e-126">Należy pamiętać, że zmiany w wartości właściwości tablicy w wyników dokumentu JSON w tablicy całego pobierania zastąpione, tj. tablicy nie są scalane.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-126">Note that changes in the values of array properties in your JSON document result in the entire array getting overwritten, i.e. the array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="5dc4e-127">Partycjonowanie danych w bazie danych rozwiązania Cosmos</span><span class="sxs-lookup"><span data-stu-id="5dc4e-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="5dc4e-128">Rozwiązania cosmos DB [kolekcje partycjonowane](../cosmos-db/partition-data.md) są zalecane podejście do partycjonowania danych.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are the recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="5dc4e-129">Dla jednej kolekcji rozwiązania Cosmos DB Stream Analytics nadal umożliwia partycji danych na podstawie wzorców zapytań i wymagania dotyczące wydajności aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-129">For single Cosmos DB collections, Stream Analytics still allows you to partition your data based on both the query patterns and performance needs of your application.</span></span> <span data-ttu-id="5dc4e-130">Każda kolekcja może zawierać maksymalnie 10GB danych (maksymalnie), a obecnie nie istnieje sposób skalowanie w górę (lub przepełnienie) kolekcji.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-130">Each collection may contain up to 10GB of data (maximum) and currently there is no way to scale up (or overflow) a collection.</span></span> <span data-ttu-id="5dc4e-131">Do skalowania, Stream Analytics umożliwia pisanie w wielu kolekcjach z danego prefiksu (zobacz poniżej szczegóły obciążenia).</span><span class="sxs-lookup"><span data-stu-id="5dc4e-131">For scaling out, Stream Analytics allows you to write to multiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="5dc4e-132">Stream Analytics korzysta z spójne [rozpoznawania partycji skrótu](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategii na podstawie użytkownika podane kolumny PartitionKey do partycjonowania jego rekordów danych wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-132">Stream Analytics uses the consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on the user provided PartitionKey column to partition its output records.</span></span> <span data-ttu-id="5dc4e-133">Liczba kolekcji z danego prefiksu podczas uruchamiania zadania przesyłania strumieniowego jest używany jako dane wyjściowe liczba partycji, do którego zadanie zapisuje równoległe (kolekcje DB rozwiązania Cosmos = partycje dane wyjściowe).</span><span class="sxs-lookup"><span data-stu-id="5dc4e-133">The number of collections with the given prefix at the streaming job’s start time is used as the output partition count, to which the job writes to in parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="5dc4e-134">Dla jednej kolekcji z opóźnieniem indeksowania czynności tylko wstawia, można oczekiwać o 0,4 przepływność zapisu MB/s.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="5dc4e-135">Przy użyciu wielu kolekcji umożliwiają osiągnięcie wyższej przepustowości i zwiększenia pojemności.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-135">Using multiple collections can allow you to achieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="5dc4e-136">Jeśli planujesz zwiększyć liczbę partycji w przyszłości, może być konieczne zatrzymanie zadania, partycje danych z istniejącej kolekcji do nowej kolekcji, a następnie ponownie uruchom zadanie usługi Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-136">If you intend to increase the partition count in the future, you may need to stop your job, repartition the data from your existing collections into new collections and then restart the Stream Analytics job.</span></span> <span data-ttu-id="5dc4e-137">Więcej informacji na temat przy użyciu PartitionResolver i ponownie partycjonowania wraz z przykładowym kodzie będą uwzględniane w kolejnych post.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="5dc4e-138">Artykuł [dzielenia na partycje i skalowania w bazie danych rozwiązania Cosmos](../documentdb/documentdb-partition-data.md) także szczegółowe informacje na ten.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-138">The article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="5dc4e-139">Ustawienia rozwiązania cosmos bazy danych dla danych wyjściowych JSON</span><span class="sxs-lookup"><span data-stu-id="5dc4e-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="5dc4e-140">Tworzenie rozwiązania Cosmos bazy danych jako dane wyjściowe w Stream Analytics generuje monit o podanie informacji, jak pokazano poniżej.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="5dc4e-141">Ta sekcja zawiera wyjaśnienie definicji właściwości.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-141">This section provides an explanation of the properties definition.</span></span>

<span data-ttu-id="5dc4e-142">Kolekcja podzielonym na partycje</span><span class="sxs-lookup"><span data-stu-id="5dc4e-142">Partitioned Collection</span></span> | <span data-ttu-id="5dc4e-143">Wiele kolekcji "Jednej partycji"</span><span class="sxs-lookup"><span data-stu-id="5dc4e-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb stream analytics dane wyjściowe ekranu](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb stream analytics dane wyjściowe ekranu](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="5dc4e-146">**Wielu kolekcji "Jednej partycji"** scenariusz wymaga klucza partycji i konfiguracja jest obsługiwana.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-146">The **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="5dc4e-147">**Dane wyjściowe Alias** — jako alias, aby znaleźć te dane wyjściowe w kwerendzie ASA</span><span class="sxs-lookup"><span data-stu-id="5dc4e-147">**Output Alias** – An alias to refer this output in your ASA query</span></span>  
* <span data-ttu-id="5dc4e-148">**Nazwa konta** — nazwa lub identyfikator URI konta DB rozwiązania Cosmos punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-148">**Account Name** – The name or endpoint URI of the Cosmos DB account.</span></span>  
* <span data-ttu-id="5dc4e-149">**Klucz konta** — współużytkowanego klucza dostępu dla konta DB rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-149">**Account Key** – The shared access key for the Cosmos DB account.</span></span>  
* <span data-ttu-id="5dc4e-150">**Baza danych** — Nazwa bazy danych DB rozwiązania Cosmos.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-150">**Database** – The Cosmos DB database name.</span></span>  
* <span data-ttu-id="5dc4e-151">**Wzorzec nazwy kolekcji** — Nazwa kolekcji lub ich wzorca kolekcji do użycia.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-151">**Collection Name Pattern** – The collection name or their pattern for the collections to be used.</span></span> <span data-ttu-id="5dc4e-152">Format nazw kolekcji można skonstruować przy użyciu tokenu opcjonalne {partition}, gdzie partycje zaczynają się od 0.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-152">The collection name format can be constructed using the optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="5dc4e-153">Poniżej przedstawiono przykładowe prawidłowe wartości wejściowe:</span><span class="sxs-lookup"><span data-stu-id="5dc4e-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="5dc4e-154">1\) MyCollection — jedną kolekcję o nazwie "MyCollection" musi istnieć.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="5dc4e-155">2\) MyCollection {partition} — takie kolekcje muszą istnieć — "MyCollection0", "MyCollection1", "MyCollection2" itd.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="5dc4e-156">**Klucz partycji** — jest to opcjonalne.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="5dc4e-157">Jest to potrzebne tylko, jeśli używasz tokenu {partycjonowania} we wzorcu nazwy Twojej kolekcji.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="5dc4e-158">Nazwa pola w zdarzeniach wyjściowych służąca do określenia klucza do partycjonowania danych wyjściowych na kolekcje.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-158">The name of the field in output events used to specify the key for partitioning output across collections.</span></span> <span data-ttu-id="5dc4e-159">Dla danych wyjściowych jednej kolekcji, wszystkie kolumny wyjściowej dowolnego mogą być używane np. PartitionId.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="5dc4e-160">**Identyfikator dokumentu** — jest to opcjonalne.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-160">**Document ID** – Optional.</span></span> <span data-ttu-id="5dc4e-161">Nazwa pola w zdarzeniach wyjściowych służąca do określenia klucza podstawowego, na które insert lub update bazują operacje.</span><span class="sxs-lookup"><span data-stu-id="5dc4e-161">The name of the field in output events used to specify the primary key on which insert or update operations are based.</span></span>  
