<span data-ttu-id="05386-101">Jeśli maszyna wirtualna na platformie Azure napotkała błąd podczas rozruchu lub błąd dysku, konieczne może wykonanie kroków rozwiązywania problemów na samym wirtualnym dysku twardym.</span><span class="sxs-lookup"><span data-stu-id="05386-101">If your virtual machine (VM) in Azure encounters a boot or disk error, you may need to perform troubleshooting steps on the virtual hard disk itself.</span></span> <span data-ttu-id="05386-102">Typowym przykładem może być niepowodzenie aktualizacji aplikacji, które uniemożliwia pomyślny rozruch maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="05386-102">A common example would be a failed application update that prevents the VM from booting successfully.</span></span> <span data-ttu-id="05386-103">W tym artykule opisano, jak za pomocą witryny Azure Portal połączyć wirtualny dysk twardy z inną maszyną wirtualną w celu naprawienia błędów, a następnie ponownie utworzyć oryginalną maszynę wirtualną.</span><span class="sxs-lookup"><span data-stu-id="05386-103">This article describes how to use Azure portal to connect your virtual hard disk to another VM to fix any errors and then re-create your original VM.</span></span>

## <a name="recovery-process-overview"></a><span data-ttu-id="05386-104">Omówienie procesu odzyskiwania</span><span class="sxs-lookup"><span data-stu-id="05386-104">Recovery process overview</span></span>
<span data-ttu-id="05386-105">Proces rozwiązywania problemów jest następujący:</span><span class="sxs-lookup"><span data-stu-id="05386-105">The troubleshooting process is as follows:</span></span>

1. <span data-ttu-id="05386-106">Usuń maszynę wirtualną, która napotyka problemy, ale zachowaj wirtualne dyski twarde.</span><span class="sxs-lookup"><span data-stu-id="05386-106">Delete the VM that's encountering issues, but retain the virtual hard disks.</span></span>
2. <span data-ttu-id="05386-107">Dołącz i zainstaluj wirtualny dysk twardy do innej maszyny wirtualnej na potrzeby rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="05386-107">Attach and mount the virtual hard disk to another VM for troubleshooting.</span></span>
3. <span data-ttu-id="05386-108">Nawiąż połączenie z maszyną wirtualną rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="05386-108">Connect to the troubleshooting VM.</span></span> <span data-ttu-id="05386-109">Edytuj pliki lub uruchom narzędzia, aby naprawić błędy na oryginalnym wirtualnym dysku twardym.</span><span class="sxs-lookup"><span data-stu-id="05386-109">Edit files or run tools to fix errors on the original virtual hard disk.</span></span>
4. <span data-ttu-id="05386-110">Odłącz wirtualny dysk twardy od maszyny wirtualnej rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="05386-110">Unmount and detach the virtual hard disk from the troubleshooting VM.</span></span>
5. <span data-ttu-id="05386-111">Utwórz maszynę wirtualną za pomocą oryginalnego wirtualnego dysku twardego.</span><span class="sxs-lookup"><span data-stu-id="05386-111">Create a VM by using the original virtual hard disk.</span></span>

## <a name="delete-the-original-vm"></a><span data-ttu-id="05386-112">Usuwanie oryginalnej maszyny wirtualnej</span><span class="sxs-lookup"><span data-stu-id="05386-112">Delete the original VM</span></span>
<span data-ttu-id="05386-113">Wirtualne dyski twarde i maszyny wirtualne to dwa odrębne zasoby na platformie Azure.</span><span class="sxs-lookup"><span data-stu-id="05386-113">Virtual hard disks and VMs are two distinct resources in Azure.</span></span> <span data-ttu-id="05386-114">Wirtualny dysk twardy to miejsce, w którym przechowywany jest system operacyjny, aplikacje i konfiguracje.</span><span class="sxs-lookup"><span data-stu-id="05386-114">A virtual hard disk is where the operating system, applications, and configurations are stored.</span></span> <span data-ttu-id="05386-115">Maszyna wirtualna jest po prostu metadanymi, które definiują rozmiar lub lokalizację i które odwołują się do zasobów, takich jak wirtualny dysk twardy lub wirtualna karta sieciowa.</span><span class="sxs-lookup"><span data-stu-id="05386-115">The VM is just metadata that defines the size or location and that references resources such as a virtual hard disk or virtual network interface card (NIC).</span></span> <span data-ttu-id="05386-116">Każdy wirtualny dysk twardy otrzymuje przypisaną dzierżawę, kiedy jest dołączany do maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="05386-116">Each virtual hard disk gets a lease assigned when that disk is attached to a VM.</span></span> <span data-ttu-id="05386-117">Dyski danych można dołączać i odłączać nawet wtedy, gdy maszyna wirtualna jest uruchomiona, ale dysku systemu operacyjnego nie można odłączyć, chyba że zasób maszyny wirtualnej zostanie usunięty.</span><span class="sxs-lookup"><span data-stu-id="05386-117">Although data disks can be attached and detached even while the VM is running, the OS disk cannot be detached unless the VM resource is deleted.</span></span> <span data-ttu-id="05386-118">Dzierżawa w dalszym ciągu będzie kojarzyła dysk systemu operacyjnego z maszyną wirtualną, nawet gdy ta maszyna wirtualna jest w stanie zatrzymania i ma cofnięty przydział.</span><span class="sxs-lookup"><span data-stu-id="05386-118">The lease continues to associate the OS disk to a VM even when that VM is in a stopped and deallocated state.</span></span>

<span data-ttu-id="05386-119">Pierwszym krokiem do odzyskania maszyny wirtualnej jest usunięcie samego zasobu maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="05386-119">The first step to recovering your VM is to delete the VM resource itself.</span></span> <span data-ttu-id="05386-120">Usunięcie maszyny wirtualnej pozostawia wirtualne dyski twarde na koncie magazynu.</span><span class="sxs-lookup"><span data-stu-id="05386-120">Deleting the VM leaves the virtual hard disks in your storage account.</span></span> <span data-ttu-id="05386-121">Po usunięciu maszyny wirtualnej możesz dołączyć wirtualny dysk twardy do innej maszyny wirtualnej, aby przeprowadzić rozwiązywanie problemów i usunąć błędy.</span><span class="sxs-lookup"><span data-stu-id="05386-121">After the VM is deleted, you can attach the virtual hard disk to another VM to troubleshoot and resolve the errors.</span></span> 

1. <span data-ttu-id="05386-122">Zaloguj się w witrynie [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="05386-122">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="05386-123">W menu po lewej stronie kliknij pozycję **Maszyny wirtualne (klasyczne)**.</span><span class="sxs-lookup"><span data-stu-id="05386-123">On the menu on the left side, click **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="05386-124">Wybierz maszynę wirtualną, której dotyczy problem, kliknij pozycję **Dyski**, a następnie zidentyfikuj nazwę wirtualnego dysku twardego.</span><span class="sxs-lookup"><span data-stu-id="05386-124">Select the VM that has the problem, click **Disks**, and then identify the name of the virtual hard disk.</span></span> 
4. <span data-ttu-id="05386-125">Wybierz wirtualny dysk twardy systemu operacyjnego i sprawdź atrybut **Lokalizacja**, aby zidentyfikować konto magazynu zawierające ten wirtualny dysk twardy.</span><span class="sxs-lookup"><span data-stu-id="05386-125">Select the OS virtual hard disk and check the **Location** to identify the storage account that contains that virtual hard disk.</span></span> <span data-ttu-id="05386-126">W poniższym przykładzie ciąg bezpośrednio przed „.blob.core.windows.net” jest nazwą konta magazynu.</span><span class="sxs-lookup"><span data-stu-id="05386-126">In the following example, the string immediately before ".blob.core.windows.net" is the storage account name.</span></span>

    ```
    https://portalvhds73fmhrw5xkp43.blob.core.windows.net/vhds/SCCM2012-2015-08-28.vhd
    ```

    ![Obraz dotyczący lokalizacji maszyny wirtualnej](./media/virtual-machines-classic-recovery-disks-portal/vm-location.png)

5. <span data-ttu-id="05386-128">Kliknij prawym przyciskiem myszy maszynę wirtualną, a następnie wybierz pozycję **Usuń**.</span><span class="sxs-lookup"><span data-stu-id="05386-128">Right-click the VM and then select **Delete**.</span></span> <span data-ttu-id="05386-129">Upewnij się, że dyski nie są wybrane podczas usuwania maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="05386-129">Make sure that the disks are not selected when you delete the VM.</span></span>
6. <span data-ttu-id="05386-130">Utwórz nową maszynę wirtualną odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="05386-130">Create a new recovery VM.</span></span> <span data-ttu-id="05386-131">Ta maszyna wirtualna musi znajdować w tym samym regionie i grupie zasobów (usłudze w chmurze) co maszyna wirtualna, której dotyczy problem.</span><span class="sxs-lookup"><span data-stu-id="05386-131">This VM must be in the same region and resource group (Cloud Service) as the problem VM.</span></span>
7. <span data-ttu-id="05386-132">Wybierz maszynę wirtualną odzyskiwania, a następnie wybierz pozycje **Dyski** > **Dołącz istniejący**.</span><span class="sxs-lookup"><span data-stu-id="05386-132">Select the recovery VM, and then select **Disks** > **Attach Existing**.</span></span>
8. <span data-ttu-id="05386-133">Aby wybrać istniejący wirtualny dysk twardy, kliknij pozycję **Plik VHD**:</span><span class="sxs-lookup"><span data-stu-id="05386-133">To select your existing virtual hard disk, click **VHD File**:</span></span>

    ![Przeglądnie w poszukiwaniu istniejącego dysku VHD](./media/virtual-machines-classic-recovery-disks-portal/select-vhd-location.png)

9. <span data-ttu-id="05386-135">Wybierz konto magazynu > kontener wirtualnego dysku twardego > wirtualny dysk twardy i kliknij przycisk **Wybierz**, aby potwierdzić wybór.</span><span class="sxs-lookup"><span data-stu-id="05386-135">Select the storage account > VHD container > the virtual hard disk, click the **Select** button to confirm your choice.</span></span>

    ![Wybieranie istniejącego wirtualnego dysku twardego](./media/virtual-machines-classic-recovery-disks-portal/select-vhd.png)

10. <span data-ttu-id="05386-137">Po wybraniu wirtualnego dysku twardego wybierz polecenie **OK**, aby dołączyć istniejący wirtualny dysk twardy.</span><span class="sxs-lookup"><span data-stu-id="05386-137">With your VHD now selected, select **OK** to attach the existing virtual hard disk.</span></span>
11. <span data-ttu-id="05386-138">Po kilku sekundach w okienku **Dyski** dla maszyny wirtualnej zostanie wyświetlony istniejący wirtualny dysk twardy podłączony jako dysk danych:</span><span class="sxs-lookup"><span data-stu-id="05386-138">After a few seconds, the **Disks** pane for your VM will display your existing virtual hard disk connected as a data disk:</span></span>

    ![Istniejący wirtualny dysk twardy dołączony jako dysk danych](./media/virtual-machines-classic-recovery-disks-portal/attached-disk.png)

## <a name="fix-issues-on-the-original-virtual-hard-disk"></a><span data-ttu-id="05386-140">Rozwiązywanie problemów na oryginalnym wirtualnym dysku twardym</span><span class="sxs-lookup"><span data-stu-id="05386-140">Fix issues on the original virtual hard disk</span></span>
<span data-ttu-id="05386-141">Kiedy istniejący wirtualny dysk twardy jest zainstalowany, można wykonać dowolne kroki obsługi i rozwiązywania problemów w zależności od potrzeb.</span><span class="sxs-lookup"><span data-stu-id="05386-141">When the existing virtual hard disk is mounted, you can now perform any maintenance and troubleshooting steps as needed.</span></span> <span data-ttu-id="05386-142">Po usunięciu problemów wykonaj następujące kroki.</span><span class="sxs-lookup"><span data-stu-id="05386-142">Once you have addressed the issues, continue with the following steps.</span></span>

## <a name="unmount-and-detach-the-original-virtual-hard-disk"></a><span data-ttu-id="05386-143">Odinstalowywanie i odłączanie oryginalnego wirtualnego dysku twardego</span><span class="sxs-lookup"><span data-stu-id="05386-143">Unmount and detach the original virtual hard disk</span></span>
<span data-ttu-id="05386-144">Po rozwiązaniu wszystkich problemów i usunięciu błędów odinstaluj i odłącz istniejący wirtualny dysk twardy z rozwiązywania problemów od maszyny wirtualnej rozwiązywania problemów.</span><span class="sxs-lookup"><span data-stu-id="05386-144">Once any errors are resolved, unmount and detach the existing virtual hard disk from your troubleshooting VM.</span></span> <span data-ttu-id="05386-145">Wirtualnego dysku twardego nie można używać razem z innymi maszynami wirtualnymi, dopóki dzierżawa, która dołącza wirtualny dysk twardy do maszyny wirtualnej rozwiązywania problemów, nie zostanie zwolniona.</span><span class="sxs-lookup"><span data-stu-id="05386-145">You cannot use your virtual hard disk together with any other VM until the lease that attaches the virtual hard disk to the troubleshooting VM is released.</span></span>  

1. <span data-ttu-id="05386-146">Zaloguj się w witrynie [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="05386-146">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="05386-147">W menu po lewej stronie wybierz pozycję **Maszyny wirtualne (klasyczne)**.</span><span class="sxs-lookup"><span data-stu-id="05386-147">On the menu on the left side, select **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="05386-148">Zlokalizuj maszynę wirtualną odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="05386-148">Locate the recovery VM.</span></span> <span data-ttu-id="05386-149">Wybierz pozycję Dyski, kliknij prawym przyciskiem myszy dysk, a następnie wybierz polecenie **Odłącz**.</span><span class="sxs-lookup"><span data-stu-id="05386-149">Select Disks, right-click the disk, and then select **Detach**.</span></span>

## <a name="create-a-vm-from-the-original-hard-disk"></a><span data-ttu-id="05386-150">Tworzenie maszyny wirtualnej na podstawie oryginalnego dysku twardego</span><span class="sxs-lookup"><span data-stu-id="05386-150">Create a VM from the original hard disk</span></span>

<span data-ttu-id="05386-151">Aby utworzyć maszynę wirtualną na podstawie oryginalnego dysku twardego, użyj [klasycznej witryny Azure Portal](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="05386-151">To create a VM from your original virtual hard disk, use [Azure classic portal](https://manage.windowsazure.com).</span></span>

1. <span data-ttu-id="05386-152">Zaloguj się do [klasycznej witryny Azure Portal](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="05386-152">Sign into [Azure classic portal](https://manage.windowsazure.com).</span></span>
2. <span data-ttu-id="05386-153">W dolnej części portalu wybierz pozycje **Nowy** > **Obliczeniowe** > **Maszyna wirtualna** > **Z galerii**.</span><span class="sxs-lookup"><span data-stu-id="05386-153">At the bottom of the portal, select **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span>
3. <span data-ttu-id="05386-154">W sekcji **Wybieranie obrazu** wybierz pozycję **Moje dyski**, a następnie wybierz oryginalny wirtualny dysk twardy.</span><span class="sxs-lookup"><span data-stu-id="05386-154">In the **Choose an Image** section, select **My disks**, and then select the original virtual hard disk.</span></span> <span data-ttu-id="05386-155">Sprawdź informacje o lokalizacji.</span><span class="sxs-lookup"><span data-stu-id="05386-155">Check the location information.</span></span> <span data-ttu-id="05386-156">Jest to region, w którym maszyna wirtualna musi zostać wdrożona.</span><span class="sxs-lookup"><span data-stu-id="05386-156">This is the region where the VM must be deployed.</span></span> <span data-ttu-id="05386-157">Kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="05386-157">Select the next button.</span></span>
4. <span data-ttu-id="05386-158">W sekcji **Konfiguracja maszyny wirtualnej** wpisz nazwę maszyny wirtualnej i wybierz rozmiar maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="05386-158">In the **Virtual machine configuration** section, type the VM name and select a size for the VM.</span></span>