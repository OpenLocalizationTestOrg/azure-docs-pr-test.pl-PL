## <a name="prepare-for-akv-integration"></a><span data-ttu-id="90312-101">Przygotowanie do Integracja</span><span class="sxs-lookup"><span data-stu-id="90312-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="90312-102">Integracja magazynu kluczy Azure umożliwia skonfigurowanie maszyną Wirtualną programu SQL Server, istnieje kilka wymagań wstępnych:</span><span class="sxs-lookup"><span data-stu-id="90312-102">To use Azure Key Vault Integration to configure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="90312-103">Instalowanie programu Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="90312-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="90312-104">Tworzenie usługi Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="90312-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="90312-105">Tworzenie magazynu kluczy</span><span class="sxs-lookup"><span data-stu-id="90312-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="90312-106">W poniższych sekcjach opisano te warunki wstępne i informacje, które należy zebrać później uruchomić polecenia cmdlet programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="90312-106">The following sections describe these prerequisites and the information you need to collect to later run the PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="90312-107">Instalowanie programu Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="90312-107">Install Azure PowerShell</span></span>
<span data-ttu-id="90312-108">Upewnij się, że zainstalowano najnowszy zestaw SDK usługi Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="90312-108">Make sure you have installed the latest Azure PowerShell SDK.</span></span> <span data-ttu-id="90312-109">Aby uzyskać więcej informacji, zobacz [Instalowanie i konfigurowanie programu Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="90312-109">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="90312-110">Tworzenie usługi Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="90312-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="90312-111">Najpierw musisz mieć [usługi Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) w ramach subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="90312-111">First, you need to have an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="90312-112">Między wiele korzyści dzięki temu można udzielić uprawnienia do magazynu kluczy dla niektórych użytkowników i aplikacje.</span><span class="sxs-lookup"><span data-stu-id="90312-112">Among many benefits, this allows you to grant permission to your key vault for certain users and applications.</span></span>

<span data-ttu-id="90312-113">Następnie należy zarejestrować aplikację przy użyciu usługi AAD.</span><span class="sxs-lookup"><span data-stu-id="90312-113">Next, register an application with AAD.</span></span> <span data-ttu-id="90312-114">Zapewni to konto nazwy głównej usługi, które ma dostęp do magazynu kluczy, które będą potrzebne maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="90312-114">This will give you a Service Principal account that has access to your key vault which your VM will need.</span></span> <span data-ttu-id="90312-115">W artykule usługi Azure Key Vault możesz znaleźć następujące kroki w [zarejestrować aplikację w usłudze Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) sekcji, lub można zobaczyć kroki z zrzuty ekranu w **uzyskać tożsamości dla sekcji aplikacji**  z [ten wpis w blogu](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="90312-115">In the Azure Key Vault article, you can find these steps in the [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see the steps with screen shots in the **Get an identity for the application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="90312-116">Przed wykonaniem tych kroków, należy pamiętać, że należy zebrać następujące informacje w tej rejestracji, który będzie później potrzebny po włączeniu integracji magazynu kluczy Azure na maszynie Wirtualnej SQL.</span><span class="sxs-lookup"><span data-stu-id="90312-116">Before completing these steps, note that you need to collect the following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="90312-117">Po dodaniu aplikacji Znajdź **identyfikator klienta** na **Konfiguruj** kartę.</span><span class="sxs-lookup"><span data-stu-id="90312-117">After the application is added, find the **CLIENT ID**  on the **CONFIGURE** tab.</span></span> 
    <span data-ttu-id="90312-118">![Identyfikator klienta usługi Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="90312-118">![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="90312-119">Identyfikator klienta jest przypisany później do **$spName** parametr (nazwę główną usługi) w skrypt programu PowerShell, aby włączyć integracji magazynu kluczy Azure.</span><span class="sxs-lookup"><span data-stu-id="90312-119">The client ID is assigned later to the **$spName** (Service Principal name) parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="90312-120">Ponadto podczas tych czynności podczas tworzenia klucza, skopiować klucza tajnego klucza pokazany na poniższym zrzucie ekranu.</span><span class="sxs-lookup"><span data-stu-id="90312-120">Also, during these steps when you create your key, copy the secret for your key as is shown in the following screenshot.</span></span> <span data-ttu-id="90312-121">Przypisano później do tego klucza klucz tajny **$spSecret** parametr (klucz tajny nazwy głównej usługi) w skrypcie programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="90312-121">This key secret is assigned later to the **$spSecret** (Service Principal secret) parameter in the PowerShell script.</span></span>  
    <span data-ttu-id="90312-122">![Klucz tajny usługi Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="90312-122">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="90312-123">Musisz autoryzować tego nowego Identyfikatora klienta, są następujące uprawnienia dostępu: **szyfrowania**, **odszyfrować**, **wrapKey**, **unwrapKey**, **znak**, i **Sprawdź**.</span><span class="sxs-lookup"><span data-stu-id="90312-123">You must authorize this new client ID to have the following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="90312-124">Jest to zrobić za pomocą [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) polecenia cmdlet.</span><span class="sxs-lookup"><span data-stu-id="90312-124">This is done with the [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="90312-125">Aby uzyskać więcej informacji, zobacz [zezwolić aplikacji na używanie klucza lub klucza tajnego](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="90312-125">For more information see [Authorize the application to use the key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="90312-126">Tworzenie magazynu kluczy</span><span class="sxs-lookup"><span data-stu-id="90312-126">Create a key vault</span></span>
<span data-ttu-id="90312-127">Aby można było używać usługi Azure Key Vault do przechowywania kluczy, który będzie używany do szyfrowania maszyny Wirtualnej, potrzebujesz dostępu do magazynu kluczy.</span><span class="sxs-lookup"><span data-stu-id="90312-127">In order to use Azure Key Vault to store the keys you will use for encryption in your VM, you need access to a key vault.</span></span> <span data-ttu-id="90312-128">Jeśli magazynu kluczy nie zostały już skonfigurowane, utwórz go, wykonując kroki opisane w [wprowadzenie do korzystania z usługi Azure Key Vault](../articles/key-vault/key-vault-get-started.md) tematu.</span><span class="sxs-lookup"><span data-stu-id="90312-128">If you have not already set up your key vault, create one by following the steps in the [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="90312-129">Przed wykonaniem tych kroków, należy pamiętać, że jest pewne informacje, które należy zebrać podczas tego — konfiguracja który będzie później potrzebny po włączeniu integracji magazynu kluczy Azure na maszynie Wirtualnej SQL.</span><span class="sxs-lookup"><span data-stu-id="90312-129">Before completing these steps, note that there is some information you need to collect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="90312-130">Po wyświetleniu okna Tworzenie krok magazynu kluczy, należy pamiętać, zwracana **vaultUri** właściwość, która jest adres URL magazynu kluczy.</span><span class="sxs-lookup"><span data-stu-id="90312-130">When you get to the Create a key vault step, note the returned **vaultUri** property, which is the key vault URL.</span></span> <span data-ttu-id="90312-131">W przykładzie przedstawionym w tym kroku przedstawiony poniżej, nazwa magazynu kluczy jest ContosoKeyVault w związku z tym adresem URL magazynu kluczy będzie https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="90312-131">In the example provided in that step, shown below, the key vault name is ContosoKeyVault, therefore the key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="90312-132">Adres URL magazynu kluczy jest przypisany później do **$akvURL** parametru w skrypt programu PowerShell, aby włączyć integracji magazynu kluczy Azure.</span><span class="sxs-lookup"><span data-stu-id="90312-132">The key vault URL is assigned later to the **$akvURL** parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span>

