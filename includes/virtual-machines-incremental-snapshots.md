# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="7c986-101">Tworzenie kopii zapasowej Azure niezarządzane dysków maszyny Wirtualnej z migawkami przyrostowe</span><span class="sxs-lookup"><span data-stu-id="7c986-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="7c986-102">Omówienie</span><span class="sxs-lookup"><span data-stu-id="7c986-102">Overview</span></span>
<span data-ttu-id="7c986-103">Magazyn Azure oferuje możliwość migawek obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-103">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="7c986-104">Migawki przechwytywania stanu obiektu blob w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="7c986-104">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="7c986-105">W tym artykule opisano scenariusz, w którym można zachować kopie zapasowe przy użyciu migawek dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7c986-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="7c986-106">Można użyć tej metody, gdy nie chcesz używać usługi Kopia zapasowa Azure i usługą odzyskiwania i chcesz utworzyć niestandardowe strategii tworzenia kopii zapasowych dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7c986-106">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="7c986-107">Dyski maszyny wirtualnej platformy Azure są przechowywane jako stronicowe obiekty BLOB w usłudze Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="7c986-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="7c986-108">Ponieważ firma Microsoft zawierająca opis strategii tworzenia kopii zapasowych dysków maszyny wirtualnej w tym artykule, zwane migawek w kontekście stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer to snapshots in the context of page blobs.</span></span> <span data-ttu-id="7c986-109">Aby dowiedzieć się więcej na temat migawek, zobacz [tworzenia migawki obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="7c986-109">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="7c986-110">Co to jest migawkę?</span><span class="sxs-lookup"><span data-stu-id="7c986-110">What is a snapshot?</span></span>
<span data-ttu-id="7c986-111">Migawki obiektu blob jest tylko do odczytu wersji obiektu blob przechwyconych w punkcie w czasie.</span><span class="sxs-lookup"><span data-stu-id="7c986-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="7c986-112">Po utworzeniu migawki, to można można odczytać, kopiowane, lub usunięte, ale nie został zmodyfikowany.</span><span class="sxs-lookup"><span data-stu-id="7c986-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="7c986-113">Migawki umożliwiają tworzenie kopii zapasowej obiektu blob, pojawiającą się w chwili.</span><span class="sxs-lookup"><span data-stu-id="7c986-113">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="7c986-114">Do POZOSTAŁEJ wersji 2015-04-05 masz możliwość kopiowania pełnej migawki.</span><span class="sxs-lookup"><span data-stu-id="7c986-114">Until REST version 2015-04-05, you had the ability to copy full snapshots.</span></span> <span data-ttu-id="7c986-115">Z resztą wersji 2015-07-08 i powyżej, możesz również skopiować przyrostowe migawki.</span><span class="sxs-lookup"><span data-stu-id="7c986-115">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="7c986-116">Pełna migawka kopii</span><span class="sxs-lookup"><span data-stu-id="7c986-116">Full snapshot copy</span></span>
<span data-ttu-id="7c986-117">Migawki można skopiować do innego konta magazynu jako obiekt blob przechowywania kopii zapasowych podstawowego obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-117">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="7c986-118">Można również skopiować migawki za pośrednictwem jego podstawowego obiektu blob, czyli jak przywracanie obiektu blob do wcześniejszej wersji.</span><span class="sxs-lookup"><span data-stu-id="7c986-118">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="7c986-119">Po skopiowaniu migawki z jednego konta magazynu do innego zajmuje to samo miejsce jako podstawowy stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-119">When a snapshot is copied from one storage account to another, it occupies the same space as the base page blob.</span></span> <span data-ttu-id="7c986-120">W związku z tym kopiowania całego migawki z jednego konta magazynu do innego działa wolno i zużywa dużo miejsce docelowe konto magazynu.</span><span class="sxs-lookup"><span data-stu-id="7c986-120">Therefore, copying whole snapshots from one storage account to another is slow and consumes much space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="7c986-121">Po skopiowaniu podstawowego obiektu blob do innej lokalizacji docelowej migawki obiektu blob nie są kopiowane razem z nim.</span><span class="sxs-lookup"><span data-stu-id="7c986-121">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="7c986-122">Podobnie w przypadku zastąpienia podstawowego obiektu blob z kopią, migawki skojarzone z podstawowego obiektu blob nie dotyczy, a pozostać bez zmian w obszarze nazwy podstawowe obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under the base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="7c986-123">Wykonywanie kopii zapasowych dysków przy użyciu migawek</span><span class="sxs-lookup"><span data-stu-id="7c986-123">Back up disks using snapshots</span></span>
<span data-ttu-id="7c986-124">Jako strategii tworzenia kopii zapasowych dysków maszyny wirtualnej, można wykonać okresowe migawki obiektu blob dysku lub strony i kopiowania do magazynu innego konta przy użyciu narzędzi, takich jak [kopiowania obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operacji lub [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="7c986-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="7c986-125">Migawki można kopiować do obiektu blob strony docelowy o innej nazwie.</span><span class="sxs-lookup"><span data-stu-id="7c986-125">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="7c986-126">Wynikowa stronicowych obiektów blob docelowym jest zapisywalny stronicowy obiekt blob i nie migawki.</span><span class="sxs-lookup"><span data-stu-id="7c986-126">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="7c986-127">Później w tym artykule opisano kroki, aby korzystać z kopii zapasowych przy użyciu migawek dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7c986-127">Later in this article, we describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="7c986-128">Przywracanie dysków za pomocą migawek</span><span class="sxs-lookup"><span data-stu-id="7c986-128">Restore disks using snapshots</span></span>
<span data-ttu-id="7c986-129">Gdy nadejdzie czas, aby przywrócić stabilną wersję przechwyconych wcześniej w jednym z migawek kopii zapasowych na dysku, możesz skopiować migawki za pośrednictwem obiektu blob strony podstawowej.</span><span class="sxs-lookup"><span data-stu-id="7c986-129">When it is time to restore your disk to a stable version that was previously captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="7c986-130">Po migawki jest podwyższany do strony podstawowej obiektu blob, pozostaje migawki, ale jego źródło jest zastępowany kopii, którą można zarówno Odczyt i zapis.</span><span class="sxs-lookup"><span data-stu-id="7c986-130">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="7c986-131">W tym artykule opisano kroki, aby przywrócić poprzednią wersję dysku z jej migawek.</span><span class="sxs-lookup"><span data-stu-id="7c986-131">Later in this article we describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="7c986-132">Implementowanie pełna migawka kopii</span><span class="sxs-lookup"><span data-stu-id="7c986-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="7c986-133">Można zaimplementować kopii pełna migawka, wykonując następujące polecenie,</span><span class="sxs-lookup"><span data-stu-id="7c986-133">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="7c986-134">Najpierw Utwórz migawkę przy użyciu podstawowego obiektu blob [migawki obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operacji.</span><span class="sxs-lookup"><span data-stu-id="7c986-134">First, take a snapshot of the base blob using the [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="7c986-135">Następnie skopiuj do docelowego magazynu konta za pomocą migawki [kopiowania obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="7c986-135">Then, copy the snapshot to a target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="7c986-136">Powtórz ten proces do obsługi kopii zapasowych z podstawowego obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-136">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="7c986-137">Kopiuj przyrostowe migawki</span><span class="sxs-lookup"><span data-stu-id="7c986-137">Incremental snapshot copy</span></span>
<span data-ttu-id="7c986-138">Nową funkcją w [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) interfejs API udostępnia znacznie poprawia sposobem wykonania kopii zapasowej migawki stronicowych obiektów blob lub dysków.</span><span class="sxs-lookup"><span data-stu-id="7c986-138">The new feature in the [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="7c986-139">Interfejsu API zwraca listę zmian podstawowego obiektu blob i migawki, co zmniejsza ilość miejsca używanego na konto kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="7c986-139">The API returns the list of changes between the base blob and the snapshots, which reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="7c986-140">Interfejs API obsługuje stronicowych obiektów blob na magazyn w warstwie Premium, a także magazynu w warstwie standardowa.</span><span class="sxs-lookup"><span data-stu-id="7c986-140">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="7c986-141">Przy użyciu tego interfejsu API, można budować szybszych i bardziej wydajnych rozwiązań kopii zapasowej dla maszyn wirtualnych platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="7c986-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="7c986-142">Ten interfejs API będą dostępne w używanej wersji REST 2015-07-08 i wyższych.</span><span class="sxs-lookup"><span data-stu-id="7c986-142">This API will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="7c986-143">Przyrostowa kopia migawki umożliwia kopiowanie z jednego konta magazynu do innego różnicy między,</span><span class="sxs-lookup"><span data-stu-id="7c986-143">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="7c986-144">Podstawowy obiektów blob i jego migawki lub</span><span class="sxs-lookup"><span data-stu-id="7c986-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="7c986-145">Wszystkie migawki dwa podstawowe obiektu blob</span><span class="sxs-lookup"><span data-stu-id="7c986-145">Any two snapshots of the base blob</span></span>

<span data-ttu-id="7c986-146">Pod warunkiem, że są spełnione następujące warunki,</span><span class="sxs-lookup"><span data-stu-id="7c986-146">Provided the following conditions are met,</span></span>

* <span data-ttu-id="7c986-147">Obiekt blob utworzono Jan-1-2016 lub nowszy.</span><span class="sxs-lookup"><span data-stu-id="7c986-147">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="7c986-148">Obiekt blob nie zostało zastąpione [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) lub [kopiowania obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) między dwiema migawkami.</span><span class="sxs-lookup"><span data-stu-id="7c986-148">The blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="7c986-149">**Uwaga**: Ta funkcja jest dostępna dla Premium i standardowa Azure stronicowe obiekty BLOB.</span><span class="sxs-lookup"><span data-stu-id="7c986-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="7c986-150">Jeśli masz niestandardowe strategii tworzenia kopii zapasowej przy użyciu migawek Kopiowanie migawki z jednego konta magazynu do innego mogą być powolne i mogą zużywać dużą ilość miejsca do magazynowania.</span><span class="sxs-lookup"><span data-stu-id="7c986-150">When you have a custom backup strategy using snapshots, copying the snapshots from one storage account to another can be slow and can consume much storage space.</span></span> <span data-ttu-id="7c986-151">Zamiast kopiować całe migawki na konto magazynu kopii zapasowej, można napisać różnica między kolejnych migawki kopii zapasowej stronicowy obiekt blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-151">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="7c986-152">W ten sposób znacznie zmniejszyć czas kopiowania i miejsca do przechowywania kopii zapasowych.</span><span class="sxs-lookup"><span data-stu-id="7c986-152">This way, the time to copy and the space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="7c986-153">Implementowanie kopiowania przyrostowe migawki</span><span class="sxs-lookup"><span data-stu-id="7c986-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="7c986-154">Wykonaj następujące czynności, można zaimplementować przyrostowe migawki kopii</span><span class="sxs-lookup"><span data-stu-id="7c986-154">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="7c986-155">Utwórz migawkę przy użyciu podstawowego obiektu blob [migawki obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="7c986-155">Take a snapshot of the base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="7c986-156">Skopiuj do docelowego magazynu kopii zapasowej konta przy użyciu migawki [kopiowania obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="7c986-156">Copy the snapshot to the target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="7c986-157">To jest kopia zapasowa stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-157">This is the backup page blob.</span></span> <span data-ttu-id="7c986-158">Utworzenie migawki kopii zapasowej stronicowych obiektów blob i zapisze go w kopii zapasowej konta.</span><span class="sxs-lookup"><span data-stu-id="7c986-158">Take a snapshot of the backup page blob and store it in the backup account.</span></span>
* <span data-ttu-id="7c986-159">Utwórz kolejną migawkę podstawowej za pomocą obiektu Blob migawki obiektu blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-159">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="7c986-160">Pobierz różnica między pierwszym i drugim migawki za pomocą podstawowego obiektu blob [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="7c986-160">Get the difference between the first and second snapshots of the base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="7c986-161">Użyj nowego parametru **prevsnapshot**, aby określić wartość DateTime w celu uzyskania różnica w stosunku do migawki.</span><span class="sxs-lookup"><span data-stu-id="7c986-161">Use the new parameter **prevsnapshot**, to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="7c986-162">Jeśli ten parametr jest obecny, odpowiedź REST zawiera tylko stron, które zostały zmienione między migawki docelowej i poprzednią migawkę tym wyczyść strony.</span><span class="sxs-lookup"><span data-stu-id="7c986-162">When this parameter is present, the REST response includes only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="7c986-163">Użyj [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) Aby zastosować te zmiany do tworzenia kopii zapasowej stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="7c986-164">Na koniec Utwórz migawkę kopii zapasowej stronicowych obiektów blob i zapisze go na koncie magazynu kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="7c986-164">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="7c986-165">W następnej sekcji zostaną przedstawione szczegółowo w sposób umożliwiający obsługę kopii zapasowych dysków przy użyciu przyrostowej migawki kopii</span><span class="sxs-lookup"><span data-stu-id="7c986-165">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="7c986-166">Scenariusz</span><span class="sxs-lookup"><span data-stu-id="7c986-166">Scenario</span></span>
<span data-ttu-id="7c986-167">W tej sekcji opisano scenariusz, który obejmuje niestandardowych strategii tworzenia kopii zapasowej przy użyciu migawek dysków maszyny wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7c986-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="7c986-168">Rozważ premium magazynu P30 dysku maszyny Wirtualnej Azure serii DS.</span><span class="sxs-lookup"><span data-stu-id="7c986-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="7c986-169">Dysk P30 nazywany *mypremiumdisk* są przechowywane na koncie magazynu premium o nazwie *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-169">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="7c986-170">Konto magazynu w warstwie standardowa nazywane *mybackupstdaccount* służy do przechowywania kopii zapasowej *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="7c986-170">A standard storage account called *mybackupstdaccount* is used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="7c986-171">Chcemy zachować migawkę *mypremiumdisk* co 12 godzin.</span><span class="sxs-lookup"><span data-stu-id="7c986-171">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="7c986-172">Aby dowiedzieć się więcej o tworzeniu konta magazynu i dyski, zapoznaj się [kont magazynu Azure o](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="7c986-172">To learn about creating storage account and disks, refer to [About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="7c986-173">Aby dowiedzieć się więcej o tworzeniu kopii zapasowych maszyn wirtualnych platformy Azure, zapoznaj się [kopii zapasowych maszyny Wirtualnej Azure Planowanie](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="7c986-173">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="7c986-174">Kroki do obsługi kopii zapasowych na dysku za pomocą przyrostowej migawki</span><span class="sxs-lookup"><span data-stu-id="7c986-174">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="7c986-175">W poniższych krokach opisano sposób migawek *mypremiumdisk* i obsługa kopii zapasowych w *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-175">The following steps describe how to take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="7c986-176">Kopia zapasowa jest standardowe stronicowy obiekt blob o nazwie *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="7c986-176">The backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="7c986-177">W obiekcie blob kopii zapasowej strony zawsze odzwierciedla jako ostatnia migawka z takim samym stanie *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="7c986-177">The backup page blob always reflects the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="7c986-178">Utworzenie obiektu blob strony tworzenia kopii zapasowej dla dysku magazynu premium, wykonując migawkę *mypremiumdisk* o nazwie *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="7c986-178">Create the backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="7c986-179">Skopiuj tę migawkę do mybackupstdaccount jako stronicowy obiekt blob o nazwie *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="7c986-179">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="7c986-180">Utwórz migawkę *mybackupstdpageblob* o nazwie *mybackupstdpageblob_ss1*za pomocą [migawki obiektu Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) i zapisze go w *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="7c986-181">Podczas tworzenia kopii zapasowych, Utwórz kolejną migawkę z *mypremiumdisk*, powiedz *mypremiumdisk_ss2*i zapisz go w *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-181">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="7c986-182">Pobierz zmiany przyrostowe między dwiema migawkami *mypremiumdisk_ss2* i *mypremiumdisk_ss1*za pomocą [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) na *mypremiumdisk_ ss2* z **prevsnapshot** parametr wartość sygnatury czasowej *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="7c986-182">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with the **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="7c986-183">Zapisać te zmiany przyrostowe do tworzenia kopii zapasowej stronicowych obiektów blob *mybackupstdpageblob* w *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-183">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="7c986-184">W przypadku usunięto zakresów w przyrostowe zmiany, muszą zostać wyczyszczone z kopii zapasowej stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-184">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="7c986-185">Użyj [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) zapisanie zmian przyrostowych kopii zapasowych stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="7c986-186">Utwórz migawkę kopii zapasowej stronicowych obiektów blob *mybackupstdpageblob*o nazwie *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="7c986-186">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="7c986-187">Usunąć poprzednią migawkę *mypremiumdisk_ss1* z konta magazynu premium.</span><span class="sxs-lookup"><span data-stu-id="7c986-187">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="7c986-188">Powtórz kroki 4 – 6 co okna kopii zapasowej.</span><span class="sxs-lookup"><span data-stu-id="7c986-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="7c986-189">W ten sposób można zachować kopie zapasowe *mypremiumdisk* w ramach konta magazynu w warstwie standardowa.</span><span class="sxs-lookup"><span data-stu-id="7c986-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Tworzenie kopii zapasowej dysku przy użyciu przyrostowej migawki](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="7c986-191">Kroki w celu przywrócenia dysku z migawki</span><span class="sxs-lookup"><span data-stu-id="7c986-191">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="7c986-192">W poniższych krokach opisano sposób przywracania dysku premium *mypremiumdisk* do wcześniejszej migawki z konta magazynu kopii zapasowej *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-192">The following steps, describe how to restore the premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="7c986-193">Identyfikowania punktu w czasie, który chcesz przywrócić dysku premium.</span><span class="sxs-lookup"><span data-stu-id="7c986-193">Identify the point in time that you wish to restore the premium disk to.</span></span> <span data-ttu-id="7c986-194">Załóżmy, że jest ona migawki *mybackupstdpageblob_ss2*, który jest przechowywany na koncie magazynu kopii zapasowej *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="7c986-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="7c986-195">W mybackupstdaccount, podwyższyć poziom migawki *mybackupstdpageblob_ss2* jako nowego obiektu blob strony podstawowej kopii zapasowej *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="7c986-195">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="7c986-196">Utworzenie migawki tej przywróconej kopii zapasowej stronicowych obiektów blob, nazywany *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="7c986-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="7c986-197">Skopiuj przywróconej stronicowych obiektów blob *mybackupstdpageblobrestored* z *mybackupstdaccount* do *mypremiumaccount* jako nowego dysku premium *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="7c986-197">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="7c986-198">Utwórz migawkę *mypremiumdiskrestored*o nazwie *mypremiumdiskrestored_ss1* dokonywania przyszłych przyrostowych kopii zapasowych.</span><span class="sxs-lookup"><span data-stu-id="7c986-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="7c986-199">Wskaż serii DS maszyny Wirtualnej przywróconej dysku *mypremiumdiskrestored* i odłączania stary *mypremiumdisk* z maszyny Wirtualnej.</span><span class="sxs-lookup"><span data-stu-id="7c986-199">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="7c986-200">Rozpocznij proces kopii zapasowej opisanych w poprzedniej sekcji przywróconej dysku *mypremiumdiskrestored*za pomocą *mybackupstdpageblobrestored* jako kopii zapasowej stronicowych obiektów blob.</span><span class="sxs-lookup"><span data-stu-id="7c986-200">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Przywracanie z migawki dysku](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="7c986-202">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="7c986-202">Next Steps</span></span>
<span data-ttu-id="7c986-203">Skorzystaj z poniższych linków, aby dowiedzieć się więcej na temat tworzenia migawki obiektu blob i planowania infrastruktury kopii zapasowych maszyn wirtualnych.</span><span class="sxs-lookup"><span data-stu-id="7c986-203">Use the following links to learn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="7c986-204">Utworzenie migawki obiektu Blob</span><span class="sxs-lookup"><span data-stu-id="7c986-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="7c986-205">Zaplanuj infrastrukturę kopii zapasowej maszyny Wirtualnej</span><span class="sxs-lookup"><span data-stu-id="7c986-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

